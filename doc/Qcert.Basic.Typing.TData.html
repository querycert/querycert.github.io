
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Module Qcert.Basic.Typing.TData</title>
<meta name="description" content="Documentation of Coq module Qcert.Basic.Typing.TData" />
<link href="coq2html.css" rel="stylesheet" type="text/css" />
<script type="text/javascript" src="coq2html.js"> </script>
</head>

<body onload="hideAll('proofscript')">
<h1 class="title">Module Qcert.Basic.Typing.TData</h1>
<div class="coq">
<br/>
<span class="kwd">Section</span> <span class="id">TData</span>.<br/>
&nbsp;&nbsp;<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id">String</span>.<br/>
&nbsp;&nbsp;<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id">List</span>.<br/>
&nbsp;&nbsp;<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id">Sumbool</span>.<br/>
&nbsp;&nbsp;<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id">Arith</span>.<br/>
&nbsp;&nbsp;<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id">Bool</span>.<br/>
&nbsp;&nbsp;<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id">Morphisms</span>.<br/>
&nbsp;&nbsp;<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id">Basics</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id">BrandRelation</span>.<br/>
&nbsp;&nbsp;<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id">Utils</span> <span class="kwd">Types</span> <span class="id">BasicRuntime</span>.<br/>
&nbsp;&nbsp;<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id">ForeignDataTyping</span>.<br/>
<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Context</span> {<span class="id">fdata</span>:<span class="id">foreign_data</span>}.<br/>
&nbsp;&nbsp;<span class="kwd">Context</span> {<span class="id">ftype</span>:<span class="id">foreign_type</span>}.<br/>
&nbsp;&nbsp;<span class="kwd">Context</span> {<span class="id">fdtyping</span>:<span class="id">foreign_data_typing</span>}.<br/>
&nbsp;&nbsp;<span class="kwd">Context</span> {<span class="id">m</span>:<span class="id">brand_model</span>}.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id">Rrec</span> (<span class="id">r1</span> <span class="id">r2</span>:(<span class="id">string</span>*<span class="id">data</span>)) :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ODT_lt_dec</span> (<span class="id">fst</span> <span class="id">r1</span>) (<span class="id">fst</span> <span class="id">r2</span>).<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Inductive</span> <span class="id">data_type</span> : <span class="id">data</span> -&gt; <span class="id">rtype</span> -&gt; <span class="kwd">Prop</span> :=<br/>
&nbsp;&nbsp;| <span class="id">dttop</span> <span class="id">d</span> : <span class="id">data_normalized</span> <span class="id">brand_relation_brands</span> <span class="id">d</span> -&gt; <span class="id">data_type</span> <span class="id">d</span> <span class="id">Top</span><br/>
&nbsp;&nbsp;| <span class="id">dtunit</span> : <span class="id">data_type</span> <span class="id">dunit</span> <span class="id">Unit</span><br/>
&nbsp;&nbsp;| <span class="id">dtnat</span> <span class="id">n</span> : <span class="id">data_type</span> (<span class="id">dnat</span> <span class="id">n</span>) <span class="id">Nat</span><br/>
&nbsp;&nbsp;| <span class="id">dtbool</span> <span class="id">b</span> : <span class="id">data_type</span> (<span class="id">dbool</span> <span class="id">b</span>) <span class="id">Bool</span><br/>
&nbsp;&nbsp;| <span class="id">dtstring</span> <span class="id">s</span> : <span class="id">data_type</span> (<span class="id">dstring</span> <span class="id">s</span>) <span class="id">String</span>               <br/>
&nbsp;&nbsp;| <span class="id">dtcoll</span> <span class="id">dl</span> <span class="id">r</span> : <span class="id">Forall</span> (<span class="kwd">fun</span> <span class="id">d</span> =&gt; <span class="id">data_type</span> <span class="id">d</span> <span class="id">r</span>) <span class="id">dl</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">data_type</span> (<span class="id">dcoll</span> <span class="id">dl</span>) (<span class="id">Coll</span> <span class="id">r</span>)<br/>
&nbsp;&nbsp;| <span class="id">dtrec</span> <span class="id">k</span> <span class="id">dl</span> <span class="id">rl</span> <span class="id">rl_sub</span> <span class="id">pf</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">pf</span>':<span class="id">is_list_sorted</span> <span class="id">ODT_lt_dec</span> (<span class="id">domain</span> <span class="id">rl</span>) = <span class="id">true</span>) :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">sublist</span> <span class="id">rl_sub</span> <span class="id">rl</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">k</span> = <span class="id">Closed</span> -&gt; <span class="id">rl_sub</span> = <span class="id">rl</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Forall2</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">fun</span> <span class="id">d</span> <span class="id">r</span> =&gt; (<span class="id">fst</span> <span class="id">d</span>) = (<span class="id">fst</span> <span class="id">r</span>) /\ <span class="id">data_type</span> (<span class="id">snd</span> <span class="id">d</span>) (<span class="id">snd</span> <span class="id">r</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">dl</span> <span class="id">rl</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">data_type</span> (<span class="id">drec</span> <span class="id">dl</span>) (<span class="id">Rec</span> <span class="id">k</span> <span class="id">rl_sub</span> <span class="id">pf</span>)<br/>
&nbsp;&nbsp;| <span class="id">dtleft</span> {<span class="id">d</span> τ<span class="id">l</span>} τ<span class="id">r</span> : <span class="id">data_type</span> <span class="id">d</span> τ<span class="id">l</span> -&gt; <span class="id">data_type</span> (<span class="id">dleft</span> <span class="id">d</span>) (<span class="id">Either</span> τ<span class="id">l</span> τ<span class="id">r</span>)<br/>
&nbsp;&nbsp;| <span class="id">dtright</span> {<span class="id">d</span>} τ<span class="id">l</span> {τ<span class="id">r</span>} : <span class="id">data_type</span> <span class="id">d</span> τ<span class="id">r</span> -&gt; <span class="id">data_type</span> (<span class="id">dright</span> <span class="id">d</span>) (<span class="id">Either</span> τ<span class="id">l</span> τ<span class="id">r</span>)<br/>
&nbsp;&nbsp;| <span class="id">dtbrand</span> <span class="id">b</span> <span class="id">b</span>' <span class="id">d</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">is_canon_brands</span> <span class="id">brand_relation_brands</span> <span class="id">b</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">data_normalized</span> <span class="id">brand_relation_brands</span> <span class="id">d</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Forall</span> (<span class="kwd">fun</span> <span class="id">bb</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> τ, <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">lookup</span> <span class="id">string_dec</span> <span class="id">brand_context_types</span> <span class="id">bb</span> = <span class="id">Some</span> τ -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">data_type</span> <span class="id">d</span> τ<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;) <span class="id">b</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">b</span> ≤ <span class="id">b</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">data_type</span> (<span class="id">dbrand</span> <span class="id">b</span> <span class="id">d</span>) (<span class="id">Brand</span> <span class="id">b</span>')<br/>
&nbsp;&nbsp;| <span class="id">dtforeign</span> {<span class="id">fd</span> <span class="id">f</span>τ} :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">foreign_data_typing_has_type</span> <span class="id">fd</span> <span class="id">f</span>τ -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">data_type</span> (<span class="id">dforeign</span> <span class="id">fd</span>) (<span class="id">Foreign</span> <span class="id">f</span>τ)<br/>
&nbsp;&nbsp;.<br/>
&nbsp;&nbsp;<br/>
&nbsp;&nbsp;<span class="kwd">Notation</span> "<span class="id">d</span> ▹ <span class="id">r</span>" := (<span class="id">data_type</span> <span class="id">d</span> <span class="id">r</span>) (<span class="tactic">at</span> <span class="id">level</span> 70). <br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Section</span> <span class="id">opt</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">dtsome</span> {<span class="id">d</span> τ} :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">data_type</span> <span class="id">d</span> τ -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">data_type</span> (<span class="id">dsome</span> <span class="id">d</span>) (<span class="id">Option</span> τ).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof1341')">Proof.</div>
<div class="proofscript" id="proof1341">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>; <span class="tactic">eapply</span> <span class="id">dtleft</span>; <span class="tactic">trivial</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">dtnone</span> τ :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">data_type</span> <span class="id">dnone</span> (<span class="id">Option</span> τ).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof1342')">Proof.</div>
<div class="proofscript" id="proof1342">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>; <span class="tactic">eapply</span> <span class="id">dtright</span>; <span class="id">econstructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">dtsome_inv</span> {<span class="id">d</span> τ} :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">data_type</span> (<span class="id">dsome</span> <span class="id">d</span>) (<span class="id">Option</span> τ) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">data_type</span> <span class="id">d</span> τ.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof1343')">Proof.</div>
<div class="proofscript" id="proof1343">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> 1; <span class="id">rtype_equalizer</span>. <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">trivial</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">End</span> <span class="id">opt</span>.<br/>
&nbsp;&nbsp;<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">dtrec_closed_inv</span> {<span class="id">dl</span> <span class="id">rl</span> <span class="id">pf</span>} :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">data_type</span> (<span class="id">drec</span> <span class="id">dl</span>) (<span class="id">Rec</span> <span class="id">Closed</span> <span class="id">rl</span> <span class="id">pf</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Forall2</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">fun</span> <span class="id">d</span> <span class="id">r</span> =&gt; (<span class="id">fst</span> <span class="id">d</span>) = (<span class="id">fst</span> <span class="id">r</span>) /\ <span class="id">data_type</span> (<span class="id">snd</span> <span class="id">d</span>) (<span class="id">snd</span> <span class="id">r</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">dl</span> <span class="id">rl</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof1344')">Proof.</div>
<div class="proofscript" id="proof1344">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> 1; <span class="tactic">intuition</span>; <span class="tactic">subst</span>; <span class="id">rtype_equalizer</span>; <span class="tactic">subst</span>; <span class="tactic">trivial</span>.<br/>
&nbsp;&nbsp;Qed.</div>
&nbsp;&nbsp;<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">dtrec_full</span> <span class="id">k</span> {<span class="id">dl</span> <span class="id">rl</span>} <span class="id">pf</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Forall2</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">fun</span> <span class="id">d</span> <span class="id">r</span> =&gt; (<span class="id">fst</span> <span class="id">d</span>) = (<span class="id">fst</span> <span class="id">r</span>) /\ <span class="id">data_type</span> (<span class="id">snd</span> <span class="id">d</span>) (<span class="id">snd</span> <span class="id">r</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">dl</span> <span class="id">rl</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">data_type</span> (<span class="id">drec</span> <span class="id">dl</span>) (<span class="id">Rec</span> <span class="id">k</span> <span class="id">rl</span> <span class="id">pf</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof1345')">Proof.</div>
<div class="proofscript" id="proof1345">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">apply</span> (<span class="id">dtrec</span> <span class="id">_</span> <span class="id">_</span> <span class="id">rl</span> <span class="id">rl</span>); <span class="tactic">intuition</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">dtrec_open</span> {<span class="id">dl</span> : <span class="id">list</span> (<span class="id">string</span>*<span class="id">data</span>)} {<span class="id">rl</span> <span class="id">rl_sub</span> : <span class="id">list</span> (<span class="id">string</span>*<span class="id">rtype</span>)}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">pf</span> (<span class="id">pf</span>':<span class="id">is_list_sorted</span> <span class="id">ODT_lt_dec</span> (<span class="id">domain</span> <span class="id">rl</span>) = <span class="id">true</span>) :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">sublist</span> <span class="id">rl_sub</span> <span class="id">rl</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Forall2</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">fun</span> <span class="id">d</span> <span class="id">r</span> =&gt; (<span class="id">fst</span> <span class="id">d</span>) = (<span class="id">fst</span> <span class="id">r</span>) /\ <span class="id">data_type</span> (<span class="id">snd</span> <span class="id">d</span>) (<span class="id">snd</span> <span class="id">r</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">dl</span> <span class="id">rl</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">data_type</span> (<span class="id">drec</span> <span class="id">dl</span>) (<span class="id">Rec</span> <span class="kwd">Open</span> <span class="id">rl_sub</span> <span class="id">pf</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof1346')">Proof.</div>
<div class="proofscript" id="proof1346">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>; <span class="tactic">apply</span> (<span class="id">dtrec</span> <span class="id">_</span> <span class="id">_</span>  <span class="id">rl</span> <span class="id">rl_sub</span>); <span class="tactic">intuition</span>; <span class="tactic">try</span> <span class="tactic">discriminate</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">dtrec_open_pf</span> {<span class="id">dl</span> : <span class="id">list</span> (<span class="id">string</span>*<span class="id">data</span>)} {<span class="id">rl</span> <span class="id">rl_sub</span> : <span class="id">list</span> (<span class="id">string</span>*<span class="id">rtype</span>)}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">pf</span>':<span class="id">is_list_sorted</span> <span class="id">ODT_lt_dec</span> (<span class="id">domain</span> <span class="id">rl</span>) = <span class="id">true</span>) :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">sub</span>:<span class="id">sublist</span> <span class="id">rl_sub</span> <span class="id">rl</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Forall2</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">fun</span> <span class="id">d</span> <span class="id">r</span> =&gt; (<span class="id">fst</span> <span class="id">d</span>) = (<span class="id">fst</span> <span class="id">r</span>) /\ <span class="id">data_type</span> (<span class="id">snd</span> <span class="id">d</span>) (<span class="id">snd</span> <span class="id">r</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">dl</span> <span class="id">rl</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">data_type</span> (<span class="id">drec</span> <span class="id">dl</span>) (<span class="id">Rec</span> <span class="kwd">Open</span> <span class="id">rl_sub</span> (<span class="id">is_list_sorted_sublist</span> <span class="id">pf</span>' (<span class="id">sublist_domain</span> <span class="id">sub</span>))).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof1347')">Proof.</div>
<div class="proofscript" id="proof1347">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>; <span class="tactic">apply</span> (<span class="id">dtrec</span> <span class="id">_</span> <span class="id">_</span>  <span class="id">rl</span> <span class="id">rl_sub</span>); <span class="tactic">intuition</span>; <span class="tactic">try</span> <span class="tactic">discriminate</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">dtrec_closed_is_open</span> <span class="id">k</span> <span class="id">dl</span> <span class="id">rl</span> <span class="id">pf</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">data_type</span> (<span class="id">drec</span> <span class="id">dl</span>) (<span class="id">Rec</span> <span class="id">Closed</span> <span class="id">rl</span> <span class="id">pf</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">data_type</span> (<span class="id">drec</span> <span class="id">dl</span>) (<span class="id">Rec</span> <span class="id">k</span> <span class="id">rl</span> <span class="id">pf</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof1348')">Proof.</div>
<div class="proofscript" id="proof1348">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">dt</span>. <span class="tactic">apply</span> <span class="id">dtrec_closed_inv</span> <span class="kwd">in</span> <span class="id">dt</span>; <span class="tactic">apply</span> <span class="id">dtrec_full</span>; <span class="tactic">trivial</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">dtbrand_inv</span> <span class="id">b</span> <span class="id">b</span>' <span class="id">d</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">data_type</span> (<span class="id">dbrand</span> <span class="id">b</span> <span class="id">d</span>) (<span class="id">Brand</span> <span class="id">b</span>') -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">is_canon_brands</span> <span class="id">brand_relation_brands</span> <span class="id">b</span> /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">data_normalized</span> <span class="id">brand_relation_brands</span> <span class="id">d</span> /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Forall</span> (<span class="kwd">fun</span> <span class="id">bb</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> τ, <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">lookup</span> <span class="id">string_dec</span> <span class="id">brand_context_types</span> <span class="id">bb</span> = <span class="id">Some</span> τ -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">data_type</span> <span class="id">d</span> τ<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;) <span class="id">b</span> /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">b</span> ≤ <span class="id">b</span>'.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof1349')">Proof.</div>
<div class="proofscript" id="proof1349">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> 1; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">canon_equiv</span> <span class="kwd">in</span> <span class="id">H2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H2</span> <span class="kwd">in</span> <span class="id">H6</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intuition</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">dtbrand_refl</span> {<span class="id">b</span> <span class="id">d</span>}:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">is_canon_brands</span> <span class="id">brand_relation_brands</span> <span class="id">b</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">data_normalized</span> <span class="id">brand_relation_brands</span> <span class="id">d</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Forall</span> (<span class="kwd">fun</span> <span class="id">bb</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> τ, <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">lookup</span> <span class="id">string_dec</span> <span class="id">brand_context_types</span> <span class="id">bb</span> = <span class="id">Some</span> τ -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">data_type</span> <span class="id">d</span> τ<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;) <span class="id">b</span>   -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">data_type</span> (<span class="id">dbrand</span> <span class="id">b</span> <span class="id">d</span>) (<span class="id">Brand</span> <span class="id">b</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof1350')">Proof.</div>
<div class="proofscript" id="proof1350">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>; <span class="tactic">eapply</span> <span class="id">dtbrand</span>; <span class="tactic">try</span> <span class="id">eassumption</span>; <span class="tactic">intuition</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span>  <span class="id">data_type_ext</span> <span class="id">d</span> τ₀ <span class="id">pf1</span> <span class="id">pf2</span>: <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">d</span> ▹ (<span class="id">exist</span> <span class="id">_</span> τ₀ <span class="id">pf1</span>) &lt;-&gt; <span class="id">d</span> ▹ (<span class="id">exist</span> <span class="id">_</span> τ₀ <span class="id">pf2</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof1351')">Proof.</div>
<div class="proofscript" id="proof1351">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> (<span class="id">wf_rtype</span>₀<span class="id">_ext</span> <span class="id">pf1</span> <span class="id">pf2</span>). <span class="tactic">intuition</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span>  <span class="id">data_type_fequal</span> <span class="id">d</span> τ₁ τ₂: <br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">proj1_sig</span> τ₁) = (<span class="id">proj1_sig</span> τ₂) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">d</span> ▹ τ₁ &lt;-&gt; <span class="id">d</span> ▹ τ₂).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof1352')">Proof.</div>
<div class="proofscript" id="proof1352">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> τ₁; <span class="tactic">destruct</span> τ₂; <span class="tactic">simpl</span>; <span class="tactic">intros</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">data_type_ext</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">data_type_not_bottom</span> {<span class="id">d</span>} : <span class="id">d</span> ▹ ⊥ -&gt; <span class="id">False</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof1353')">Proof.</div>
<div class="proofscript" id="proof1353">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">d</span>; <span class="tactic">inversion</span> 1.<br/>
&nbsp;&nbsp;Qed.</div>
&nbsp;&nbsp;&nbsp;&nbsp;<br/>
<span class="kwd">Section</span> <span class="id">inv</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">data_type_dunit_inv</span> {τ}:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">isTop</span> τ = <span class="id">false</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">dunit</span> ▹ τ -&gt; τ = <span class="id">Unit</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof1354')">Proof.</div>
<div class="proofscript" id="proof1354">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> τ <span class="kwd">using</span> <span class="id">rtype_rect</span>; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">try</span> <span class="id">solve</span> [<span class="tactic">intros</span> <span class="id">HH</span> <span class="id">HH0</span>; <span class="tactic">assert</span> <span class="id">False</span>; [<span class="tactic">inversion</span> <span class="id">HH0</span>|<span class="tactic">intuition</span>]];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eauto</span>; <span class="tactic">simpl</span>; <span class="tactic">try</span> <span class="tactic">discriminate</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">data_type_dnat_inv</span> {<span class="id">n</span> τ}:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">isTop</span> τ = <span class="id">false</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">dnat</span> <span class="id">n</span> ▹ τ -&gt; τ = <span class="id">Nat</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof1355')">Proof.</div>
<div class="proofscript" id="proof1355">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> τ <span class="kwd">using</span> <span class="id">rtype_rect</span>; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">try</span> <span class="id">solve</span> [<span class="tactic">intros</span> ? <span class="id">HH</span>; <span class="tactic">assert</span> <span class="id">False</span>; [<span class="tactic">inversion</span> <span class="id">HH</span>|<span class="tactic">intuition</span>]];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eauto</span>; <span class="tactic">simpl</span>; <span class="tactic">try</span> <span class="tactic">discriminate</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">data_type_dbool_inv</span> {<span class="id">b</span> τ}:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">isTop</span> τ = <span class="id">false</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">dbool</span> <span class="id">b</span> ▹ τ -&gt; τ = <span class="id">Bool</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof1356')">Proof.</div>
<div class="proofscript" id="proof1356">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> τ <span class="kwd">using</span> <span class="id">rtype_rect</span>; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">try</span> <span class="id">solve</span> [<span class="tactic">intros</span> ? <span class="id">HH</span>; <span class="tactic">assert</span> <span class="id">False</span>; [<span class="tactic">inversion</span> <span class="id">HH</span>|<span class="tactic">intuition</span>]];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eauto</span>; <span class="tactic">simpl</span>; <span class="tactic">try</span> <span class="tactic">discriminate</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">data_type_dstring_inv</span> {<span class="id">s</span> τ}:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">isTop</span> τ = <span class="id">false</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">dstring</span> <span class="id">s</span> ▹ τ -&gt; τ = <span class="id">String</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof1357')">Proof.</div>
<div class="proofscript" id="proof1357">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> τ <span class="kwd">using</span> <span class="id">rtype_rect</span>; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">try</span> <span class="id">solve</span> [<span class="tactic">intros</span> ? <span class="id">HH</span>; <span class="tactic">assert</span> <span class="id">False</span>; [<span class="tactic">inversion</span> <span class="id">HH</span>|<span class="tactic">intuition</span>]];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eauto</span>; <span class="tactic">simpl</span>; <span class="tactic">try</span> <span class="tactic">discriminate</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">data_type_dcoll_inv</span> {<span class="id">d</span> τ}:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">isTop</span> τ = <span class="id">false</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">dcoll</span> <span class="id">d</span> ▹ τ -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{τ' | τ = <span class="id">Coll</span> τ'}.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof1358')">Proof.</div>
<div class="proofscript" id="proof1358">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> τ <span class="kwd">using</span> <span class="id">rtype_rect</span>; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">try</span> <span class="id">solve</span> [<span class="tactic">intros</span> ? <span class="id">HH</span>; <span class="tactic">assert</span> <span class="id">False</span>; [<span class="tactic">inversion</span> <span class="id">HH</span>|<span class="tactic">intuition</span>]];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eauto</span>; <span class="tactic">simpl</span>; <span class="tactic">try</span> <span class="tactic">discriminate</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">data_type_drec_inv</span> {<span class="id">sdl</span> τ}:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">isTop</span> τ = <span class="id">false</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">drec</span> <span class="id">sdl</span> ▹ τ -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{<span class="id">k</span> : <span class="id">record_kind</span> &amp; {τ' | <span class="id">exists</span> <span class="id">pf</span>, τ = <span class="id">Rec</span> <span class="id">k</span> τ' <span class="id">pf</span>}}.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof1359')">Proof.</div>
<div class="proofscript" id="proof1359">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> τ <span class="kwd">using</span> <span class="id">rtype_rect</span>; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">try</span> <span class="id">solve</span> [<span class="tactic">intros</span> ? <span class="id">HH</span>; <span class="tactic">assert</span> <span class="id">False</span>; [<span class="tactic">inversion</span> <span class="id">HH</span>|<span class="tactic">intuition</span>]];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eauto</span>; <span class="tactic">simpl</span>; <span class="tactic">try</span> <span class="tactic">discriminate</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">data_type_dleft_inv</span> {<span class="id">d</span> τ} :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">isTop</span> τ = <span class="id">false</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">dleft</span> <span class="id">d</span> ▹ τ -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{τ<span class="id">l</span> : <span class="id">rtype</span> &amp; {τ<span class="id">r</span> | τ = <span class="id">Either</span> τ<span class="id">l</span> τ<span class="id">r</span>}}.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof1360')">Proof.</div>
<div class="proofscript" id="proof1360">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> τ <span class="kwd">using</span> <span class="id">rtype_rect</span>; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">try</span> <span class="id">solve</span> [<span class="tactic">intros</span> ? <span class="id">HH</span>; <span class="tactic">assert</span> <span class="id">False</span>; [<span class="tactic">inversion</span> <span class="id">HH</span>|<span class="tactic">intuition</span>]];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eauto</span>; <span class="tactic">simpl</span>; <span class="tactic">try</span> <span class="tactic">discriminate</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">data_type_dright_inv</span> {<span class="id">d</span> τ} :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">isTop</span> τ = <span class="id">false</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">dright</span> <span class="id">d</span> ▹ τ -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{τ<span class="id">l</span> : <span class="id">rtype</span> &amp; {τ<span class="id">r</span> | τ = <span class="id">Either</span> τ<span class="id">l</span> τ<span class="id">r</span>}}.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof1361')">Proof.</div>
<div class="proofscript" id="proof1361">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> τ <span class="kwd">using</span> <span class="id">rtype_rect</span>; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">try</span> <span class="id">solve</span> [<span class="tactic">intros</span> ? <span class="id">HH</span>; <span class="tactic">assert</span> <span class="id">False</span>; [<span class="tactic">inversion</span> <span class="id">HH</span>|<span class="tactic">intuition</span>]];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eauto</span>; <span class="tactic">simpl</span>; <span class="tactic">try</span> <span class="tactic">discriminate</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">data_type_dsome_inv</span> {<span class="id">d</span> τ} :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">isTop</span> τ = <span class="id">false</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">dsome</span> <span class="id">d</span> ▹ τ -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{τ<span class="id">l</span> : <span class="id">rtype</span> &amp; {τ<span class="id">r</span> | τ = <span class="id">Either</span> τ<span class="id">l</span> τ<span class="id">r</span>}}.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof1362')">Proof.</div>
<div class="proofscript" id="proof1362">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">data_type_dleft_inv</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">data_type_dnone_inv</span> {τ} :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">isTop</span> τ = <span class="id">false</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">dnone</span> ▹ τ -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{τ<span class="id">l</span> : <span class="id">rtype</span> &amp; {τ<span class="id">r</span> | τ = <span class="id">Either</span> τ<span class="id">l</span> τ<span class="id">r</span>}}.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof1363')">Proof.</div>
<div class="proofscript" id="proof1363">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">data_type_dright_inv</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">data_type_Unit_inv</span> {<span class="id">d</span>}:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">d</span> ▹ <span class="id">Unit</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">d</span> = <span class="id">dunit</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof1364')">Proof.</div>
<div class="proofscript" id="proof1364">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">d</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">try</span> <span class="id">solve</span> [<span class="tactic">intros</span> <span class="id">HH</span>; <span class="tactic">assert</span> <span class="id">False</span>; [<span class="tactic">inversion</span> <span class="id">HH</span>|<span class="tactic">intuition</span>]];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eauto</span>; <span class="tactic">simpl</span>; <span class="tactic">try</span> <span class="tactic">discriminate</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">data_type_Nat_inv</span> {<span class="id">d</span>}:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">d</span> ▹ <span class="id">Nat</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{<span class="id">n</span> | <span class="id">d</span> = <span class="id">dnat</span> <span class="id">n</span>}.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof1365')">Proof.</div>
<div class="proofscript" id="proof1365">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">d</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">try</span> <span class="id">solve</span> [<span class="tactic">intros</span> <span class="id">HH</span>; <span class="tactic">assert</span> <span class="id">False</span>; [<span class="tactic">inversion</span> <span class="id">HH</span>|<span class="tactic">intuition</span>]];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eauto</span>; <span class="tactic">simpl</span>; <span class="tactic">try</span> <span class="tactic">discriminate</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">data_type_Bool_inv</span> {<span class="id">d</span>}:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">d</span> ▹ <span class="id">Bool</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{<span class="id">b</span> | <span class="id">d</span> = <span class="id">dbool</span> <span class="id">b</span>}.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof1366')">Proof.</div>
<div class="proofscript" id="proof1366">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">d</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">try</span> <span class="id">solve</span> [<span class="tactic">intros</span> <span class="id">HH</span>; <span class="tactic">assert</span> <span class="id">False</span>; [<span class="tactic">inversion</span> <span class="id">HH</span>|<span class="tactic">intuition</span>]];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eauto</span>; <span class="tactic">simpl</span>; <span class="tactic">try</span> <span class="tactic">discriminate</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">data_type_String_inv</span> {<span class="id">d</span>}:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">d</span> ▹ <span class="id">String</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{<span class="id">s</span> | <span class="id">d</span> = <span class="id">dstring</span> <span class="id">s</span>}.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof1367')">Proof.</div>
<div class="proofscript" id="proof1367">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">d</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">try</span> <span class="id">solve</span> [<span class="tactic">intros</span> <span class="id">HH</span>; <span class="tactic">assert</span> <span class="id">False</span>; [<span class="tactic">inversion</span> <span class="id">HH</span>|<span class="tactic">intuition</span>]];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eauto</span>; <span class="tactic">simpl</span>; <span class="tactic">try</span> <span class="tactic">discriminate</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">data_type_Col_inv</span> {<span class="id">d</span> τ}:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">d</span> ▹ <span class="id">Coll</span> τ -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{<span class="id">dl</span> | <span class="id">d</span> = <span class="id">dcoll</span> <span class="id">dl</span>}.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof1368')">Proof.</div>
<div class="proofscript" id="proof1368">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">revert</span> τ.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">d</span>; <span class="tactic">intros</span> τ;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">try</span> <span class="id">solve</span> [<span class="tactic">intros</span> <span class="id">HH</span>; <span class="tactic">assert</span> <span class="id">False</span>; [<span class="tactic">inversion</span> <span class="id">HH</span>|<span class="tactic">intuition</span>]];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eauto</span>; <span class="tactic">simpl</span>; <span class="tactic">try</span> <span class="tactic">discriminate</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">Col_inv</span> {<span class="id">d</span> τ}:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">dcoll</span> <span class="id">d</span> ▹ <span class="id">Coll</span> τ -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Forall</span> (<span class="kwd">fun</span> <span class="id">c</span> =&gt; <span class="id">c</span> ▹ τ) <span class="id">d</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof1369')">Proof.</div>
<div class="proofscript" id="proof1369">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> 1; <span class="id">rtype_equalizer</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">trivial</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">data_type_Rec_inv</span> {<span class="id">d</span> <span class="id">k</span> τ <span class="id">pf</span>} :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">d</span> ▹ <span class="id">Rec</span> <span class="id">k</span> τ <span class="id">pf</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{<span class="id">dl</span> | <span class="id">d</span> = <span class="id">drec</span> <span class="id">dl</span>}.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof1370')">Proof.</div>
<div class="proofscript" id="proof1370">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">revert</span> τ <span class="id">pf</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">d</span>; <span class="tactic">intros</span> τ <span class="id">pf</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">try</span> <span class="id">solve</span> [<span class="tactic">intros</span> <span class="id">HH</span>; <span class="tactic">assert</span> <span class="id">False</span>; [<span class="tactic">inversion</span> <span class="id">HH</span>|<span class="tactic">intuition</span>]];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eauto</span>; <span class="tactic">simpl</span>; <span class="tactic">try</span> <span class="tactic">discriminate</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">data_type_Arrow_inv</span> {<span class="id">d</span> τ<span class="kwd">in</span> τ<span class="id">out</span>}:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">d</span> ▹ <span class="id">Arrow</span> τ<span class="kwd">in</span> τ<span class="id">out</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">False</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof1371')">Proof.</div>
<div class="proofscript" id="proof1371">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> 1.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">data_type_Foreign_inv</span> {<span class="id">d</span> <span class="id">ft</span>}:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">d</span> ▹ <span class="id">Foreign</span> <span class="id">ft</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{<span class="id">fd</span> | <span class="id">d</span> = <span class="id">dforeign</span> <span class="id">fd</span>}.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof1372')">Proof.</div>
<div class="proofscript" id="proof1372">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">revert</span> <span class="id">ft</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">d</span>; <span class="tactic">intros</span> <span class="id">ft</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">try</span> <span class="id">solve</span> [<span class="tactic">intros</span> <span class="id">HH</span>; <span class="tactic">assert</span> <span class="id">False</span>; [<span class="tactic">inversion</span> <span class="id">HH</span>|<span class="tactic">intuition</span>]];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eauto</span>; <span class="tactic">simpl</span>; <span class="tactic">try</span> <span class="tactic">discriminate</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">data_type_Either_inv</span> {<span class="id">d</span> τ<span class="id">l</span> τ<span class="id">r</span>}:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">d</span> ▹ <span class="id">Either</span> τ<span class="id">l</span> τ<span class="id">r</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{<span class="id">dl</span> | <span class="id">d</span> = <span class="id">dleft</span> <span class="id">dl</span> /\ <span class="id">dl</span> ▹ τ<span class="id">l</span>} + {<span class="id">dr</span> | <span class="id">d</span> = <span class="id">dright</span> <span class="id">dr</span> /\ <span class="id">dr</span> ▹ τ<span class="id">r</span>}.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof1373')">Proof.</div>
<div class="proofscript" id="proof1373">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">revert</span> τ<span class="id">l</span> τ<span class="id">r</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">d</span>; <span class="tactic">intros</span> τ <span class="id">pf</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">try</span> <span class="id">solve</span> [<span class="tactic">intros</span> <span class="id">HH</span>; <span class="tactic">assert</span> <span class="id">False</span>; [<span class="tactic">inversion</span> <span class="id">HH</span>|<span class="tactic">intuition</span>]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">left</span>. <span class="id">econstructor</span>. <span class="tactic">inversion</span> <span class="id">H</span>; <span class="id">rtype_equalizer</span>. <span class="tactic">subst</span>; <span class="tactic">intuition</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">right</span>. <span class="id">econstructor</span>. <span class="tactic">inversion</span> <span class="id">H</span>; <span class="id">rtype_equalizer</span>. <span class="tactic">subst</span>; <span class="tactic">intuition</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">data_type_Option_inv</span> {<span class="id">d</span> τ}:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">d</span> ▹ <span class="id">Option</span> τ -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{<span class="id">ds</span> | <span class="id">d</span> = <span class="id">dsome</span> <span class="id">ds</span> /\ <span class="id">ds</span> ▹ τ} + {<span class="id">d</span> = <span class="id">dnone</span>}.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof1374')">Proof.</div>
<div class="proofscript" id="proof1374">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">inn</span>. <span class="tactic">apply</span> <span class="id">data_type_Either_inv</span> <span class="kwd">in</span> <span class="id">inn</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">dsome</span>, <span class="id">dnone</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">inn</span> <span class="kwd">as</span> [[?[??]]|[?[??]]]; <span class="tactic">subst</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">data_type_Unit_inv</span> <span class="kwd">in</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">data_type_Brand_inv</span> {<span class="id">d</span> <span class="id">br</span>} :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">d</span> ▹ <span class="id">Brand</span> <span class="id">br</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{<span class="id">bs</span>:<span class="id">brands</span> &amp; {<span class="id">d</span>' | <span class="id">d</span> = <span class="id">dbrand</span> <span class="id">bs</span> <span class="id">d</span>'}}.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof1375')">Proof.</div>
<div class="proofscript" id="proof1375">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">revert</span> <span class="id">br</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">d</span>; <span class="tactic">intros</span> <span class="id">br</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">try</span> <span class="id">solve</span> [<span class="tactic">intros</span> <span class="id">H</span>; <span class="tactic">assert</span> <span class="id">False</span>; [<span class="tactic">inversion</span> <span class="id">H</span>|<span class="tactic">intuition</span>]];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eauto</span>; <span class="tactic">simpl</span>; <span class="tactic">try</span> <span class="tactic">discriminate</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">intros</span>. <span class="tactic">assert</span> <span class="id">False</span>; [<span class="tactic">inversion</span> <span class="id">H0</span>|<span class="tactic">intuition</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">intros</span>. <span class="tactic">assert</span> <span class="id">False</span>; [<span class="tactic">inversion</span> <span class="id">H0</span>|<span class="tactic">intuition</span>].<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
<span class="kwd">End</span> <span class="id">inv</span>.<br/>
<br/>
<div class="doc">Inversion tactic for typed data </div>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Ltac</span> <span class="id">data_type_inverter</span> :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| [<span class="id">H</span>: <span class="id">dunit</span> ▹ ?τ,  <span class="id">H1</span>: <span class="id">isTop</span> ?τ = <span class="id">false</span> |- <span class="id">_</span> ] =&gt; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> τ <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">Unit</span> =&gt; <span class="tactic">fail</span> 1<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">_</span> =&gt; <span class="tactic">generalize</span> (<span class="id">data_type_dunit_inv</span> <span class="id">H1</span> <span class="id">H</span>); <span class="tactic">intros</span> ?; <span class="tactic">try</span> <span class="tactic">subst</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| [<span class="id">H</span>: <span class="id">dnat</span> <span class="id">_</span> ▹ ?τ,  <span class="id">H1</span>: <span class="id">isTop</span> ?τ = <span class="id">false</span>  |- <span class="id">_</span> ] =&gt; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> τ <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">Nat</span> =&gt; <span class="tactic">fail</span> 1<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">_</span> =&gt; <span class="tactic">generalize</span> (<span class="id">data_type_dnat_inv</span> <span class="id">H1</span> <span class="id">H</span>); <span class="tactic">intros</span> ?; <span class="tactic">try</span> <span class="tactic">subst</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| [<span class="id">H</span>: <span class="id">dbool</span> <span class="id">_</span> ▹ ?τ,  <span class="id">H1</span>: <span class="id">isTop</span> ?τ = <span class="id">false</span>  |- <span class="id">_</span> ] =&gt; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> τ <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">Bool</span> =&gt; <span class="tactic">fail</span> 1<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">_</span> =&gt; <span class="tactic">generalize</span> (<span class="id">data_type_dbool_inv</span> <span class="id">H1</span> <span class="id">H</span>); <span class="tactic">intros</span> ?; <span class="tactic">try</span> <span class="tactic">subst</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| [<span class="id">H</span>: <span class="id">dstring</span> <span class="id">_</span> ▹ ?τ,  <span class="id">H1</span>: <span class="id">isTop</span> ?τ = <span class="id">false</span>  |- <span class="id">_</span> ] =&gt; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> τ <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">String</span> =&gt; <span class="tactic">fail</span> 1<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">_</span> =&gt; <span class="tactic">generalize</span> (<span class="id">data_type_dstring_inv</span> <span class="id">H1</span> <span class="id">H</span>); <span class="tactic">intros</span> ?; <span class="tactic">try</span> <span class="tactic">subst</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| [<span class="id">H</span>: <span class="id">dcoll</span> <span class="id">_</span> ▹ ?τ,  <span class="id">H1</span>: <span class="id">isTop</span> ?τ = <span class="id">false</span>  |- <span class="id">_</span> ] =&gt; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> τ <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">Coll</span> <span class="id">_</span> =&gt; <span class="tactic">fail</span> 1<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">_</span> =&gt; <span class="tactic">destruct</span> (<span class="id">data_type_dcoll_inv</span> <span class="id">H1</span> <span class="id">H</span>); <span class="tactic">try</span> <span class="tactic">subst</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| [<span class="id">H</span>: <span class="id">drec</span> <span class="id">_</span> ▹ ?τ,  <span class="id">H1</span>: <span class="id">isTop</span> ?τ = <span class="id">false</span>  |- <span class="id">_</span> ] =&gt; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> τ <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">Rec</span> <span class="id">_</span> <span class="id">_</span> =&gt; <span class="tactic">fail</span> 1<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">_</span> =&gt; <span class="tactic">destruct</span> (<span class="id">data_type_drec_inv</span> <span class="id">H1</span> <span class="id">H</span>) <span class="kwd">as</span> [?[?[??]]]; <span class="tactic">try</span> <span class="tactic">subst</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span><br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">data_type_Rec_sublist</span> {<span class="id">r</span> <span class="id">k</span> <span class="id">l</span> <span class="id">l</span>' <span class="id">pf</span>} <span class="id">pf</span>' :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">drec</span> <span class="id">r</span> ▹ <span class="id">Rec</span> <span class="id">k</span> <span class="id">l</span> <span class="id">pf</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">sublist</span> <span class="id">l</span>' <span class="id">l</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">drec</span> <span class="id">r</span> ▹ <span class="id">Rec</span> <span class="kwd">Open</span> <span class="id">l</span>' <span class="id">pf</span>'.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof1376')">Proof.</div>
<div class="proofscript" id="proof1376">
&nbsp;&nbsp;<span class="tactic">inversion</span> 1; <span class="tactic">subst</span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H2</span>; <span class="tactic">clear</span> <span class="id">H2</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> *; <span class="id">rtype_equalizer</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;<span class="id">econstructor</span>.<br/>
&nbsp;&nbsp;- <span class="id">eassumption</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">rewrite</span> <span class="id">H0</span>; <span class="id">eassumption</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">intros</span>; <span class="tactic">discriminate</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">trivial</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">sorted_forall_same_domain</span> {<span class="id">dl</span> τ}:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Forall2</span> (<span class="kwd">fun</span> (<span class="id">d</span> : <span class="id">string</span> * <span class="id">data</span>) (<span class="id">r</span> : <span class="id">string</span> * <span class="id">rtype</span>) =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">fst</span> <span class="id">d</span> = <span class="id">fst</span> <span class="id">r</span> /\ <span class="id">data_type</span> (<span class="id">snd</span> <span class="id">d</span>) (<span class="id">snd</span> <span class="id">r</span>)) <span class="id">dl</span> τ -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">domain</span> <span class="id">dl</span>) = (<span class="id">domain</span> τ).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof1377')">Proof.</div>
<div class="proofscript" id="proof1377">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">Forall2</span> (<span class="kwd">fun</span> (<span class="id">d</span> : <span class="id">string</span> * <span class="id">data</span>) (<span class="id">r</span> : <span class="id">string</span> * <span class="id">rtype</span>) =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">fst</span> <span class="id">d</span> = <span class="id">fst</span> <span class="id">r</span>) <span class="id">dl</span> τ)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">by</span> (<span class="tactic">eapply</span> <span class="id">Forall2_incl</span>; <span class="tactic">try</span> <span class="tactic">apply</span> <span class="id">H</span>; <span class="tactic">intuition</span>).<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">Forall2_map</span> <span class="kwd">in</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">Forall2_eq</span> <span class="kwd">in</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;<span class="tactic">assumption</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">data_type_Rec_domain</span> {<span class="id">r</span> <span class="id">k</span> <span class="id">l</span> <span class="id">pf</span>} :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">drec</span> <span class="id">r</span> ▹ <span class="id">Rec</span> <span class="id">k</span> <span class="id">l</span> <span class="id">pf</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">sublist</span> (<span class="id">domain</span> <span class="id">l</span>) (<span class="id">domain</span> <span class="id">r</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof1378')">Proof.</div>
<div class="proofscript" id="proof1378">
&nbsp;&nbsp;<span class="id">revert</span> <span class="id">l</span> <span class="id">pf</span>. <span class="tactic">induction</span> <span class="id">r</span>; <span class="tactic">inversion</span> 1; <span class="id">rtype_equalizer</span>; <span class="tactic">subst</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H5</span>; <span class="tactic">subst</span>; <span class="tactic">clear</span> <span class="id">H5</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">apply</span> <span class="id">sublist_nil_r</span> <span class="kwd">in</span> <span class="id">H3</span>; <span class="tactic">subst</span>; <span class="tactic">simpl</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">simpl</span>. <span class="tactic">intuition</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">sublist_domain</span> <span class="kwd">in</span> <span class="id">H3</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H3</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">sublist_cons</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> (<span class="id">IHr</span> <span class="id">_</span> (<span class="id">is_list_sorted_cons_inv</span> <span class="id">_</span> <span class="id">pf</span>')).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">dtrec_full</span>; <span class="tactic">trivial</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">data_type_Rec_closed_domain</span> {<span class="id">r</span> <span class="id">l</span> <span class="id">pf</span>} :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">drec</span> <span class="id">r</span> ▹ <span class="id">Rec</span> <span class="id">Closed</span> <span class="id">l</span> <span class="id">pf</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">domain</span> <span class="id">r</span> = <span class="id">domain</span> <span class="id">l</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof1379')">Proof.</div>
<div class="proofscript" id="proof1379">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">symmetry</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">sublist_length_eq</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">apply</span> (<span class="id">data_type_Rec_domain</span> <span class="id">H</span>).<br/>
&nbsp;&nbsp;- <span class="tactic">apply</span> <span class="id">dtrec_closed_inv</span> <span class="kwd">in</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="tactic">rewrite</span> <span class="id">domain_length</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">symmetry</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">Forall2_length</span>; <span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">data_type_Recs_domain</span> {<span class="id">r</span> <span class="id">k</span> <span class="id">l</span> <span class="id">pf</span> <span class="id">l</span>' <span class="id">pf</span>'} :<br/>
&nbsp;&nbsp;<span class="id">drec</span> <span class="id">r</span> ▹ <span class="id">Rec</span> <span class="id">k</span> <span class="id">l</span> <span class="id">pf</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">drec</span> <span class="id">r</span> ▹ <span class="id">Rec</span> <span class="id">Closed</span> <span class="id">l</span>' <span class="id">pf</span>' -&gt;<br/>
&nbsp;&nbsp;<span class="id">sublist</span> (<span class="id">domain</span> <span class="id">l</span>) (<span class="id">domain</span> <span class="id">l</span>').<br/>
<div class="toggleproof" onclick="toggleDisplay('proof1380')">Proof.</div>
<div class="proofscript" id="proof1380">
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">t1</span> <span class="id">t2</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> (<span class="id">data_type_Rec_domain</span> <span class="id">t1</span>).<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> (<span class="id">data_type_Rec_closed_domain</span> <span class="id">t2</span>).<br/>
&nbsp;&nbsp;<span class="tactic">reflexivity</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">data_type_Recs_closed_domain</span> {<span class="id">r</span> <span class="id">l</span> <span class="id">l</span>' <span class="id">pf</span> <span class="id">pf</span>'} :<br/>
&nbsp;&nbsp;<span class="id">drec</span> <span class="id">r</span> ▹ <span class="id">Rec</span> <span class="id">Closed</span> <span class="id">l</span> <span class="id">pf</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">drec</span> <span class="id">r</span> ▹ <span class="id">Rec</span> <span class="id">Closed</span> <span class="id">l</span>' <span class="id">pf</span>' -&gt;<br/>
&nbsp;&nbsp;<span class="id">domain</span> <span class="id">l</span> = <span class="id">domain</span> <span class="id">l</span>'.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof1381')">Proof.</div>
<div class="proofscript" id="proof1381">
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">t1</span> <span class="id">t2</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- (<span class="id">data_type_Rec_closed_domain</span> <span class="id">t1</span>).<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- (<span class="id">data_type_Rec_closed_domain</span> <span class="id">t2</span>).<br/>
&nbsp;&nbsp;<span class="tactic">trivial</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">dtrec_edot_parts</span> <span class="id">a</span> <span class="id">k</span> τ <span class="id">pf</span> <span class="id">s</span> <span class="id">x</span> <span class="id">y</span>:<br/>
&nbsp;&nbsp;<span class="id">drec</span> <span class="id">a</span> ▹ <span class="id">Rec</span> <span class="id">k</span> τ <span class="id">pf</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">edot</span> <span class="id">a</span> <span class="id">s</span> = <span class="id">Some</span> <span class="id">x</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">edot</span> τ <span class="id">s</span> = <span class="id">Some</span> <span class="id">y</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">x</span> ▹ <span class="id">y</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof1382')">Proof.</div>
<div class="proofscript" id="proof1382">
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">edot</span>.<br/>
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">dt</span> <span class="id">ina</span> <span class="kwd">in</span>τ.<br/>
&nbsp;&nbsp;<span class="id">invcs</span> <span class="id">dt</span>; <span class="id">rtype_equalizer</span>.<br/>
&nbsp;&nbsp;<span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">is_list_sorted_NoDup_strlt</span> <span class="kwd">in</span> <span class="id">pf</span>'.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> (<span class="id">assoc_lookupr_nodup_sublist</span> <span class="id">pf</span>' <span class="id">H2</span> (<span class="id">R_dec</span>:=<span class="id">ODT_eqdec</span>)) <span class="kwd">in</span> <span class="kwd">in</span>τ.<br/>
&nbsp;&nbsp;<span class="tactic">clear</span> <span class="id">H3</span> <span class="id">H2</span>.<br/>
&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">H4</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> *; <span class="tactic">try</span> <span class="tactic">discriminate</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">x0</span>; <span class="tactic">destruct</span> <span class="id">y0</span>; <span class="tactic">destruct</span> <span class="id">H</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> *; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;<span class="id">invcs</span> <span class="id">pf</span>'.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">string_eqdec</span> <span class="id">s</span> <span class="id">s1</span>); <span class="tactic">unfold</span> <span class="id">Equivalence.equiv</span> <span class="kwd">in</span> *; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">apply</span> <span class="id">sorted_forall_same_domain</span> <span class="kwd">in</span> <span class="id">H4</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">nd2</span>:~ <span class="id">In</span> <span class="id">s1</span> (<span class="id">domain</span> <span class="id">l</span>)) <span class="tactic">by</span> (<span class="tactic">rewrite</span> <span class="id">H4</span>; <span class="tactic">trivial</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> (<span class="id">assoc_lookupr_nin_none</span>) <span class="kwd">with</span> (<span class="id">dec</span>:=<span class="id">string_eqdec</span>) <span class="kwd">in</span> <span class="id">H2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H2</span> <span class="kwd">in</span> <span class="kwd">in</span>τ.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">invcs</span> <span class="kwd">in</span>τ.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> (<span class="id">assoc_lookupr_nin_none</span>) <span class="kwd">with</span> (<span class="id">dec</span>:=<span class="id">string_eqdec</span>) <span class="kwd">in</span> <span class="id">nd2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">Equivalence.equiv</span>, <span class="id">RelationClasses.complement</span>, <span class="id">not</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">nd2</span> <span class="kwd">in</span> <span class="id">ina</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">invcs</span> <span class="id">ina</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">trivial</span>.<br/>
&nbsp;&nbsp;- <span class="id">match_case_in</span> <span class="kwd">in</span>τ<br/>
&nbsp;&nbsp;&nbsp;&nbsp;; [<span class="tactic">intros</span> ? <span class="id">eqq1</span> | <span class="tactic">intros</span> <span class="id">eqq1</span>]; <span class="tactic">rewrite</span> <span class="id">eqq1</span> <span class="kwd">in</span> <span class="kwd">in</span>τ<br/>
&nbsp;&nbsp;&nbsp;&nbsp;; <span class="tactic">try</span> <span class="tactic">discriminate</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">invcs</span> <span class="kwd">in</span>τ.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">match_case_in</span> <span class="id">ina</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;; [<span class="tactic">intros</span> ? <span class="id">eqq2</span> | <span class="tactic">intros</span> <span class="id">eqq2</span>]; <span class="tactic">rewrite</span> <span class="id">eqq2</span> <span class="kwd">in</span> <span class="id">ina</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;; <span class="tactic">try</span> <span class="tactic">discriminate</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">invcs</span> <span class="id">ina</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intuition</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">coll_type_cons</span> <span class="id">a</span> <span class="id">c</span> <span class="id">x</span>:<br/>
&nbsp;&nbsp;<span class="id">dcoll</span> (<span class="id">a</span> :: <span class="id">c</span>) ▹ <span class="id">Coll</span> <span class="id">x</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">a</span> ▹ <span class="id">x</span> /\ <span class="id">dcoll</span> <span class="id">c</span> ▹ <span class="id">Coll</span> <span class="id">x</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof1383')">Proof.</div>
<div class="proofscript" id="proof1383">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">r</span> = <span class="id">x</span>) <span class="tactic">by</span> (<span class="tactic">apply</span> <span class="id">rtype_fequal</span>; <span class="tactic">assumption</span>).<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Forall_forall</span> <span class="kwd">in</span> <span class="id">H2</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">H2</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H3</span> <span class="kwd">in</span> *; <span class="tactic">clear</span> <span class="id">H3</span> <span class="id">H1</span>.<br/>
&nbsp;&nbsp;<span class="tactic">split</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> (<span class="id">H2</span> <span class="id">a</span>); <span class="id">left</span>; <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">dtcoll</span>; <span class="tactic">rewrite</span> <span class="id">Forall_forall</span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> (<span class="id">H2</span> <span class="id">x0</span>); <span class="id">right</span>; <span class="tactic">assumption</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">dcoll_coll_in_inv</span> {<span class="id">d</span> τ <span class="id">a</span>} :<br/>
&nbsp;&nbsp;<span class="id">In</span> <span class="id">a</span> <span class="id">d</span> -&gt; <span class="id">dcoll</span> <span class="id">d</span> ▹ <span class="id">Coll</span> τ -&gt; <span class="id">a</span> ▹ τ.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof1384')">Proof.</div>
<div class="proofscript" id="proof1384">
&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">d</span>; [<span class="tactic">simpl</span>; <span class="tactic">intuition</span>| ]; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">coll_type_cons</span> <span class="kwd">in</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> *; <span class="tactic">intuition</span>; <span class="tactic">subst</span>; <span class="tactic">intuition</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">rec_type_closed_cons</span> {<span class="id">x</span> <span class="id">y</span> <span class="id">l</span> <span class="id">l</span>' <span class="id">pf</span>} <span class="id">pf</span>':<br/>
&nbsp;&nbsp;<span class="id">drec</span> (<span class="id">x</span> :: <span class="id">l</span>) ▹ <span class="id">Rec</span> <span class="id">Closed</span> (<span class="id">y</span> :: <span class="id">l</span>') <span class="id">pf</span> -&gt;<br/>
&nbsp;&nbsp;(<span class="id">snd</span> <span class="id">x</span>) ▹ (<span class="id">snd</span> <span class="id">y</span>) /\ <span class="id">drec</span> <span class="id">l</span> ▹ <span class="id">Rec</span> <span class="id">Closed</span> <span class="id">l</span>' <span class="id">pf</span>'.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof1385')">Proof.</div>
<div class="proofscript" id="proof1385">
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">dtrec_closed_inv</span> <span class="kwd">in</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H</span>; <span class="tactic">subst</span>; <span class="tactic">intuition</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">dtrec_full</span>; <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">rec_type_cons</span> {<span class="id">k</span> <span class="id">x</span> <span class="id">y</span> <span class="id">l</span> <span class="id">l</span>' <span class="id">pf</span>} <span class="id">pf</span>':<br/>
&nbsp;&nbsp;<span class="id">drec</span> (<span class="id">x</span> :: <span class="id">l</span>) ▹ <span class="id">Rec</span> <span class="id">k</span> (<span class="id">y</span> :: <span class="id">l</span>') <span class="id">pf</span> -&gt;<br/>
&nbsp;&nbsp;((<span class="id">fst</span> <span class="id">x</span>) = (<span class="id">fst</span> <span class="id">y</span>) /\ (<span class="id">snd</span> <span class="id">x</span>) ▹ (<span class="id">snd</span> <span class="id">y</span>) /\ <span class="id">drec</span> <span class="id">l</span> ▹ <span class="id">Rec</span> <span class="id">k</span> <span class="id">l</span>' <span class="id">pf</span>')<br/>
&nbsp;&nbsp;\/ ((<span class="id">fst</span> <span class="id">x</span>) &lt;&gt; (<span class="id">fst</span> <span class="id">y</span>) /\ <span class="id">drec</span> <span class="id">l</span> ▹ <span class="id">Rec</span> <span class="id">k</span> (<span class="id">y</span>::<span class="id">l</span>') <span class="id">pf</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof1386')">Proof.</div>
<div class="proofscript" id="proof1386">
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H</span>; <span class="tactic">clear</span> <span class="id">H</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H5</span>; <span class="tactic">clear</span> <span class="id">H5</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">rl_sub</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> *; <span class="tactic">try</span> <span class="tactic">discriminate</span>.<br/>
&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H2</span>; <span class="tactic">clear</span> <span class="id">H2</span>.<br/>
&nbsp;&nbsp;<span class="id">rtype_equalizer</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;<span class="tactic">intuition</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">p</span>; <span class="tactic">destruct</span> <span class="id">x</span>; <span class="tactic">destruct</span> <span class="id">y</span>; <span class="tactic">destruct</span> <span class="id">y0</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> *; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H3</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;- <span class="id">left</span>; <span class="tactic">intuition</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">econstructor</span>; <span class="tactic">try</span> <span class="tactic">apply</span> <span class="id">H7</span>; <span class="tactic">trivial</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">is_list_sorted_cons_inv</span>; <span class="id">eassumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">kc</span>; <span class="id">specialize</span> (<span class="id">H4</span> <span class="id">kc</span>); <span class="tactic">inversion</span> <span class="id">H4</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">trivial</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">assert</span> (<span class="id">neq</span>:<span class="id">s2</span> = <span class="id">s1</span> -&gt; <span class="id">False</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">intro</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">generalize</span> <span class="id">pf</span>'0.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">generalize</span> (<span class="id">sublist_In</span> <span class="id">H1</span> (<span class="id">s1</span>, <span class="id">r0</span>)); <span class="tactic">clear</span>; <span class="tactic">simpl</span>; <span class="tactic">intuition</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> (@<span class="id">is_list_sorted_cons</span> <span class="id">string</span>) <span class="kwd">in</span> <span class="id">pf</span>'0.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> (@<span class="id">is_list_sorted_cons</span> <span class="id">string</span>) <span class="kwd">in</span> <span class="id">pf</span>'0.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">is_list_sorted_NoDup</span> <span class="kwd">in</span> <span class="id">pf</span>'0<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;; [ | <span class="tactic">eapply</span> <span class="id">StringOrder.lt_strorder</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">pf</span>'0; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">in_dom</span> <span class="kwd">in</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">tauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">right</span>; <span class="tactic">split</span>; <span class="tactic">trivial</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">econstructor</span>; <span class="tactic">try</span> <span class="tactic">apply</span> <span class="id">H1</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> (<span class="id">is_list_sorted_cons_inv</span> <span class="id">_</span> <span class="id">pf</span>'0).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">kc</span>; <span class="id">specialize</span> (<span class="id">H4</span> <span class="id">kc</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H4</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">elim</span> <span class="id">neq</span>; <span class="tactic">trivial</span>.<br/>
Qed.</div>
&nbsp;&nbsp;<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">sorted_forall_sorted</span> (<span class="id">dl</span>:<span class="id">list</span> (<span class="id">string</span>*<span class="id">data</span>)) (τ:<span class="id">list</span> (<span class="id">string</span>*<span class="id">rtype</span>)):<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">is_list_sorted</span> <span class="id">ODT_lt_dec</span> (<span class="id">domain</span> τ) = <span class="id">true</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Forall2</span> (<span class="kwd">fun</span> (<span class="id">d</span> : <span class="id">string</span> * <span class="id">data</span>) (<span class="id">r</span> : <span class="id">string</span> * <span class="id">rtype</span>) =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">fst</span> <span class="id">d</span> = <span class="id">fst</span> <span class="id">r</span> /\ <span class="id">data_type</span> (<span class="id">snd</span> <span class="id">d</span>) (<span class="id">snd</span> <span class="id">r</span>)) <span class="id">dl</span> τ -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">is_list_sorted</span> <span class="id">ODT_lt_dec</span> (<span class="id">domain</span> <span class="id">dl</span>) = <span class="id">true</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof1387')">Proof.</div>
<div class="proofscript" id="proof1387">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">domain</span> <span class="id">dl</span> = <span class="id">domain</span> τ).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">sorted_forall_same_domain</span>; <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H1</span>; <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">insert_and_foralls_mean_same_sort</span> <span class="id">l1</span> <span class="id">l2</span> τ₁ τ₂ <span class="id">x</span> <span class="id">y</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">is_list_sorted</span> <span class="id">ODT_lt_dec</span> (<span class="id">domain</span> (<span class="id">rec_sort</span> (τ₁ ++ τ₂))) = <span class="id">true</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Forall2</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">fun</span> (<span class="id">d</span> : <span class="id">string</span> * <span class="id">data</span>) (<span class="id">r</span> : <span class="id">string</span> * <span class="id">rtype</span>) =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">fst</span> <span class="id">d</span> = <span class="id">fst</span> <span class="id">r</span> /\ <span class="id">data_type</span> (<span class="id">snd</span> <span class="id">d</span>) (<span class="id">snd</span> <span class="id">r</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">rec_sort</span> (<span class="id">l1</span> ++ <span class="id">l2</span>)) (<span class="id">rec_sort</span> (τ₁ ++ τ₂)) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">fst</span> <span class="id">x</span> = <span class="id">fst</span> <span class="id">y</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">is_list_sorted</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ODT_lt_dec</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">domain</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">insertion_sort_insert</span> <span class="id">rec_field_lt_dec</span> <span class="id">y</span> (<span class="id">rec_sort</span> (τ₁ ++ τ₂)))) = <span class="id">true</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">is_list_sorted</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ODT_lt_dec</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">domain</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">insertion_sort_insert</span> <span class="id">rec_field_lt_dec</span> <span class="id">x</span> (<span class="id">rec_sort</span> (<span class="id">l1</span> ++ <span class="id">l2</span>)))) = <span class="id">true</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof1388')">Proof.</div>
<div class="proofscript" id="proof1388">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">domain</span> (<span class="id">rec_sort</span> (<span class="id">l1</span> ++ <span class="id">l2</span>)) = <span class="id">domain</span> (<span class="id">rec_sort</span> (τ₁ ++ τ₂))).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">sorted_forall_same_domain</span>; <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">domain</span> (<span class="id">insertion_sort_insert</span> <span class="id">rec_field_lt_dec</span> <span class="id">x</span> (<span class="id">rec_sort</span> (<span class="id">l1</span> ++ <span class="id">l2</span>))) =<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">domain</span> (<span class="id">insertion_sort_insert</span> <span class="id">rec_field_lt_dec</span> <span class="id">y</span> (<span class="id">rec_sort</span> (τ₁ ++ τ₂)))).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">generalize</span> (<span class="id">same_domain_insert</span> (<span class="id">rec_sort</span> (<span class="id">l1</span>++<span class="id">l2</span>)) (<span class="id">rec_sort</span> (τ₁++τ₂)) <span class="id">x</span> <span class="id">y</span>); <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">rec_cons_sort</span> <span class="kwd">in</span> *. <span class="tactic">rewrite</span> <span class="id">H4</span>; <span class="tactic">try</span> <span class="tactic">assumption</span>; <span class="tactic">try</span> <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H4</span>; <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">sorted_cons_skip</span> {<span class="id">A</span>} (<span class="id">l</span>:<span class="id">list</span> (<span class="id">string</span>*<span class="id">A</span>)) (<span class="id">x</span> <span class="id">x0</span>:<span class="id">string</span>*<span class="id">A</span>) :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">is_list_sorted</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ODT_lt_dec</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">domain</span> (<span class="id">rec_cons_sort</span> <span class="id">x</span> (<span class="id">x0</span> :: <span class="id">l</span>))) = <span class="id">true</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;-&gt; <span class="id">is_list_sorted</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ODT_lt_dec</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">domain</span> (<span class="id">rec_cons_sort</span> <span class="id">x</span> <span class="id">l</span>)) = <span class="id">true</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof1389')">Proof.</div>
<div class="proofscript" id="proof1389">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">revert</span> <span class="id">H</span>; <span class="tactic">elim</span> (<span class="id">rec_field_lt_dec</span> <span class="id">x</span> <span class="id">x0</span>); <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">is_list_sorted</span> <span class="id">ODT_lt_dec</span> (<span class="id">domain</span> (<span class="id">x</span> :: <span class="id">l</span>)) = <span class="id">true</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> (@<span class="id">rec_sorted_skip_second</span> <span class="id">string</span> <span class="id">ODT_string</span> <span class="id">_</span> <span class="id">l</span> <span class="id">x</span> <span class="id">x0</span>); <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> ((<span class="id">rec_cons_sort</span> <span class="id">x</span> <span class="id">l</span>) = <span class="id">x</span>::<span class="id">l</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">rec_cons_sorted_id</span>; <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H1</span>; <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">revert</span> <span class="id">H</span>; <span class="tactic">elim</span> (<span class="id">rec_field_lt_dec</span> <span class="id">x0</span> <span class="id">x</span>); <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> (@<span class="id">rec_sorted_skip_first</span> <span class="id">string</span> <span class="id">ODT_string</span> <span class="id">_</span> (<span class="id">rec_cons_sort</span> <span class="id">x</span> <span class="id">l</span>) <span class="id">x0</span>); <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">fst</span> <span class="id">x</span> = <span class="id">fst</span> <span class="id">x0</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">lt_contr1</span>; <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">H0</span> <span class="kwd">in</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> ((<span class="id">rec_cons_sort</span> <span class="id">x</span> <span class="id">l</span>) = <span class="id">x</span>::<span class="id">l</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">rec_cons_sorted_id</span>; <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H1</span>; <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">Forall2_cons_sorted</span> <span class="id">l1</span> <span class="id">l2</span> <span class="id">x</span> <span class="id">y</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Forall2</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">fun</span> (<span class="id">d</span> : <span class="id">string</span> * <span class="id">data</span>) (<span class="id">r</span> : <span class="id">string</span> * <span class="id">rtype</span>) =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">fst</span> <span class="id">d</span> = <span class="id">fst</span> <span class="id">r</span> /\ <span class="id">data_type</span> (<span class="id">snd</span> <span class="id">d</span>) (<span class="id">snd</span> <span class="id">r</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">l1</span> <span class="id">l2</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">is_list_sorted</span> <span class="id">ODT_lt_dec</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">domain</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">insertion_sort_insert</span> <span class="id">rec_field_lt_dec</span> <span class="id">x</span> <span class="id">l1</span>)) =<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">true</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">is_list_sorted</span> <span class="id">ODT_lt_dec</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">domain</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">insertion_sort_insert</span> <span class="id">rec_field_lt_dec</span> <span class="id">y</span> <span class="id">l2</span>)) =<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">true</span> -&gt; <span class="id">fst</span> <span class="id">x</span> = <span class="id">fst</span> <span class="id">y</span> -&gt; <span class="id">data_type</span> (<span class="id">snd</span> <span class="id">x</span>) (<span class="id">snd</span> <span class="id">y</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Forall2</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">fun</span> (<span class="id">d</span> : <span class="id">string</span> * <span class="id">data</span>) (<span class="id">r</span> : <span class="id">string</span> * <span class="id">rtype</span>) =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">fst</span> <span class="id">d</span> = <span class="id">fst</span> <span class="id">r</span> /\ <span class="id">data_type</span> (<span class="id">snd</span> <span class="id">d</span>) (<span class="id">snd</span> <span class="id">r</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">insertion_sort_insert</span> <span class="id">rec_field_lt_dec</span> <span class="id">x</span> <span class="id">l1</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">insertion_sort_insert</span> <span class="id">rec_field_lt_dec</span> <span class="id">y</span> <span class="id">l2</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof1390')">Proof.</div>
<div class="proofscript" id="proof1390">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">apply</span> <span class="id">Forall2_cons</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>; <span class="tactic">assumption</span>; <span class="tactic">apply</span> <span class="id">Forall2_nil</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">Forall2_nil</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">assert</span> (<span class="id">is_list_sorted</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ODT_lt_dec</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">domain</span> (<span class="id">insertion_sort_insert</span> <span class="id">rec_field_lt_dec</span> <span class="id">x</span> <span class="id">l</span>)) = <span class="id">true</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">by</span> (<span class="tactic">apply</span> (<span class="id">sorted_cons_skip</span> <span class="id">l</span> <span class="id">x</span> <span class="id">x0</span>); <span class="tactic">assumption</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">is_list_sorted</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ODT_lt_dec</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">domain</span> (<span class="id">insertion_sort_insert</span> <span class="id">rec_field_lt_dec</span> <span class="id">y</span> <span class="id">l</span>')) = <span class="id">true</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">by</span> (<span class="tactic">apply</span> (<span class="id">sorted_cons_skip</span> <span class="id">l</span>' <span class="id">y</span> <span class="id">y0</span>); <span class="tactic">assumption</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id">IHForall2</span> <span class="id">H5</span> <span class="id">H6</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">revert</span> <span class="id">H0</span> <span class="id">H1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">elim</span> (<span class="id">rec_field_lt_dec</span> <span class="id">x</span> <span class="id">x0</span>); <span class="tactic">elim</span> (<span class="id">rec_field_lt_dec</span> <span class="id">y</span> <span class="id">y0</span>); <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">apply</span> <span class="id">Forall2_cons</span>. <span class="tactic">split</span>; <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">Forall2_cons</span>; <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">revert</span> <span class="id">H1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">elim</span> (<span class="id">rec_field_lt_dec</span> <span class="id">y0</span> <span class="id">y</span>); <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">Forall2_cons</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">elim</span> <span class="id">H</span>; <span class="tactic">intros</span>; <span class="tactic">clear</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">elim</span> <span class="id">H</span>; <span class="tactic">intros</span>; <span class="tactic">clear</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> ((<span class="id">fst</span> <span class="id">y</span>) = (<span class="id">fst</span> <span class="id">y0</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">lt_contr1</span>; <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> ((<span class="id">fst</span> <span class="id">x</span>) = (<span class="id">fst</span> <span class="id">x0</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">elim</span> <span class="id">H</span>; <span class="tactic">intros</span>; <span class="tactic">clear</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">H7</span> <span class="kwd">in</span> <span class="id">H8</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">H2</span> <span class="kwd">in</span> <span class="id">H8</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H8</span>; <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">revert</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">elim</span> (<span class="id">rec_field_lt_dec</span> <span class="id">x0</span> <span class="id">x</span>); <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">Forall2_cons</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">elim</span> <span class="id">H</span>; <span class="tactic">intros</span>; <span class="tactic">clear</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">elim</span> <span class="id">H</span>; <span class="tactic">intros</span>; <span class="tactic">clear</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> ((<span class="id">fst</span> <span class="id">x</span>) = (<span class="id">fst</span> <span class="id">x0</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">lt_contr1</span>; <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> ((<span class="id">fst</span> <span class="id">y</span>) = (<span class="id">fst</span> <span class="id">y0</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">elim</span> <span class="id">H</span>; <span class="tactic">intros</span>; <span class="tactic">clear</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">H8</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">H2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">revert</span> <span class="id">H0</span> <span class="id">H1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">elim</span> (<span class="id">rec_field_lt_dec</span> <span class="id">x0</span> <span class="id">x</span>); <span class="tactic">elim</span> (<span class="id">rec_field_lt_dec</span> <span class="id">y0</span> <span class="id">y</span>); <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">Forall2_cons</span>; <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> ((<span class="id">fst</span> <span class="id">y</span>) = (<span class="id">fst</span> <span class="id">y0</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">lt_contr1</span>; <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> ((<span class="id">fst</span> <span class="id">x</span>) = (<span class="id">fst</span> <span class="id">x0</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">elim</span> <span class="id">H</span>; <span class="tactic">intros</span>; <span class="tactic">clear</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">H7</span> <span class="kwd">in</span> <span class="id">H8</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">H2</span> <span class="kwd">in</span> <span class="id">H8</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H8</span>; <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> ((<span class="id">fst</span> <span class="id">x</span>) = (<span class="id">fst</span> <span class="id">x0</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">lt_contr1</span>; <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> ((<span class="id">fst</span> <span class="id">y</span>) = (<span class="id">fst</span> <span class="id">y0</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">elim</span> <span class="id">H</span>; <span class="tactic">intros</span>; <span class="tactic">clear</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">H8</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">H2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">Forall2_cons</span>; <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">dtrec_rec_concat_sort</span> {<span class="id">x</span> <span class="id">xt</span> <span class="id">pfx</span> <span class="id">y</span> <span class="id">yt</span> <span class="id">pfy</span>} <span class="id">pxyt</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">drec</span> <span class="id">x</span> ▹ <span class="id">Rec</span> <span class="id">Closed</span> <span class="id">xt</span> <span class="id">pfx</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">drec</span> <span class="id">y</span> ▹ <span class="id">Rec</span> <span class="id">Closed</span> <span class="id">yt</span> <span class="id">pfy</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">drec</span> (<span class="id">rec_concat_sort</span> <span class="id">x</span> <span class="id">y</span>) ▹ <span class="id">Rec</span> <span class="id">Closed</span> (<span class="id">rec_concat_sort</span> <span class="id">xt</span> <span class="id">yt</span>) <span class="id">pxyt</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof1391')">Proof.</div>
<div class="proofscript" id="proof1391">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">typ1</span> <span class="id">typ2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">dtrec_closed_inv</span> <span class="kwd">in</span> <span class="id">typ1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">dtrec_closed_inv</span> <span class="kwd">in</span> <span class="id">typ2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">dtrec_full</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">rec_concat_sort</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">rec_sort_Forall2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">repeat</span> <span class="tactic">rewrite</span> <span class="id">domain_app</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> (<span class="id">sorted_forall_same_domain</span> <span class="id">typ1</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> (<span class="id">sorted_forall_same_domain</span> <span class="id">typ2</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">trivial</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">apply</span> <span class="id">Forall2_app</span>; <span class="tactic">trivial</span>.<br/>
&nbsp;&nbsp;Qed.</div>
&nbsp;&nbsp;<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">dttop</span>' <span class="id">d</span> : <span class="id">data_normalized</span> <span class="id">brand_relation_brands</span> <span class="id">d</span> -&gt; <span class="id">d</span> ▹ ⊤.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof1392')">Proof.</div>
<div class="proofscript" id="proof1392">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">dttop</span>.<br/>
&nbsp;&nbsp;Qed.</div>
&nbsp;&nbsp;<span class="kwd">Hint</span> <span class="kwd">Resolve</span> <span class="id">dttop</span> <span class="id">dttop</span>'.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">Forall_map</span> {<span class="id">A</span> <span class="id">B</span>} <span class="id">P</span> (<span class="id">f</span>:<span class="id">A</span>-&gt;<span class="id">B</span>) <span class="id">l</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Forall</span> <span class="id">P</span> (<span class="id">map</span> <span class="id">f</span> <span class="id">l</span>) &lt;-&gt; <span class="id">Forall</span> (<span class="kwd">fun</span> <span class="id">x</span> =&gt; <span class="id">P</span> (<span class="id">f</span> <span class="id">x</span>)) <span class="id">l</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof1393')">Proof.</div>
<div class="proofscript" id="proof1393">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">l</span>; <span class="tactic">simpl</span>; <span class="tactic">intuition</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">inversion</span> <span class="id">H1</span>; <span class="tactic">subst</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">inversion</span> <span class="id">H1</span>; <span class="tactic">subst</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
<div class="doc">Well typed data must be normalized </div>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">data_type_normalized</span> <span class="id">d</span> τ :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">d</span> ▹ τ -&gt; <span class="id">data_normalized</span> <span class="id">brand_relation_brands</span> <span class="id">d</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof1394')">Proof.</div>
<div class="proofscript" id="proof1394">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Hint</span> <span class="id">Constructors</span> <span class="id">data_normalized</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">revert</span> τ.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">d</span> <span class="kwd">using</span> <span class="id">dataInd2</span>; <span class="tactic">intros</span>; <span class="tactic">try</span> <span class="tactic">assumption</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> *;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">auto</span> 2.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">constructor</span>. <span class="tactic">inversion</span> <span class="id">H0</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">inversion</span> <span class="id">H1</span>; <span class="tactic">trivial</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">revert</span> <span class="id">H2</span>; <span class="tactic">apply</span> <span class="id">Forall_impl_in</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">inversion</span> <span class="id">H0</span>; <span class="tactic">subst</span>; <span class="tactic">trivial</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">constructor</span>; <span class="tactic">trivial</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">apply</span> <span class="id">Forall_forall</span>. <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">x</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id">H</span> <span class="id">_</span> <span class="id">_</span> <span class="id">H1</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">revert</span> <span class="id">H</span> <span class="id">H1</span> <span class="id">H4</span>. <span class="tactic">clear</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">revert</span> <span class="id">rl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">r</span>; <span class="tactic">inversion</span> 3; <span class="tactic">subst</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> *;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intuition</span>; <span class="tactic">subst</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> *; <span class="tactic">subst</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">apply</span> <span class="id">sorted_forall_same_domain</span> <span class="kwd">in</span> <span class="id">H4</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H4</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">trivial</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">inversion</span> <span class="id">H</span>; <span class="tactic">subst</span>; <span class="tactic">trivial</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">inversion</span> <span class="id">H</span>; <span class="tactic">subst</span>; <span class="tactic">trivial</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">inversion</span> <span class="id">H</span>; <span class="tactic">subst</span>; <span class="tactic">trivial</span>; <span class="id">constructor</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">invcs</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">constructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">foreign_data_typing_normalized</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
<div class="doc">Lemma showing that normalization preserves typing </div>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">normalize_preserves_type</span> <span class="id">d</span> τ :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">d</span> ▹ τ -&gt; <span class="id">normalize_data</span> <span class="id">brand_relation_brands</span> <span class="id">d</span> ▹ τ.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof1395')">Proof.</div>
<div class="proofscript" id="proof1395">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">normalize_normalized_eq</span>; <span class="tactic">trivial</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">data_type_normalized</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;Qed.</div>
&nbsp;&nbsp;<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">dttop_weaken</span> {<span class="id">d</span> τ} : <span class="id">data_type</span> <span class="id">d</span> τ -&gt; <span class="id">data_type</span> <span class="id">d</span> ⊤.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof1396')">Proof.</div>
<div class="proofscript" id="proof1396">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">H</span>; <span class="tactic">apply</span> <span class="id">data_type_normalized</span> <span class="kwd">in</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">auto</span> 2.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
<span class="kwd">End</span> <span class="id">TData</span>.<br/>
<br/>
<span class="kwd">Notation</span> "<span class="id">d</span> ▹ <span class="id">r</span>" := (<span class="id">data_type</span> <span class="id">d</span> <span class="id">r</span>) (<span class="tactic">at</span> <span class="id">level</span> 70). <br/>
<br/>
<span class="kwd">Ltac</span> <span class="id">dtype_inverter</span><br/>
&nbsp;&nbsp;:= <span class="tactic">repeat</span> <span class="tactic">progress</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| [<span class="id">H</span>:?<span class="id">d</span> ▹ <span class="id">Unit</span> |- <span class="id">_</span> ] =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">data_type_Unit_inv</span> <span class="kwd">in</span> <span class="id">H</span>; <span class="tactic">try</span> <span class="tactic">subst</span> <span class="id">d</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| [<span class="id">H</span>:?<span class="id">d</span> ▹ <span class="id">Nat</span> |- <span class="id">_</span> ] =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">data_type_Nat_inv</span> <span class="kwd">in</span> <span class="id">H</span>; <span class="tactic">destruct</span> <span class="id">H</span>; <span class="tactic">try</span> <span class="tactic">subst</span> <span class="id">d</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| [<span class="id">H</span>:?<span class="id">d</span> ▹ <span class="id">Bool</span> |- <span class="id">_</span> ] =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">data_type_Bool_inv</span> <span class="kwd">in</span> <span class="id">H</span>;  <span class="tactic">destruct</span> <span class="id">H</span>; <span class="tactic">try</span> <span class="tactic">subst</span> <span class="id">d</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| [<span class="id">H</span>:?<span class="id">d</span> ▹ <span class="id">String</span> |- <span class="id">_</span> ] =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">data_type_String_inv</span> <span class="kwd">in</span> <span class="id">H</span>;  <span class="tactic">destruct</span> <span class="id">H</span>; <span class="tactic">try</span> <span class="tactic">subst</span> <span class="id">d</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| [<span class="id">H</span>:?<span class="id">d</span> ▹ (<span class="id">Coll</span> ?τ) |- <span class="id">_</span> ] =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">d</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">dcoll</span> ?<span class="id">d</span> =&gt; <span class="tactic">fail</span> 1<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">_</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">XX</span> := <span class="tactic">fresh</span> <span class="kwd">in</span> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">data_type_Col_inv</span> <span class="id">H</span>) <span class="kwd">as</span> [<span class="id">XX</span> ?];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="tactic">discriminate</span> || (<span class="tactic">subst</span> <span class="id">d</span>; <span class="tactic">rename</span> <span class="id">XX</span> <span class="id">into</span> <span class="id">d</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| [<span class="id">H</span>:?<span class="id">d</span> ▹ <span class="id">Arrow</span> <span class="id">_</span> <span class="id">_</span> |- <span class="id">_</span> ] =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">data_type_Arrow_inv</span> <span class="kwd">in</span> <span class="id">H</span>; <span class="tactic">tauto</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| [<span class="id">H</span>:?<span class="id">d</span> ▹ (<span class="id">Foreign</span> ?τ) |- <span class="id">_</span> ] =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">d</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">dforeign</span> <span class="id">_</span> =&gt; <span class="tactic">fail</span> 1<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">_</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">XX</span> := <span class="tactic">fresh</span> <span class="kwd">in</span> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">data_type_Foreign_inv</span> <span class="id">H</span>) <span class="kwd">as</span> [<span class="id">XX</span> ?];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="tactic">discriminate</span> || (<span class="tactic">subst</span> <span class="id">d</span>; <span class="tactic">rename</span> <span class="id">XX</span> <span class="id">into</span> <span class="id">d</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| [<span class="id">H</span>:?<span class="id">d</span> ▹ (<span class="id">Brand</span> <span class="id">_</span>) |- <span class="id">_</span> ] =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">d</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">dbrand</span> <span class="id">_</span> <span class="id">_</span> =&gt; <span class="tactic">fail</span> 1<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">_</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">XX</span> := <span class="tactic">fresh</span> <span class="kwd">in</span> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">data_type_Brand_inv</span> <span class="id">H</span>) <span class="kwd">as</span> [? [<span class="id">XX</span> ?]];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="tactic">discriminate</span> || (<span class="tactic">subst</span> <span class="id">d</span>; <span class="tactic">rename</span> <span class="id">XX</span> <span class="id">into</span> <span class="id">d</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| [<span class="id">H</span>:?<span class="id">d</span> ▹ (<span class="id">Rec</span> ?<span class="id">k</span> ?τ ?<span class="id">pf</span>) |- <span class="id">_</span> ] =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">d</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">drec</span> <span class="id">_</span> =&gt; <span class="tactic">fail</span> 1<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">_</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">XX</span> := <span class="tactic">fresh</span> <span class="kwd">in</span> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">data_type_Rec_inv</span> <span class="id">H</span>) <span class="kwd">as</span> [<span class="id">XX</span> ?];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="tactic">discriminate</span> || (<span class="tactic">subst</span> <span class="id">d</span>; <span class="tactic">rename</span> <span class="id">XX</span> <span class="id">into</span> <span class="id">d</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|   [<span class="id">H</span>:?<span class="id">d</span> ▹ <span class="id">Bool</span> |- <span class="id">_</span> ] =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">XX</span> := <span class="tactic">fresh</span> <span class="kwd">in</span> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">data_type_Bool_inv</span> <span class="id">H</span>) <span class="kwd">as</span> [<span class="id">XX</span> ?]; <span class="tactic">try</span> <span class="tactic">subst</span> <span class="id">d</span>; <span class="tactic">clear</span> <span class="id">H</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rename</span> <span class="id">XX</span> <span class="id">into</span> <span class="id">d</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| [<span class="id">H</span>:<span class="id">proj1_sig</span> <span class="id">_</span> =<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Rec</span>₀ <span class="id">Closed</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">map</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">fun</span> <span class="id">x</span> : <span class="id">string</span> * {τ₀ : <span class="id">rtype</span>₀ | <span class="id">wf_rtype</span>₀ τ₀ = <span class="id">true</span>} =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">fst</span> <span class="id">x</span>, <span class="id">proj1_sig</span> (<span class="id">snd</span> <span class="id">x</span>))) <span class="id">_</span>) |- <span class="id">_</span> ] <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&gt; <span class="tactic">apply</span> <span class="id">Rec</span>₀<span class="id">_eq_proj1_Rec</span> <span class="kwd">in</span> <span class="id">H</span>; <span class="tactic">destruct</span> <span class="id">H</span> <span class="kwd">as</span> [??]<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>; <span class="tactic">simpl</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Ltac</span> <span class="id">dtype_inverter_with_either</span> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;:= <span class="tactic">repeat</span> <span class="tactic">progress</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">try</span> <span class="id">dtype_inverter</span>; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">try</span> <span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| [<span class="id">H</span>:?<span class="id">d</span> ▹ (<span class="id">Either</span> <span class="id">_</span> <span class="id">_</span>) |- <span class="id">_</span> ] =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">d</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">dleft</span> ?<span class="id">d</span> =&gt; <span class="tactic">fail</span> 1<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">dright</span> ?<span class="id">d</span> =&gt; <span class="tactic">fail</span> 1<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">_</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">XX</span> := <span class="tactic">fresh</span> <span class="kwd">in</span> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">data_type_Either_inv</span> <span class="id">H</span>) <span class="kwd">as</span> [[<span class="id">XX</span> [??]]|[<span class="id">XX</span> [??]]];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="tactic">discriminate</span> || (<span class="tactic">subst</span> <span class="id">d</span>; <span class="tactic">rename</span> <span class="id">XX</span> <span class="id">into</span> <span class="id">d</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Ltac</span> <span class="id">dtype_enrich</span> :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| [<span class="id">H</span>: <span class="id">In</span> ?<span class="id">a</span> ?<span class="id">l</span>, <span class="id">H2</span>: (<span class="id">dcoll</span> ?<span class="id">l</span>) ▹ (<span class="id">Coll</span> ?τ) |- <span class="id">_</span> ] =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">extend</span> (<span class="id">dcoll_coll_in_inv</span> <span class="id">H</span> <span class="id">H2</span>)<br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Hint</span> <span class="kwd">Immediate</span> <span class="id">dttop</span> <span class="id">dttop</span>'.<br/>
<span class="kwd">Hint</span> <span class="kwd">Resolve</span> <span class="id">dttop_weaken</span>.<br/>
<br/>
<span class="kwd">Section</span> <span class="id">rmap</span>.<br/>
&nbsp;&nbsp;<span class="kwd">Context</span> {<span class="id">fdata</span>:<span class="id">foreign_data</span>}.<br/>
&nbsp;&nbsp;<span class="kwd">Context</span> {<span class="id">ftype</span>:<span class="id">foreign_type</span>}.<br/>
&nbsp;&nbsp;<span class="kwd">Context</span> {<span class="id">fdtyping</span>:<span class="id">foreign_data_typing</span>}.<br/>
&nbsp;&nbsp;<span class="kwd">Context</span> {<span class="id">m</span>:<span class="id">brand_model</span>}.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">rmap_concat_empty_right</span> τ <span class="id">pf</span> <span class="id">l</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Forall</span> (<span class="kwd">fun</span> <span class="id">d</span> : <span class="id">data</span> =&gt; <span class="id">d</span> ▹ <span class="id">Rec</span> <span class="id">Closed</span> τ <span class="id">pf</span>) <span class="id">l</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">rmap_concat</span> (<span class="kwd">fun</span> <span class="id">_</span> : <span class="id">data</span> =&gt; <span class="id">Some</span> (<span class="id">dcoll</span> (<span class="id">drec</span> <span class="id">nil</span> :: <span class="id">nil</span>))) <span class="id">l</span>) = <span class="id">Some</span> <span class="id">l</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof1397')">Proof.</div>
<div class="proofscript" id="proof1397">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">l</span>; <span class="tactic">simpl</span>; <span class="tactic">unfold</span> <span class="id">rmap_concat</span> <span class="kwd">in</span> *; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">inversion</span> <span class="id">H</span>; <span class="tactic">clear</span> <span class="id">H</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id">IHl</span> <span class="id">H3</span>); <span class="tactic">clear</span> <span class="id">H3</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">IHl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">dtype_inverter</span>. <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">rec_concat_sort</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">app_nil_r</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">rec_sort</span> <span class="id">dl</span> = <span class="id">dl</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">clear</span> <span class="id">a</span> <span class="id">e</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">sort_sorted_is_id</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> (<span class="id">same_domain_same_sorted</span> <span class="id">rl</span> <span class="id">dl</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> <span class="id">pf</span>' <span class="id">H0</span> <span class="id">H2</span> <span class="id">H4</span> <span class="id">H1</span> <span class="id">rl_sub</span> <span class="id">IHl</span> <span class="id">pf</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">domain</span> <span class="id">dl</span> = <span class="id">domain</span> <span class="id">rl</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> (<span class="id">sorted_forall_same_domain</span>); <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">rewrite</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;Qed.</div>
&nbsp;&nbsp;<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">rmap_concat_empty_left</span> τ <span class="id">pf</span> <span class="id">l</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Forall</span> (<span class="kwd">fun</span> <span class="id">d</span> : <span class="id">data</span> =&gt; <span class="id">d</span> ▹ <span class="id">Rec</span> <span class="id">Closed</span> τ <span class="id">pf</span>) <span class="id">l</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">rmap_concat</span> (<span class="kwd">fun</span> <span class="id">_</span> : <span class="id">data</span> =&gt; <span class="id">Some</span> (<span class="id">dcoll</span> <span class="id">l</span>)) (<span class="id">drec</span> <span class="id">nil</span>::<span class="id">nil</span>)) = <span class="id">Some</span> <span class="id">l</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof1398')">Proof.</div>
<div class="proofscript" id="proof1398">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">l</span>; <span class="tactic">simpl</span>; <span class="tactic">unfold</span> <span class="id">rmap_concat</span> <span class="kwd">in</span> *; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">inversion</span> <span class="id">H</span>; <span class="tactic">clear</span> <span class="id">H</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id">IHl</span> <span class="id">H3</span>); <span class="tactic">clear</span> <span class="id">H3</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">oflat_map</span> <span class="kwd">in</span> <span class="id">IHl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">oomap_concat</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">omap_concat</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">dtype_inverter</span>. <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">rec_concat_sort</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">app_nil_l</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">rec_sort</span> <span class="id">dl</span> = <span class="id">dl</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">clear</span> <span class="id">a</span> <span class="id">e</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">sort_sorted_is_id</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> (<span class="id">same_domain_same_sorted</span> <span class="id">rl</span> <span class="id">dl</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> <span class="id">pf</span>' <span class="id">H0</span> <span class="id">H2</span> <span class="id">H4</span> <span class="id">H1</span> <span class="id">rl_sub</span> <span class="id">IHl</span> <span class="id">pf</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">domain</span> <span class="id">dl</span> = <span class="id">domain</span> <span class="id">rl</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> (<span class="id">sorted_forall_same_domain</span>); <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">destruct</span> (<span class="id">rmap</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">fun</span> <span class="id">x</span> : <span class="id">data</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">x</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">dunit</span> =&gt; <span class="id">None</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">dnat</span> <span class="id">_</span> =&gt; <span class="id">None</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">dbool</span> <span class="id">_</span> =&gt; <span class="id">None</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">dstring</span> <span class="id">_</span> =&gt; <span class="id">None</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">dcoll</span> <span class="id">_</span> =&gt; <span class="id">None</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">drec</span> <span class="id">r1</span> =&gt; <span class="id">Some</span> (<span class="id">drec</span> (<span class="id">rec_sort</span> (<span class="id">nil</span> ++ <span class="id">r1</span>)))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">dleft</span> <span class="id">_</span> =&gt; <span class="id">None</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">dright</span> <span class="id">_</span> =&gt; <span class="id">None</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">dbrand</span> <span class="id">_</span> <span class="id">_</span> =&gt; <span class="id">None</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">dforeign</span> <span class="id">_</span> =&gt; <span class="id">None</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>) <span class="id">l</span>); <span class="tactic">simpl</span> <span class="kwd">in</span> *; <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;Qed.</div>
&nbsp;&nbsp;&nbsp;&nbsp;<br/>
<span class="kwd">End</span> <span class="id">rmap</span>.<br/>
<br/>
<span class="kwd">Section</span> <span class="id">subtype</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">subtype_Rec_sublist_strengthen</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<span class="id">fdata</span>:<span class="id">foreign_data</span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<span class="id">ftype</span>:<span class="id">foreign_type</span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<span class="id">fdtyping</span>:<span class="id">foreign_data_typing</span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<span class="id">m</span>:<span class="id">brand_model</span>} {<span class="id">dl</span> <span class="id">rl</span> <span class="id">srl</span> <span class="id">k1</span> <span class="id">pf</span> <span class="id">srl0</span> <span class="id">pf0</span> <span class="id">k2</span>} :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">f2</span>:<span class="id">Forall2</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">fun</span> (<span class="id">d</span> : <span class="id">string</span> * <span class="id">data</span>) (<span class="id">r</span> : <span class="id">string</span> * <span class="id">rtype</span>) =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">fst</span> <span class="id">d</span> = <span class="id">fst</span> <span class="id">r</span> /\ <span class="id">data_type</span> (<span class="id">snd</span> <span class="id">d</span>) (<span class="id">snd</span> <span class="id">r</span>)) <span class="id">dl</span> <span class="id">rl</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">subl</span>:<span class="id">sublist</span> <span class="id">srl</span> <span class="id">rl</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">subt</span>:<span class="id">Rec</span> <span class="id">k1</span> <span class="id">srl</span> <span class="id">pf</span> &lt;: <span class="id">Rec</span> <span class="id">k2</span> <span class="id">srl0</span> <span class="id">pf0</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">pf3</span>:<span class="id">is_list_sorted</span> <span class="id">ODT_lt_dec</span> (<span class="id">domain</span> <span class="id">rl</span>) = <span class="id">true</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">ft</span>:<span class="id">Forallt</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">fun</span> <span class="id">ab</span> : <span class="id">string</span> * <span class="id">rtype</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">d</span> : <span class="id">data</span>) (τ₂ : <span class="id">rtype</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">snd</span> <span class="id">ab</span> &lt;: τ₂ -&gt; <span class="id">data_type</span> <span class="id">d</span> (<span class="id">snd</span> <span class="id">ab</span>) -&gt; <span class="id">data_type</span> <span class="id">d</span> τ₂) <span class="id">srl</span>),<br/>
&nbsp;&nbsp;<span class="id">exists</span> <span class="id">l2</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Forall2</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">fun</span> (<span class="id">d</span> : <span class="id">string</span> * <span class="id">data</span>) (<span class="id">r</span> : <span class="id">string</span> * <span class="id">rtype</span>) =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">fst</span> <span class="id">d</span> = <span class="id">fst</span> <span class="id">r</span> /\ <span class="id">data_type</span> (<span class="id">snd</span> <span class="id">d</span>) (<span class="id">snd</span> <span class="id">r</span>)) <span class="id">dl</span> <span class="id">l2</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;/\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">sublist</span> <span class="id">srl0</span> <span class="id">l2</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof1399')">Proof.</div>
<div class="proofscript" id="proof1399">
&nbsp;&nbsp;<span class="id">revert</span> <span class="id">dl</span> <span class="id">srl</span> <span class="id">k1</span> <span class="id">pf</span> <span class="id">srl0</span> <span class="id">pf0</span> <span class="id">k2</span>.<br/>
&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">rl</span>; <span class="tactic">intros</span> <span class="id">dl</span> <span class="id">srl</span> <span class="id">k1</span> <span class="id">pf</span> <span class="id">srl0</span> <span class="id">pf0</span> <span class="id">k2</span> <span class="id">f2</span> <span class="id">subl</span> <span class="id">subt</span> <span class="id">pf3</span>; <span class="tactic">inversion</span> <span class="id">f2</span>; <span class="tactic">clear</span> <span class="id">f2</span>; <span class="tactic">subst</span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;-  <span class="tactic">apply</span> <span class="id">sublist_nil_r</span> <span class="kwd">in</span> <span class="id">subl</span>; <span class="tactic">subst</span>. <span class="id">exists</span> <span class="id">nil</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">subtype_Rec_sublist</span> <span class="kwd">in</span> <span class="id">subt</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">sublist_nil_r</span> <span class="kwd">in</span> <span class="id">subt</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">domain</span> <span class="kwd">in</span> <span class="id">subt</span>; <span class="tactic">apply</span> <span class="id">map_eq_nil</span> <span class="kwd">in</span> <span class="id">subt</span>. <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intuition</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">destruct</span> <span class="id">x</span>; <span class="tactic">destruct</span> <span class="id">a</span>. <span class="tactic">unfold</span> <span class="id">fst</span>, <span class="id">snd</span> <span class="kwd">in</span> <span class="id">H2</span>; <span class="tactic">destruct</span> <span class="id">H2</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">sublist_cons_inv</span> <span class="id">subl</span> <span class="id">pf3</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">destruct</span> <span class="id">H</span> <span class="kwd">as</span> [?[??]]. <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">ft</span>; <span class="tactic">subst</span>; <span class="tactic">clear</span> <span class="id">ft</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">case_eq</span> (<span class="id">lookup</span> <span class="id">string_dec</span> <span class="id">srl0</span> <span class="id">s0</span>); <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="comment">(*&nbsp;clear&nbsp;subl.&nbsp;revert&nbsp;x&nbsp;H1&nbsp;pf&nbsp;subt.&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">srl0</span>; <span class="tactic">intros</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">H</span>; <span class="tactic">try</span> <span class="tactic">discriminate</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">p</span>. <span class="tactic">destruct</span> (<span class="id">string_dec</span> <span class="id">s0</span> <span class="id">s</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H</span>; <span class="tactic">clear</span> <span class="id">H</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">Rec_subtype_cons_inv</span> <span class="id">subt</span>) <span class="kwd">as</span> [? [??]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id">IHrl</span> <span class="id">_</span> <span class="id">_</span> <span class="id">k1</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">H3</span> <span class="id">H1</span> <span class="id">H</span> (<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">is_list_sorted_cons_inv</span> <span class="id">ODT_lt_dec</span> <span class="id">pf3</span>) <span class="id">H5</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">IHrl</span>) <span class="kwd">as</span> [? [??]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> ((<span class="id">s</span>,<span class="id">r0</span>)::<span class="id">x2</span>); <span class="tactic">intuition</span>;[ | <span class="tactic">apply</span> <span class="id">sublist_cons</span>; <span class="tactic">auto</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">constructor</span>; <span class="tactic">intuition</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">subt</span>; <span class="id">rtype_equalizer</span>; <span class="tactic">subst</span>; <span class="tactic">trivial</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">rl2</span>; <span class="tactic">inversion</span> <span class="id">H11</span>; <span class="id">rtype_equalizer</span>; <span class="tactic">clear</span> <span class="id">H11</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">rl1</span>; <span class="tactic">inversion</span> <span class="id">H8</span>; <span class="id">rtype_equalizer</span>; <span class="tactic">clear</span> <span class="id">H8</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">p</span>; <span class="tactic">destruct</span> <span class="id">p0</span>; <span class="tactic">unfold</span> <span class="id">fst</span> <span class="kwd">in</span> <span class="id">H11</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id">H10</span> <span class="id">s0</span> <span class="id">r1</span>). <span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">H10</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">string_dec</span> <span class="id">s0</span> <span class="id">s0</span>); [| <span class="tactic">congruence</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H10</span> <span class="kwd">as</span> [? [??]]; <span class="tactic">trivial</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">invcs</span> <span class="id">H7</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">generalize</span> (<span class="id">subtype_Rec_sublist</span> <span class="id">subt</span>); <span class="tactic">intros</span> <span class="id">subl</span>'.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="tactic">rewrite</span> <span class="id">domain_cons</span> <span class="kwd">in</span> <span class="id">subl</span>'; <span class="tactic">unfold</span> <span class="id">fst</span> <span class="kwd">in</span> <span class="id">subl</span>'.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">subl</span>'; <span class="tactic">subst</span>; [<span class="tactic">congruence</span> | ].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">lookup_in</span> <span class="kwd">in</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">in_dom</span> <span class="kwd">in</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">generalize</span> (<span class="id">sublist_In</span> <span class="id">H7</span> <span class="id">s0</span>); <span class="tactic">simpl</span>; <span class="tactic">intuition</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">generalize</span> (<span class="id">is_list_sorted_NoDup</span> <span class="id">_</span> <span class="id">_</span> <span class="id">pf</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> 1; <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">apply</span> <span class="id">Rec_subtype_cons_inv1</span> <span class="kwd">in</span> <span class="id">subt</span>; <span class="tactic">trivial</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">subt</span> <span class="kwd">as</span> [<span class="id">pf</span>' <span class="id">subt</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id">IHrl</span> <span class="id">_</span> <span class="id">_</span> <span class="id">k1</span> <span class="id">pf</span>' <span class="id">_</span> <span class="id">pf0</span> <span class="id">_</span> <span class="id">H3</span> <span class="id">H1</span> <span class="id">subt</span> (<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">is_list_sorted_cons_inv</span> <span class="id">ODT_lt_dec</span> <span class="id">pf3</span>) <span class="id">H5</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">IHrl</span> <span class="kwd">as</span> [? [? ?]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> ((<span class="id">s0</span>,<span class="id">r</span>)::<span class="id">x0</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intuition</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">sublist_skip</span>; <span class="tactic">auto</span> 1.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">H</span>; <span class="tactic">destruct</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id">IHrl</span> <span class="id">_</span> <span class="id">_</span> <span class="id">k1</span> <span class="id">pf</span> <span class="id">_</span> <span class="id">pf0</span> <span class="id">_</span> <span class="id">H3</span> <span class="id">H1</span> <span class="id">subt</span> (<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">is_list_sorted_cons_inv</span> <span class="id">ODT_lt_dec</span> <span class="id">pf3</span>) <span class="id">ft</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">IHrl</span> <span class="kwd">as</span> [? [? ?]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> ((<span class="id">s0</span>,<span class="id">r</span>)::<span class="id">x</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intuition</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">sublist_skip</span>; <span class="tactic">auto</span> 1.<br/>
Qed.</div>
<br/>
<span class="kwd">Global</span> <span class="kwd">Instance</span> <span class="id">data_type_subtype_prop</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<span class="id">fdata</span>:<span class="id">foreign_data</span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<span class="id">ftype</span>:<span class="id">foreign_type</span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<span class="id">fdtyping</span>:<span class="id">foreign_data_typing</span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<span class="id">m</span>:<span class="id">brand_model</span>} : <span class="id">Proper</span> (<span class="id">eq</span> ==&gt; <span class="id">subtype</span> ==&gt; <span class="id">impl</span>) (<span class="id">data_type</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof1400')">Proof.</div>
<div class="proofscript" id="proof1400">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">Proper</span>, <span class="id">respectful</span>, <span class="id">impl</span>, <span class="id">flip</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> ? <span class="id">d</span> ? τ₁ τ₂ <span class="id">sub</span> ; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Hint</span> <span class="kwd">Resolve</span> <span class="id">data_type_ext</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Hint</span> <span class="kwd">Resolve</span> <span class="id">data_type_not_bottom</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Hint</span> <span class="kwd">Resolve</span> <span class="id">dtrec_closed_is_open</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Hint</span> <span class="id">Constructors</span> <span class="id">data_normalized</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">revert</span> <span class="id">d</span> τ₂ <span class="id">sub</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> τ₁ <span class="kwd">using</span> <span class="id">rtype_rect</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> τ₂ <span class="kwd">using</span> <span class="id">rtype_rect</span>; <span class="tactic">simpl</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">try</span> <span class="id">autorewrite</span> <span class="kwd">with</span> <span class="id">rtype_join</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">try</span> <span class="id">solve</span>[<span class="tactic">inversion</span> 1; <span class="tactic">subst</span>; <span class="tactic">intros</span>; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">try</span> <span class="id">solve</span> [<span class="tactic">intros</span>; <span class="id">dtype_inverter</span>; <span class="tactic">eauto</span> 2<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">eelim</span> <span class="id">data_type_not_bottom</span>; <span class="tactic">eauto</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="tactic">unfold</span> <span class="id">Top</span>, <span class="id">Bottom</span>, <span class="id">Unit</span>, <span class="id">Nat</span>, <span class="id">Bool</span>, <span class="id">String</span>, <span class="id">Coll</span>, <span class="id">Rec</span> <span class="kwd">in</span> *;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eauto</span> 2; <span class="tactic">try</span> <span class="id">r_ext</span>]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">clear</span> <span class="id">IH</span>τ₂. <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H</span>; <span class="id">rtype_equalizer</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">sub</span>; <span class="id">rtype_equalizer</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">subst</span>; <span class="tactic">trivial</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">subst</span>. <span class="id">constructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">revert</span> <span class="id">H2</span>; <span class="tactic">apply</span> <span class="id">Forall_impl</span>; <span class="tactic">auto</span>. <br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">clear</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H0</span>; <span class="id">rtype_equalizer</span>; <span class="tactic">subst</span>. <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">subtype_Rec_sublist_strengthen</span> <span class="id">H6</span> <span class="id">H3</span> <span class="id">sub</span>) <span class="kwd">as</span> [?[??]]; <span class="tactic">trivial</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">dtrec</span>; <span class="tactic">try</span> <span class="tactic">exact</span> <span class="id">H1</span>; <span class="tactic">trivial</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- (<span class="id">sorted_forall_same_domain</span> <span class="id">H1</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> (<span class="id">sorted_forall_same_domain</span> <span class="id">H6</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">trivial</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">generalize</span> (<span class="id">subtype_Rec_closed2_closed1</span> <span class="id">sub</span>); <span class="tactic">intros</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intuition</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">generalize</span> (<span class="id">subtype_Rec_closed_domain</span> <span class="id">sub</span>); <span class="tactic">intros</span> <span class="id">eqd</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- (<span class="id">sorted_forall_same_domain</span> <span class="id">H6</span>) <span class="kwd">in</span> <span class="id">eqd</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> (<span class="id">sorted_forall_same_domain</span> <span class="id">H1</span>) <span class="kwd">in</span> <span class="id">eqd</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">sublist_length_eq</span>; <span class="tactic">trivial</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- (<span class="id">domain_length</span> <span class="id">srl0</span>), &lt;- (<span class="id">domain_length</span> <span class="id">x</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">intros</span> <span class="id">e</span> <span class="id">sub</span>. <span class="tactic">apply</span> <span class="id">subtype_Either_inv</span> <span class="kwd">in</span> <span class="id">e</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">e</span> <span class="kwd">as</span> [<span class="id">e1</span> <span class="id">e2</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">sub</span>; <span class="tactic">subst</span>; <span class="id">rtype_equalizer</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">subst</span>. <span class="id">econstructor</span>; <span class="tactic">intuition</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">subst</span>. <span class="id">econstructor</span>; <span class="tactic">intuition</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">inversion</span> 1; <span class="tactic">trivial</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">apply</span> <span class="id">canon_equiv</span> <span class="kwd">in</span> <span class="id">H1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H1</span>; <span class="tactic">trivial</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">apply</span> <span class="id">canon_equiv</span> <span class="kwd">in</span> <span class="id">H</span>; <span class="tactic">apply</span> <span class="id">canon_equiv</span> <span class="kwd">in</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H</span>, <span class="id">H0</span> <span class="kwd">in</span> <span class="id">H1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> 1; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">canon_equiv</span> <span class="kwd">in</span> <span class="id">H3</span>. <span class="tactic">rewrite</span> <span class="id">H3</span> <span class="kwd">in</span> <span class="id">H8</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">econstructor</span>; <span class="tactic">trivial</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">etransitivity</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">intros</span> <span class="id">sub</span> <span class="id">dt</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">invcs</span> <span class="id">sub</span>; <span class="tactic">trivial</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">invcs</span> <span class="id">dt</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">constructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">foreign_data_typing_subtype</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Global</span> <span class="kwd">Instance</span> <span class="id">data_type_subtype_prop</span>'<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<span class="id">fdata</span>:<span class="id">foreign_data</span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<span class="id">ftype</span>:<span class="id">foreign_type</span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<span class="id">fdtyping</span>:<span class="id">foreign_data_typing</span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<span class="id">m</span>:<span class="id">brand_model</span>} <span class="id">d</span> : <span class="id">Proper</span> (<span class="id">subtype</span> ==&gt; <span class="id">impl</span>) (<span class="id">data_type</span> <span class="id">d</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof1401')">Proof.</div>
<div class="proofscript" id="proof1401">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">data_type_subtype_prop</span>; <span class="tactic">trivial</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">join_preserves_data_type</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<span class="id">fdata</span>:<span class="id">foreign_data</span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<span class="id">ftype</span>:<span class="id">foreign_type</span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<span class="id">fdtyping</span>:<span class="id">foreign_data_typing</span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<span class="id">m</span>:<span class="id">brand_model</span>} {<span class="id">d</span> τ}:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">d</span> ▹ τ -&gt; <span class="kwd">forall</span> τ₀, <span class="id">d</span> ▹ (τ ⊔ τ₀).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof1402')">Proof.</div>
<div class="proofscript" id="proof1402">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> (<span class="id">join_leq_l</span> τ τ₀) <span class="kwd">in</span> <span class="id">H</span>; <span class="tactic">trivial</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Theorem</span> <span class="id">subtyping_preserves_data_type</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<span class="id">fdata</span>:<span class="id">foreign_data</span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<span class="id">ftype</span>:<span class="id">foreign_type</span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<span class="id">fdtyping</span>:<span class="id">foreign_data_typing</span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<span class="id">m</span>:<span class="id">brand_model</span>} {<span class="id">d</span> τ₁ τ₂}:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">d</span> ▹ τ₁ -&gt; τ₁ ≤ τ₂ -&gt; <span class="id">d</span> ▹ τ₂.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof1403')">Proof.</div>
<div class="proofscript" id="proof1403">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">trivial</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">map_rtype_meet_cons2_nin</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<span class="id">ftype</span>:<span class="id">foreign_type</span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<span class="id">br</span>:<span class="id">brand_relation</span>} <span class="id">s</span> <span class="id">x</span> <span class="id">l1</span> <span class="id">l2</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;~ <span class="id">In</span> <span class="id">s</span> (<span class="id">domain</span> <span class="id">l1</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">map_rtype_meet</span> <span class="id">l1</span> ((<span class="id">s</span>, <span class="id">x</span>) :: <span class="id">l2</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;= <span class="id">map_rtype_meet</span> <span class="id">l1</span> <span class="id">l2</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof1404')">Proof.</div>
<div class="proofscript" id="proof1404">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">l1</span>; <span class="tactic">simpl</span>; <span class="tactic">trivial</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">a</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intuition</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">string_dec</span> <span class="id">s0</span> <span class="id">s</span>); <span class="tactic">intuition</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">lookup_diff_cons2_nin</span> {<span class="id">A</span> <span class="id">B</span> <span class="id">C</span>} <span class="id">dec</span> <span class="id">s</span> <span class="id">x</span> (<span class="id">l1</span>:<span class="id">list</span> (<span class="id">A</span>*<span class="id">B</span>)) (<span class="id">l2</span>:<span class="id">list</span> (<span class="id">A</span>*<span class="id">C</span>)) :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;~ <span class="id">In</span> <span class="id">s</span> (<span class="id">domain</span> <span class="id">l1</span>) -&gt;<br/>
&nbsp;&nbsp;<span class="id">lookup_diff</span> <span class="id">dec</span> <span class="id">l1</span> ((<span class="id">s</span>, <span class="id">x</span>) :: <span class="id">l2</span>)<br/>
&nbsp;&nbsp;= <span class="id">lookup_diff</span> <span class="id">dec</span> <span class="id">l1</span> <span class="id">l2</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof1405')">Proof.</div>
<div class="proofscript" id="proof1405">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">l1</span>; <span class="tactic">simpl</span>; <span class="tactic">trivial</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intuition</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H</span>. <span class="tactic">destruct</span> (<span class="id">dec</span> (<span class="id">fst</span> <span class="id">a</span>) <span class="id">s</span>); <span class="tactic">intuition</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">lookup_diff_sublist</span> {<span class="id">A</span> <span class="id">B</span> <span class="id">C</span>} (<span class="id">dec</span>:<span class="kwd">forall</span> <span class="id">a</span> <span class="id">a</span>':<span class="id">A</span>, {<span class="id">a</span>=<span class="id">a</span>'} + {<span class="id">a</span>&lt;&gt;<span class="id">a</span>'})<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">l1</span>:<span class="id">list</span> (<span class="id">A</span>*<span class="id">B</span>)) (<span class="id">l2</span>:<span class="id">list</span> (<span class="id">A</span>*<span class="id">C</span>)):<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">sublist</span> (<span class="id">lookup_diff</span> <span class="id">dec</span> <span class="id">l1</span> <span class="id">l2</span>) <span class="id">l1</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof1406')">Proof.</div>
<div class="proofscript" id="proof1406">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">l1</span>; <span class="tactic">simpl</span>; <span class="tactic">trivial</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">intuition</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">match_destr</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">apply</span> <span class="id">sublist_skip</span>; <span class="tactic">trivial</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">apply</span> <span class="id">sublist_cons</span>; <span class="tactic">trivial</span>.<br/>
&nbsp;&nbsp;Qed.</div>
&nbsp;&nbsp;<br/>
&nbsp;&nbsp;<span class="kwd">Theorem</span> <span class="id">meet_preserves_data_type</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<span class="id">fdata</span>:<span class="id">foreign_data</span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<span class="id">ftype</span>:<span class="id">foreign_type</span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<span class="id">fdtyping</span>:<span class="id">foreign_data_typing</span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<span class="id">m</span>:<span class="id">brand_model</span>} {<span class="id">d</span> τ₁ τ₂}:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">d</span> ▹ τ₁ -&gt; <span class="id">d</span> ▹ τ₂ -&gt; <span class="id">d</span> ▹ (τ₁ ⊓ τ₂).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof1407')">Proof.</div>
<div class="proofscript" id="proof1407">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Hint</span> <span class="kwd">Resolve</span> <span class="id">data_type_ext</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Hint</span> <span class="kwd">Resolve</span> <span class="id">data_type_not_bottom</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Hint</span> <span class="kwd">Resolve</span> <span class="id">dtrec_closed_is_open</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Hint</span> <span class="id">Constructors</span> <span class="id">data_normalized</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">revert</span> <span class="id">d</span> τ₂.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> τ₁ <span class="kwd">using</span> <span class="id">rtype_rect</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> τ₂ <span class="kwd">using</span> <span class="id">rtype_rect</span>; <span class="tactic">simpl</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">try</span> <span class="id">autorewrite</span> <span class="kwd">with</span> <span class="id">rtype_meet</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">try</span> <span class="id">solve</span>[<span class="tactic">inversion</span> 1; <span class="tactic">subst</span>; <span class="tactic">intros</span>; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">try</span> <span class="id">solve</span> [<span class="tactic">intros</span>; <span class="id">dtype_inverter_with_either</span>; <span class="tactic">try</span> <span class="tactic">discriminate</span>; <span class="tactic">eauto</span> 2<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">eelim</span> <span class="id">data_type_not_bottom</span>; <span class="tactic">eauto</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="tactic">unfold</span> <span class="id">Top</span>, <span class="id">Bottom</span>, <span class="id">Unit</span>, <span class="id">Nat</span>, <span class="id">Bool</span>, <span class="id">String</span>, <span class="id">Coll</span>, <span class="id">Rec</span> <span class="kwd">in</span> *;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eauto</span> 2; <span class="tactic">try</span> <span class="id">r_ext</span>]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">intros</span>; <span class="id">dtype_inverter</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H</span>; <span class="tactic">clear</span> <span class="id">H</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H0</span>; <span class="tactic">clear</span> <span class="id">H0</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rtype_equalizer</span>. <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">constructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Forall_forall</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> ? <span class="id">inn</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">IH</span>τ₁; <span class="tactic">intuition</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">intros</span>; <span class="id">dtype_inverter</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">invcs</span> <span class="id">H1</span>; <span class="id">rtype_equalizer</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">invcs</span> <span class="id">H2</span>; <span class="id">rtype_equalizer</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">match_destr</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ { <span class="tactic">clear</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">F2</span>:<span class="id">Forall2</span> (<span class="kwd">fun</span> (<span class="id">d</span> : <span class="id">string</span> * <span class="id">data</span>) (<span class="id">r</span> : <span class="id">string</span> * <span class="id">rtype</span>) =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">fst</span> <span class="id">d</span> = <span class="id">fst</span> <span class="id">r</span> /\ <span class="id">snd</span> <span class="id">d</span> ▹ <span class="id">snd</span> <span class="id">r</span>) <span class="id">d</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">rec_concat_sort</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">map_rtype_meet</span> <span class="id">srl</span> <span class="id">srl0</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">lookup_diff</span> <span class="id">string_dec</span> <span class="id">rl0</span> <span class="id">srl</span>))).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> <span class="id">H7</span> <span class="id">H10</span> <span class="id">r</span> <span class="id">k</span> <span class="id">k0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">revert</span> <span class="id">rl</span> <span class="id">rl0</span> <span class="id">srl</span> <span class="id">srl0</span> <span class="id">pf</span> <span class="id">pf</span>' <span class="id">pf0</span> <span class="id">pf</span>'0 <span class="id">H</span> <span class="id">H6</span> <span class="id">H9</span> <span class="id">H8</span> <span class="id">H11</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">d</span>; <span class="tactic">simpl</span>; <span class="tactic">intros</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">invcs</span> <span class="id">H8</span>; <span class="id">invcs</span> <span class="id">H11</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">apply</span> <span class="id">sublist_nil_r</span> <span class="kwd">in</span> <span class="id">H6</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>. <span class="id">constructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">destruct</span> <span class="id">H3</span>; <span class="tactic">destruct</span> <span class="id">H2</span>; <span class="tactic">destruct</span> <span class="id">a</span>; <span class="tactic">destruct</span> <span class="id">y</span>; <span class="tactic">destruct</span> <span class="id">y0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">H</span>, <span class="id">H0</span>, <span class="id">H1</span>, <span class="id">H2</span> |- *. <span class="tactic">repeat</span> <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">sublist_cons_inv_simple</span> <span class="kwd">in</span> <span class="id">H6</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[| <span class="tactic">apply</span> <span class="id">NoDup_domain_NoDup</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">is_list_sorted_NoDup</span>; [ <span class="tactic">eapply</span> <span class="id">StringOrder.lt_strorder</span> | ];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eauto</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">sublist_cons_inv_simple</span> <span class="kwd">in</span> <span class="id">H9</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[| <span class="tactic">apply</span> <span class="id">NoDup_domain_NoDup</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">is_list_sorted_NoDup</span>; [ <span class="tactic">eapply</span> <span class="id">StringOrder.lt_strorder</span> | ];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eauto</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H6</span> <span class="kwd">as</span> [[<span class="id">srl</span>' [<span class="id">eqq</span> <span class="id">subl</span>']]|[<span class="id">nin</span> <span class="id">subl</span>']].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">subst</span>. <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">invcs</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">string_dec</span> <span class="id">s1</span> <span class="id">s1</span>); [ | <span class="tactic">congruence</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H9</span> <span class="kwd">as</span> [[<span class="id">srl0</span>' [<span class="id">eqq0</span> <span class="id">subl0</span>']]|[<span class="id">nin0</span> <span class="id">subl</span>'0]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">subst</span>. <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">string_dec</span> <span class="id">s1</span> <span class="id">s1</span>); [ | <span class="tactic">congruence</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">rec_concat_sort</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">rewrite</span> <span class="id">insertion_sort_insert_forall_lt</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">constructor</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">split</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">rewrite</span> <span class="id">map_rtype_meet_cons2_nin</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[<span class="tactic">rewrite</span> <span class="id">lookup_diff_cons2_nin</span> | ].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*  <span class="tactic">apply</span> (<span class="id">IHd</span> <span class="id">l</span>' <span class="id">l</span>'0); <span class="tactic">trivial</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">try</span> <span class="id">solve</span>[<span class="tactic">eapply</span> <span class="id">is_list_sorted_cons_inv</span>; <span class="tactic">eauto</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">apply</span> <span class="id">is_list_sorted_NoDup</span> <span class="kwd">in</span> <span class="id">pf</span>'0;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[ | <span class="tactic">eapply</span> <span class="id">StringOrder.lt_strorder</span> ].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">pf</span>'0; <span class="tactic">subst</span>; <span class="tactic">trivial</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">apply</span> <span class="id">is_list_sorted_NoDup</span> <span class="kwd">in</span> <span class="id">pf</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[ | <span class="tactic">eapply</span> <span class="id">StringOrder.lt_strorder</span> ].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">pf</span>; <span class="tactic">subst</span>; <span class="tactic">trivial</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">apply</span> <span class="id">Forall_sorted</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">Forall_rec_field_lt</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">domain_app</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">map_rtype_meet_domain</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">Forall_app</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">apply</span> <span class="id">sorted_StronglySorted</span> <span class="kwd">in</span> <span class="id">pf</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[ | <span class="tactic">eapply</span> <span class="id">StrictOrder_Transitive</span> ].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">pf</span>. <span class="tactic">inversion</span> <span class="id">pf</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">trivial</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">eapply</span> <span class="id">Forall_sublist</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">eapply</span> <span class="id">sublist_domain</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">lookup_diff_sublist</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">apply</span> <span class="id">sorted_StronglySorted</span> <span class="kwd">in</span> <span class="id">pf</span>'0;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[ | <span class="tactic">eapply</span> <span class="id">StrictOrder_Transitive</span> ].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">pf</span>'0. <span class="tactic">inversion</span> <span class="id">pf</span>'0; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">trivial</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">assert</span> (<span class="id">nind</span>: ~ <span class="id">In</span> <span class="id">s1</span> (<span class="id">domain</span> <span class="id">srl0</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">apply</span> <span class="id">is_list_sorted_NoDup</span> <span class="kwd">in</span> <span class="id">pf</span>'0;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[ | <span class="tactic">eapply</span> <span class="id">StringOrder.lt_strorder</span> ].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">pf</span>'0; <span class="tactic">subst</span>; <span class="tactic">trivial</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">inn</span>; <span class="tactic">apply</span> <span class="id">H2</span>. <span class="tactic">eapply</span> <span class="id">sublist_In</span>; <span class="tactic">try</span> <span class="tactic">eapply</span> <span class="id">inn</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">sublist_domain</span>; <span class="tactic">trivial</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> (<span class="id">lookup_nin_none</span> <span class="id">string_dec</span>) <span class="kwd">in</span> <span class="id">nind</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">nind</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">rec_concat_sort</span>. <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<span class="tactic">rewrite</span> <span class="id">insertion_sort_insert_forall_lt</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">constructor</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">split</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">rewrite</span> <span class="id">lookup_diff_cons2_nin</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*  <span class="tactic">apply</span> (<span class="id">IHd</span> <span class="id">l</span>' <span class="id">l</span>'0); <span class="tactic">trivial</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">try</span> <span class="id">solve</span>[<span class="tactic">eapply</span> <span class="id">is_list_sorted_cons_inv</span>; <span class="tactic">eauto</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">apply</span> <span class="id">is_list_sorted_NoDup</span> <span class="kwd">in</span> <span class="id">pf</span>'0;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[ | <span class="tactic">eapply</span> <span class="id">StringOrder.lt_strorder</span> ].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">pf</span>'0; <span class="tactic">subst</span>; <span class="tactic">trivial</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">apply</span> <span class="id">Forall_sorted</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">Forall_rec_field_lt</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">domain_app</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">map_rtype_meet_domain</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">Forall_app</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">apply</span> <span class="id">sorted_StronglySorted</span> <span class="kwd">in</span> <span class="id">pf</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[ | <span class="tactic">eapply</span> <span class="id">StrictOrder_Transitive</span> ].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">pf</span>. <span class="tactic">inversion</span> <span class="id">pf</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">trivial</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">eapply</span> <span class="id">Forall_sublist</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">eapply</span> <span class="id">sublist_domain</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">lookup_diff_sublist</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">apply</span> <span class="id">sorted_StronglySorted</span> <span class="kwd">in</span> <span class="id">pf</span>'0;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[ | <span class="tactic">eapply</span> <span class="id">StrictOrder_Transitive</span> ].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">pf</span>'0. <span class="tactic">inversion</span> <span class="id">pf</span>'0; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">trivial</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">assert</span> (<span class="id">nind</span>: ~ <span class="id">In</span> <span class="id">s1</span> (<span class="id">domain</span> <span class="id">srl</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">apply</span> <span class="id">is_list_sorted_NoDup</span> <span class="kwd">in</span> <span class="id">pf</span>';<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[ | <span class="tactic">eapply</span> <span class="id">StringOrder.lt_strorder</span> ].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">pf</span>'; <span class="tactic">subst</span>; <span class="tactic">trivial</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">inn</span>; <span class="tactic">apply</span> <span class="id">H5</span>. <span class="tactic">eapply</span> <span class="id">sublist_In</span>; <span class="tactic">try</span> <span class="tactic">eapply</span> <span class="id">inn</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">sublist_domain</span>; <span class="tactic">trivial</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> (<span class="id">lookup_nin_none</span> <span class="id">string_dec</span>) <span class="kwd">in</span> <span class="id">nind</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">nind</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">rec_concat_sort</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">rec_sort</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">insertion_sort_insert_middle</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* {<span class="tactic">rewrite</span> <span class="id">insertion_sort_insert_forall_lt</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">constructor</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">split</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">destruct</span> <span class="id">H9</span> <span class="kwd">as</span> [[<span class="id">srl0</span>' [<span class="id">eqq0</span> <span class="id">subl0</span>']]|[<span class="id">nin0</span> <span class="id">subl0</span>']].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">rewrite</span> <span class="id">map_rtype_meet_cons2_nin</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">apply</span> (<span class="id">IHd</span> <span class="id">l</span>' ); <span class="tactic">trivial</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">try</span> <span class="id">solve</span>[<span class="tactic">eapply</span> <span class="id">is_list_sorted_cons_inv</span>; <span class="tactic">eauto</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">apply</span> <span class="id">lookup_none_nin</span> <span class="kwd">in</span> <span class="id">nind</span>; <span class="tactic">trivial</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">apply</span> (<span class="id">IHd</span> <span class="id">l</span>' ); <span class="tactic">trivial</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">try</span> <span class="id">solve</span>[<span class="tactic">eapply</span> <span class="id">is_list_sorted_cons_inv</span>; <span class="tactic">eauto</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">change</span> (<span class="id">Forall</span> (<span class="id">rec_field_lt</span> (<span class="id">s1</span>, <span class="id">r0</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">rec_sort</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">map_rtype_meet</span> <span class="id">srl</span> <span class="id">srl0</span> ++<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">lookup_diff</span> <span class="id">string_dec</span> <span class="id">l</span>'0 <span class="id">srl</span>))).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">Forall_sorted</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">Forall_rec_field_lt</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">domain_app</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">map_rtype_meet_domain</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">Forall_app</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">apply</span> <span class="id">sorted_StronglySorted</span> <span class="kwd">in</span> <span class="id">pf</span>';<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[ | <span class="tactic">eapply</span> <span class="id">StrictOrder_Transitive</span> ].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">pf</span>'. <span class="tactic">inversion</span> <span class="id">pf</span>'; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">Forall_sublist</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">sublist_domain</span>; <span class="tactic">trivial</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">eapply</span> <span class="id">Forall_sublist</span>.  <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">eapply</span> <span class="id">sublist_domain</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">lookup_diff_sublist</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">apply</span> <span class="id">sorted_StronglySorted</span> <span class="kwd">in</span> <span class="id">pf</span>'0;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[ | <span class="tactic">eapply</span> <span class="id">StrictOrder_Transitive</span> ].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">pf</span>'0. <span class="tactic">inversion</span> <span class="id">pf</span>'0; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">trivial</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">rewrite</span> <span class="id">map_rtype_meet_domain</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">lookup_none_nin</span> <span class="kwd">in</span> <span class="id">nind</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">trivial</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">econstructor</span>; <span class="tactic">try</span> <span class="tactic">eapply</span> <span class="id">F2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">eapply</span> <span class="id">rec_concat_sort_sorted</span>; <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">unfold</span> <span class="id">rec_concat_sort</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">Sorted_incl_sublist</span>; <span class="tactic">try</span> <span class="tactic">apply</span> <span class="id">insertion_sort_Sorted</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> ? <span class="id">inn</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">rec_sort_perm</span> <span class="kwd">in</span> <span class="id">inn</span> |- *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">rewrite</span> <span class="id">in_app_iff</span> <span class="kwd">in</span> <span class="id">inn</span> |- *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">inn</span> <span class="kwd">as</span> [<span class="id">inn</span>|<span class="id">inn</span>]; [<span class="tactic">tauto</span> | ].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">right</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">lookup_diff_inv</span> <span class="kwd">in</span> <span class="id">inn</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">inn</span> <span class="kwd">as</span> [<span class="id">inn</span> <span class="id">ninn</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">x</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> (<span class="id">lookup_in</span> <span class="id">string_dec</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">lookup_diff_none2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">apply</span> <span class="id">in_lookup_nodup</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">eapply</span> <span class="id">is_list_sorted_NoDup</span> ;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[ <span class="tactic">eapply</span> <span class="id">StringOrder.lt_strorder</span> | ]; <span class="tactic">eauto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">sublist_In</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">apply</span> <span class="id">lookup_nin_none</span>; <span class="tactic">trivial</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">apply</span> <span class="id">NoDup_map_rtype_meet_lookup_diff</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">eapply</span> <span class="id">is_list_sorted_NoDup</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[ <span class="tactic">eapply</span> <span class="id">StringOrder.lt_strorder</span> | ].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">sublist_domain</span> <span class="kwd">in</span> <span class="id">H6</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">is_list_sorted_sublist</span>; <span class="tactic">try</span> <span class="tactic">eapply</span> <span class="id">H6</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">eapply</span> <span class="id">is_list_sorted_NoDup</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[ <span class="tactic">eapply</span> <span class="id">StringOrder.lt_strorder</span> | ].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">sublist_domain</span> <span class="kwd">in</span> <span class="id">H9</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">is_list_sorted_sublist</span>; <span class="tactic">try</span> <span class="tactic">eapply</span> <span class="id">H9</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">rewrite</span> <span class="id">domain_app</span>, <span class="id">map_rtype_meet_domain</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">NoDup_app</span>; <span class="tactic">eauto</span> 2.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">symmetry</span>; <span class="tactic">apply</span> <span class="id">lookup_diff_disjoint</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">apply</span> <span class="id">NoDup_lookup_diff</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">k</span>; <span class="tactic">destruct</span> <span class="id">k0</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">discriminate</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">rewrite</span> <span class="id">H10</span> <span class="tactic">by</span> <span class="tactic">trivial</span>; <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">rewrite</span> <span class="id">H7</span> <span class="tactic">by</span> <span class="tactic">trivial</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="tactic">rewrite</span> <span class="id">lookup_diff_domain_bounded</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">rewrite</span> &lt;- (<span class="id">sorted_forall_same_domain</span> <span class="id">H8</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- (<span class="id">sorted_forall_same_domain</span> <span class="id">H11</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">rewrite</span> &lt;- (<span class="id">sorted_forall_same_domain</span> <span class="id">H8</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span>  (<span class="id">sorted_forall_same_domain</span> <span class="id">H11</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H9</span>; <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">rewrite</span> <span class="id">H10</span> <span class="tactic">by</span> <span class="tactic">trivial</span>; <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">elim</span> <span class="id">n</span>; <span class="tactic">clear</span> <span class="id">n</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">domeq</span>:<span class="id">domain</span> <span class="id">rl</span> = <span class="id">domain</span> <span class="id">rl0</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- (<span class="id">sorted_forall_same_domain</span> <span class="id">H8</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> (<span class="id">sorted_forall_same_domain</span> <span class="id">H11</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">trivial</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">k</span>; <span class="tactic">destruct</span> <span class="id">k0</span>; <span class="tactic">simpl</span>; <span class="tactic">trivial</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">rewrite</span> <span class="id">H10</span> <span class="kwd">in</span> * <span class="tactic">by</span> <span class="tactic">trivial</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">domeq</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">sublist_domain</span>; <span class="tactic">trivial</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*  <span class="tactic">rewrite</span> <span class="id">H7</span> <span class="kwd">in</span> * <span class="tactic">by</span> <span class="tactic">trivial</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">domeq</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">sublist_domain</span>; <span class="tactic">trivial</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">rewrite</span> <span class="id">H7</span>, <span class="id">H10</span> <span class="tactic">by</span> <span class="tactic">trivial</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">intros</span>; <span class="id">dtype_inverter_with_either</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">inversion</span> <span class="id">H</span>; <span class="id">rtype_equalizer</span>. <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">econstructor</span>. <span class="tactic">apply</span> <span class="id">IH</span>τ₁1; <span class="tactic">trivial</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">inversion</span> <span class="id">H</span>; <span class="id">rtype_equalizer</span>. <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">econstructor</span>. <span class="tactic">apply</span> <span class="id">IH</span>τ₁2; <span class="tactic">trivial</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">intros</span>; <span class="id">dtype_inverter</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H</span>; <span class="tactic">clear</span> <span class="id">H</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H0</span>; <span class="tactic">clear</span> <span class="id">H0</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">constructor</span>; <span class="tactic">trivial</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">canon_equiv</span> <span class="kwd">in</span> <span class="id">H3</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">canon_equiv</span> <span class="kwd">in</span> <span class="id">H2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H3</span> <span class="kwd">in</span> <span class="id">H7</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H2</span> <span class="kwd">in</span> <span class="id">H11</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> (<span class="id">meet_most</span> (<span class="id">olattice</span>:=<span class="id">brands_olattice</span>)); <span class="tactic">trivial</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">intros</span> <span class="id">dt1</span> <span class="id">dt2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">invcs</span> <span class="id">dt1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">invcs</span> <span class="id">dt2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">constructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">foreign_data_typing_meet</span>; <span class="tactic">trivial</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Theorem</span> <span class="id">meet_data_type_iff</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<span class="id">fdata</span>:<span class="id">foreign_data</span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<span class="id">ftype</span>:<span class="id">foreign_type</span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<span class="id">fdtyping</span>:<span class="id">foreign_data_typing</span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<span class="id">m</span>:<span class="id">brand_model</span>} <span class="id">d</span> τ₁ τ₂:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">d</span> ▹ (τ₁ ⊓ τ₂) &lt;-&gt; (<span class="id">d</span> ▹ τ₁ /\ <span class="id">d</span> ▹ τ₂).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof1408')">Proof.</div>
<div class="proofscript" id="proof1408">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>; <span class="tactic">intros</span> <span class="id">HH</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">rewrite</span> <span class="id">meet_leq_l</span> <span class="kwd">in</span> <span class="id">HH</span>; <span class="tactic">trivial</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">rewrite</span> <span class="id">meet_leq_r</span> <span class="kwd">in</span> <span class="id">HH</span>; <span class="tactic">trivial</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">apply</span> <span class="id">meet_preserves_data_type</span>; <span class="tactic">tauto</span>.<br/>
&nbsp;&nbsp;Qed.</div>
&nbsp;&nbsp;<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">brands_type_Forall</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<span class="id">fdata</span>:<span class="id">foreign_data</span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<span class="id">ftype</span>:<span class="id">foreign_type</span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<span class="id">fdtyping</span>:<span class="id">foreign_data_typing</span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<span class="id">m</span>:<span class="id">brand_model</span>} <span class="id">d</span> <span class="id">b</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">d</span> ▹ (<span class="id">brands_type</span> <span class="id">b</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">data_normalized</span> <span class="id">brand_relation_brands</span> <span class="id">d</span> /\ <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Forall</span> (<span class="kwd">fun</span> <span class="id">bb</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> τ, <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">lookup</span> <span class="id">string_dec</span> <span class="id">brand_context_types</span> <span class="id">bb</span> = <span class="id">Some</span> τ -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">d</span> ▹ τ<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;) <span class="id">b</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof1409')">Proof.</div>
<div class="proofscript" id="proof1409">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Hint</span> <span class="kwd">Resolve</span> <span class="id">data_type_normalized</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">brands_type_alt</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">b</span>; <span class="tactic">simpl</span>; [ <span class="tactic">intuition</span>; <span class="tactic">eauto</span> | ].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">IHb</span> <span class="kwd">as</span> [<span class="id">IHb1</span> <span class="id">IHb2</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">case_eq</span> ( <span class="id">lookup</span> <span class="id">string_dec</span> <span class="id">brand_context_types</span> <span class="id">a</span>); <span class="tactic">intros</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">generalize</span> (<span class="id">meet_data_type_iff</span> <span class="id">d</span> <span class="id">r</span> (<span class="id">fold_right</span> <span class="id">rtype_meet</span> ⊤ (<span class="id">brands_type_list</span> <span class="id">b</span>))); <span class="tactic">simpl</span>; <span class="tactic">intros</span> <span class="id">eqq</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">eqq</span>; <span class="tactic">clear</span> <span class="id">eqq</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">split</span>; <span class="tactic">intros</span> [<span class="id">dt</span> <span class="id">dtf</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">split</span>; [<span class="tactic">eauto</span> | ].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">constructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">rewrite</span> <span class="id">H</span>. <span class="tactic">intro</span>; <span class="tactic">inversion</span> 1; <span class="tactic">subst</span>; <span class="tactic">trivial</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">apply</span> <span class="id">IHb1</span>; <span class="tactic">trivial</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">inversion</span> <span class="id">dtf</span>; <span class="tactic">clear</span> <span class="id">dtf</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id">H2</span> <span class="id">_</span> <span class="id">H</span>). <span class="tactic">split</span>; <span class="tactic">trivial</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">IHb2</span>; <span class="tactic">split</span>; <span class="tactic">trivial</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- { <span class="tactic">split</span>; [<span class="tactic">intros</span> <span class="id">dt</span> | <span class="tactic">intros</span> [<span class="id">dt</span> <span class="id">dtf</span>]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">split</span>; [ <span class="tactic">eauto</span> | ].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">constructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">rewrite</span> <span class="id">H</span>; <span class="tactic">intros</span>; <span class="tactic">discriminate</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">apply</span> <span class="id">IHb1</span>; <span class="tactic">trivial</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">inversion</span> <span class="id">dtf</span>; <span class="tactic">clear</span> <span class="id">dtf</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">IHb2</span>; <span class="tactic">split</span>; <span class="tactic">trivial</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} <br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">dtbrand</span>'<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<span class="id">fdata</span>:<span class="id">foreign_data</span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<span class="id">ftype</span>:<span class="id">foreign_type</span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<span class="id">fdtyping</span>:<span class="id">foreign_data_typing</span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<span class="id">m</span>:<span class="id">brand_model</span>} <span class="id">b</span> <span class="id">b</span>' <span class="id">d</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">is_canon_brands</span> <span class="id">brand_relation_brands</span> <span class="id">b</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">d</span> ▹ (<span class="id">brands_type</span> <span class="id">b</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">b</span> ≤ <span class="id">b</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">data_type</span> (<span class="id">dbrand</span> <span class="id">b</span> <span class="id">d</span>) (<span class="id">Brand</span> <span class="id">b</span>').<br/>
<div class="toggleproof" onclick="toggleDisplay('proof1410')">Proof.</div>
<div class="proofscript" id="proof1410">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">brands_type_Forall</span> <span class="kwd">in</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">dtbrand</span>; <span class="tactic">intuition</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">dtbrand</span>'<span class="id">_inv</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<span class="id">fdata</span>:<span class="id">foreign_data</span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<span class="id">ftype</span>:<span class="id">foreign_type</span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<span class="id">fdtyping</span>:<span class="id">foreign_data_typing</span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<span class="id">m</span>:<span class="id">brand_model</span>} <span class="id">b</span> <span class="id">b</span>' <span class="id">d</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">data_type</span> (<span class="id">dbrand</span> <span class="id">b</span> <span class="id">d</span>) (<span class="id">Brand</span> <span class="id">b</span>') -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">is_canon_brands</span> <span class="id">brand_relation_brands</span> <span class="id">b</span> /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">d</span> ▹ (<span class="id">brands_type</span> <span class="id">b</span>) /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">b</span> ≤ <span class="id">b</span>'.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof1411')">Proof.</div>
<div class="proofscript" id="proof1411">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">dt</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">dtbrand_inv</span> <span class="kwd">in</span> <span class="id">dt</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intuition</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">brands_type_Forall</span>; <span class="tactic">intuition</span>.<br/>
&nbsp;&nbsp;Qed.</div>
&nbsp;&nbsp;&nbsp;&nbsp;<br/>
<span class="kwd">End</span> <span class="id">subtype</span>.<br/>
<br/>
<span class="kwd">Hint</span> <span class="kwd">Resolve</span> <span class="id">data_type_normalized</span>. <br/>
<br/>
<br/>

</div>
<div class="footer"><hr/>Generated by <a href="https://github.com/xavierleroy/coq2html/">coq2html</div>
</body>
</html>
