
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Module Qcert.NRAEnv.Optim.NRAEnvRewrite</title>
<meta name="description" content="Documentation of Coq module Qcert.NRAEnv.Optim.NRAEnvRewrite" />
<link href="coq2html.css" rel="stylesheet" type="text/css" />
<script type="text/javascript" src="coq2html.js"> </script>
</head>

<body onload="hideAll('proofscript')">
<h1 class="title">Module Qcert.NRAEnv.Optim.NRAEnvRewrite</h1>
<div class="coq">
<br/>
<span class="kwd">Section</span> <span class="id">ROptimEnv</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id">List</span> <span class="id">String</span>.<br/>
&nbsp;&nbsp;<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id">ListSet</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id">Utils</span> <span class="id">BasicRuntime</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id">NRARuntime</span> <span class="id">NRAOptim</span>.<br/>
&nbsp;&nbsp;<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id">cNRAEnv</span> <span class="id">cNRAEnvIgnore</span> <span class="id">cNRAEnvEq</span>.<br/>
<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Local</span> <span class="kwd">Open</span> <span class="kwd">Scope</span> <span class="id">nra_scope</span>.<br/>
&nbsp;&nbsp;<span class="kwd">Local</span> <span class="kwd">Open</span> <span class="kwd">Scope</span> <span class="id">nraenv_core_scope</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Context</span> {<span class="id">fruntime</span>:<span class="id">foreign_runtime</span>}.<br/>
<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Hint</span> <span class="kwd">Resolve</span> <span class="id">dnrec_sort_content</span>.<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">pull_nra_opt</span> (<span class="id">p1</span> <span class="id">p2</span>:<span class="id">nraenv_core</span>) :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">nra_of_nraenv_core</span> <span class="id">p1</span>) ≡ₐ (<span class="id">nra_of_nraenv_core</span> <span class="id">p2</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">p1</span> ≡ₑ <span class="id">p2</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof1997')">Proof.</div>
<div class="proofscript" id="proof1997">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">nra_eq</span>, <span class="id">nraenv_core_eq</span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="tactic">rewrite</span> <span class="id">unfold_env_nra_sort</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">envand_comm</span> (<span class="id">p1</span> <span class="id">p2</span>: <span class="id">nraenv_core</span>) :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">p2</span> ∧ <span class="id">p1</span> ≡ₑ <span class="id">p1</span> ∧ <span class="id">p2</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof1998')">Proof.</div>
<div class="proofscript" id="proof1998">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">pull_nra_opt</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">nra_of_nraenv_core</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">and_comm</span>; <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">envunion_assoc</span> (<span class="id">p1</span> <span class="id">p2</span> <span class="id">p3</span>: <span class="id">nraenv_core</span>):<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">p1</span> ⋃ <span class="id">p2</span>) ⋃ <span class="id">p3</span> ≡ₑ <span class="id">p1</span> ⋃ (<span class="id">p2</span> ⋃ <span class="id">p3</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof1999')">Proof.</div>
<div class="proofscript" id="proof1999">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">pull_nra_opt</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">nra_of_nraenv_core</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">union_assoc</span>; <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;Qed.</div>
&nbsp;&nbsp;<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">select_union_distr</span> (<span class="id">q</span> <span class="id">q</span>₁ <span class="id">q</span>₂: <span class="id">nraenv_core</span>) :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;σ⟨ <span class="id">q</span> ⟩(<span class="id">q</span>₁ ⋃ <span class="id">q</span>₂) ≡ₑ σ⟨ <span class="id">q</span> ⟩(<span class="id">q</span>₁) ⋃ σ⟨ <span class="id">q</span> ⟩(<span class="id">q</span>₂).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2000')">Proof.</div>
<div class="proofscript" id="proof2000">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">nraenv_core_eq</span>; <span class="tactic">intros</span> ? ? <span class="id">_</span> ? <span class="id">_</span> ? <span class="id">_</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">generalize</span> (<span class="id">h</span> ⊢ₑ <span class="id">q</span>₁ @ₑ <span class="id">x</span>  ⊣ <span class="id">c</span>;<span class="id">env</span>) <span class="kwd">as</span> <span class="id">d1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">generalize</span> (<span class="id">h</span> ⊢ₑ <span class="id">q</span>₂ @ₑ <span class="id">x</span>  ⊣ <span class="id">c</span>;<span class="id">env</span>) <span class="kwd">as</span> <span class="id">d2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">d1</span>; <span class="tactic">destruct</span> <span class="id">d2</span>; <span class="tactic">try</span> (<span class="id">autorewrite</span> <span class="kwd">with</span> <span class="id">alg</span>; <span class="tactic">reflexivity</span>); <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">d</span>; <span class="tactic">try</span> <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">d0</span>; <span class="tactic">simpl</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">try</span> (<span class="tactic">destruct</span> (<span class="id">lift_filter</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">fun</span> <span class="id">x</span>' : <span class="id">data</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">h</span> ⊢ₑ <span class="id">q</span> @ₑ <span class="id">x</span>' ⊣ <span class="id">c</span>;<span class="id">env</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">Some</span> (<span class="id">dbool</span> <span class="id">b</span>) =&gt; <span class="id">Some</span> <span class="id">b</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">_</span> =&gt; <span class="id">None</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>) <span class="id">l</span>); <span class="tactic">simpl</span>; <span class="tactic">reflexivity</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">l</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">lift_filter</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">fun</span> <span class="id">x</span>' : <span class="id">data</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">h</span> ⊢ₑ <span class="id">q</span> @ₑ <span class="id">x</span>' ⊣ <span class="id">c</span>;<span class="id">env</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">Some</span> (<span class="id">dbool</span> <span class="id">b</span>) =&gt; <span class="id">Some</span> <span class="id">b</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">_</span> =&gt; <span class="id">None</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>) <span class="id">l0</span>); <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">generalize</span>(<span class="id">h</span> ⊢ₑ <span class="id">q</span> @ₑ <span class="id">a</span> ⊣ <span class="id">c</span>;<span class="id">env</span>); <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">bunion</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">lift_app_filter</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">o</span>; <span class="tactic">try</span> <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">d</span>; <span class="tactic">try</span> <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">revert</span> <span class="id">IHl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">generalize</span> ((<span class="id">lift_filter</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">fun</span> <span class="id">x</span>' : <span class="id">data</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">h</span> ⊢ₑ <span class="id">q</span> @ₑ <span class="id">x</span>' ⊣ <span class="id">c</span>;<span class="id">env</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">Some</span> (<span class="id">dbool</span> <span class="id">b0</span>) =&gt; <span class="id">Some</span> <span class="id">b0</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">_</span> =&gt; <span class="id">None</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>) <span class="id">l</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">generalize</span> (<span class="id">lift_filter</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">fun</span> <span class="id">x</span>' : <span class="id">data</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">h</span> ⊢ₑ <span class="id">q</span> @ₑ <span class="id">x</span>' ⊣ <span class="id">c</span>;<span class="id">env</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">Some</span> (<span class="id">dbool</span> <span class="id">b0</span>) =&gt; <span class="id">Some</span> <span class="id">b0</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">_</span> =&gt; <span class="id">None</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>) <span class="id">l0</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">o0</span>; <span class="tactic">try</span> <span class="tactic">reflexivity</span>. <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">o</span>; <span class="tactic">try</span> <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">destruct</span> <span class="id">b</span>; <span class="id">autorewrite</span> <span class="kwd">with</span> <span class="id">alg</span>; <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">autorewrite</span> <span class="kwd">with</span> <span class="id">alg</span>. <span class="tactic">reflexivity</span>. <br/>
&nbsp;&nbsp;Qed.</div>
<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">envmap_singleton</span> (<span class="id">p1</span> <span class="id">p2</span>:<span class="id">nraenv_core</span>) :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;χ⟨ <span class="id">p1</span> ⟩( ‵{| <span class="id">p2</span> |} ) ≡ₑ ‵{| <span class="id">p1</span> ◯ <span class="id">p2</span> |}.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2001')">Proof.</div>
<div class="proofscript" id="proof2001">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">nraenv_core_eq</span>; <span class="tactic">intros</span> ? ? <span class="id">_</span> ? <span class="id">_</span> ? <span class="id">_</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">generalize</span> (<span class="id">h</span> ⊢ₑ <span class="id">p2</span> @ₑ <span class="id">x</span> ⊣ <span class="id">c</span>;<span class="id">env</span>); <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">o</span>; <span class="tactic">try</span> <span class="tactic">reflexivity</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">generalize</span> (<span class="id">h</span> ⊢ₑ <span class="id">p1</span> @ₑ <span class="id">d</span> ⊣ <span class="id">c</span>;<span class="id">env</span>); <span class="tactic">intros</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">o</span>; <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">envmap_map_compose</span> (<span class="id">p1</span> <span class="id">p2</span> <span class="id">p3</span>:<span class="id">nraenv_core</span>) :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;χ⟨ <span class="id">p1</span> ⟩( χ⟨ <span class="id">p2</span> ⟩( <span class="id">p3</span> ) ) ≡ₑ χ⟨ <span class="id">p1</span> ◯ <span class="id">p2</span> ⟩( <span class="id">p3</span> ).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2002')">Proof.</div>
<div class="proofscript" id="proof2002">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">nraenv_core_eq</span>; <span class="tactic">intros</span> ? ? <span class="id">_</span> ? <span class="id">_</span> ? <span class="id">_</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">generalize</span> (<span class="id">h</span> ⊢ₑ <span class="id">p3</span> @ₑ <span class="id">x</span> ⊣ <span class="id">c</span>;<span class="id">env</span>); <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">o</span>; <span class="tactic">try</span> <span class="tactic">reflexivity</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">d</span>; <span class="tactic">try</span> <span class="tactic">reflexivity</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">olift</span>, <span class="id">lift</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">l</span>; <span class="tactic">try</span> <span class="tactic">reflexivity</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">generalize</span> (<span class="id">h</span> ⊢ₑ <span class="id">p2</span> @ₑ <span class="id">a</span> ⊣ <span class="id">c</span>;<span class="id">env</span>); <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">o</span>; <span class="tactic">try</span> <span class="tactic">reflexivity</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">revert</span> <span class="id">IHl</span>; <span class="tactic">generalize</span> (<span class="id">rmap</span> (<span class="id">nraenv_core_eval</span> <span class="id">h</span> <span class="id">c</span> <span class="id">p2</span> <span class="id">env</span>) <span class="id">l</span>); <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">o</span>; <span class="tactic">try</span> <span class="tactic">reflexivity</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">h</span> ⊢ₑ <span class="id">p1</span> @ₑ <span class="id">d</span> ⊣ <span class="id">c</span>;<span class="id">env</span>); <span class="tactic">try</span> <span class="tactic">reflexivity</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">revert</span> <span class="id">IHl</span>; <span class="tactic">generalize</span> (<span class="id">rmap</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">fun</span> <span class="id">x0</span> : <span class="id">data</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">h</span> ⊢ₑ <span class="id">p2</span> @ₑ <span class="id">x0</span> ⊣ <span class="id">c</span>;<span class="id">env</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">Some</span> <span class="id">x</span>'0 =&gt; <span class="id">h</span> ⊢ₑ <span class="id">p1</span> @ₑ <span class="id">x</span>'0 ⊣ <span class="id">c</span>;<span class="id">env</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">None</span> =&gt; <span class="id">None</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>) <span class="id">l</span>); <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">o</span>; <span class="tactic">try</span> <span class="tactic">reflexivity</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">rmap</span> (<span class="id">nraenv_core_eval</span> <span class="id">h</span> <span class="id">c</span> <span class="id">p1</span> <span class="id">env</span>) <span class="id">l0</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">IHl</span>; <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">rmap</span> (<span class="id">nraenv_core_eval</span> <span class="id">h</span> <span class="id">c</span> <span class="id">p1</span> <span class="id">env</span>) <span class="id">l0</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">revert</span> <span class="id">IHl</span>; <span class="tactic">generalize</span> (<span class="id">rmap</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">fun</span> <span class="id">x0</span> : <span class="id">data</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">h</span> ⊢ₑ <span class="id">p2</span> @ₑ <span class="id">x0</span> ⊣ <span class="id">c</span>;<span class="id">env</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">Some</span> <span class="id">x</span>'0 =&gt; <span class="id">h</span> ⊢ₑ <span class="id">p1</span> @ₑ <span class="id">x</span>'0 ⊣ <span class="id">c</span>;<span class="id">env</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">None</span> =&gt; <span class="id">None</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>) <span class="id">l</span>); <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">o</span>; <span class="tactic">try</span> <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">h</span> ⊢ₑ <span class="id">p1</span> @ₑ <span class="id">d</span> ⊣ <span class="id">c</span>;<span class="id">env</span>); <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">app_over_rec</span> <span class="id">s</span> <span class="id">p1</span> <span class="id">p2</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;‵[| (<span class="id">s</span>, <span class="id">p1</span>) |] ◯ <span class="id">p2</span> ≡ₑ ‵[| (<span class="id">s</span>, <span class="id">p1</span> ◯ <span class="id">p2</span>) |].<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2003')">Proof.</div>
<div class="proofscript" id="proof2003">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">nraenv_core_eq</span>; <span class="tactic">intros</span> ? ? <span class="id">_</span> ? <span class="id">_</span> ? <span class="id">_</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">generalize</span> (<span class="id">h</span> ⊢ₑ <span class="id">p2</span> @ₑ <span class="id">x</span> ⊣ <span class="id">c</span>;<span class="id">env</span>); <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">o</span>; <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">envflatten_coll_flatten</span> <span class="id">p</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;♯<span class="id">flatten</span>(‵{| ♯<span class="id">flatten</span>( <span class="id">p</span> ) |}) ≡ₑ ♯<span class="id">flatten</span>( <span class="id">p</span> ).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2004')">Proof.</div>
<div class="proofscript" id="proof2004">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">nraenv_core_eq</span>; <span class="tactic">intros</span> ? ? <span class="id">_</span> ? <span class="id">_</span> ? <span class="id">_</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">generalize</span> (<span class="id">h</span> ⊢ₑ <span class="id">p</span> @ₑ <span class="id">x</span> ⊣ <span class="id">c</span>;<span class="id">env</span>); <span class="tactic">clear</span> <span class="id">x</span> <span class="id">p</span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">o</span>; <span class="tactic">try</span> <span class="tactic">reflexivity</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">olift</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">d</span>; <span class="tactic">try</span> <span class="tactic">reflexivity</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">l</span>; <span class="tactic">try</span> <span class="tactic">reflexivity</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">lift</span>, <span class="id">rflatten</span> <span class="kwd">in</span> *; <span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">a</span>; <span class="tactic">try</span> <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">revert</span> <span class="id">IHl</span>; <span class="tactic">generalize</span> (<span class="id">oflat_map</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">fun</span> <span class="id">x</span> : <span class="id">data</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">x</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">dcoll</span> <span class="id">y</span> =&gt; <span class="id">Some</span> <span class="id">y</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">_</span> =&gt; <span class="id">None</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>) <span class="id">l</span>); <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">o</span>; <span class="tactic">try</span> <span class="tactic">reflexivity</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">app_nil_r</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;Qed.</div>
&nbsp;&nbsp;<br/>
&nbsp;&nbsp;<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">envflatten_coll_coll</span> <span class="id">p</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;♯<span class="id">flatten</span>(‵{| ‵{| <span class="id">p</span> |} |}) ≡ₑ ‵{| <span class="id">p</span> |}.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2005')">Proof.</div>
<div class="proofscript" id="proof2005">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">nraenv_core_eq</span>; <span class="tactic">intros</span> ? ? <span class="id">_</span> ? <span class="id">_</span> ? <span class="id">_</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">generalize</span> (<span class="id">h</span> ⊢ₑ <span class="id">p</span> @ₑ <span class="id">x</span> ⊣ <span class="id">c</span>;<span class="id">env</span>); <span class="tactic">clear</span> <span class="id">x</span> <span class="id">p</span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">o</span>; <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">envflatten_nil</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;♯<span class="id">flatten</span>(‵{||}) ≡ₑ ‵{||}.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2006')">Proof.</div>
<div class="proofscript" id="proof2006">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">nraenv_core_eq</span>; <span class="tactic">intros</span> ? ? <span class="id">_</span> ? <span class="id">_</span> ? <span class="id">_</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">trivial</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">envflatten_coll_map</span> <span class="id">p1</span> <span class="id">p2</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;♯<span class="id">flatten</span>(‵{| χ⟨ <span class="id">p1</span> ⟩( <span class="id">p2</span> ) |}) ≡ₑ χ⟨ <span class="id">p1</span> ⟩( <span class="id">p2</span> ).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2007')">Proof.</div>
<div class="proofscript" id="proof2007">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">nraenv_core_eq</span>; <span class="tactic">intros</span> ? ? <span class="id">_</span> ? <span class="id">_</span> ? <span class="id">_</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">generalize</span> (<span class="id">h</span> ⊢ₑ <span class="id">p2</span> @ₑ <span class="id">x</span> ⊣ <span class="id">c</span>;<span class="id">env</span>); <span class="tactic">clear</span> <span class="id">x</span> <span class="id">p2</span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">o</span>; <span class="tactic">try</span> <span class="tactic">reflexivity</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">d</span>; <span class="tactic">try</span> <span class="tactic">reflexivity</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">l</span>; <span class="tactic">try</span> <span class="tactic">reflexivity</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">olift</span> <span class="kwd">in</span> *; <span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">generalize</span> (<span class="id">h</span> ⊢ₑ <span class="id">p1</span> @ₑ <span class="id">a</span> ⊣ <span class="id">c</span>;<span class="id">env</span>); <span class="tactic">clear</span> <span class="id">a</span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">o</span>; <span class="tactic">try</span> <span class="tactic">reflexivity</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">lift</span> <span class="kwd">in</span> *; <span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">revert</span> <span class="id">IHl</span>; <span class="tactic">generalize</span> (<span class="id">rmap</span> (<span class="id">nraenv_core_eval</span> <span class="id">h</span> <span class="id">c</span> <span class="id">p1</span> <span class="id">env</span>) <span class="id">l</span>); <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">o</span>; <span class="tactic">try</span> <span class="tactic">reflexivity</span>; <span class="tactic">try</span> <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">lift_oncoll</span> <span class="kwd">in</span> *; <span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">app_nil_r</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">app_nil_r</span> <span class="kwd">in</span> <span class="id">IHl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">IHl</span>; <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">flatten_flatten_map_either_nil</span> <span class="id">p</span>₁ <span class="id">p</span>₂ <span class="id">p</span>₃ :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;♯<span class="id">flatten</span>( ♯<span class="id">flatten</span>(χ⟨<span class="id">ANEither</span> <span class="id">p</span>₁ ‵{||} ◯ <span class="id">p</span>₂⟩(<span class="id">p</span>₃))) ≡ₑ <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;♯<span class="id">flatten</span>( χ⟨<span class="id">ANEither</span>( ♯<span class="id">flatten</span>(<span class="id">p</span>₁)) ‵{||} ◯ <span class="id">p</span>₂⟩(<span class="id">p</span>₃)).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2008')">Proof.</div>
<div class="proofscript" id="proof2008">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">nraenv_core_eq</span>; <span class="tactic">intros</span> ? ? <span class="id">_</span> ? <span class="id">_</span> ? <span class="id">_</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">h</span> ⊢ₑ <span class="id">p</span>₃ @ₑ <span class="id">x</span> ⊣ <span class="id">c</span>; <span class="id">env</span>); <span class="tactic">simpl</span>; <span class="tactic">trivial</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">olift</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">d</span>; <span class="tactic">simpl</span>; <span class="tactic">trivial</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">l</span>; <span class="tactic">simpl</span>; <span class="tactic">trivial</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">lift</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> ( <span class="id">rmap</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">fun</span> <span class="id">x0</span> : <span class="id">data</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">h</span> ⊢ₑ <span class="id">p</span>₂ @ₑ <span class="id">x0</span> ⊣ <span class="id">c</span>; <span class="id">env</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">Some</span> (<span class="id">dleft</span> <span class="id">dl</span>) =&gt; <span class="id">h</span> ⊢ₑ <span class="id">p</span>₁ @ₑ <span class="id">dl</span> ⊣ <span class="id">c</span>; <span class="id">env</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">Some</span> (<span class="id">dright</span> <span class="id">_</span>) =&gt; <span class="id">Some</span> (<span class="id">dcoll</span> <span class="id">nil</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">Some</span> <span class="id">_</span> =&gt; <span class="id">None</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">None</span> =&gt; <span class="id">None</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>) <span class="id">l</span>); <span class="tactic">simpl</span> <span class="kwd">in</span> *;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">rmap</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">fun</span> <span class="id">x0</span> : <span class="id">data</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">h</span> ⊢ₑ <span class="id">p</span>₂ @ₑ <span class="id">x0</span> ⊣ <span class="id">c</span>; <span class="id">env</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">Some</span> (<span class="id">dleft</span> <span class="id">dl</span>) =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">h</span> ⊢ₑ <span class="id">p</span>₁ @ₑ <span class="id">dl</span> ⊣ <span class="id">c</span>; <span class="id">env</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">Some</span> <span class="id">x</span>'0 =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">lift_oncoll</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">fun</span> <span class="id">l1</span> : <span class="id">list</span> <span class="id">data</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">rflatten</span> <span class="id">l1</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">Some</span> <span class="id">a</span>' =&gt; <span class="id">Some</span> (<span class="id">dcoll</span> <span class="id">a</span>')<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">None</span> =&gt; <span class="id">None</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>) <span class="id">x</span>'0<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">None</span> =&gt; <span class="id">None</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">Some</span> (<span class="id">dright</span> <span class="id">_</span>) =&gt; <span class="id">Some</span> (<span class="id">dcoll</span> <span class="id">nil</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">Some</span> <span class="id">_</span> =&gt; <span class="id">None</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">None</span> =&gt; <span class="id">None</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>) <span class="id">l</span>); <span class="tactic">simpl</span> <span class="kwd">in</span> * .<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">destruct</span> (<span class="id">h</span> ⊢ₑ <span class="id">p</span>₂ @ₑ <span class="id">a</span> ⊣ <span class="id">c</span>; <span class="id">env</span>); <span class="tactic">simpl</span>; <span class="tactic">trivial</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">case_eq</span> (<span class="id">rflatten</span> <span class="id">l0</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[<span class="tactic">intros</span> ? <span class="id">eqq0</span> | <span class="tactic">intros</span> <span class="id">eqq0</span>]; <span class="tactic">rewrite</span> <span class="id">eqq0</span> <span class="kwd">in</span> *;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">case_eq</span> (<span class="id">rflatten</span> <span class="id">l1</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[<span class="tactic">intros</span> ? <span class="id">eqq1</span> | <span class="tactic">intros</span> <span class="id">eqq1</span>]; <span class="tactic">rewrite</span> <span class="id">eqq1</span> <span class="kwd">in</span> *;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">IHl</span>); <span class="tactic">try</span> <span class="tactic">discriminate</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">case_eq</span> (<span class="id">rflatten</span> <span class="id">l2</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[<span class="tactic">intros</span> ? <span class="id">eqq2</span> | <span class="tactic">intros</span> <span class="id">eqq2</span>]; <span class="tactic">try</span> <span class="tactic">rewrite</span> <span class="id">eqq2</span> <span class="kwd">in</span> *;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">try</span> <span class="tactic">discriminate</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">IHl</span>; <span class="tactic">clear</span> <span class="id">IHl</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">d</span>; <span class="tactic">simpl</span>; <span class="tactic">trivial</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">destruct</span> (<span class="id">h</span> ⊢ₑ <span class="id">p</span>₁ @ₑ <span class="id">d</span> ⊣ <span class="id">c</span>; <span class="id">env</span>); <span class="tactic">simpl</span>; <span class="tactic">trivial</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">d0</span>; <span class="tactic">simpl</span>; <span class="tactic">trivial</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> (<span class="id">rflatten_cons</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">eqq0</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">case_eq</span> (<span class="id">rflatten</span> <span class="id">l4</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[<span class="tactic">intros</span> ? <span class="id">eqq4</span> | <span class="tactic">intros</span> <span class="id">eqq4</span>]; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">rewrite</span> (<span class="id">rflatten_cons</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">eqq1</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> (<span class="id">rflatten_app</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">eqq4</span> <span class="id">eqq2</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">trivial</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-  <span class="tactic">rewrite</span> (<span class="id">rflatten_app_none1</span> <span class="id">_</span> <span class="id">_</span> <span class="id">eqq4</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">trivial</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">rewrite</span> (<span class="id">rflatten_cons</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">eqq0</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> (<span class="id">rflatten_cons</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">eqq1</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">eqq2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">trivial</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+  <span class="id">case_eq</span> (<span class="id">rflatten</span> <span class="id">l2</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[<span class="tactic">intros</span> ? <span class="id">eqq2</span> | <span class="tactic">intros</span> <span class="id">eqq2</span>]; <span class="tactic">try</span> <span class="tactic">rewrite</span> <span class="id">eqq2</span> <span class="kwd">in</span> *;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">try</span> <span class="tactic">discriminate</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">d</span>; <span class="tactic">simpl</span>; <span class="tactic">trivial</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">destruct</span> (<span class="id">h</span> ⊢ₑ <span class="id">p</span>₁ @ₑ <span class="id">d</span> ⊣ <span class="id">c</span>; <span class="id">env</span>); <span class="tactic">simpl</span>; <span class="tactic">trivial</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">d0</span>; <span class="tactic">simpl</span>; <span class="tactic">trivial</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> (<span class="id">rflatten_cons</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">eqq0</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> (<span class="id">rflatten_app_none2</span> <span class="id">_</span> <span class="id">_</span> <span class="id">eqq2</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">rflatten</span> <span class="id">l3</span>); <span class="tactic">simpl</span>; <span class="tactic">trivial</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> (<span class="id">rflatten_cons_none</span> <span class="id">_</span> <span class="id">_</span> <span class="id">eqq1</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">trivial</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">rewrite</span> (<span class="id">rflatten_cons</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">eqq0</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> (<span class="id">rflatten_cons_none</span> <span class="id">_</span> <span class="id">_</span> <span class="id">eqq1</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">eqq2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">trivial</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">destruct</span> <span class="id">d</span>; <span class="tactic">simpl</span>; <span class="tactic">trivial</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">destruct</span> (<span class="id">h</span> ⊢ₑ <span class="id">p</span>₁ @ₑ <span class="id">d</span> ⊣ <span class="id">c</span>; <span class="id">env</span>); <span class="tactic">simpl</span>; <span class="tactic">trivial</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> (<span class="id">rflatten_cons_none</span> <span class="id">_</span> <span class="id">_</span> <span class="id">eqq0</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">d0</span>; <span class="tactic">simpl</span>; <span class="tactic">trivial</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">rflatten</span> <span class="id">l2</span>); <span class="tactic">simpl</span>; <span class="tactic">trivial</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> (<span class="id">rflatten_cons_none</span> <span class="id">_</span> <span class="id">_</span> <span class="id">eqq1</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">trivial</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">rewrite</span> (<span class="id">rflatten_cons_none</span> <span class="id">_</span> <span class="id">_</span> <span class="id">eqq0</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> (<span class="id">rflatten_cons_none</span> <span class="id">_</span> <span class="id">_</span> <span class="id">eqq1</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">trivial</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">destruct</span> (<span class="id">h</span> ⊢ₑ <span class="id">p</span>₂ @ₑ <span class="id">a</span> ⊣ <span class="id">c</span>; <span class="id">env</span>); <span class="tactic">simpl</span>; <span class="tactic">trivial</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">d</span>; <span class="tactic">simpl</span>; <span class="tactic">trivial</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">destruct</span> (<span class="id">h</span> ⊢ₑ <span class="id">p</span>₁ @ₑ <span class="id">d</span> ⊣ <span class="id">c</span>; <span class="id">env</span>); <span class="tactic">simpl</span>; <span class="tactic">trivial</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">d0</span>; <span class="tactic">simpl</span>; <span class="tactic">trivial</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">case_eq</span> (<span class="id">rflatten</span> <span class="id">l0</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[<span class="tactic">intros</span> ? <span class="id">eqq0</span> | <span class="tactic">intros</span> <span class="id">eqq0</span>]; <span class="tactic">rewrite</span> <span class="id">eqq0</span> <span class="kwd">in</span> *; <span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">case_eq</span> (<span class="id">rflatten</span> <span class="id">l2</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[<span class="tactic">intros</span> ? <span class="id">eqq2</span> | <span class="tactic">intros</span> <span class="id">eqq2</span>]; <span class="tactic">rewrite</span> <span class="id">eqq2</span> <span class="kwd">in</span> *; <span class="tactic">try</span> <span class="tactic">discriminate</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> (<span class="id">rflatten_cons</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">eqq0</span>); <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> (<span class="id">rflatten_app_none2</span> <span class="id">_</span> <span class="id">_</span> <span class="id">eqq2</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">rflatten</span> <span class="id">l1</span>); <span class="tactic">trivial</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">rewrite</span> (<span class="id">rflatten_cons_none</span> <span class="id">_</span> <span class="id">_</span> <span class="id">eqq0</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">rflatten</span> <span class="id">l1</span>); <span class="tactic">trivial</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">case_eq</span> (<span class="id">rflatten</span> <span class="id">l0</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[<span class="tactic">intros</span> ? <span class="id">eqq0</span> | <span class="tactic">intros</span> <span class="id">eqq0</span>]; <span class="tactic">rewrite</span> <span class="id">eqq0</span> <span class="kwd">in</span> *; <span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">case_eq</span> (<span class="id">rflatten</span> <span class="id">l1</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[<span class="tactic">intros</span> ? <span class="id">eqq1</span> | <span class="tactic">intros</span> <span class="id">eqq1</span>]; <span class="tactic">rewrite</span> <span class="id">eqq1</span> <span class="kwd">in</span> *; <span class="tactic">try</span> <span class="tactic">discriminate</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> (<span class="id">rflatten_cons</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">eqq0</span>); <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">eqq1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">trivial</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">rewrite</span> (<span class="id">rflatten_cons_none</span> <span class="id">_</span> <span class="id">_</span> <span class="id">eqq0</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">trivial</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">case_eq</span> (<span class="id">rflatten</span> <span class="id">l0</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[<span class="tactic">intros</span> ? <span class="id">eqq0</span> | <span class="tactic">intros</span> <span class="id">eqq0</span>];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">eqq0</span> <span class="kwd">in</span> *; <span class="tactic">simpl</span> <span class="kwd">in</span> *; <span class="tactic">try</span> <span class="tactic">discriminate</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">h</span> ⊢ₑ <span class="id">p</span>₂ @ₑ <span class="id">a</span> ⊣ <span class="id">c</span>; <span class="id">env</span>); <span class="tactic">simpl</span>; <span class="tactic">trivial</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">d</span>; <span class="tactic">simpl</span>; <span class="tactic">trivial</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">destruct</span> (<span class="id">h</span> ⊢ₑ <span class="id">p</span>₁ @ₑ <span class="id">d</span> ⊣ <span class="id">c</span>; <span class="id">env</span>); <span class="tactic">simpl</span>; <span class="tactic">trivial</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">d0</span>; <span class="tactic">simpl</span>; <span class="tactic">trivial</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">rflatten</span> <span class="id">l1</span>); <span class="tactic">simpl</span>; <span class="tactic">trivial</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> (<span class="id">rflatten_cons_none</span> <span class="id">_</span> <span class="id">_</span> <span class="id">eqq0</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">trivial</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">rewrite</span> (<span class="id">rflatten_cons_none</span> <span class="id">_</span> <span class="id">_</span> <span class="id">eqq0</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">trivial</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">destruct</span> (<span class="id">h</span> ⊢ₑ <span class="id">p</span>₂ @ₑ <span class="id">a</span> ⊣ <span class="id">c</span>; <span class="id">env</span>); <span class="tactic">simpl</span>; <span class="tactic">trivial</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">d</span>; <span class="tactic">simpl</span>; <span class="tactic">trivial</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">h</span> ⊢ₑ <span class="id">p</span>₁ @ₑ <span class="id">d</span> ⊣ <span class="id">c</span>; <span class="id">env</span>); <span class="tactic">simpl</span>; <span class="tactic">trivial</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">d0</span>; <span class="tactic">simpl</span>; <span class="tactic">trivial</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">rflatten</span> <span class="id">l0</span>); <span class="tactic">simpl</span>; <span class="tactic">trivial</span>.<br/>
&nbsp;&nbsp;Qed.</div>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">envflatten_coll_mergeconcat</span> <span class="id">p1</span> <span class="id">p2</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;♯<span class="id">flatten</span>( ‵{| <span class="id">p1</span> ⊗ <span class="id">p2</span> |} ) ≡ₑ <span class="id">p1</span> ⊗ <span class="id">p2</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2009')">Proof.</div>
<div class="proofscript" id="proof2009">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">nraenv_core_eq</span>; <span class="tactic">intros</span> ? ? <span class="id">_</span> ? <span class="id">_</span> ? <span class="id">_</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">generalize</span> (<span class="id">h</span> ⊢ₑ <span class="id">p1</span> @ₑ <span class="id">x</span> ⊣ <span class="id">c</span>;<span class="id">env</span>); <span class="tactic">clear</span> <span class="id">p1</span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">generalize</span> (<span class="id">h</span> ⊢ₑ <span class="id">p2</span> @ₑ <span class="id">x</span> ⊣ <span class="id">c</span>;<span class="id">env</span>); <span class="tactic">clear</span> <span class="id">x</span> <span class="id">p2</span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">o</span>; <span class="tactic">destruct</span> <span class="id">o0</span>; <span class="tactic">try</span> <span class="tactic">reflexivity</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">d</span>; <span class="tactic">destruct</span> <span class="id">d0</span>; <span class="tactic">try</span> <span class="tactic">reflexivity</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">merge_bindings</span> <span class="id">l</span> <span class="id">l0</span>); <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">rmap_to_map</span> <span class="id">l</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rmap</span> (<span class="kwd">fun</span> <span class="id">x</span> : <span class="id">data</span> =&gt; <span class="id">Some</span> (<span class="id">dcoll</span> (<span class="id">x</span> :: <span class="id">nil</span>))) <span class="id">l</span> =<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Some</span> (<span class="id">map</span> (<span class="kwd">fun</span> <span class="id">x</span> : <span class="id">data</span> =&gt; (<span class="id">dcoll</span> (<span class="id">x</span> :: <span class="id">nil</span>))) <span class="id">l</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2010')">Proof.</div>
<div class="proofscript" id="proof2010">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">l</span>; [<span class="tactic">reflexivity</span>|<span class="tactic">simpl</span>; <span class="tactic">rewrite</span> <span class="id">IHl</span>; <span class="tactic">reflexivity</span>].<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">double_flatten_map_coll</span> <span class="id">p1</span> <span class="id">p2</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;♯<span class="id">flatten</span>(χ⟨ χ⟨ ‵{| <span class="id">ID</span> |} ⟩( ♯<span class="id">flatten</span>( <span class="id">p1</span> ) ) ⟩( <span class="id">p2</span> ))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;≡ₑ χ⟨ ‵{| <span class="id">ID</span> |} ⟩(♯<span class="id">flatten</span>(χ⟨ ♯<span class="id">flatten</span>( <span class="id">p1</span> ) ⟩( <span class="id">p2</span> ))).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2011')">Proof.</div>
<div class="proofscript" id="proof2011">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">nraenv_core_eq</span>; <span class="tactic">intros</span> ? ? <span class="id">_</span> ? <span class="id">_</span> ? <span class="id">_</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">generalize</span> (<span class="id">h</span> ⊢ₑ <span class="id">p2</span> @ₑ <span class="id">x</span> ⊣ <span class="id">c</span>;<span class="id">env</span>); <span class="tactic">clear</span> <span class="id">x</span> <span class="id">p2</span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">o</span>; <span class="tactic">try</span> <span class="tactic">reflexivity</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">d</span>; <span class="tactic">try</span> <span class="tactic">reflexivity</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">olift</span> <span class="kwd">in</span> *; <span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">l</span>; <span class="tactic">try</span> <span class="tactic">reflexivity</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">generalize</span> (<span class="id">h</span> ⊢ₑ <span class="id">p1</span> @ₑ <span class="id">a</span> ⊣ <span class="id">c</span>;<span class="id">env</span>); <span class="tactic">clear</span> <span class="id">a</span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">o</span>; <span class="tactic">try</span> <span class="tactic">reflexivity</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">lift_oncoll</span> (<span class="kwd">fun</span> <span class="id">l0</span> : <span class="id">list</span> <span class="id">data</span> =&gt; <span class="id">lift</span> <span class="id">dcoll</span> (<span class="id">rflatten</span> <span class="id">l0</span>)) <span class="id">d</span>); <span class="tactic">try</span> <span class="tactic">reflexivity</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">lift</span> <span class="kwd">in</span> *; <span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (         <span class="id">rmap</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">fun</span> <span class="id">x</span> : <span class="id">data</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">h</span> ⊢ₑ <span class="id">p1</span> @ₑ <span class="id">x</span> ⊣ <span class="id">c</span>;<span class="id">env</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">Some</span> <span class="id">x</span>' =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">lift_oncoll</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">fun</span> <span class="id">l0</span> : <span class="id">list</span> <span class="id">data</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">rflatten</span> <span class="id">l0</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">Some</span> <span class="id">a</span>' =&gt; <span class="id">Some</span> (<span class="id">dcoll</span> <span class="id">a</span>')<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">None</span> =&gt; <span class="id">None</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>) <span class="id">x</span>'<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">None</span> =&gt; <span class="id">None</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>) <span class="id">l</span>); <span class="tactic">try</span> <span class="tactic">reflexivity</span>; <span class="tactic">try</span> <span class="tactic">congruence</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">unfold</span> <span class="id">rflatten</span>, <span class="id">lift_oncoll</span> <span class="kwd">in</span> *; <span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">d0</span>; <span class="tactic">try</span> <span class="tactic">reflexivity</span>; <span class="tactic">try</span> <span class="tactic">congruence</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">generalize</span> (<span class="id">rmap_to_map</span> <span class="id">l1</span>); <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H</span>; <span class="tactic">clear</span> <span class="id">H</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (            <span class="id">rmap</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">fun</span> <span class="id">x</span> : <span class="id">data</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">h</span> ⊢ₑ <span class="id">p1</span> @ₑ <span class="id">x</span> ⊣ <span class="id">c</span>;<span class="id">env</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">Some</span> (<span class="id">dcoll</span> <span class="id">l1</span>) =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">oflat_map</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">fun</span> <span class="id">x0</span> : <span class="id">data</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">x0</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">dcoll</span> <span class="id">y</span> =&gt; <span class="id">Some</span> <span class="id">y</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">_</span> =&gt; <span class="id">None</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>) <span class="id">l1</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">Some</span> <span class="id">a</span>' =&gt; <span class="id">Some</span> (<span class="id">dcoll</span> <span class="id">a</span>')<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">None</span> =&gt; <span class="id">None</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">_</span> =&gt; <span class="id">None</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">Some</span> (<span class="id">dcoll</span> <span class="id">l1</span>) =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rmap</span> (<span class="kwd">fun</span> <span class="id">x0</span> : <span class="id">data</span> =&gt; <span class="id">Some</span> (<span class="id">dcoll</span> (<span class="id">x0</span> :: <span class="id">nil</span>))) <span class="id">l1</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">Some</span> <span class="id">a</span>' =&gt; <span class="id">Some</span> (<span class="id">dcoll</span> <span class="id">a</span>')<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">None</span> =&gt; <span class="id">None</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">_</span> =&gt; <span class="id">None</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>) <span class="id">l</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;); <span class="tactic">try</span> <span class="tactic">reflexivity</span>; <span class="tactic">try</span> <span class="tactic">congruence</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> ((<span class="id">oflat_map</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">fun</span> <span class="id">x</span> : <span class="id">data</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">x</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">dcoll</span> <span class="id">y</span> =&gt; <span class="id">Some</span> <span class="id">y</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">_</span> =&gt; <span class="id">None</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>) <span class="id">l2</span>)); <span class="tactic">try</span> <span class="tactic">reflexivity</span>; <span class="tactic">try</span> <span class="tactic">congruence</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (       (<span class="id">oflat_map</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">fun</span> <span class="id">x</span> : <span class="id">data</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">x</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">dcoll</span> <span class="id">y</span> =&gt; <span class="id">Some</span> <span class="id">y</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">_</span> =&gt; <span class="id">None</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>) <span class="id">l0</span>)); <span class="tactic">try</span> <span class="tactic">reflexivity</span>; <span class="tactic">try</span> <span class="tactic">congruence</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">generalize</span> (<span class="id">rmap_to_map</span> <span class="id">l4</span>); <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H</span> <span class="kwd">in</span> *; <span class="tactic">clear</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">generalize</span> (<span class="id">rmap_to_map</span> (<span class="id">l1</span>++<span class="id">l4</span>)); <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H</span> <span class="kwd">in</span> *; <span class="tactic">clear</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">IHl</span>; <span class="tactic">clear</span> <span class="id">IHl</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">rewrite</span> <span class="id">map_app</span>; <span class="tactic">simpl</span>; <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">destruct</span> ((<span class="id">oflat_map</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">fun</span> <span class="id">x</span> : <span class="id">data</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">x</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">dcoll</span> <span class="id">y</span> =&gt; <span class="id">Some</span> <span class="id">y</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">_</span> =&gt; <span class="id">None</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>) <span class="id">l0</span>)); <span class="tactic">try</span> <span class="tactic">reflexivity</span>; <span class="tactic">try</span> <span class="tactic">congruence</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">generalize</span> (<span class="id">rmap_to_map</span> <span class="id">l3</span>); <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H</span> <span class="kwd">in</span> *; <span class="tactic">clear</span> <span class="id">H</span>; <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">destruct</span> ((<span class="id">oflat_map</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">fun</span> <span class="id">x</span> : <span class="id">data</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">x</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">dcoll</span> <span class="id">y</span> =&gt; <span class="id">Some</span> <span class="id">y</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">_</span> =&gt; <span class="id">None</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>) <span class="id">l0</span>)); <span class="tactic">try</span> <span class="tactic">reflexivity</span>; <span class="tactic">try</span> <span class="tactic">congruence</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">generalize</span> (<span class="id">rmap_to_map</span> <span class="id">l2</span>); <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H</span> <span class="kwd">in</span> *; <span class="tactic">clear</span> <span class="id">H</span>; <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">destruct</span> <span class="id">d0</span>; <span class="tactic">try</span> <span class="tactic">reflexivity</span>; <span class="tactic">try</span> <span class="tactic">congruence</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">rmap</span> (<span class="kwd">fun</span> <span class="id">x</span> : <span class="id">data</span> =&gt; <span class="id">Some</span> (<span class="id">dcoll</span> (<span class="id">x</span> :: <span class="id">nil</span>))) <span class="id">l0</span>); <span class="tactic">try</span> <span class="tactic">reflexivity</span>; <span class="tactic">try</span> <span class="tactic">congruence</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (            <span class="id">rmap</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">fun</span> <span class="id">x</span> : <span class="id">data</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">h</span> ⊢ₑ <span class="id">p1</span> @ₑ <span class="id">x</span> ⊣ <span class="id">c</span>;<span class="id">env</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">Some</span> <span class="id">x</span>' =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">lift_oncoll</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">fun</span> <span class="id">l0</span> : <span class="id">list</span> <span class="id">data</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">rflatten</span> <span class="id">l0</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">Some</span> <span class="id">a</span>' =&gt; <span class="id">Some</span> (<span class="id">dcoll</span> <span class="id">a</span>')<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">None</span> =&gt; <span class="id">None</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>) <span class="id">x</span>'<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">None</span> =&gt; <span class="id">None</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">Some</span> <span class="id">x</span>' =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">lift_oncoll</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">fun</span> <span class="id">c1</span> : <span class="id">list</span> <span class="id">data</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rmap</span> (<span class="kwd">fun</span> <span class="id">x0</span> : <span class="id">data</span> =&gt; <span class="id">Some</span> (<span class="id">dcoll</span> (<span class="id">x0</span> :: <span class="id">nil</span>))) <span class="id">c1</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">Some</span> <span class="id">a</span>' =&gt; <span class="id">Some</span> (<span class="id">dcoll</span> <span class="id">a</span>')<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">None</span> =&gt; <span class="id">None</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>) <span class="id">x</span>'<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">None</span> =&gt; <span class="id">None</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>) <span class="id">l</span>); <span class="tactic">try</span> <span class="tactic">reflexivity</span>; <span class="tactic">try</span> <span class="tactic">congruence</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">rflatten</span> <span class="kwd">in</span> *; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">oflat_map</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">fun</span> <span class="id">x</span> : <span class="id">data</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">x</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">dcoll</span> <span class="id">y</span> =&gt; <span class="id">Some</span> <span class="id">y</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">_</span> =&gt; <span class="id">None</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>) <span class="id">l2</span>); <span class="tactic">try</span> <span class="tactic">reflexivity</span>; <span class="tactic">try</span> <span class="tactic">congruence</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">envflatten_map_coll</span> <span class="id">p1</span> <span class="id">p2</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;♯<span class="id">flatten</span>(χ⟨ ‵{| <span class="id">p1</span> |} ⟩( <span class="id">p2</span> )) ≡ₑ χ⟨ <span class="id">p1</span> ⟩( <span class="id">p2</span> ).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2012')">Proof.</div>
<div class="proofscript" id="proof2012">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">nraenv_core_eq</span>; <span class="tactic">intros</span> ? ? <span class="id">_</span> ? <span class="id">_</span> ? <span class="id">_</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">generalize</span> (<span class="id">h</span> ⊢ₑ <span class="id">p2</span> @ₑ <span class="id">x</span> ⊣ <span class="id">c</span>;<span class="id">env</span>); <span class="tactic">clear</span> <span class="id">x</span> <span class="id">p2</span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">o</span>; <span class="tactic">try</span> <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">d</span>; <span class="tactic">try</span> <span class="tactic">reflexivity</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">l</span>; <span class="tactic">try</span> <span class="tactic">reflexivity</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">generalize</span> (<span class="id">h</span> ⊢ₑ <span class="id">p1</span> @ₑ <span class="id">a</span> ⊣ <span class="id">c</span>;<span class="id">env</span>); <span class="tactic">clear</span> <span class="id">a</span>; <span class="tactic">intros</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">o</span>; <span class="tactic">try</span> <span class="tactic">reflexivity</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">olift</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">revert</span> <span class="id">IHl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">generalize</span> (<span class="id">rmap</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">fun</span> <span class="id">x</span> : <span class="id">data</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">h</span> ⊢ₑ <span class="id">p1</span> @ₑ <span class="id">x</span> ⊣ <span class="id">c</span>;<span class="id">env</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">Some</span> <span class="id">x</span>' =&gt; <span class="id">Some</span> (<span class="id">dcoll</span> (<span class="id">x</span>' :: <span class="id">nil</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">None</span> =&gt; <span class="id">None</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>) <span class="id">l</span>); <span class="tactic">generalize</span> (<span class="id">rmap</span> (<span class="id">nraenv_core_eval</span> <span class="id">h</span> <span class="id">c</span> <span class="id">p1</span> <span class="id">env</span>) <span class="id">l</span>); <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">lift</span> <span class="kwd">in</span> *; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">o</span>; <span class="tactic">destruct</span> <span class="id">o0</span>; <span class="tactic">simpl</span>; <span class="tactic">try</span> <span class="tactic">reflexivity</span>; <span class="tactic">try</span> <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">rflatten</span> <span class="kwd">in</span> *; <span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">revert</span> <span class="id">IHl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">generalize</span> ((<span class="id">oflat_map</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">fun</span> <span class="id">x</span> : <span class="id">data</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">x</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">dcoll</span> <span class="id">y</span> =&gt; <span class="id">Some</span> <span class="id">y</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">_</span> =&gt; <span class="id">None</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>) <span class="id">l1</span>)); <span class="tactic">intros</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">o</span>; <span class="tactic">try</span> <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">IHl</span>; <span class="tactic">clear</span> <span class="id">IHl</span> <span class="id">H0</span>; <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">rflatten</span> <span class="kwd">in</span> *; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">revert</span> <span class="id">IHl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">generalize</span> ((<span class="id">oflat_map</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">fun</span> <span class="id">x</span> : <span class="id">data</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">x</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">dcoll</span> <span class="id">y</span> =&gt; <span class="id">Some</span> <span class="id">y</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">_</span> =&gt; <span class="id">None</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>) <span class="id">l0</span>)); <span class="tactic">intros</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">o</span>; <span class="tactic">try</span> <span class="tactic">congruence</span>; <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">select_over_nil</span> <span class="id">p</span>₁ :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;σ⟨<span class="id">p</span>₁⟩(<span class="id">ANConst</span> (<span class="id">dcoll</span> <span class="id">nil</span>)) ≡ₑ <span class="id">ANConst</span> (<span class="id">dcoll</span> <span class="id">nil</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2013')">Proof.</div>
<div class="proofscript" id="proof2013">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">red</span>; <span class="tactic">intros</span> <span class="id">br</span> <span class="id">env</span> <span class="id">dn_env</span> <span class="id">d</span> <span class="id">dn_d</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>; <span class="tactic">trivial</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">map_over_nil</span> <span class="id">p</span>₁ :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;χ⟨<span class="id">p</span>₁⟩(<span class="id">ANConst</span> (<span class="id">dcoll</span> <span class="id">nil</span>)) ≡ₑ <span class="id">ANConst</span> (<span class="id">dcoll</span> <span class="id">nil</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2014')">Proof.</div>
<div class="proofscript" id="proof2014">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">red</span>; <span class="tactic">intros</span> <span class="id">br</span> <span class="id">env</span> <span class="id">dn_env</span> <span class="id">d</span> <span class="id">dn_d</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>; <span class="tactic">trivial</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">map_over_flatten</span> <span class="id">p</span>₁ <span class="id">p</span>₂ :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;χ⟨<span class="id">p</span>₁⟩(♯<span class="id">flatten</span>(<span class="id">p</span>₂)) ≡ₑ (♯<span class="id">flatten</span>(χ⟨χ⟨<span class="id">p</span>₁⟩(<span class="id">ID</span>)⟩(<span class="id">p</span>₂))).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2015')">Proof.</div>
<div class="proofscript" id="proof2015">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">red</span>; <span class="tactic">intros</span> <span class="id">br</span> <span class="id">c</span> <span class="id">dn_c</span> <span class="id">env</span> <span class="id">dn_env</span> <span class="id">d</span> <span class="id">dn_d</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">br</span> ⊢ₑ <span class="id">p</span>₂ @ₑ <span class="id">d</span> ⊣ <span class="id">c</span>;<span class="id">env</span>); <span class="tactic">simpl</span>; <span class="tactic">trivial</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">d0</span>; <span class="tactic">simpl</span>; <span class="tactic">trivial</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> <span class="id">d</span> <span class="id">dn_d</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">l</span>; <span class="tactic">simpl</span>; <span class="tactic">trivial</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">a</span>; <span class="tactic">simpl</span>; <span class="tactic">trivial</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">case_eq</span> (<span class="id">rflatten</span> <span class="id">l</span>); [<span class="tactic">intros</span> ? <span class="id">eqq1</span> | <span class="tactic">intros</span> <span class="id">eqq1</span>];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">eqq1</span> <span class="kwd">in</span> <span class="id">IHl</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> *;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;[<span class="tactic">rewrite</span> (<span class="id">rflatten_cons</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">eqq1</span>) | <span class="tactic">rewrite</span> (<span class="id">rflatten_cons_none</span> <span class="id">_</span> <span class="id">_</span> <span class="id">eqq1</span>)]<br/>
&nbsp;&nbsp;&nbsp;&nbsp;; (<span class="id">case_eq</span> (<span class="id">rmap</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">fun</span> <span class="id">x</span> : <span class="id">data</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">lift_oncoll</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">fun</span> <span class="id">c1</span> : <span class="id">list</span> <span class="id">data</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">lift</span> <span class="id">dcoll</span> (<span class="id">rmap</span> (<span class="id">nraenv_core_eval</span> <span class="id">br</span> <span class="id">c</span> <span class="id">p</span>₁ <span class="id">env</span>) <span class="id">c1</span>)) <span class="id">x</span>) <span class="id">l</span>);  [<span class="tactic">intros</span> ? <span class="id">eqq2</span> | <span class="tactic">intros</span> <span class="id">eqq2</span>];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">eqq2</span> <span class="kwd">in</span> <span class="id">IHl</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> * ).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">apply</span> <span class="id">lift_injective</span> <span class="kwd">in</span> <span class="id">IHl</span>; [ | <span class="tactic">inversion</span> 1; <span class="tactic">trivial</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">rmap_over_app</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">IHl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">rmap</span> (<span class="id">nraenv_core_eval</span> <span class="id">br</span> <span class="id">c</span> <span class="id">p</span>₁ <span class="id">env</span>) <span class="id">l0</span>); <span class="tactic">simpl</span>; <span class="tactic">trivial</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">apply</span> <span class="id">none_lift</span> <span class="kwd">in</span> <span class="id">IHl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">rmap_over_app</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">IHl</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">rmap</span> (<span class="id">nraenv_core_eval</span> <span class="id">br</span> <span class="id">c</span> <span class="id">p</span>₁ <span class="id">env</span>) <span class="id">l0</span>); <span class="tactic">simpl</span>; <span class="tactic">trivial</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">clear</span> <span class="id">IHl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">cut</span> <span class="id">False</span>; [<span class="tactic">intuition</span> | ].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">revert</span> <span class="id">eqq1</span> <span class="id">l1</span> <span class="id">eqq2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">l</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> *; <span class="tactic">try</span> <span class="tactic">discriminate</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">a</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> *; <span class="tactic">try</span> <span class="tactic">discriminate</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">rflatten</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">none_lift</span> <span class="kwd">in</span> <span class="id">eqq1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id">IHl</span> <span class="id">eqq1</span>); <span class="tactic">clear</span> <span class="id">eqq1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">match_destr_in</span> <span class="id">eqq2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">some_lift</span> <span class="kwd">in</span> <span class="id">eqq2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">eqq2</span> <span class="kwd">as</span> [? <span class="id">eqq2</span> ?]; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> (<span class="id">IHl</span> <span class="id">_</span> <span class="id">eqq2</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">match_destr</span>.<br/>
&nbsp;&nbsp;Qed.</div>
&nbsp;&nbsp;<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">select_over_flatten</span> <span class="id">p</span>₁ <span class="id">p</span>₂ :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;σ⟨<span class="id">p</span>₁⟩(♯<span class="id">flatten</span>(<span class="id">p</span>₂)) ≡ₑ (♯<span class="id">flatten</span>(χ⟨σ⟨<span class="id">p</span>₁⟩(<span class="id">ID</span>)⟩(<span class="id">p</span>₂))).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2016')">Proof.</div>
<div class="proofscript" id="proof2016">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">red</span>; <span class="tactic">intros</span> <span class="id">br</span> <span class="id">c</span> <span class="id">dn_c</span> <span class="id">env</span> <span class="id">dn_env</span> <span class="id">d</span> <span class="id">dn_d</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">br</span> ⊢ₑ <span class="id">p</span>₂ @ₑ <span class="id">d</span> ⊣ <span class="id">c</span>;<span class="id">env</span>); <span class="tactic">simpl</span>; <span class="tactic">trivial</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">d0</span>; <span class="tactic">simpl</span>; <span class="tactic">trivial</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> <span class="id">d</span> <span class="id">dn_d</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">l</span>; <span class="tactic">simpl</span>; <span class="tactic">trivial</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">a</span>; <span class="tactic">simpl</span>; <span class="tactic">trivial</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">case_eq</span> (<span class="id">rflatten</span> <span class="id">l</span>); [<span class="tactic">intros</span> ? <span class="id">eqq1</span> | <span class="tactic">intros</span> <span class="id">eqq1</span>];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">eqq1</span> <span class="kwd">in</span> <span class="id">IHl</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> *;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;[<span class="tactic">rewrite</span> (<span class="id">rflatten_cons</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">eqq1</span>) | <span class="tactic">rewrite</span> (<span class="id">rflatten_cons_none</span> <span class="id">_</span> <span class="id">_</span> <span class="id">eqq1</span>)];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">case_eq</span> (<span class="id">rmap</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">fun</span> <span class="id">x</span> : <span class="id">data</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">lift_oncoll</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">fun</span> <span class="id">c1</span> : <span class="id">list</span> <span class="id">data</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">lift</span> <span class="id">dcoll</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">lift_filter</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">fun</span> <span class="id">x</span>' : <span class="id">data</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">br</span> ⊢ₑ <span class="id">p</span>₁ @ₑ <span class="id">x</span>' ⊣ <span class="id">c</span>;<span class="id">env</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">Some</span> (<span class="id">dbool</span> <span class="id">b</span>) =&gt; <span class="id">Some</span> <span class="id">b</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">Some</span> <span class="id">_</span> =&gt; <span class="id">None</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">None</span> =&gt; <span class="id">None</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>) <span class="id">c1</span>)) <span class="id">x</span>) <span class="id">l</span>);  [<span class="tactic">intros</span> ? <span class="id">eqq2</span> | <span class="tactic">intros</span> <span class="id">eqq2</span>];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">eqq2</span> <span class="kwd">in</span> <span class="id">IHl</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> * ).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">apply</span> <span class="id">lift_injective</span> <span class="kwd">in</span> <span class="id">IHl</span>; [ | <span class="tactic">inversion</span> 1; <span class="tactic">trivial</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">lift_app_filter</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">IHl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> ( (<span class="id">lift_filter</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">fun</span> <span class="id">x</span>' : <span class="id">data</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">br</span> ⊢ₑ <span class="id">p</span>₁ @ₑ <span class="id">x</span>' ⊣ <span class="id">c</span>;<span class="id">env</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">Some</span> (<span class="id">dbool</span> <span class="id">b</span>) =&gt; <span class="id">Some</span> <span class="id">b</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">Some</span> <span class="id">_</span> =&gt; <span class="id">None</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">None</span> =&gt; <span class="id">None</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>) <span class="id">l0</span>)); <span class="tactic">simpl</span>; <span class="tactic">trivial</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">apply</span> <span class="id">none_lift</span> <span class="kwd">in</span> <span class="id">IHl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">lift_app_filter</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">IHl</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">lift_filter</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">fun</span> <span class="id">x</span>' : <span class="id">data</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">br</span> ⊢ₑ <span class="id">p</span>₁ @ₑ <span class="id">x</span>' ⊣ <span class="id">c</span>;<span class="id">env</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">Some</span> (<span class="id">dbool</span> <span class="id">b</span>) =&gt; <span class="id">Some</span> <span class="id">b</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">Some</span> <span class="id">_</span> =&gt; <span class="id">None</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">None</span> =&gt; <span class="id">None</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>) <span class="id">l0</span>); <span class="tactic">simpl</span>; <span class="tactic">trivial</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">clear</span> <span class="id">IHl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">cut</span> <span class="id">False</span>; [<span class="tactic">intuition</span> | ].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">revert</span> <span class="id">eqq1</span> <span class="id">l1</span> <span class="id">eqq2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">l</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> *; <span class="tactic">try</span> <span class="tactic">discriminate</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">a</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> *; <span class="tactic">try</span> <span class="tactic">discriminate</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">rflatten</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">none_lift</span> <span class="kwd">in</span> <span class="id">eqq1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id">IHl</span> <span class="id">eqq1</span>); <span class="tactic">clear</span> <span class="id">eqq1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">match_destr_in</span> <span class="id">eqq2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">some_lift</span> <span class="kwd">in</span> <span class="id">eqq2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">eqq2</span> <span class="kwd">as</span> [? <span class="id">eqq2</span> ?]; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> (<span class="id">IHl</span> <span class="id">_</span> <span class="id">eqq2</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">match_destr</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">select_over_either</span> <span class="id">p</span>₁ <span class="id">p</span>₂ <span class="id">p</span>₃ :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;σ⟨<span class="id">p</span>₁⟩( <span class="id">ANEither</span> <span class="id">p</span>₂ <span class="id">p</span>₃) ≡ₑ <span class="id">ANEither</span> (σ⟨<span class="id">p</span>₁⟩(<span class="id">p</span>₂)) (σ⟨<span class="id">p</span>₁⟩(<span class="id">p</span>₃)).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2017')">Proof.</div>
<div class="proofscript" id="proof2017">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">nraenv_core_eq</span>; <span class="tactic">intros</span> ? ? <span class="id">_</span> ? <span class="id">_</span> ? <span class="id">_</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">match_destr</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
<div class="doc">Now has a (better) typed variant for arbitrary p1/p2, see TOptimEnv </div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">envdot_from_duplicate_r</span> <span class="id">s1</span> <span class="id">s2</span> <span class="id">p1</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(‵[| (<span class="id">s1</span>, <span class="id">p1</span>) |] ⊕ ‵[| (<span class="id">s2</span>, <span class="id">p1</span>) |])·<span class="id">s2</span> ≡ₑ <span class="id">p1</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2018')">Proof.</div>
<div class="proofscript" id="proof2018">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">nraenv_core_eq</span>; <span class="tactic">intros</span> ? ? <span class="id">_</span> ? <span class="id">_</span> ? <span class="id">_</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">generalize</span> (<span class="id">h</span> ⊢ₑ <span class="id">p1</span> @ₑ <span class="id">x</span> ⊣ <span class="id">c</span>;<span class="id">env</span>); <span class="tactic">clear</span> <span class="id">p1</span> <span class="id">x</span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">o</span>; <span class="tactic">try</span> <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">olift</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">StringOrder.lt_dec</span> <span class="id">s1</span> <span class="id">s2</span>); <span class="tactic">try</span> <span class="tactic">reflexivity</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">edot</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">string_eqdec</span> <span class="id">s2</span> <span class="id">s2</span>); <span class="tactic">try</span> <span class="tactic">congruence</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">StringOrder.lt_dec</span> <span class="id">s1</span> <span class="id">s2</span>); <span class="tactic">try</span> <span class="tactic">congruence</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">StringOrder.lt_dec</span> <span class="id">s2</span> <span class="id">s1</span>); <span class="tactic">try</span> <span class="tactic">congruence</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">edot</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">string_eqdec</span> <span class="id">s2</span> <span class="id">s1</span>); <span class="tactic">try</span> <span class="tactic">congruence</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">string_eqdec</span> <span class="id">s2</span> <span class="id">s2</span>); <span class="tactic">try</span> <span class="tactic">congruence</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">edot</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">string_eqdec</span> <span class="id">s2</span> <span class="id">s2</span>); <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">envdot_from_duplicate_l</span> <span class="id">s1</span> <span class="id">s2</span> <span class="id">p1</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(‵[| (<span class="id">s1</span>, <span class="id">p1</span>) |] ⊕ ‵[| (<span class="id">s2</span>, <span class="id">p1</span>) |])·<span class="id">s1</span> ≡ₑ <span class="id">p1</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2019')">Proof.</div>
<div class="proofscript" id="proof2019">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">nraenv_core_eq</span>; <span class="tactic">intros</span> ? ? <span class="id">_</span> ? <span class="id">_</span> ? <span class="id">_</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">generalize</span> (<span class="id">h</span> ⊢ₑ <span class="id">p1</span> @ₑ <span class="id">x</span> ⊣ <span class="id">c</span>;<span class="id">env</span>); <span class="tactic">clear</span> <span class="id">p1</span> <span class="id">x</span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">o</span>; <span class="tactic">try</span> <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">olift</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">StringOrder.lt_dec</span> <span class="id">s1</span> <span class="id">s2</span>); <span class="tactic">try</span> <span class="tactic">reflexivity</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">edot</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">string_eqdec</span> <span class="id">s1</span> <span class="id">s1</span>); <span class="tactic">try</span> <span class="tactic">congruence</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">string_eqdec</span> <span class="id">s1</span> <span class="id">s2</span>); <span class="tactic">try</span> <span class="tactic">congruence</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">StringOrder.lt_dec</span> <span class="id">s2</span> <span class="id">s1</span>); <span class="tactic">try</span> <span class="tactic">congruence</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">edot</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">string_eqdec</span> <span class="id">s1</span> <span class="id">s1</span>); <span class="tactic">try</span> <span class="tactic">congruence</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">edot</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">string_eqdec</span> <span class="id">s1</span> <span class="id">s2</span>); <span class="tactic">try</span> <span class="tactic">congruence</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">StringOrder.eq</span> <span class="id">s1</span> <span class="id">s2</span>) <span class="tactic">by</span> (<span class="tactic">apply</span> <span class="id">lt_contr1</span>; <span class="tactic">assumption</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">contradiction</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">envmap_over_either</span> <span class="id">p</span>₁ <span class="id">p</span>₂ <span class="id">p</span>₃ :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;χ⟨<span class="id">p</span>₁⟩( <span class="id">ANEither</span> <span class="id">p</span>₂ <span class="id">p</span>₃) ≡ₑ <span class="id">ANEither</span> (χ⟨<span class="id">p</span>₁⟩(<span class="id">p</span>₂)) (χ⟨<span class="id">p</span>₁⟩(<span class="id">p</span>₃)).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2020')">Proof.</div>
<div class="proofscript" id="proof2020">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">nraenv_core_eq</span>; <span class="tactic">intros</span> ? ? <span class="id">_</span> ? <span class="id">_</span> ? <span class="id">_</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">match_destr</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">envmap_over_either_app</span> <span class="id">p</span>₁ <span class="id">p</span>₂ <span class="id">p</span>₃ <span class="id">p</span>₄:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;χ⟨<span class="id">p</span>₁⟩( <span class="id">ANEither</span> <span class="id">p</span>₂ <span class="id">p</span>₃ ◯ <span class="id">p</span>₄) ≡ₑ <span class="id">ANEither</span> (χ⟨<span class="id">p</span>₁⟩(<span class="id">p</span>₂)) (χ⟨<span class="id">p</span>₁⟩(<span class="id">p</span>₃)) ◯ <span class="id">p</span>₄.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2021')">Proof.</div>
<div class="proofscript" id="proof2021">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">nraenv_core_eq</span>; <span class="tactic">intros</span> ? ? <span class="id">_</span> ? <span class="id">_</span> ? <span class="id">_</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">olift</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">h</span> ⊢ₑ <span class="id">p</span>₄ @ₑ <span class="id">x</span> ⊣ <span class="id">c</span>; <span class="id">env</span>); <span class="tactic">simpl</span>; <span class="tactic">trivial</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">d</span>; <span class="tactic">simpl</span>; <span class="tactic">trivial</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">envmap_into_id</span> <span class="id">p</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;χ⟨ <span class="id">ID</span> ⟩(‵{| <span class="id">p</span> |}) ≡ₑ ‵{| <span class="id">p</span> |}.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2022')">Proof.</div>
<div class="proofscript" id="proof2022">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">nraenv_core_eq</span>; <span class="tactic">intros</span> ? ? <span class="id">_</span> ? <span class="id">_</span> ? <span class="id">_</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">generalize</span> (<span class="id">h</span> ⊢ₑ <span class="id">p</span> @ₑ <span class="id">x</span> ⊣ <span class="id">c</span>;<span class="id">env</span>); <span class="tactic">clear</span> <span class="id">x</span> <span class="id">p</span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">o</span>; <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<br/>
<br/>
&nbsp;&nbsp;<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">envmap_into_id_flatten</span> <span class="id">p</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;χ⟨ <span class="id">ID</span> ⟩( ♯<span class="id">flatten</span>(<span class="id">p</span>) ) ≡ₑ ♯<span class="id">flatten</span>(<span class="id">p</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2023')">Proof.</div>
<div class="proofscript" id="proof2023">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">nraenv_core_eq</span>; <span class="tactic">intros</span> ? ? <span class="id">_</span> ? <span class="id">_</span> ? <span class="id">_</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">generalize</span> (<span class="id">h</span> ⊢ₑ <span class="id">p</span> @ₑ <span class="id">x</span> ⊣ <span class="id">c</span>;<span class="id">env</span>); <span class="tactic">clear</span> <span class="id">x</span> <span class="id">p</span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">o</span>; <span class="tactic">try</span> <span class="tactic">reflexivity</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">lift_oncoll</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">d</span>; <span class="tactic">try</span> <span class="tactic">reflexivity</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">olift</span>, <span class="id">lift</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">rflatten</span> <span class="id">l</span>); <span class="tactic">try</span> <span class="tactic">reflexivity</span>; <span class="tactic">clear</span> <span class="id">l</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">l0</span>; <span class="tactic">try</span> <span class="tactic">reflexivity</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">lift</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">revert</span> <span class="id">IHl0</span>; <span class="tactic">destruct</span> (<span class="id">rmap</span> (<span class="kwd">fun</span> <span class="id">x</span>: <span class="id">data</span> =&gt; <span class="id">Some</span> <span class="id">x</span>) <span class="id">l0</span>); <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">product_singletons</span> <span class="id">s1</span> <span class="id">s2</span> <span class="id">p1</span> <span class="id">p2</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;‵{|‵[| (<span class="id">s1</span>, <span class="id">p1</span>) |] |} × ‵{| ‵[| (<span class="id">s2</span>, <span class="id">p2</span>) |] |} ≡ₑ<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;‵{|‵[| (<span class="id">s1</span>, <span class="id">p1</span>) |] ⊕ ‵[| (<span class="id">s2</span>, <span class="id">p2</span>) |] |}.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2024')">Proof.</div>
<div class="proofscript" id="proof2024">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">nra_eq</span>, <span class="id">nraenv_core_eq</span>; <span class="tactic">intros</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">generalize</span> (<span class="id">h</span> ⊢ₑ <span class="id">p1</span> @ₑ <span class="id">x</span> ⊣ <span class="id">c</span>;<span class="id">env</span>); <span class="tactic">generalize</span> (<span class="id">h</span> ⊢ₑ <span class="id">p2</span> @ₑ <span class="id">x</span> ⊣ <span class="id">c</span>;<span class="id">env</span>); <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">o</span>; <span class="tactic">destruct</span> <span class="id">o0</span>; <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">app_over_id</span> <span class="id">p</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">p</span> ◯ <span class="id">ID</span> ≡ₑ <span class="id">p</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2025')">Proof.</div>
<div class="proofscript" id="proof2025">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">nra_eq</span>, <span class="id">nraenv_core_eq</span>; <span class="tactic">intros</span>; <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">appenv_over_env</span> <span class="id">p</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ENV</span> ◯ₑ <span class="id">p</span> ≡ₑ <span class="id">p</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2026')">Proof.</div>
<div class="proofscript" id="proof2026">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">nra_eq</span>, <span class="id">nraenv_core_eq</span>; <span class="tactic">intros</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">h</span> ⊢ₑ <span class="id">p</span> @ₑ <span class="id">x</span> ⊣ <span class="id">c</span>;<span class="id">env</span>); <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">app_over_id_l</span> <span class="id">p</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ID</span> ◯ <span class="id">p</span> ≡ₑ <span class="id">p</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2027')">Proof.</div>
<div class="proofscript" id="proof2027">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">nra_eq</span>, <span class="id">nraenv_core_eq</span>; <span class="tactic">intros</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">generalize</span> (<span class="id">h</span> ⊢ₑ <span class="id">p</span> @ₑ <span class="id">x</span> ⊣ <span class="id">c</span>;<span class="id">env</span>); <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">o</span>; <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">app_over_app</span> <span class="id">p1</span> <span class="id">p2</span> <span class="id">p3</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">p1</span> ◯ <span class="id">p2</span>) ◯ <span class="id">p3</span>  ≡ₑ <span class="id">p1</span> ◯ (<span class="id">p2</span> ◯ <span class="id">p3</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2028')">Proof.</div>
<div class="proofscript" id="proof2028">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">nra_eq</span>, <span class="id">nraenv_core_eq</span>; <span class="tactic">intros</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">generalize</span> (<span class="id">h</span> ⊢ₑ <span class="id">p3</span> @ₑ <span class="id">x</span> ⊣ <span class="id">c</span>;<span class="id">env</span>); <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">o</span>; <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">app_over_unop</span> <span class="id">u</span> <span class="id">p1</span> <span class="id">p2</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">ANUnop</span> <span class="id">u</span> <span class="id">p1</span>) ◯ <span class="id">p2</span> ≡ₑ (<span class="id">ANUnop</span> <span class="id">u</span> (<span class="id">p1</span> ◯ <span class="id">p2</span>)).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2029')">Proof.</div>
<div class="proofscript" id="proof2029">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">nra_eq</span>, <span class="id">nraenv_core_eq</span>; <span class="tactic">intros</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">generalize</span> (<span class="id">h</span> ⊢ₑ <span class="id">p2</span> @ₑ <span class="id">x</span> ⊣ <span class="id">c</span>;<span class="id">env</span>); <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">o</span>; <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">appenv_over_unop</span> <span class="id">u</span> <span class="id">p1</span> <span class="id">p2</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">ANUnop</span> <span class="id">u</span> <span class="id">p1</span>) ◯ₑ <span class="id">p2</span> ≡ₑ (<span class="id">ANUnop</span> <span class="id">u</span> (<span class="id">p1</span> ◯ₑ <span class="id">p2</span>)).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2030')">Proof.</div>
<div class="proofscript" id="proof2030">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">nra_eq</span>, <span class="id">nraenv_core_eq</span>; <span class="tactic">intros</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">generalize</span> (<span class="id">h</span> ⊢ₑ <span class="id">p2</span> @ₑ <span class="id">x</span> ⊣ <span class="id">c</span>;<span class="id">env</span>); <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">o</span>; <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">unop_over_either</span> <span class="id">u</span> <span class="id">p</span>₁ <span class="id">p</span>₂ :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ANUnop</span> <span class="id">u</span> (<span class="id">ANEither</span> <span class="id">p</span>₁ <span class="id">p</span>₂) ≡ₑ <span class="id">ANEither</span> (<span class="id">ANUnop</span> <span class="id">u</span> <span class="id">p</span>₁)(<span class="id">ANUnop</span> <span class="id">u</span> <span class="id">p</span>₂).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2031')">Proof.</div>
<div class="proofscript" id="proof2031">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">nraenv_core_eq</span>; <span class="tactic">intros</span> ? ? <span class="id">_</span> ? <span class="id">_</span> ? <span class="id">_</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">match_destr</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">unop_over_either_app</span> <span class="id">u</span> <span class="id">p</span>₁ <span class="id">p</span>₂ <span class="id">p</span>₃ :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ANUnop</span> <span class="id">u</span> (<span class="id">ANEither</span> <span class="id">p</span>₁ <span class="id">p</span>₂ ◯ <span class="id">p</span>₃)  ≡ₑ <span class="id">ANEither</span> (<span class="id">ANUnop</span> <span class="id">u</span> <span class="id">p</span>₁)(<span class="id">ANUnop</span> <span class="id">u</span> <span class="id">p</span>₂) ◯ <span class="id">p</span>₃.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2032')">Proof.</div>
<div class="proofscript" id="proof2032">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">nraenv_core_eq</span>; <span class="tactic">intros</span> ? ? <span class="id">_</span> ? <span class="id">_</span> ? <span class="id">_</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">olift</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">h</span> ⊢ₑ <span class="id">p</span>₃ @ₑ <span class="id">x</span> ⊣ <span class="id">c</span>; <span class="id">env</span>); <span class="tactic">simpl</span>; <span class="tactic">trivial</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">d</span>; <span class="tactic">simpl</span>; <span class="tactic">trivial</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">app_over_merge</span> <span class="id">p1</span> <span class="id">p2</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">ANEnv</span> ⊗ <span class="id">p1</span>) ◯ <span class="id">p2</span> ≡ₑ <span class="id">ANEnv</span> ⊗ (<span class="id">p1</span> ◯ <span class="id">p2</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2033')">Proof.</div>
<div class="proofscript" id="proof2033">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">nra_eq</span>, <span class="id">nraenv_core_eq</span>; <span class="tactic">intros</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">generalize</span> (<span class="id">h</span> ⊢ₑ <span class="id">p2</span> @ₑ <span class="id">x</span> ⊣ <span class="id">c</span>;<span class="id">env</span>); <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">o</span>; <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">app_over_binop_l</span> <span class="id">b</span> <span class="id">d</span> <span class="id">p1</span> <span class="id">p2</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">ANBinop</span> <span class="id">b</span> <span class="id">p2</span> (<span class="id">ANConst</span> <span class="id">d</span>) ◯ <span class="id">p1</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;≡ₑ (<span class="id">ANBinop</span> <span class="id">b</span> (<span class="id">p2</span> ◯ <span class="id">p1</span>) (<span class="id">ANConst</span> <span class="id">d</span>)).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2034')">Proof.</div>
<div class="proofscript" id="proof2034">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">nra_eq</span>, <span class="id">nraenv_core_eq</span>; <span class="tactic">intros</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">generalize</span> (<span class="id">h</span> ⊢ₑ <span class="id">p1</span> @ₑ <span class="id">x</span> ⊣ <span class="id">c</span>;<span class="id">env</span>); <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">o</span>; <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;Qed.</div>
&nbsp;<br/>
&nbsp;&nbsp;<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">app_concat_over_binop</span> <span class="id">b</span> <span class="id">p1</span> <span class="id">p2</span> <span class="id">p3</span> <span class="id">p4</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">ANBinop</span> <span class="id">b</span> <span class="id">p1</span> <span class="id">p2</span> ◯ (<span class="id">p3</span> ⊕ <span class="id">p4</span>) )<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;≡ₑ (<span class="id">ANBinop</span> <span class="id">b</span> (<span class="id">p1</span> ◯ (<span class="id">p3</span> ⊕ <span class="id">p4</span>)) (<span class="id">p2</span> ◯ (<span class="id">p3</span> ⊕ <span class="id">p4</span>))).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2035')">Proof.</div>
<div class="proofscript" id="proof2035">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">nra_eq</span>, <span class="id">nraenv_core_eq</span>; <span class="tactic">intros</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">h</span> ⊢ₑ <span class="id">p3</span> @ₑ <span class="id">x</span> ⊣ <span class="id">c</span>;<span class="id">env</span>); <span class="tactic">try</span> <span class="tactic">reflexivity</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">h</span> ⊢ₑ <span class="id">p4</span> @ₑ <span class="id">x</span> ⊣ <span class="id">c</span>;<span class="id">env</span>); <span class="tactic">try</span> <span class="tactic">reflexivity</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">d</span>; <span class="tactic">try</span> <span class="tactic">reflexivity</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">d0</span>; <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">app_over_binop_env</span> <span class="id">b</span> <span class="id">p1</span> <span class="id">p2</span> <span class="id">s</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">ANBinop</span> <span class="id">b</span> <span class="id">p1</span> <span class="id">p2</span> ◯ (<span class="id">ANUnop</span> (<span class="id">ADot</span> <span class="id">s</span>) <span class="id">ANEnv</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;≡ₑ (<span class="id">ANBinop</span> <span class="id">b</span> (<span class="id">p1</span> ◯ (<span class="id">ANUnop</span> (<span class="id">ADot</span> <span class="id">s</span>) <span class="id">ANEnv</span>)) (<span class="id">p2</span> ◯ (<span class="id">ANUnop</span> (<span class="id">ADot</span> <span class="id">s</span>) <span class="id">ANEnv</span>))).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2036')">Proof.</div>
<div class="proofscript" id="proof2036">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">nra_eq</span>, <span class="id">nraenv_core_eq</span>; <span class="tactic">intros</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">env</span>; <span class="tactic">try</span> <span class="tactic">reflexivity</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">edot</span> <span class="id">l</span> <span class="id">s</span>); <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">app_over_select</span> <span class="id">p0</span> <span class="id">p1</span> <span class="id">p2</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;σ⟨ <span class="id">p1</span> ⟩( <span class="id">p2</span> ) ◯ <span class="id">p0</span> ≡ₑ σ⟨ <span class="id">p1</span> ⟩( <span class="id">p2</span> ◯ <span class="id">p0</span> ).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2037')">Proof.</div>
<div class="proofscript" id="proof2037">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">nra_eq</span>, <span class="id">nraenv_core_eq</span>; <span class="tactic">intros</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">generalize</span> (<span class="id">h</span> ⊢ₑ <span class="id">p0</span> @ₑ <span class="id">x</span> ⊣ <span class="id">c</span>;<span class="id">env</span>); <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">o</span>; <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">app_over_map</span> <span class="id">p0</span> <span class="id">p1</span> <span class="id">p2</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;χ⟨ <span class="id">p1</span> ⟩( <span class="id">p2</span> ) ◯ <span class="id">p0</span> ≡ₑ χ⟨ <span class="id">p1</span> ⟩( <span class="id">p2</span> ◯ <span class="id">p0</span> ).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2038')">Proof.</div>
<div class="proofscript" id="proof2038">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">nra_eq</span>, <span class="id">nraenv_core_eq</span>; <span class="tactic">intros</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">generalize</span> (<span class="id">h</span> ⊢ₑ <span class="id">p0</span> @ₑ <span class="id">x</span> ⊣ <span class="id">c</span>;<span class="id">env</span>); <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">o</span>; <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;Qed.</div>
&nbsp;&nbsp;<br/>
&nbsp;&nbsp;<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">app_over_mapconcat</span> <span class="id">p0</span> <span class="id">p1</span> <span class="id">p2</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;⋈ᵈ⟨ <span class="id">p1</span> ⟩( <span class="id">p2</span> ) ◯ <span class="id">p0</span> ≡ₑ ⋈ᵈ⟨ <span class="id">p1</span> ⟩( <span class="id">p2</span> ◯ <span class="id">p0</span> ).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2039')">Proof.</div>
<div class="proofscript" id="proof2039">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">nra_eq</span>, <span class="id">nraenv_core_eq</span>; <span class="tactic">intros</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">generalize</span> (<span class="id">h</span> ⊢ₑ <span class="id">p0</span> @ₑ <span class="id">x</span> ⊣ <span class="id">c</span>;<span class="id">env</span>); <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">o</span>; <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;Qed.</div>
&nbsp;&nbsp;<br/>
&nbsp;&nbsp;<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">app_over_product</span> <span class="id">p0</span> <span class="id">p1</span> <span class="id">p2</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">p1</span> × <span class="id">p2</span>) ◯ <span class="id">p0</span> ≡ₑ (<span class="id">p1</span>  ◯ <span class="id">p0</span>) × (<span class="id">p2</span> ◯ <span class="id">p0</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2040')">Proof.</div>
<div class="proofscript" id="proof2040">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">nra_eq</span>, <span class="id">nraenv_core_eq</span>; <span class="tactic">intros</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">generalize</span> (<span class="id">h</span> ⊢ₑ <span class="id">p0</span> @ₑ <span class="id">x</span> ⊣ <span class="id">c</span>;<span class="id">env</span>); <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">o</span>; <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;Qed.</div>
&nbsp;&nbsp;<br/>
&nbsp;&nbsp;<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">appenv_over_map</span> <span class="id">p0</span> <span class="id">p1</span> <span class="id">p2</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">nraenv_core_ignores_id</span> <span class="id">p0</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;χ⟨ <span class="id">p1</span> ⟩( <span class="id">p2</span> ) ◯ₑ <span class="id">p0</span> ≡ₑ χ⟨ <span class="id">p1</span> ◯ₑ <span class="id">p0</span> ⟩( <span class="id">p2</span> ◯ₑ <span class="id">p0</span> ).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2041')">Proof.</div>
<div class="proofscript" id="proof2041">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">nra_eq</span>, <span class="id">nraenv_core_eq</span>; <span class="tactic">intros</span> ? ? ? <span class="id">_</span> ? <span class="id">_</span> ? <span class="id">_</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">case_eq</span> (<span class="id">h</span> ⊢ₑ <span class="id">p0</span> @ₑ <span class="id">x</span> ⊣ <span class="id">c</span>;<span class="id">env</span>); <span class="tactic">intros</span>; <span class="tactic">try</span> <span class="tactic">reflexivity</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">h</span> ⊢ₑ <span class="id">p2</span> @ₑ <span class="id">x</span> ⊣ <span class="id">c</span>;<span class="id">d</span>); <span class="tactic">try</span> <span class="tactic">reflexivity</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">d0</span>; <span class="tactic">try</span> <span class="tactic">reflexivity</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">l</span>; <span class="tactic">try</span> <span class="tactic">reflexivity</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> (<span class="id">nraenv_core_ignores_id_swap</span> <span class="id">p0</span> <span class="id">H</span> <span class="id">h</span> <span class="id">c</span> <span class="id">env</span> <span class="id">a</span> <span class="id">x</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H0</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">h</span> ⊢ₑ <span class="id">p1</span> @ₑ <span class="id">a</span> ⊣ <span class="id">c</span>;<span class="id">d</span>); <span class="tactic">try</span> <span class="tactic">reflexivity</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">f_equal</span>; <span class="tactic">unfold</span> <span class="id">lift</span> <span class="kwd">in</span> *; <span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">rmap</span> (<span class="id">nraenv_core_eval</span> <span class="id">h</span> <span class="id">c</span> <span class="id">p1</span> <span class="id">d</span>) <span class="id">l</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">rmap</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">fun</span> <span class="id">x0</span> : <span class="id">data</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">olift</span> (<span class="kwd">fun</span> <span class="id">env</span>' : <span class="id">data</span> =&gt; <span class="id">h</span> ⊢ₑ <span class="id">p1</span> @ₑ <span class="id">x0</span> ⊣ <span class="id">c</span>;<span class="id">env</span>') (<span class="id">h</span> ⊢ₑ <span class="id">p0</span> @ₑ <span class="id">x0</span> ⊣ <span class="id">c</span>;<span class="id">env</span>)) <span class="id">l</span>); <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">appenv_over_select</span> <span class="id">p0</span> <span class="id">p1</span> <span class="id">p2</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">nraenv_core_ignores_id</span> <span class="id">p0</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;σ⟨ <span class="id">p1</span> ⟩( <span class="id">p2</span> ) ◯ₑ <span class="id">p0</span> ≡ₑ σ⟨ <span class="id">p1</span> ◯ₑ <span class="id">p0</span> ⟩( <span class="id">p2</span> ◯ₑ <span class="id">p0</span> ).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2042')">Proof.</div>
<div class="proofscript" id="proof2042">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">nra_eq</span>, <span class="id">nraenv_core_eq</span>; <span class="tactic">intros</span> ? ? ? <span class="id">_</span> ? <span class="id">_</span> ? <span class="id">_</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">case_eq</span> (<span class="id">h</span> ⊢ₑ <span class="id">p0</span> @ₑ <span class="id">x</span> ⊣ <span class="id">c</span>;<span class="id">env</span>); <span class="tactic">intros</span>; <span class="tactic">try</span> <span class="tactic">reflexivity</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">h</span> ⊢ₑ <span class="id">p2</span> @ₑ <span class="id">x</span> ⊣ <span class="id">c</span>;<span class="id">d</span>); <span class="tactic">try</span> <span class="tactic">reflexivity</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">d0</span>; <span class="tactic">try</span> <span class="tactic">reflexivity</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">l</span>; <span class="tactic">try</span> <span class="tactic">reflexivity</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> (<span class="id">nraenv_core_ignores_id_swap</span> <span class="id">p0</span> <span class="id">H</span> <span class="id">h</span> <span class="id">c</span> <span class="id">env</span> <span class="id">a</span> <span class="id">x</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H0</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">h</span> ⊢ₑ <span class="id">p1</span> @ₑ <span class="id">a</span> ⊣ <span class="id">c</span>;<span class="id">d</span>); <span class="tactic">try</span> <span class="tactic">reflexivity</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">d0</span>; <span class="tactic">try</span> <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">b</span>; <span class="tactic">try</span> <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">f_equal</span>; <span class="tactic">unfold</span> <span class="id">lift</span> <span class="kwd">in</span> *; <span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">lift_filter</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">fun</span> <span class="id">x</span>' : <span class="id">data</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">h</span> ⊢ₑ <span class="id">p1</span> @ₑ <span class="id">x</span>' ⊣ <span class="id">c</span>;<span class="id">d</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">Some</span> (<span class="id">dbool</span> <span class="id">b</span>) =&gt; <span class="id">Some</span> <span class="id">b</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">_</span> =&gt; <span class="id">None</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>) <span class="id">l</span>); <span class="tactic">destruct</span> (<span class="id">lift_filter</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">fun</span> <span class="id">x</span>' : <span class="id">data</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">olift</span> (<span class="kwd">fun</span> <span class="id">env</span>' : <span class="id">data</span> =&gt; <span class="id">h</span> ⊢ₑ <span class="id">p1</span> @ₑ <span class="id">x</span>' ⊣ <span class="id">c</span>;<span class="id">env</span>') (<span class="id">h</span> ⊢ₑ <span class="id">p0</span> @ₑ <span class="id">x</span>' ⊣ <span class="id">c</span>;<span class="id">env</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">Some</span> (<span class="id">dbool</span> <span class="id">b</span>) =&gt; <span class="id">Some</span> <span class="id">b</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">_</span> =&gt; <span class="id">None</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>) <span class="id">l</span>); <span class="tactic">simpl</span> <span class="kwd">in</span> *; <span class="tactic">try</span> <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">f_equal</span>; <span class="tactic">unfold</span> <span class="id">lift</span> <span class="kwd">in</span> *; <span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">lift_filter</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">fun</span> <span class="id">x</span>' : <span class="id">data</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">h</span> ⊢ₑ <span class="id">p1</span> @ₑ <span class="id">x</span>' ⊣ <span class="id">c</span>;<span class="id">d</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">Some</span> (<span class="id">dbool</span> <span class="id">b</span>) =&gt; <span class="id">Some</span> <span class="id">b</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">_</span> =&gt; <span class="id">None</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>) <span class="id">l</span>); <span class="tactic">destruct</span> (<span class="id">lift_filter</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">fun</span> <span class="id">x</span>' : <span class="id">data</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">olift</span> (<span class="kwd">fun</span> <span class="id">env</span>' : <span class="id">data</span> =&gt; <span class="id">h</span> ⊢ₑ <span class="id">p1</span> @ₑ <span class="id">x</span>' ⊣ <span class="id">c</span>;<span class="id">env</span>') (<span class="id">h</span> ⊢ₑ <span class="id">p0</span> @ₑ <span class="id">x</span>' ⊣ <span class="id">c</span>;<span class="id">env</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">Some</span> (<span class="id">dbool</span> <span class="id">b</span>) =&gt; <span class="id">Some</span> <span class="id">b</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">_</span> =&gt; <span class="id">None</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>) <span class="id">l</span>); <span class="tactic">simpl</span> <span class="kwd">in</span> *; <span class="tactic">try</span> <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">appenv_over_mapenv</span> <span class="id">p</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ANAppEnv</span> (<span class="id">ANMapEnv</span> (<span class="id">ANUnop</span> <span class="id">AColl</span> <span class="id">ANEnv</span>)) (<span class="id">ANUnop</span> <span class="id">AFlatten</span> <span class="id">p</span>) ≡ₑ (<span class="id">ANMap</span> (<span class="id">ANUnop</span> <span class="id">AColl</span> <span class="id">ANID</span>) (<span class="id">ANUnop</span> <span class="id">AFlatten</span> <span class="id">p</span>)).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2043')">Proof.</div>
<div class="proofscript" id="proof2043">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">nra_eq</span>, <span class="id">nraenv_core_eq</span>; <span class="tactic">intros</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">generalize</span> (<span class="id">h</span> ⊢ₑ <span class="id">p</span> @ₑ <span class="id">x</span> ⊣ <span class="id">c</span>;<span class="id">env</span>); <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">o</span>; <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">appenv_over_mapenv_coll</span> <span class="id">p</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ANAppEnv</span> (<span class="id">ANMapEnv</span> (<span class="id">ANUnop</span> <span class="id">AColl</span> (<span class="id">ANUnop</span> <span class="id">AColl</span> <span class="id">ANEnv</span>))) (<span class="id">ANUnop</span> <span class="id">AFlatten</span> <span class="id">p</span>) ≡ₑ (<span class="id">ANMap</span> (<span class="id">ANUnop</span> <span class="id">AColl</span> (<span class="id">ANUnop</span> <span class="id">AColl</span> <span class="id">ANID</span>)) (<span class="id">ANUnop</span> <span class="id">AFlatten</span> <span class="id">p</span>)).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2044')">Proof.</div>
<div class="proofscript" id="proof2044">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">nra_eq</span>, <span class="id">nraenv_core_eq</span>; <span class="tactic">intros</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">generalize</span> (<span class="id">h</span> ⊢ₑ <span class="id">p</span> @ₑ <span class="id">x</span> ⊣ <span class="id">c</span>;<span class="id">env</span>); <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">o</span>; <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">appenv_over_mapenv_merge</span> <span class="id">s</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ANAppEnv</span> (<span class="id">ANMapEnv</span> (<span class="id">ANUnop</span> <span class="id">AColl</span> ((<span class="id">ENV</span>) · <span class="id">s</span>))) (<span class="id">ENV</span> ⊗ <span class="id">ID</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;≡ₑ <span class="id">ANMap</span> (<span class="id">ANUnop</span> <span class="id">AColl</span> ((<span class="id">ID</span>) · <span class="id">s</span>)) (<span class="id">ENV</span> ⊗ <span class="id">ID</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2045')">Proof.</div>
<div class="proofscript" id="proof2045">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">nra_eq</span>, <span class="id">nraenv_core_eq</span>; <span class="tactic">intros</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">x</span>; <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">appenv_over_env_merge_l</span> <span class="id">p1</span> <span class="id">p2</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">nraenv_core_ignores_env</span> <span class="id">p1</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ANAppEnv</span> (<span class="id">ENV</span> ⊗ <span class="id">p1</span>) <span class="id">p2</span> ≡ₑ <span class="id">p2</span> ⊗ <span class="id">p1</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2046')">Proof.</div>
<div class="proofscript" id="proof2046">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">nra_eq</span>, <span class="id">nraenv_core_eq</span>; <span class="tactic">intros</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">h</span> ⊢ₑ <span class="id">p2</span> @ₑ <span class="id">x</span> ⊣ <span class="id">c</span>;<span class="id">env</span>); <span class="tactic">try</span> <span class="tactic">reflexivity</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> (<span class="id">nraenv_core_ignores_env_swap</span> <span class="id">p1</span> <span class="id">H</span> <span class="id">h</span> <span class="id">c</span> <span class="id">d</span> <span class="id">env</span> <span class="id">x</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">h</span> ⊢ₑ <span class="id">p1</span> @ₑ <span class="id">x</span> ⊣ <span class="id">c</span>;<span class="id">env</span>); <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">appenv_over_mapenv_merge2</span> <span class="id">s</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ANAppEnv</span> (<span class="id">ANMapEnv</span> ((<span class="id">ENV</span>) · <span class="id">s</span>)) (<span class="id">ENV</span> ⊗ <span class="id">ID</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;≡ₑ <span class="id">ANMap</span> ((<span class="id">ID</span>) · <span class="id">s</span>) (<span class="id">ENV</span> ⊗ <span class="id">ID</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2047')">Proof.</div>
<div class="proofscript" id="proof2047">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">nra_eq</span>, <span class="id">nraenv_core_eq</span>; <span class="tactic">intros</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">x</span>; <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">env_appenv</span> <span class="id">p</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">ENV</span>) ◯ₑ <span class="id">p</span> ≡ₑ <span class="id">p</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2048')">Proof.</div>
<div class="proofscript" id="proof2048">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">nra_eq</span>, <span class="id">nraenv_core_eq</span>; <span class="tactic">intros</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">h</span> ⊢ₑ <span class="id">p</span> @ₑ <span class="id">x</span> ⊣ <span class="id">c</span>;<span class="id">env</span>); <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<br/>
&nbsp;&nbsp;<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">envmap_singleton_rec</span> <span class="id">s1</span> <span class="id">s2</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;χ⟨‵[| (<span class="id">s1</span>, <span class="id">ID</span>) |] ⟩( ‵{|(<span class="id">ID</span>) · <span class="id">s2</span> |}) ≡ₑ ‵{|‵[| (<span class="id">s1</span>, (<span class="id">ID</span>) · <span class="id">s2</span>) |] |}.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2049')">Proof.</div>
<div class="proofscript" id="proof2049">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">envmap_singleton</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">envmap_dot_singleton</span> <span class="id">a</span> <span class="id">p</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;χ⟨ <span class="id">ID</span>·<span class="id">a</span> ⟩( ‵{| <span class="id">p</span> |} ) ≡ₑ ‵{| <span class="id">p</span>·<span class="id">a</span> |}.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2050')">Proof.</div>
<div class="proofscript" id="proof2050">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">envmap_singleton</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">envunnest_singleton</span> <span class="id">s1</span> <span class="id">s2</span> <span class="id">s3</span> <span class="id">p1</span> <span class="id">p2</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">s1</span> &lt;&gt; <span class="id">s2</span> /\ <span class="id">s2</span> &lt;&gt; <span class="id">s3</span> /\ <span class="id">s3</span> &lt;&gt; <span class="id">s1</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;χ⟨ ¬π[<span class="id">s1</span>](<span class="id">ID</span>) ⟩(<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;⋈ᵈ⟨ χ⟨‵[| (<span class="id">s2</span>,<span class="id">ID</span>) |] ⟩((<span class="id">ID</span>)·<span class="id">s1</span>) ⟩( ‵{|‵[| (<span class="id">s3</span>,<span class="id">p1</span>) |] ⊕ ‵[| (<span class="id">s1</span>,‵{| <span class="id">p2</span> |}) |]|} )<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;≡ₑ ‵{|‵[| (<span class="id">s3</span>, <span class="id">p1</span>) |] ⊕ ‵[| (<span class="id">s2</span>, <span class="id">p2</span>) |]|}.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2051')">Proof.</div>
<div class="proofscript" id="proof2051">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">elim</span> <span class="id">H</span>; <span class="tactic">clear</span> <span class="id">H</span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">elim</span> <span class="id">H0</span>; <span class="tactic">clear</span> <span class="id">H0</span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">nraenv_core_eq</span>; <span class="tactic">intros</span> ? ? <span class="id">_</span> ? <span class="id">_</span> ? <span class="id">_</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">generalize</span> (<span class="id">h</span> ⊢ₑ <span class="id">p1</span> @ₑ <span class="id">x</span> ⊣ <span class="id">c</span>;<span class="id">env</span>); <span class="tactic">generalize</span>(<span class="id">h</span> ⊢ₑ <span class="id">p2</span> @ₑ <span class="id">x</span> ⊣ <span class="id">c</span>;<span class="id">env</span>); <span class="tactic">clear</span> <span class="id">p1</span> <span class="id">p2</span> <span class="id">x</span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">o</span>; <span class="tactic">try</span> <span class="tactic">reflexivity</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">unfold</span> <span class="id">olift</span>, <span class="id">olift2</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">o0</span>; <span class="tactic">try</span> <span class="tactic">reflexivity</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">StringOrder.lt_dec</span> <span class="id">s3</span> <span class="id">s1</span>); <span class="tactic">try</span> <span class="tactic">reflexivity</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">lift</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">rmap_concat</span>, <span class="id">oomap_concat</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">edot</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">string_eqdec</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">string_dec</span> <span class="id">s1</span> <span class="id">s1</span>); <span class="tactic">try</span> <span class="tactic">reflexivity</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">rremove</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">rec_concat_sort</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">string_eqdec</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">StringOrder.lt_dec</span> <span class="id">s1</span> <span class="id">s2</span>); <span class="tactic">try</span> <span class="tactic">reflexivity</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">StringOrder.lt_dec</span> <span class="id">s3</span> <span class="id">s1</span>); <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">string_dec</span> <span class="id">s1</span> <span class="id">s3</span>); <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">string_dec</span> <span class="id">s1</span> <span class="id">s1</span>); <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">StringOrder.lt_dec</span> <span class="id">s3</span> <span class="id">s2</span>); <span class="tactic">try</span> <span class="tactic">reflexivity</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">string_dec</span> <span class="id">s1</span> <span class="id">s2</span>); <span class="tactic">try</span> <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">StringOrder.lt_dec</span> <span class="id">s2</span> <span class="id">s3</span>); <span class="tactic">try</span> <span class="tactic">reflexivity</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">string_dec</span> <span class="id">s1</span> <span class="id">s2</span>); <span class="tactic">try</span> <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">StringOrder.lt</span> <span class="id">s3</span> <span class="id">s2</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">RelationClasses.transitivity</span> <span class="kwd">with</span> (<span class="id">y</span> := <span class="id">s1</span>); <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">contradiction</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">string_dec</span> <span class="id">s1</span> <span class="id">s2</span>); <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> <span class="id">False</span>; <span class="tactic">auto</span>; <span class="id">contradiction</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">StringOrder.lt</span> <span class="id">s3</span> <span class="id">s2</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">RelationClasses.transitivity</span> <span class="kwd">with</span> (<span class="id">y</span> := <span class="id">s1</span>); <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">contradiction</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">StringOrder.lt_dec</span> <span class="id">s3</span> <span class="id">s2</span>); <span class="tactic">try</span> <span class="tactic">reflexivity</span>; <span class="tactic">try</span> <span class="tactic">congruence</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">StringOrder.lt_dec</span> <span class="id">s2</span> <span class="id">s1</span>); <span class="tactic">try</span> <span class="tactic">reflexivity</span>; <span class="tactic">try</span> <span class="tactic">congruence</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">StringOrder.lt_dec</span> <span class="id">s3</span> <span class="id">s2</span>); <span class="tactic">try</span> <span class="tactic">reflexivity</span>; <span class="tactic">try</span> <span class="tactic">congruence</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">string_dec</span> <span class="id">s1</span> <span class="id">s3</span>); <span class="tactic">try</span> <span class="tactic">congruence</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">string_dec</span> <span class="id">s1</span> <span class="id">s2</span>); <span class="tactic">try</span> <span class="tactic">congruence</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">string_dec</span> <span class="id">s1</span> <span class="id">s1</span>); <span class="tactic">try</span> <span class="tactic">congruence</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">StringOrder.lt_dec</span> <span class="id">s3</span> <span class="id">s2</span>); <span class="tactic">try</span> <span class="tactic">reflexivity</span>; <span class="tactic">try</span> <span class="tactic">congruence</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">string_dec</span> <span class="id">s1</span> <span class="id">s3</span>); <span class="tactic">try</span> <span class="tactic">congruence</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">string_dec</span> <span class="id">s1</span> <span class="id">s2</span>); <span class="tactic">try</span> <span class="tactic">congruence</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">StringOrder.lt_dec</span> <span class="id">s2</span> <span class="id">s3</span>); <span class="tactic">try</span> <span class="tactic">reflexivity</span>; <span class="tactic">try</span> <span class="tactic">congruence</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">StringOrder.lt_dec</span> <span class="id">s2</span> <span class="id">s1</span>); <span class="tactic">try</span> <span class="tactic">reflexivity</span>; <span class="tactic">try</span> <span class="tactic">congruence</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">StringOrder.lt_dec</span> <span class="id">s3</span> <span class="id">s2</span>); <span class="tactic">try</span> <span class="tactic">reflexivity</span>; <span class="tactic">try</span> <span class="tactic">congruence</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">StringOrder.lt_dec</span> <span class="id">s2</span> <span class="id">s3</span>); <span class="tactic">try</span> <span class="tactic">reflexivity</span>; <span class="tactic">try</span> <span class="tactic">congruence</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">string_dec</span> <span class="id">s1</span> <span class="id">s2</span>); <span class="tactic">try</span> <span class="tactic">congruence</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">StringOrder.lt_dec</span> <span class="id">s3</span> <span class="id">s1</span>); <span class="tactic">try</span> <span class="tactic">reflexivity</span>; <span class="tactic">try</span> <span class="tactic">congruence</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">string_dec</span> <span class="id">s1</span> <span class="id">s3</span>); <span class="tactic">try</span> <span class="tactic">congruence</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">string_dec</span> <span class="id">s1</span> <span class="id">s1</span>); <span class="tactic">try</span> <span class="tactic">congruence</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">StringOrder.lt_dec</span> <span class="id">s2</span> <span class="id">s3</span>); <span class="tactic">try</span> <span class="tactic">reflexivity</span>; <span class="tactic">try</span> <span class="tactic">congruence</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">StringOrder.lt_dec</span> <span class="id">s3</span> <span class="id">s2</span>); <span class="tactic">try</span> <span class="tactic">reflexivity</span>; <span class="tactic">try</span> <span class="tactic">congruence</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">string_dec</span> <span class="id">s1</span> <span class="id">s2</span>); <span class="tactic">try</span> <span class="tactic">congruence</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">string_dec</span> <span class="id">s1</span> <span class="id">s3</span>); <span class="tactic">try</span> <span class="tactic">congruence</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">StringOrder.lt_dec</span> <span class="id">s2</span> <span class="id">s1</span>); <span class="tactic">try</span> <span class="tactic">reflexivity</span>; <span class="tactic">try</span> <span class="tactic">congruence</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">StringOrder.lt_dec</span> <span class="id">s1</span> <span class="id">s3</span>); <span class="tactic">try</span> <span class="tactic">reflexivity</span>; <span class="tactic">try</span> <span class="tactic">congruence</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">StringOrder.lt_dec</span> <span class="id">s3</span> <span class="id">s1</span>); <span class="tactic">try</span> <span class="tactic">reflexivity</span>; <span class="tactic">try</span> <span class="tactic">congruence</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">StringOrder.lt_dec</span> <span class="id">s2</span> <span class="id">s3</span>); <span class="tactic">try</span> <span class="tactic">reflexivity</span>; <span class="tactic">try</span> <span class="tactic">congruence</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">StringOrder.lt_dec</span> <span class="id">s3</span> <span class="id">s2</span>); <span class="tactic">try</span> <span class="tactic">reflexivity</span>; <span class="tactic">try</span> <span class="tactic">congruence</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">string_dec</span> <span class="id">s1</span> <span class="id">s2</span>); <span class="tactic">try</span> <span class="tactic">congruence</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">string_dec</span> <span class="id">s1</span> <span class="id">s1</span>); <span class="tactic">try</span> <span class="tactic">congruence</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">StringOrder.lt_dec</span> <span class="id">s3</span> <span class="id">s2</span>); <span class="tactic">try</span> <span class="tactic">reflexivity</span>; <span class="tactic">try</span> <span class="tactic">congruence</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">StringOrder.lt_dec</span> <span class="id">s2</span> <span class="id">s3</span>); <span class="tactic">try</span> <span class="tactic">reflexivity</span>; <span class="tactic">try</span> <span class="tactic">congruence</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">string_dec</span> <span class="id">s1</span> <span class="id">s2</span>); <span class="tactic">try</span> <span class="tactic">congruence</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">string_dec</span> <span class="id">s1</span> <span class="id">s1</span>); <span class="tactic">try</span> <span class="tactic">congruence</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">StringOrder.lt_dec</span> <span class="id">s3</span> <span class="id">s2</span>); <span class="tactic">try</span> <span class="tactic">reflexivity</span>; <span class="tactic">try</span> <span class="tactic">congruence</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">StringOrder.lt_dec</span> <span class="id">s2</span> <span class="id">s3</span>); <span class="tactic">try</span> <span class="tactic">reflexivity</span>; <span class="tactic">try</span> <span class="tactic">congruence</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">string_dec</span> <span class="id">s1</span> <span class="id">s2</span>); <span class="tactic">try</span> <span class="tactic">congruence</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">string_dec</span> <span class="id">s1</span> <span class="id">s3</span>); <span class="tactic">try</span> <span class="tactic">congruence</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">StringOrder.lt_dec</span> <span class="id">s3</span> <span class="id">s2</span>); <span class="tactic">try</span> <span class="tactic">reflexivity</span>; <span class="tactic">try</span> <span class="tactic">congruence</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">StringOrder.lt_dec</span> <span class="id">s1</span> <span class="id">s3</span>); <span class="tactic">try</span> <span class="tactic">reflexivity</span>; <span class="tactic">try</span> <span class="tactic">congruence</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">lift</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">rmap_concat</span>, <span class="id">oomap_concat</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">edot</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">string_eqdec</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">string_dec</span> <span class="id">s1</span> <span class="id">s3</span>); <span class="tactic">try</span> <span class="tactic">congruence</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">string_dec</span> <span class="id">s1</span> <span class="id">s1</span>); <span class="tactic">try</span> <span class="tactic">congruence</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">rremove</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">rec_concat_sort</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">string_eqdec</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">StringOrder.lt_dec</span> <span class="id">s3</span> <span class="id">s2</span>); <span class="tactic">try</span> <span class="tactic">reflexivity</span>; <span class="tactic">try</span> <span class="tactic">congruence</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">StringOrder.lt_dec</span> <span class="id">s1</span> <span class="id">s3</span>); <span class="tactic">try</span> <span class="tactic">reflexivity</span>; <span class="tactic">try</span> <span class="tactic">congruence</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">string_dec</span> <span class="id">s1</span> <span class="id">s1</span>); <span class="tactic">try</span> <span class="tactic">congruence</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">string_dec</span> <span class="id">s1</span> <span class="id">s3</span>); <span class="tactic">try</span> <span class="tactic">congruence</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">string_dec</span> <span class="id">s1</span> <span class="id">s2</span>); <span class="tactic">try</span> <span class="tactic">congruence</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">lift</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">rmap_concat</span>, <span class="id">oomap_concat</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">edot</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">string_eqdec</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">string_dec</span> <span class="id">s1</span> <span class="id">s1</span>); <span class="tactic">try</span> <span class="tactic">congruence</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">rremove</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">rec_concat_sort</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">string_eqdec</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">StringOrder.lt_dec</span> <span class="id">s1</span> <span class="id">s2</span>); <span class="tactic">try</span> <span class="tactic">reflexivity</span>; <span class="tactic">try</span> <span class="tactic">congruence</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">string_dec</span> <span class="id">s1</span> <span class="id">s1</span>); <span class="tactic">try</span> <span class="tactic">congruence</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">string_dec</span> <span class="id">s1</span> <span class="id">s2</span>); <span class="tactic">try</span> <span class="tactic">congruence</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">StringOrder.eq</span> <span class="id">s1</span> <span class="id">s3</span>) <span class="tactic">by</span> (<span class="tactic">apply</span> <span class="id">lt_contr1</span>; <span class="tactic">assumption</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">StringOrder.eq</span> <span class="id">s1</span> <span class="id">s3</span>) <span class="tactic">by</span> (<span class="tactic">apply</span> <span class="id">lt_contr1</span>; <span class="tactic">assumption</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">lift</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">rmap_concat</span>, <span class="id">oomap_concat</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">edot</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">string_eqdec</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">string_dec</span> <span class="id">s1</span> <span class="id">s1</span>); <span class="tactic">try</span> <span class="tactic">congruence</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">StringOrder.lt_dec</span> <span class="id">s2</span> <span class="id">s3</span>); <span class="tactic">try</span> <span class="tactic">reflexivity</span>; <span class="tactic">try</span> <span class="tactic">congruence</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">StringOrder.lt_dec</span> <span class="id">s1</span> <span class="id">s3</span>); <span class="tactic">try</span> <span class="tactic">reflexivity</span>; <span class="tactic">try</span> <span class="tactic">congruence</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">string_dec</span> <span class="id">s1</span> <span class="id">s1</span>); <span class="tactic">try</span> <span class="tactic">congruence</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">string_dec</span> <span class="id">s1</span> <span class="id">s3</span>); <span class="tactic">try</span> <span class="tactic">congruence</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">rremove</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">rec_concat_sort</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">string_eqdec</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">StringOrder.lt_dec</span> <span class="id">s3</span> <span class="id">s2</span>); <span class="tactic">try</span> <span class="tactic">reflexivity</span>; <span class="tactic">try</span> <span class="tactic">congruence</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">StringOrder.lt_dec</span> <span class="id">s2</span> <span class="id">s3</span>); <span class="tactic">try</span> <span class="tactic">reflexivity</span>; <span class="tactic">try</span> <span class="tactic">congruence</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">StringOrder.lt_dec</span> <span class="id">s2</span> <span class="id">s1</span>); <span class="tactic">try</span> <span class="tactic">reflexivity</span>; <span class="tactic">try</span> <span class="tactic">congruence</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">StringOrder.lt_dec</span> <span class="id">s1</span> <span class="id">s2</span>); <span class="tactic">try</span> <span class="tactic">reflexivity</span>; <span class="tactic">try</span> <span class="tactic">congruence</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">string_dec</span> <span class="id">s1</span> <span class="id">s1</span>); <span class="tactic">try</span> <span class="tactic">congruence</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">string_dec</span> <span class="id">s1</span> <span class="id">s2</span>); <span class="tactic">try</span> <span class="tactic">congruence</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">string_dec</span> <span class="id">s1</span> <span class="id">s3</span>); <span class="tactic">try</span> <span class="tactic">congruence</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">string_dec</span> <span class="id">s1</span> <span class="id">s2</span>); <span class="tactic">try</span> <span class="tactic">congruence</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">StringOrder.lt_dec</span> <span class="id">s1</span> <span class="id">s3</span>); <span class="tactic">try</span> <span class="tactic">reflexivity</span>; <span class="tactic">try</span> <span class="tactic">congruence</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">string_dec</span> <span class="id">s1</span> <span class="id">s1</span>); <span class="tactic">try</span> <span class="tactic">congruence</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">string_dec</span> <span class="id">s1</span> <span class="id">s3</span>); <span class="tactic">try</span> <span class="tactic">congruence</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">StringOrder.lt_dec</span> <span class="id">s1</span> <span class="id">s2</span>); <span class="tactic">try</span> <span class="tactic">reflexivity</span>; <span class="tactic">try</span> <span class="tactic">congruence</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">string_dec</span> <span class="id">s1</span> <span class="id">s1</span>); <span class="tactic">try</span> <span class="tactic">congruence</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">string_dec</span> <span class="id">s1</span> <span class="id">s2</span>); <span class="tactic">try</span> <span class="tactic">congruence</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">string_dec</span> <span class="id">s1</span> <span class="id">s3</span>); <span class="tactic">try</span> <span class="tactic">congruence</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">string_dec</span> <span class="id">s1</span> <span class="id">s2</span>); <span class="tactic">try</span> <span class="tactic">congruence</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">string_dec</span> <span class="id">s1</span> <span class="id">s3</span>); <span class="tactic">try</span> <span class="tactic">congruence</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">string_dec</span> <span class="id">s1</span> <span class="id">s1</span>); <span class="tactic">try</span> <span class="tactic">congruence</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">StringOrder.eq</span> <span class="id">s1</span> <span class="id">s3</span>) <span class="tactic">by</span> (<span class="tactic">apply</span> <span class="id">lt_contr1</span>; <span class="tactic">assumption</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">StringOrder.eq</span> <span class="id">s2</span> <span class="id">s3</span>) <span class="tactic">by</span> (<span class="tactic">apply</span> <span class="id">lt_contr1</span>; <span class="tactic">assumption</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">destruct</span> <span class="id">o0</span>; <span class="tactic">simpl</span>; <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">binop_over_rec_pair</span> <span class="id">b</span> <span class="id">p1</span> <span class="id">p2</span> <span class="id">a1</span> <span class="id">a2</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">a1</span> &lt;&gt; <span class="id">a2</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">ANBinop</span> <span class="id">b</span> ((<span class="id">ID</span>) · <span class="id">a1</span>) ((<span class="id">ID</span>) · <span class="id">a2</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;◯ (‵[| (<span class="id">a1</span>, <span class="id">p1</span>) |] ⊕ ‵[| (<span class="id">a2</span>, <span class="id">p2</span>) |])<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;≡ₑ (<span class="id">ANBinop</span> <span class="id">b</span> <span class="id">p1</span> <span class="id">p2</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2052')">Proof.</div>
<div class="proofscript" id="proof2052">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">nra_eq</span>, <span class="id">nraenv_core_eq</span>; <span class="tactic">intros</span> ? ? ? <span class="id">_</span> ? <span class="id">_</span> ? <span class="id">_</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">generalize</span> (<span class="id">h</span> ⊢ₑ <span class="id">p1</span> @ₑ <span class="id">x</span> ⊣ <span class="id">c</span>;<span class="id">env</span>); <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">generalize</span> (<span class="id">h</span> ⊢ₑ <span class="id">p2</span> @ₑ <span class="id">x</span> ⊣ <span class="id">c</span>;<span class="id">env</span>); <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">o</span>; <span class="tactic">destruct</span> <span class="id">o0</span>; <span class="tactic">try</span> <span class="tactic">reflexivity</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">StringOrder.lt_dec</span> <span class="id">a1</span> <span class="id">a2</span>); <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">unfold</span> <span class="id">edot</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">string_eqdec</span> <span class="id">a1</span> <span class="id">a2</span>); <span class="tactic">try</span> <span class="tactic">congruence</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">string_eqdec</span> <span class="id">a2</span> <span class="id">a2</span>); <span class="tactic">try</span> <span class="tactic">congruence</span>; <span class="tactic">simpl</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">string_eqdec</span> <span class="id">a1</span> <span class="id">a1</span>); <span class="tactic">try</span> <span class="tactic">congruence</span>; <span class="tactic">simpl</span>; <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">destruct</span> (<span class="id">StringOrder.lt_dec</span> <span class="id">a2</span> <span class="id">a1</span>); <span class="tactic">try</span> <span class="tactic">congruence</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">unfold</span> <span class="id">edot</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">string_eqdec</span> <span class="id">a1</span> <span class="id">a1</span>); <span class="tactic">try</span> <span class="tactic">congruence</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">string_eqdec</span> <span class="id">a2</span> <span class="id">a1</span>); <span class="tactic">try</span> <span class="tactic">congruence</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">string_eqdec</span> <span class="id">a2</span> <span class="id">a2</span>); <span class="tactic">simpl</span>; <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">unfold</span> <span class="id">edot</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">string_eqdec</span> <span class="id">a1</span> <span class="id">a2</span>); <span class="tactic">try</span> <span class="tactic">congruence</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> <span class="id">False</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">generalize</span> (<span class="id">StringOrder.compare_spec</span> <span class="id">a1</span> <span class="id">a2</span>); <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">elim</span> <span class="id">H0</span>; <span class="tactic">intros</span>; <span class="id">contradiction</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">contradiction</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">concat_id_left</span> <span class="id">p1</span> <span class="id">p2</span> <span class="id">s1</span> <span class="id">s2</span> <span class="id">d</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(‵[| (<span class="id">s1</span>, <span class="id">p1</span>) |] ⊕ ‵[| (<span class="id">s2</span>, <span class="id">ANConst</span> <span class="id">d</span>) |])<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;◯ <span class="id">p2</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;≡ₑ (‵[| (<span class="id">s1</span>, <span class="id">p1</span> ◯ <span class="id">p2</span>) |] ⊕ ‵[| (<span class="id">s2</span>, <span class="id">ANConst</span> <span class="id">d</span>) |]).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2053')">Proof.</div>
<div class="proofscript" id="proof2053">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">nra_eq</span>, <span class="id">nraenv_core_eq</span>; <span class="tactic">intros</span> ? ? <span class="id">_</span> ? <span class="id">_</span> ? <span class="id">_</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">generalize</span> (<span class="id">h</span> ⊢ₑ <span class="id">p2</span> @ₑ <span class="id">x</span> ⊣ <span class="id">c</span>;<span class="id">env</span>); <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">o</span>; <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">tostring_dstring</span> <span class="id">s</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">ANUnop</span> <span class="id">AToString</span> (<span class="id">ANConst</span> (<span class="id">dstring</span> <span class="id">s</span>))) ≡ₑ (<span class="id">ANConst</span> (<span class="id">dstring</span> <span class="id">s</span>)).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2054')">Proof.</div>
<div class="proofscript" id="proof2054">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">nraenv_core_eq</span>; <span class="tactic">intros</span> ? ? <span class="id">_</span> ? <span class="id">_</span> ? <span class="id">_</span>; <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">tostring_tostring</span> <span class="id">p</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">ANUnop</span> <span class="id">AToString</span> (<span class="id">ANUnop</span> <span class="id">AToString</span> <span class="id">p</span>)) ≡ₑ (<span class="id">ANUnop</span> <span class="id">AToString</span> <span class="id">p</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2055')">Proof.</div>
<div class="proofscript" id="proof2055">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">nraenv_core_eq</span>; <span class="tactic">intros</span> ? ? <span class="id">_</span> ? <span class="id">_</span> ? <span class="id">_</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">h</span> ⊢ₑ <span class="id">p</span> @ₑ <span class="id">x</span> ⊣ <span class="id">c</span>;<span class="id">env</span>); <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">app_over_env_dot</span> <span class="id">s</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">ENV</span> ◯ (<span class="id">ENV</span>) · <span class="id">s</span>) · <span class="id">s</span> ≡ₑ (<span class="id">ENV</span>) · <span class="id">s</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2056')">Proof.</div>
<div class="proofscript" id="proof2056">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">nraenv_core_eq</span>; <span class="tactic">intros</span> ? ? <span class="id">_</span> ? <span class="id">_</span> ? <span class="id">_</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">env</span>; <span class="tactic">try</span> <span class="tactic">reflexivity</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">case_eq</span> (<span class="id">RRelation.edot</span> <span class="id">l</span> <span class="id">s</span>); <span class="tactic">intros</span>; <span class="tactic">try</span> <span class="tactic">reflexivity</span>; <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">app_over_appenv</span> <span class="id">p1</span> <span class="id">p2</span> <span class="id">p3</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">nraenv_core_ignores_id</span> <span class="id">p3</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;((<span class="id">p3</span> ◯ₑ <span class="id">p2</span>) ◯ <span class="id">p1</span>) ≡ₑ <span class="id">p3</span> ◯ₑ (<span class="id">p2</span> ◯ <span class="id">p1</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2057')">Proof.</div>
<div class="proofscript" id="proof2057">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">nraenv_core_eq</span>; <span class="tactic">intros</span> ? ? ? <span class="id">_</span> ? <span class="id">_</span> ? <span class="id">_</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">generalize</span> (<span class="id">h</span> ⊢ₑ <span class="id">p1</span> @ₑ <span class="id">x</span> ⊣ <span class="id">c</span>;<span class="id">env</span>); <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">o</span>; <span class="tactic">try</span> <span class="tactic">reflexivity</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">generalize</span> (<span class="id">h</span> ⊢ₑ <span class="id">p2</span> @ₑ <span class="id">d</span> ⊣ <span class="id">c</span>;<span class="id">env</span>); <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">o</span>; <span class="tactic">try</span> <span class="tactic">reflexivity</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">nraenv_core_ignores_id_swap</span>; <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">appenv_over_app_ie</span> <span class="id">p1</span> <span class="id">p2</span> <span class="id">p3</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">nraenv_core_ignores_env</span> <span class="id">p3</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;((<span class="id">p3</span> ◯ <span class="id">p2</span>) ◯ₑ <span class="id">p1</span>) ≡ₑ <span class="id">p3</span> ◯ (<span class="id">p2</span> ◯ₑ <span class="id">p1</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2058')">Proof.</div>
<div class="proofscript" id="proof2058">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">nraenv_core_eq</span>; <span class="tactic">intros</span> ? ? ? <span class="id">_</span> ? <span class="id">_</span> ? <span class="id">_</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">generalize</span> (<span class="id">h</span> ⊢ₑ <span class="id">p1</span> @ₑ <span class="id">x</span> ⊣ <span class="id">c</span>;<span class="id">env</span>); <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">o</span>; <span class="tactic">try</span> <span class="tactic">reflexivity</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">h</span> ⊢ₑ <span class="id">p2</span> @ₑ <span class="id">x</span> ⊣ <span class="id">c</span>;<span class="id">d</span>); <span class="tactic">simpl</span>; <span class="tactic">trivial</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">nraenv_core_ignores_env_swap</span>; <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">app_over_appenv_over_mapenv</span> <span class="id">p1</span> <span class="id">p2</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(((<span class="id">ANMapEnv</span> (‵{|<span class="id">ENV</span>|})) ◯ₑ <span class="id">p1</span>) ◯ <span class="id">p2</span>) ≡ₑ<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(((<span class="id">ANMapEnv</span> (‵{|<span class="id">ENV</span>|})) ◯ₑ (<span class="id">p1</span> ◯ <span class="id">p2</span>) )).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2059')">Proof.</div>
<div class="proofscript" id="proof2059">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">nraenv_core_eq</span>; <span class="tactic">intros</span> ? ? <span class="id">_</span> ? <span class="id">_</span> ? <span class="id">_</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">generalize</span> (<span class="id">h</span> ⊢ₑ <span class="id">p2</span> @ₑ <span class="id">x</span> ⊣ <span class="id">c</span>;<span class="id">env</span>); <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">o</span>; <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">map_full_over_select_id</span> <span class="id">p0</span> <span class="id">p1</span> <span class="id">p2</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;χ⟨ <span class="id">p0</span> ⟩(σ⟨ <span class="id">p1</span> ⟩(‵{| <span class="id">p2</span> |})) ≡ₑ χ⟨ <span class="id">p0</span> ◯ <span class="id">p2</span> ⟩(σ⟨ <span class="id">p1</span> ◯ <span class="id">p2</span> ⟩(‵{| <span class="id">ID</span> |})).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2060')">Proof.</div>
<div class="proofscript" id="proof2060">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">nraenv_core_eq</span>; <span class="tactic">intros</span> ? ? <span class="id">_</span> ? <span class="id">_</span> ? <span class="id">_</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">case_eq</span> (<span class="id">h</span> ⊢ₑ <span class="id">p2</span> @ₑ <span class="id">x</span> ⊣ <span class="id">c</span>;<span class="id">env</span>); <span class="tactic">intros</span>; <span class="tactic">try</span> <span class="tactic">reflexivity</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">h</span> ⊢ₑ <span class="id">p1</span> @ₑ <span class="id">d</span> ⊣ <span class="id">c</span>;<span class="id">env</span>); <span class="tactic">try</span> <span class="tactic">reflexivity</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">d0</span>; <span class="tactic">try</span> <span class="tactic">reflexivity</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">case_eq</span> <span class="id">b</span>; <span class="tactic">intros</span>; <span class="tactic">try</span> <span class="tactic">reflexivity</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H</span>; <span class="tactic">simpl</span>. <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">compose_selects_in_mapenv</span> <span class="id">p1</span> <span class="id">p2</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(♯<span class="id">flatten</span>(<span class="id">ANMapEnv</span> (χ⟨<span class="id">ENV</span>⟩(σ⟨<span class="id">p1</span>⟩( ‵{| <span class="id">ID</span> |}))))) ◯ₑ (χ⟨<span class="id">ENV</span>⟩(σ⟨<span class="id">p2</span>⟩( ‵{| <span class="id">ID</span> |})))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;≡ₑ (χ⟨<span class="id">ENV</span>⟩(σ⟨<span class="id">p1</span>⟩(σ⟨<span class="id">p2</span>⟩( ‵{| <span class="id">ID</span> |})))).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2061')">Proof.</div>
<div class="proofscript" id="proof2061">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">nraenv_core_eq</span>; <span class="tactic">intros</span> ? ? <span class="id">_</span> ? <span class="id">_</span> ? <span class="id">_</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">autorewrite</span> <span class="kwd">with</span> <span class="id">alg</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">h</span> ⊢ₑ <span class="id">p2</span> @ₑ <span class="id">x</span> ⊣ <span class="id">c</span>;<span class="id">env</span>); <span class="tactic">try</span> <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">d</span>; <span class="tactic">try</span> <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">b</span>; <span class="tactic">try</span> <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">autorewrite</span> <span class="kwd">with</span> <span class="id">alg</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">h</span> ⊢ₑ <span class="id">p1</span> @ₑ <span class="id">x</span> ⊣ <span class="id">c</span>;<span class="id">env</span>); <span class="tactic">try</span> <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">d</span>; <span class="tactic">try</span> <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">b</span>; <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">flatten_through_appenv</span> <span class="id">p1</span> <span class="id">p2</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;♯<span class="id">flatten</span>(<span class="id">p1</span> ◯ₑ <span class="id">p2</span>) ≡ₑ ♯<span class="id">flatten</span>(<span class="id">p1</span>) ◯ₑ <span class="id">p2</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2062')">Proof.</div>
<div class="proofscript" id="proof2062">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">nraenv_core_eq</span>; <span class="tactic">intros</span> ? ? <span class="id">_</span> ? <span class="id">_</span> ? <span class="id">_</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">h</span> ⊢ₑ <span class="id">p2</span> @ₑ <span class="id">x</span> ⊣ <span class="id">c</span>;<span class="id">env</span>); <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">appenv_through_either</span> <span class="id">q</span>₁ <span class="id">q</span>₂ <span class="id">q</span>₃:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">nraenv_core_ignores_id</span> <span class="id">q</span>₃ -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ANEither</span> <span class="id">q</span>₁ <span class="id">q</span>₂ ◯ₑ <span class="id">q</span>₃ ≡ₑ <span class="id">ANEither</span> (<span class="id">q</span>₁ ◯ₑ <span class="id">q</span>₃) (<span class="id">q</span>₂ ◯ₑ <span class="id">q</span>₃).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2063')">Proof.</div>
<div class="proofscript" id="proof2063">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">nraenv_core_eq</span>; <span class="tactic">intros</span> ? ? <span class="id">_</span> ? <span class="id">_</span> ? <span class="id">_</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">olift</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">generalize</span> (<span class="id">nraenv_core_ignores_id_swap</span> <span class="id">q</span>₃ <span class="id">H</span> <span class="id">h</span> <span class="id">c</span> <span class="id">env</span> <span class="id">x</span>); <span class="tactic">intros</span> <span class="id">eqq</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">h</span> ⊢ₑ <span class="id">q</span>₃ @ₑ <span class="id">x</span> ⊣ <span class="id">c</span>;<span class="id">env</span>); <span class="tactic">simpl</span> <span class="kwd">in</span> * ;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">x</span>; <span class="tactic">simpl</span>; <span class="tactic">trivial</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id">eqq</span> <span class="id">x</span>); <span class="tactic">rewrite</span> &lt;- <span class="id">eqq</span>; <span class="tactic">trivial</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
<br/>
&nbsp;&nbsp;<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">flatten_mapenv_coll</span> <span class="id">p1</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;♯<span class="id">flatten</span>(<span class="id">ANMapEnv</span> (‵{| <span class="id">p1</span> |})) ≡ₑ <span class="id">ANMapEnv</span> <span class="id">p1</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2064')">Proof.</div>
<div class="proofscript" id="proof2064">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">nraenv_core_eq</span>; <span class="tactic">intros</span> ? ? <span class="id">_</span> ? <span class="id">_</span> ? <span class="id">_</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">env</span>; <span class="tactic">try</span> <span class="tactic">reflexivity</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">autorewrite</span> <span class="kwd">with</span> <span class="id">alg</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">l</span>; <span class="tactic">try</span> <span class="tactic">reflexivity</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">h</span> ⊢ₑ <span class="id">p1</span> @ₑ <span class="id">x</span> ⊣ <span class="id">c</span>;<span class="id">a</span>); <span class="tactic">try</span> <span class="tactic">reflexivity</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="tactic">f_equal</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">revert</span> <span class="id">IHl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> ((<span class="id">rmap</span> (<span class="kwd">fun</span> <span class="id">env</span>' : <span class="id">data</span> =&gt; <span class="id">h</span> ⊢ₑ <span class="id">p1</span> @ₑ <span class="id">x</span> ⊣ <span class="id">c</span>;<span class="id">env</span>') <span class="id">l</span>));<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> ((<span class="id">rmap</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">fun</span> <span class="id">env</span>' : <span class="id">data</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">olift</span> (<span class="kwd">fun</span> <span class="id">d1</span> : <span class="id">data</span> =&gt; <span class="id">Some</span> (<span class="id">dcoll</span> (<span class="id">d1</span> :: <span class="id">nil</span>)))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">h</span> ⊢ₑ <span class="id">p1</span> @ₑ <span class="id">x</span> ⊣ <span class="id">c</span>;<span class="id">env</span>')) <span class="id">l</span>)); <span class="tactic">intros</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> *; <span class="tactic">try</span> <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> (<span class="id">rflatten_cons</span> (<span class="id">d</span>::<span class="id">nil</span>) <span class="id">l1</span> <span class="id">l0</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">rflatten</span> <span class="id">l1</span>); <span class="tactic">simpl</span> <span class="kwd">in</span> *; <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">lift</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">case_eq</span> (<span class="id">rflatten</span> <span class="id">l0</span>); <span class="tactic">intros</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> *; <span class="tactic">try</span> (<span class="tactic">rewrite</span> <span class="id">H</span> <span class="kwd">in</span> *; <span class="tactic">congruence</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">rflatten</span> <span class="kwd">in</span> *; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">flip_env1</span> <span class="id">p</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;χ⟨<span class="id">ENV</span>⟩(σ⟨ <span class="id">p</span> ⟩(‵{|<span class="id">ID</span>|})) ◯ₑ <span class="id">ID</span> ≡ₑ (σ⟨ <span class="id">p</span> ⟩(‵{|<span class="id">ID</span>|})) ◯ₑ <span class="id">ID</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2065')">Proof.</div>
<div class="proofscript" id="proof2065">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">nraenv_core_eq</span>; <span class="tactic">intros</span> ? ? <span class="id">_</span> ? <span class="id">_</span> ? <span class="id">_</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">h</span> ⊢ₑ <span class="id">p</span> @ₑ <span class="id">x</span> ⊣ <span class="id">c</span>;<span class="id">x</span>); <span class="tactic">try</span> <span class="tactic">reflexivity</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">d</span>; <span class="tactic">try</span> <span class="tactic">reflexivity</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">b</span>; <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">flip_env2</span> <span class="id">p</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(σ⟨ <span class="id">p</span> ⟩(‵{|<span class="id">ID</span>|}) ◯ₑ <span class="id">ID</span>) ≡ₑ σ⟨ <span class="id">p</span> ◯ₑ <span class="id">ID</span> ⟩(‵{|<span class="id">ID</span>|}).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2066')">Proof.</div>
<div class="proofscript" id="proof2066">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">nraenv_core_eq</span>; <span class="tactic">intros</span> ? ? <span class="id">_</span> ? <span class="id">_</span> ? <span class="id">_</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">h</span> ⊢ₑ <span class="id">p</span> @ₑ <span class="id">x</span> ⊣ <span class="id">c</span>;<span class="id">x</span>); <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">flip_env3</span> <span class="id">b</span> <span class="id">p1</span> <span class="id">p2</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">ANBinop</span> <span class="id">b</span> <span class="id">p1</span> <span class="id">p2</span>) ◯ₑ <span class="id">ID</span> ≡ₑ (<span class="id">ANBinop</span> <span class="id">b</span> (<span class="id">p1</span> ◯ₑ <span class="id">ID</span>) (<span class="id">p2</span> ◯ₑ <span class="id">ID</span>)).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2067')">Proof.</div>
<div class="proofscript" id="proof2067">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">nraenv_core_eq</span>; <span class="tactic">intros</span> ? ? <span class="id">_</span> ? <span class="id">_</span> ? <span class="id">_</span>; <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">flip_env4</span> <span class="id">p1</span> <span class="id">p2</span> <span class="id">s</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">ANUnop</span> (<span class="id">ADot</span> <span class="id">s</span>) <span class="id">p1</span>) ◯ₑ <span class="id">p2</span> ≡ₑ (<span class="id">ANUnop</span> (<span class="id">ADot</span> <span class="id">s</span>) (<span class="id">p1</span> ◯ₑ <span class="id">p2</span>)).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2068')">Proof.</div>
<div class="proofscript" id="proof2068">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">nraenv_core_eq</span>; <span class="tactic">intros</span> ? ? <span class="id">_</span> ? <span class="id">_</span> ? <span class="id">_</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">h</span> ⊢ₑ <span class="id">p2</span> @ₑ <span class="id">x</span> ⊣ <span class="id">c</span>;<span class="id">env</span>); <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">flip_env5</span> <span class="id">p1</span> <span class="id">p2</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;♯<span class="id">flatten</span>(χ⟨σ⟨<span class="id">p1</span>⟩(‵{|<span class="id">ID</span>|})⟩(<span class="id">p2</span>)) ≡ₑ σ⟨<span class="id">p1</span>⟩(<span class="id">p2</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2069')">Proof.</div>
<div class="proofscript" id="proof2069">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">nraenv_core_eq</span>; <span class="tactic">intros</span> ? ? <span class="id">_</span> ? <span class="id">_</span> ? <span class="id">_</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">h</span> ⊢ₑ <span class="id">p2</span> @ₑ <span class="id">x</span> ⊣ <span class="id">c</span>;<span class="id">env</span>); <span class="tactic">try</span> <span class="tactic">reflexivity</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">d</span>; <span class="tactic">try</span> <span class="tactic">reflexivity</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">autorewrite</span> <span class="kwd">with</span> <span class="id">alg</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">l</span>; <span class="tactic">try</span> <span class="tactic">reflexivity</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">h</span> ⊢ₑ <span class="id">p1</span> @ₑ <span class="id">a</span> ⊣ <span class="id">c</span>;<span class="id">env</span>); <span class="tactic">try</span> <span class="tactic">reflexivity</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">f_equal</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">d</span>; <span class="tactic">try</span> <span class="tactic">reflexivity</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">b</span>; <span class="tactic">try</span> <span class="tactic">reflexivity</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">destruct</span> ((<span class="id">rmap</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">fun</span> <span class="id">x0</span> : <span class="id">data</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">lift</span> <span class="id">dcoll</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">h</span> ⊢ₑ <span class="id">p1</span> @ₑ <span class="id">x0</span> ⊣ <span class="id">c</span>;<span class="id">env</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">Some</span> (<span class="id">dbool</span> <span class="id">b</span>) =&gt; <span class="id">Some</span> <span class="id">b</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">_</span> =&gt; <span class="id">None</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">Some</span> <span class="id">true</span> =&gt; <span class="id">Some</span> (<span class="id">x0</span> :: <span class="id">nil</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">Some</span> <span class="id">false</span> =&gt; <span class="id">Some</span> <span class="id">nil</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">None</span> =&gt; <span class="id">None</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>) <span class="id">l</span>)); <span class="tactic">destruct</span> (<span class="id">lift_filter</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">fun</span> <span class="id">x</span>' : <span class="id">data</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">h</span> ⊢ₑ <span class="id">p1</span> @ₑ <span class="id">x</span>' ⊣ <span class="id">c</span>;<span class="id">env</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">Some</span> (<span class="id">dbool</span> <span class="id">b</span>) =&gt; <span class="id">Some</span> <span class="id">b</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">_</span> =&gt; <span class="id">None</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>) <span class="id">l</span>); <span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">rflatten_cons</span> <span class="kwd">with</span> (<span class="id">r</span>' := <span class="id">l1</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">lift</span> <span class="kwd">in</span> <span class="id">IHl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">rflatten</span> <span class="id">l0</span>); <span class="tactic">try</span> <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">lift</span> <span class="kwd">in</span> <span class="id">IHl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">rflatten</span> <span class="kwd">in</span> *; <span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">oflat_map</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">fun</span> <span class="id">x0</span> : <span class="id">data</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">x0</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">dcoll</span> <span class="id">y</span> =&gt; <span class="id">Some</span> <span class="id">y</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">_</span> =&gt; <span class="id">None</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>) <span class="id">l0</span>); <span class="tactic">try</span> <span class="tactic">congruence</span>; <span class="tactic">try</span> <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">destruct</span> ((<span class="id">rmap</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">fun</span> <span class="id">x0</span> : <span class="id">data</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">lift</span> <span class="id">dcoll</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">h</span> ⊢ₑ <span class="id">p1</span> @ₑ <span class="id">x0</span> ⊣ <span class="id">c</span>;<span class="id">env</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">Some</span> (<span class="id">dbool</span> <span class="id">b</span>) =&gt; <span class="id">Some</span> <span class="id">b</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">_</span> =&gt; <span class="id">None</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">Some</span> <span class="id">true</span> =&gt; <span class="id">Some</span> (<span class="id">x0</span> :: <span class="id">nil</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">Some</span> <span class="id">false</span> =&gt; <span class="id">Some</span> <span class="id">nil</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">None</span> =&gt; <span class="id">None</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>) <span class="id">l</span>)); <span class="tactic">destruct</span> (<span class="id">lift_filter</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">fun</span> <span class="id">x</span>' : <span class="id">data</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">h</span> ⊢ₑ <span class="id">p1</span> @ₑ <span class="id">x</span>' ⊣ <span class="id">c</span>;<span class="id">env</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">Some</span> (<span class="id">dbool</span> <span class="id">b</span>) =&gt; <span class="id">Some</span> <span class="id">b</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">_</span> =&gt; <span class="id">None</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>) <span class="id">l</span>); <span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">rflatten_cons</span> <span class="kwd">with</span> (<span class="id">r</span>' := <span class="id">l1</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">lift</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">rflatten</span> <span class="id">l0</span>); <span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">IHl</span>; <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">rflatten</span> <span class="kwd">in</span> *; <span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> ((<span class="id">oflat_map</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">fun</span> <span class="id">x0</span> : <span class="id">data</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">x0</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">dcoll</span> <span class="id">y</span> =&gt; <span class="id">Some</span> <span class="id">y</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">_</span> =&gt; <span class="id">None</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>) <span class="id">l0</span>)); <span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">flip_env7</span> <span class="id">p1</span> <span class="id">p2</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">nraenv_core_ignores_id</span> <span class="id">p1</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">ANMapEnv</span> (‵{| <span class="id">p1</span> |})) ◯ₑ <span class="id">p2</span> ≡ₑ χ⟨‵{| <span class="id">p1</span> ◯ₑ <span class="id">ID</span> |}⟩(<span class="id">p2</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2070')">Proof.</div>
<div class="proofscript" id="proof2070">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">nraenv_core_eq</span>; <span class="tactic">intros</span> ? ? ? <span class="id">_</span> ? <span class="id">_</span> ? <span class="id">_</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">h</span> ⊢ₑ <span class="id">p2</span> @ₑ <span class="id">x</span> ⊣ <span class="id">c</span>;<span class="id">env</span>); <span class="tactic">try</span> <span class="tactic">reflexivity</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">d</span>; <span class="tactic">try</span> <span class="tactic">reflexivity</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">l</span>; <span class="tactic">try</span> <span class="tactic">reflexivity</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> (<span class="id">nraenv_core_ignores_id_swap</span> <span class="id">p1</span> <span class="id">H</span> <span class="id">h</span> <span class="id">c</span> <span class="id">a</span> <span class="id">x</span> <span class="id">a</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">h</span> ⊢ₑ <span class="id">p1</span> @ₑ <span class="id">a</span> ⊣ <span class="id">c</span>;<span class="id">a</span>); <span class="tactic">try</span> <span class="tactic">reflexivity</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> ((<span class="id">rmap</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">fun</span> <span class="id">env</span>' : <span class="id">data</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">olift</span> (<span class="kwd">fun</span> <span class="id">d1</span> : <span class="id">data</span> =&gt; <span class="id">Some</span> (<span class="id">dcoll</span> (<span class="id">d1</span> :: <span class="id">nil</span>)))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">h</span> ⊢ₑ <span class="id">p1</span> @ₑ <span class="id">x</span> ⊣ <span class="id">c</span>;<span class="id">env</span>')) <span class="id">l</span>));<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> ((<span class="id">rmap</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">fun</span> <span class="id">x0</span> : <span class="id">data</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">olift</span> (<span class="kwd">fun</span> <span class="id">d1</span> : <span class="id">data</span> =&gt; <span class="id">Some</span> (<span class="id">dcoll</span> (<span class="id">d1</span> :: <span class="id">nil</span>))) (<span class="id">h</span> ⊢ₑ <span class="id">p1</span> @ₑ <span class="id">x0</span> ⊣ <span class="id">c</span>;<span class="id">x0</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">l</span>)); <span class="tactic">simpl</span> <span class="kwd">in</span> *; <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">merge_concat_to_concat</span> <span class="id">s1</span> <span class="id">s2</span> <span class="id">p1</span> <span class="id">p2</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">s1</span> &lt;&gt; <span class="id">s2</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;‵[| (<span class="id">s1</span>, <span class="id">p1</span>)|] ⊗ ‵[| (<span class="id">s2</span>, <span class="id">p2</span>)|] ≡ₑ ‵{|‵[| (<span class="id">s1</span>, <span class="id">p1</span>)|] ⊕ ‵[| (<span class="id">s2</span>, <span class="id">p2</span>)|]|}.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2071')">Proof.</div>
<div class="proofscript" id="proof2071">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">nraenv_core_eq</span>; <span class="tactic">intros</span> ? ? <span class="id">_</span> ? <span class="id">_</span> ? <span class="id">_</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">h</span> ⊢ₑ <span class="id">p1</span> @ₑ <span class="id">x</span> ⊣ <span class="id">c</span>;<span class="id">env</span>); <span class="tactic">try</span> <span class="tactic">reflexivity</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">h</span> ⊢ₑ <span class="id">p2</span> @ₑ <span class="id">x</span> ⊣ <span class="id">c</span>;<span class="id">env</span>); <span class="tactic">try</span> <span class="tactic">reflexivity</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">merge_bindings</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">compatible_with</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">EquivDec.equiv_dec</span> <span class="id">s1</span> <span class="id">s2</span>); <span class="tactic">try</span> <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">dot_over_rec</span> <span class="id">s</span> <span class="id">p</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(‵[| (<span class="id">s</span>, <span class="id">p</span>)|]) · <span class="id">s</span> ≡ₑ <span class="id">p</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2072')">Proof.</div>
<div class="proofscript" id="proof2072">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">nraenv_core_eq</span>; <span class="tactic">intros</span> ? ? <span class="id">_</span> ? <span class="id">_</span> ? <span class="id">_</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">h</span> ⊢ₑ <span class="id">p</span> @ₑ <span class="id">x</span> ⊣ <span class="id">c</span>;<span class="id">env</span>); <span class="tactic">try</span> <span class="tactic">reflexivity</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">edot</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">string_eqdec</span> <span class="id">s</span> <span class="id">s</span>); <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">either_app_over_dleft</span> <span class="id">p</span>₁ <span class="id">p</span>₂ <span class="id">d</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">ANEither</span> <span class="id">p</span>₁ <span class="id">p</span>₂) ◯ (<span class="id">ANConst</span> (<span class="id">dleft</span> <span class="id">d</span>)) ≡ₑ <span class="id">p</span>₁ ◯ (<span class="id">ANConst</span> <span class="id">d</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2073')">Proof.</div>
<div class="proofscript" id="proof2073">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">red</span>; <span class="tactic">simpl</span>; <span class="tactic">intros</span>; <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">either_app_over_dright</span> <span class="id">p</span>₁ <span class="id">p</span>₂ <span class="id">d</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">ANEither</span> <span class="id">p</span>₁ <span class="id">p</span>₂) ◯ (<span class="id">ANConst</span> (<span class="id">dright</span> <span class="id">d</span>)) ≡ₑ <span class="id">p</span>₂ ◯ (<span class="id">ANConst</span> <span class="id">d</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2074')">Proof.</div>
<div class="proofscript" id="proof2074">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">red</span>; <span class="tactic">simpl</span>; <span class="tactic">intros</span>; <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">either_app_over_aleft</span> <span class="id">p</span>₁ <span class="id">p</span>₂ <span class="id">p</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">ANEither</span> <span class="id">p</span>₁ <span class="id">p</span>₂) ◯ (<span class="id">ANUnop</span> <span class="id">ALeft</span> <span class="id">p</span>) ≡ₑ <span class="id">p</span>₁ ◯ <span class="id">p</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2075')">Proof.</div>
<div class="proofscript" id="proof2075">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">red</span>; <span class="tactic">simpl</span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">olift</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">h</span> ⊢ₑ <span class="id">p</span> @ₑ <span class="id">x</span> ⊣ <span class="id">c</span>;<span class="id">env</span>); <span class="tactic">trivial</span>.<br/>
&nbsp;&nbsp;Qed.</div>
&nbsp;&nbsp;<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">either_app_over_aright</span> <span class="id">p</span>₁ <span class="id">p</span>₂ <span class="id">p</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">ANEither</span> <span class="id">p</span>₁ <span class="id">p</span>₂) ◯ (<span class="id">ANUnop</span> <span class="id">ARight</span> <span class="id">p</span>) ≡ₑ <span class="id">p</span>₂ ◯ <span class="id">p</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2076')">Proof.</div>
<div class="proofscript" id="proof2076">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">red</span>; <span class="tactic">simpl</span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">olift</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">h</span> ⊢ₑ <span class="id">p</span> @ₑ <span class="id">x</span> ⊣ <span class="id">c</span>;<span class="id">env</span>); <span class="tactic">trivial</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
<div class="doc">optimizations for record projection </div>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">rproject_over_concat</span> <span class="id">sl</span> <span class="id">p1</span> <span class="id">p2</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;π[<span class="id">sl</span>](<span class="id">p1</span> ⊕ <span class="id">p2</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;≡ₑ π[<span class="id">sl</span>](<span class="id">p1</span>) ⊕ π[<span class="id">sl</span>](<span class="id">p2</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2077')">Proof.</div>
<div class="proofscript" id="proof2077">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">red</span>; <span class="tactic">simpl</span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">h</span> ⊢ₑ <span class="id">p1</span> @ₑ <span class="id">x</span> ⊣ <span class="id">c</span>;<span class="id">env</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">h</span> ⊢ₑ <span class="id">p2</span> @ₑ <span class="id">x</span> ⊣ <span class="id">c</span>;<span class="id">env</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">destruct</span> <span class="id">d</span>; <span class="tactic">destruct</span> <span class="id">d0</span>; <span class="tactic">simpl</span>; <span class="tactic">trivial</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">rproject_rec_sort_commute</span>, <span class="id">rproject_app</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">trivial</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">destruct</span> <span class="id">x</span>; <span class="tactic">destruct</span> <span class="id">d</span>; <span class="tactic">simpl</span>; <span class="tactic">trivial</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">destruct</span> <span class="id">x</span>; <span class="tactic">destruct</span> <span class="id">d</span>; <span class="tactic">simpl</span>; <span class="tactic">trivial</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">destruct</span> <span class="id">x</span>; <span class="tactic">simpl</span>; <span class="tactic">trivial</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">rproject_over_const</span> <span class="id">sl</span> <span class="id">l</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;π[<span class="id">sl</span>](<span class="id">ANConst</span> (<span class="id">drec</span> <span class="id">l</span>)) ≡ₑ <span class="id">ANConst</span> (<span class="id">drec</span> (<span class="id">RRelation.rproject</span> <span class="id">l</span> <span class="id">sl</span>)).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2078')">Proof.</div>
<div class="proofscript" id="proof2078">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">red</span>; <span class="tactic">simpl</span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">rproject_rec_sort_commute</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">rproject_map_fst_same</span>; <span class="tactic">intuition</span>.<br/>
&nbsp;&nbsp;Qed.</div>
&nbsp;&nbsp;<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">rproject_over_rec_in</span> <span class="id">sl</span> <span class="id">s</span> <span class="id">p</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">In</span> <span class="id">s</span> <span class="id">sl</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;π[<span class="id">sl</span>](‵[| (<span class="id">s</span>, <span class="id">p</span>) |]) ≡ₑ ‵[| (<span class="id">s</span>, <span class="id">p</span>) |].<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2079')">Proof.</div>
<div class="proofscript" id="proof2079">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">red</span>; <span class="tactic">simpl</span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">h</span> ⊢ₑ <span class="id">p</span> @ₑ <span class="id">x</span> ⊣ <span class="id">c</span>;<span class="id">env</span>); <span class="tactic">simpl</span>; <span class="tactic">trivial</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">in_dec</span> <span class="id">string_dec</span> <span class="id">s</span> <span class="id">sl</span>); <span class="tactic">intuition</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">rproject_over_rec_nin</span> <span class="id">sl</span> <span class="id">s</span> <span class="id">p</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;~ <span class="id">In</span> <span class="id">s</span> <span class="id">sl</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;π[<span class="id">sl</span>](‵[| (<span class="id">s</span>, <span class="id">p</span>) |]) ≡ₑ ‵[||] ◯ <span class="id">p</span> .<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2080')">Proof.</div>
<div class="proofscript" id="proof2080">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">red</span>; <span class="tactic">simpl</span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">h</span> ⊢ₑ <span class="id">p</span> @ₑ <span class="id">x</span> ⊣ <span class="id">c</span>;<span class="id">env</span>); <span class="tactic">simpl</span>; <span class="tactic">trivial</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">in_dec</span> <span class="id">string_dec</span> <span class="id">s</span> <span class="id">sl</span>); <span class="tactic">intuition</span>.<br/>
&nbsp;&nbsp;Qed.</div>
&nbsp;&nbsp;<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">rproject_over_rproject</span> <span class="id">sl1</span> <span class="id">sl2</span> <span class="id">p</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;π[<span class="id">sl1</span>](π[<span class="id">sl2</span>](<span class="id">p</span>)) ≡ₑ π[<span class="id">set_inter</span> <span class="id">string_dec</span> <span class="id">sl2</span> <span class="id">sl1</span>](<span class="id">p</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2081')">Proof.</div>
<div class="proofscript" id="proof2081">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">red</span>; <span class="tactic">simpl</span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">h</span> ⊢ₑ <span class="id">p</span> @ₑ <span class="id">x</span> ⊣ <span class="id">c</span>;<span class="id">env</span>); <span class="tactic">simpl</span>; <span class="tactic">trivial</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">d</span>; <span class="tactic">simpl</span>; <span class="tactic">trivial</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">rproject_rproject</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">trivial</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">rproject_over_either</span> <span class="id">sl</span> <span class="id">p1</span> <span class="id">p2</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;π[<span class="id">sl</span>](<span class="id">ANEither</span> <span class="id">p1</span> <span class="id">p2</span>) ≡ₑ <span class="id">ANEither</span> (π[<span class="id">sl</span>](<span class="id">p1</span>)) (π[<span class="id">sl</span>](<span class="id">p2</span>)).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2082')">Proof.</div>
<div class="proofscript" id="proof2082">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">red</span>; <span class="tactic">simpl</span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">x</span>; <span class="tactic">simpl</span>; <span class="tactic">trivial</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">map_over_map_split</span> <span class="id">p</span>₁ <span class="id">p</span>₂ <span class="id">p</span>₃ :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;χ⟨χ⟨<span class="id">p</span>₁ ⟩( <span class="id">p</span>₂) ⟩( <span class="id">p</span>₃) ≡ₑ χ⟨χ⟨<span class="id">p</span>₁ ⟩( <span class="id">ID</span>) ⟩(χ⟨<span class="id">p</span>₂⟩(<span class="id">p</span>₃)).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2083')">Proof.</div>
<div class="proofscript" id="proof2083">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">red</span>; <span class="tactic">simpl</span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">h</span> ⊢ₑ <span class="id">p</span>₃ @ₑ <span class="id">x</span> ⊣ <span class="id">c</span>; <span class="id">env</span>); <span class="tactic">simpl</span>; <span class="tactic">trivial</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">d</span>; <span class="tactic">simpl</span>; <span class="tactic">trivial</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">lift</span>, <span class="id">olift</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">l</span>; <span class="tactic">simpl</span>; <span class="tactic">trivial</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">h</span> ⊢ₑ <span class="id">p</span>₂ @ₑ <span class="id">a</span> ⊣ <span class="id">c</span>; <span class="id">env</span>); <span class="tactic">simpl</span>; <span class="tactic">trivial</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">rmap</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">fun</span> <span class="id">x0</span> : <span class="id">data</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">h</span> ⊢ₑ <span class="id">p</span>₂ @ₑ <span class="id">x0</span> ⊣ <span class="id">c</span>; <span class="id">env</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">Some</span> <span class="id">x</span>'0 =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">lift_oncoll</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">fun</span> <span class="id">c1</span> : <span class="id">list</span> <span class="id">data</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">rmap</span> (<span class="id">nraenv_core_eval</span> <span class="id">h</span> <span class="id">c</span> <span class="id">p</span>₁ <span class="id">env</span>) <span class="id">c1</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">Some</span> <span class="id">a</span>' =&gt; <span class="id">Some</span> (<span class="id">dcoll</span> <span class="id">a</span>')<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">None</span> =&gt; <span class="id">None</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>) <span class="id">x</span>'0<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">None</span> =&gt; <span class="id">None</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>) <span class="id">l</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">rmap</span> (<span class="id">nraenv_core_eval</span> <span class="id">h</span> <span class="id">c</span> <span class="id">p</span>₂ <span class="id">env</span>) <span class="id">l</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> * .<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">destruct</span> (<span class="id">rmap</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">fun</span> <span class="id">x0</span> : <span class="id">data</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">lift_oncoll</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">fun</span> <span class="id">c1</span> : <span class="id">list</span> <span class="id">data</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">rmap</span> (<span class="id">nraenv_core_eval</span> <span class="id">h</span> <span class="id">c</span> <span class="id">p</span>₁ <span class="id">env</span>) <span class="id">c1</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">Some</span> <span class="id">a</span>' =&gt; <span class="id">Some</span> (<span class="id">dcoll</span> <span class="id">a</span>')<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">None</span> =&gt; <span class="id">None</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>) <span class="id">x0</span>) <span class="id">l1</span>); <span class="tactic">try</span> <span class="tactic">discriminate</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">IHl</span>; <span class="tactic">clear</span> <span class="id">IHl</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">trivial</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">discriminate</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">destruct</span> (<span class="id">rmap</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">fun</span> <span class="id">x0</span> : <span class="id">data</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">lift_oncoll</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">fun</span> <span class="id">c1</span> : <span class="id">list</span> <span class="id">data</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">rmap</span> (<span class="id">nraenv_core_eval</span> <span class="id">h</span> <span class="id">c</span> <span class="id">p</span>₁ <span class="id">env</span>) <span class="id">c1</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">Some</span> <span class="id">a</span>' =&gt; <span class="id">Some</span> (<span class="id">dcoll</span> <span class="id">a</span>')<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">None</span> =&gt; <span class="id">None</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>) <span class="id">x0</span>) <span class="id">l0</span>); <span class="tactic">try</span> <span class="tactic">discriminate</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">trivial</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">destruct</span> ( <span class="id">lift_oncoll</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">fun</span> <span class="id">c1</span> : <span class="id">list</span> <span class="id">data</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">rmap</span> (<span class="id">nraenv_core_eval</span> <span class="id">h</span> <span class="id">c</span> <span class="id">p</span>₁ <span class="id">env</span>) <span class="id">c1</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">Some</span> <span class="id">a</span>' =&gt; <span class="id">Some</span> (<span class="id">dcoll</span> <span class="id">a</span>')<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">None</span> =&gt; <span class="id">None</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>) <span class="id">d</span>); <span class="tactic">trivial</span>.<br/>
&nbsp;&nbsp;Qed.</div>
&nbsp;&nbsp;<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id">nodupA</span> : <span class="id">nraenv_core</span> -&gt; <span class="kwd">Prop</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">nraenv_core_always_ensures</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">fun</span> <span class="id">d</span> =&gt; <span class="kwd">match</span> <span class="id">d</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">dcoll</span> <span class="id">dl</span> =&gt; <span class="id">NoDup</span> <span class="id">dl</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">_</span> =&gt; <span class="id">False</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>).<br/>
&nbsp;&nbsp;<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">dup_elim</span> (<span class="id">q</span>:<span class="id">nraenv_core</span>) :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">nodupA</span> <span class="id">q</span> -&gt; <span class="id">ANUnop</span> <span class="id">ADistinct</span> <span class="id">q</span>  ≡ₑ  <span class="id">q</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2084')">Proof.</div>
<div class="proofscript" id="proof2084">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">nd</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">red</span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">case_eq</span> (<span class="id">h</span> ⊢ₑ <span class="id">q</span> @ₑ <span class="id">x</span> ⊣ <span class="id">c</span>; <span class="id">env</span>); <span class="tactic">simpl</span>; <span class="tactic">trivial</span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id">nd</span> <span class="id">h</span> <span class="id">c</span> <span class="id">dn_c</span> <span class="id">env</span> <span class="id">dn_env</span> <span class="id">x</span> <span class="id">dn_x</span> <span class="id">d</span> <span class="id">H</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">nd</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">match_destr_in</span> <span class="id">nd</span>; <span class="tactic">try</span> <span class="tactic">tauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">rondcoll_dcoll</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">NoDup_bdistinct</span>; <span class="tactic">trivial</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
<div class="doc">Some optimizations are best seen through outlining -- the 
       opposite of inlining.  This allows sharing of common sub-expressions.
       To enable this, we first define the "last" part of a computation.
  </div>
&nbsp;&nbsp;<br/>
<div class="doc">returns: (last part of the computation, rest of it) </div>
&nbsp;&nbsp;<span class="kwd">Fixpoint</span> <span class="id">nraenv_core_split_last</span> (<span class="id">e</span>:<span class="id">nraenv_core</span>) : (<span class="id">nraenv_core</span>*<span class="id">nraenv_core</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;:= <span class="kwd">match</span> <span class="id">e</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">ANID</span> =&gt; (<span class="id">ANID</span>,<span class="id">ANID</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">ANConst</span> <span class="id">c</span> =&gt;  (<span class="id">ANID</span>,<span class="id">ANConst</span> <span class="id">c</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">ANBinop</span> <span class="id">b</span> <span class="id">e1</span> <span class="id">e2</span> =&gt; (<span class="id">ANBinop</span> <span class="id">b</span> <span class="id">e1</span> <span class="id">e2</span>,<span class="id">ANID</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">ANUnop</span> <span class="id">u</span> <span class="id">e1</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">nraenv_core_split_last</span> <span class="id">e1</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| (<span class="id">ANID</span>, <span class="id">r</span>) =&gt; (<span class="id">ANUnop</span> <span class="id">u</span> <span class="id">r</span>, <span class="id">ANID</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| (<span class="id">e1last</span>, <span class="id">e1rest</span>) =&gt; (<span class="id">e1last</span>, <span class="id">ANUnop</span> <span class="id">u</span> <span class="id">e1rest</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">ANMap</span> <span class="id">e1</span> <span class="id">e2</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">nraenv_core_split_last</span> <span class="id">e2</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| (<span class="id">ANID</span>, <span class="id">r</span>) =&gt; (<span class="id">ANMap</span> <span class="id">e1</span> <span class="id">e2</span>, <span class="id">ANID</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| (<span class="id">e2last</span>, <span class="id">e2rest</span>) =&gt; (<span class="id">e2last</span>, <span class="id">ANMap</span> <span class="id">e1</span> <span class="id">e2rest</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">ANMapConcat</span> <span class="id">e1</span> <span class="id">e2</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">nraenv_core_split_last</span> <span class="id">e2</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| (<span class="id">ANID</span>, <span class="id">r</span>) =&gt; (<span class="id">ANMapConcat</span> <span class="id">e1</span> <span class="id">e2</span>, <span class="id">ANID</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| (<span class="id">e2last</span>, <span class="id">e2rest</span>) =&gt; (<span class="id">e2last</span>, <span class="id">ANMapConcat</span> <span class="id">e1</span> <span class="id">e2rest</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">ANProduct</span> <span class="id">e1</span> <span class="id">e2</span> =&gt; (<span class="id">ANProduct</span> <span class="id">e1</span> <span class="id">e2</span>,<span class="id">ANID</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">ANSelect</span> <span class="id">e1</span> <span class="id">e2</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">nraenv_core_split_last</span> <span class="id">e2</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| (<span class="id">ANID</span>, <span class="id">r</span>) =&gt; (<span class="id">ANSelect</span> <span class="id">e1</span> <span class="id">e2</span>, <span class="id">ANID</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| (<span class="id">e2last</span>, <span class="id">e2rest</span>) =&gt; (<span class="id">e2last</span>, <span class="id">ANSelect</span> <span class="id">e1</span> <span class="id">e2rest</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>         <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">ANDefault</span> <span class="id">e1</span> <span class="id">e2</span> =&gt; (<span class="id">ANDefault</span> <span class="id">e1</span> <span class="id">e2</span>,<span class="id">ANID</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">ANEither</span> <span class="id">l</span> <span class="id">r</span> =&gt; (<span class="id">ANEither</span> <span class="id">l</span> <span class="id">r</span>, <span class="id">ANID</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">ANEitherConcat</span> <span class="id">l</span> <span class="id">r</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">ANEitherConcat</span> <span class="id">l</span> <span class="id">r</span>, <span class="id">ANID</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">ANApp</span> <span class="id">e1</span> <span class="id">e2</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">nraenv_core_split_last</span> <span class="id">e2</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| (<span class="id">ANID</span>, <span class="id">r</span>) =&gt; (<span class="id">e1</span>, <span class="id">r</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| (<span class="id">e2last</span>, <span class="id">e2rest</span>) =&gt; (<span class="id">e2last</span>, <span class="id">ANApp</span> <span class="id">e1</span> <span class="id">e2rest</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>         <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">ANGetConstant</span> <span class="id">s</span> =&gt; (<span class="id">ANID</span>,<span class="id">ANGetConstant</span> <span class="id">s</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">ANEnv</span> =&gt; (<span class="id">ANID</span>,<span class="id">ANEnv</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">ANAppEnv</span> <span class="id">e1</span> <span class="id">e2</span> =&gt; (<span class="id">ANAppEnv</span> <span class="id">e1</span> <span class="id">e2</span>, <span class="id">ANID</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">ANMapEnv</span> <span class="id">e</span> =&gt; (<span class="id">ANMapEnv</span> <span class="id">e</span>, <span class="id">ANID</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
&nbsp;&nbsp;<br/>
<span class="kwd">End</span> <span class="id">ROptimEnv</span>.<br/>
<br/>
<br/>
<br/>
<span class="kwd">Hint</span> <span class="id">Rewrite</span> @<span class="id">envflatten_map_coll</span> : <span class="id">nraenv_core_optim</span>.<br/>
<span class="kwd">Hint</span> <span class="id">Rewrite</span> @<span class="id">envmap_into_id</span> : <span class="id">nraenv_core_optim</span>.<br/>
<span class="kwd">Hint</span> <span class="id">Rewrite</span> @<span class="id">envmap_into_id_flatten</span> : <span class="id">nraenv_core_optim</span>.<br/>
<br/>
<br/>
<span class="kwd">Hint</span> <span class="id">Rewrite</span> @<span class="id">envmap_map_compose</span> : <span class="id">nraenv_core_optim</span>.<br/>
<span class="kwd">Hint</span> <span class="id">Rewrite</span> @<span class="id">envmap_singleton</span> : <span class="id">nraenv_core_optim</span>.<br/>
<br/>
<br/>
<span class="kwd">Hint</span> <span class="id">Rewrite</span> @<span class="id">envflatten_coll_mergeconcat</span> : <span class="id">nraenv_core_optim</span>.<br/>
<span class="kwd">Hint</span> <span class="id">Rewrite</span> @<span class="id">envflatten_coll_map</span> : <span class="id">nraenv_core_optim</span>.<br/>
<span class="kwd">Hint</span> <span class="id">Rewrite</span> @<span class="id">envflatten_coll_flatten</span> : <span class="id">nraenv_core_optim</span>.<br/>
<span class="kwd">Hint</span> <span class="id">Rewrite</span> @<span class="id">envflatten_coll_coll</span> : <span class="id">nraenv_core_optim</span>.<br/>
<br/>
<br/>
<span class="kwd">Hint</span> <span class="id">Rewrite</span> @<span class="id">app_over_id</span> : <span class="id">nraenv_core_optim</span>.<br/>
<span class="kwd">Hint</span> <span class="id">Rewrite</span> @<span class="id">app_over_id_l</span> : <span class="id">nraenv_core_optim</span>.<br/>
<span class="kwd">Hint</span> <span class="id">Rewrite</span> @<span class="id">app_over_app</span> : <span class="id">nraenv_core_optim</span>.           <br/>
<span class="kwd">Hint</span> <span class="id">Rewrite</span> @<span class="id">app_over_map</span> : <span class="id">nraenv_core_optim</span>.<br/>
<span class="kwd">Hint</span> <span class="id">Rewrite</span> @<span class="id">app_over_select</span> : <span class="id">nraenv_core_optim</span>.<br/>
<span class="kwd">Hint</span> <span class="id">Rewrite</span> @<span class="id">app_over_unop</span> : <span class="id">nraenv_core_optim</span>.<br/>
<span class="kwd">Hint</span> <span class="id">Rewrite</span> @<span class="id">app_over_binop_l</span> : <span class="id">nraenv_core_optim</span>.<br/>
<span class="kwd">Hint</span> <span class="id">Rewrite</span> @<span class="id">app_over_merge</span> : <span class="id">nraenv_core_optim</span>.<br/>
<span class="kwd">Hint</span> <span class="id">Rewrite</span> @<span class="id">app_over_rec</span> : <span class="id">nraenv_core_optim</span>.<br/>
<span class="kwd">Hint</span> <span class="id">Rewrite</span> @<span class="id">binop_over_rec_pair</span> : <span class="id">nraenv_core_optim</span>.<br/>
<span class="kwd">Hint</span> <span class="id">Rewrite</span> @<span class="id">concat_id_left</span> : <span class="id">nraenv_core_optim</span>.<br/>
<span class="kwd">Hint</span> <span class="id">Rewrite</span> @<span class="id">app_over_env_dot</span> : <span class="id">nraenv_core_optim</span>.<br/>
<span class="kwd">Hint</span> <span class="id">Rewrite</span> @<span class="id">app_over_appenv_over_mapenv</span> : <span class="id">nraenv_core_optim</span>.<br/>
<br/>
<br/>
<span class="kwd">Hint</span> <span class="id">Rewrite</span> @<span class="id">product_singletons</span> : <span class="id">nraenv_core_optim</span>.<br/>
<span class="kwd">Hint</span> <span class="id">Rewrite</span> @<span class="id">double_flatten_map_coll</span> : <span class="id">nraenv_core_optim</span>.<br/>
<span class="kwd">Hint</span> <span class="id">Rewrite</span> @<span class="id">tostring_dstring</span> : <span class="id">nraenv_core_optim</span>.<br/>
<span class="kwd">Hint</span> <span class="id">Rewrite</span> @<span class="id">tostring_tostring</span> : <span class="id">nraenv_core_optim</span>.<br/>
<br/>
<br/>
<span class="kwd">Hint</span> <span class="id">Rewrite</span> @<span class="id">env_appenv</span> : <span class="id">nraenv_core_optim</span>.<br/>
<span class="kwd">Hint</span> <span class="id">Rewrite</span> @<span class="id">appenv_over_mapenv</span> : <span class="id">nraenv_core_optim</span>.<br/>
<span class="kwd">Hint</span> <span class="id">Rewrite</span> @<span class="id">appenv_over_mapenv_coll</span> : <span class="id">nraenv_core_optim</span>.<br/>
<span class="kwd">Hint</span> <span class="id">Rewrite</span> @<span class="id">appenv_over_mapenv_merge</span> : <span class="id">nraenv_core_optim</span>.<br/>
<span class="kwd">Hint</span> <span class="id">Rewrite</span> @<span class="id">appenv_over_mapenv_merge2</span> : <span class="id">nraenv_core_optim</span>.<br/>
<span class="kwd">Hint</span> <span class="id">Rewrite</span> @<span class="id">compose_selects_in_mapenv</span> : <span class="id">nraenv_core_optim</span>.<br/>
<span class="kwd">Hint</span> <span class="id">Rewrite</span> @<span class="id">flatten_through_appenv</span> : <span class="id">nraenv_core_optim</span>.<br/>
<span class="kwd">Hint</span> <span class="id">Rewrite</span> @<span class="id">flatten_mapenv_coll</span> : <span class="id">nraenv_core_optim</span>.<br/>
<br/>
<span class="kwd">Hint</span> <span class="id">Rewrite</span> @<span class="id">either_app_over_dleft</span> : <span class="id">nraenv_core_optim</span>.<br/>
<span class="kwd">Hint</span> <span class="id">Rewrite</span> @<span class="id">either_app_over_dright</span> : <span class="id">nraenv_core_optim</span>.<br/>
<span class="kwd">Hint</span> <span class="id">Rewrite</span> @<span class="id">either_app_over_aleft</span> : <span class="id">nraenv_core_optim</span>.<br/>
<span class="kwd">Hint</span> <span class="id">Rewrite</span> @<span class="id">either_app_over_aright</span> : <span class="id">nraenv_core_optim</span>.<br/>
<br/>
<span class="kwd">Hint</span> <span class="id">Rewrite</span> @<span class="id">rproject_over_concat</span> : <span class="id">nraenv_core_optim</span>.<br/>
<span class="kwd">Hint</span> <span class="id">Rewrite</span> @<span class="id">rproject_over_rec_in</span> : <span class="id">nraenv_core_optim</span>. <br/>
<span class="kwd">Hint</span> <span class="id">Rewrite</span> @<span class="id">rproject_over_rec_nin</span> : <span class="id">nraenv_core_optim</span>. <br/>
<span class="kwd">Hint</span> <span class="id">Rewrite</span> @<span class="id">rproject_over_rproject</span> : <span class="id">nraenv_core_optim</span>. <br/>
<span class="kwd">Hint</span> <span class="id">Rewrite</span> @<span class="id">rproject_over_either</span>  : <span class="id">nraenv_core_optim</span>.<br/>
&nbsp;&nbsp;<br/>
<br/>

</div>
<div class="footer"><hr/>Generated by <a href="https://github.com/xavierleroy/coq2html/">coq2html</div>
</body>
</html>
