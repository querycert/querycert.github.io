
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Module Qcert.Translation.DatatoSparkDF</title>
<meta name="description" content="Documentation of Coq module Qcert.Translation.DatatoSparkDF" />
<link href="coq2html.css" rel="stylesheet" type="text/css" />
<script type="text/javascript" src="coq2html.js"> </script>
</head>

<body onload="hideAll('proofscript')">
<h1 class="title">Module Qcert.Translation.DatatoSparkDF</h1>
<div class="coq">
<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id">Basics</span>.<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id">List</span>.<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id">String</span>.<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id">EquivDec</span>.<br/>
<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="kwd">Types</span>.<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id">BasicRuntime</span>.<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id">ForeignDataTyping</span>.<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id">NNRCtoJavaScript</span>.<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id">ForeignToJSON</span>.<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id">JSON</span>.<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id">JSONtoData</span>.<br/>
<br/>
<br/>
<span class="kwd">Section</span> <span class="id">DatatoSparkDF</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Context</span> {<span class="id">f</span>:<span class="id">foreign_runtime</span>}.<br/>
&nbsp;&nbsp;<span class="kwd">Context</span> {<span class="id">h</span>:<span class="id">brand_relation_t</span>}.<br/>
&nbsp;&nbsp;<span class="kwd">Context</span> {<span class="id">fttojs</span>: <span class="id">ForeignToJavaScript.foreign_to_javascript</span>}.<br/>
&nbsp;&nbsp;<span class="kwd">Context</span> {<span class="id">ftype</span>:<span class="id">foreign_type</span>}.<br/>
&nbsp;&nbsp;<span class="kwd">Context</span> {<span class="id">fdtyping</span>:<span class="id">foreign_data_typing</span>}.<br/>
&nbsp;&nbsp;<span class="kwd">Context</span> {<span class="id">m</span>:<span class="id">brand_model</span>}.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id">data_to_blob</span> (<span class="id">d</span>: <span class="id">data</span>): <span class="id">string</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">dataToJS</span> <span class="id">quotel_double</span> <span class="id">d</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">dataToJS_correctly_escapes_quote_inside_string</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">dataToJS</span> """" (<span class="id">dstring</span> "<span class="id">abc</span>""<span class="id">cde</span>") = """<span class="id">abc</span>\""<span class="id">cde</span>"""%<span class="id">string</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof3027')">Proof.</div>
<div class="proofscript" id="proof3027">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">vm_compute</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;Qed.</div>
&nbsp;&nbsp;<br/>
&nbsp;&nbsp;<span class="kwd">Fixpoint</span> <span class="id">typed_data_to_json</span> (<span class="id">d</span>: <span class="id">data</span>) (<span class="id">r</span>: <span class="id">rtype</span>₀): <span class="id">option</span> <span class="id">json</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">d</span>, <span class="id">r</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">_</span>, <span class="id">Top</span>₀ =&gt; <span class="id">Some</span> (<span class="id">jstring</span> (<span class="id">data_to_blob</span> <span class="id">d</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">dunit</span>, <span class="id">Unit</span>₀ =&gt; <span class="id">Some</span> <span class="id">jnil</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">dnat</span> <span class="id">i</span>, <span class="id">Nat</span>₀ =&gt; <span class="id">Some</span> (<span class="id">jnumber</span> <span class="id">i</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">dbool</span> <span class="id">b</span>, <span class="id">Bool</span>₀ =&gt; <span class="id">Some</span> (<span class="id">jbool</span> <span class="id">b</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">dstring</span> <span class="id">s</span>, <span class="id">String</span>₀ =&gt; <span class="id">Some</span> (<span class="id">jstring</span> <span class="id">s</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">dcoll</span> <span class="id">xs</span>, (<span class="id">Coll</span>₀ <span class="id">et</span>) =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">listo</span> := <span class="id">map</span> (<span class="id">flip</span> <span class="id">typed_data_to_json</span> <span class="id">et</span>) <span class="id">xs</span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">lift</span> <span class="id">jarray</span> (<span class="id">listo_to_olist</span> <span class="id">listo</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">drec</span> <span class="id">fs</span>, <span class="id">Rec</span>₀ <span class="id">Closed</span> <span class="id">ft</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">fix</span> <span class="id">convert_fields</span> <span class="id">ds</span> <span class="id">ts</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">ds</span>, <span class="id">ts</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">nil</span>, <span class="id">nil</span> =&gt; <span class="id">Some</span> <span class="id">nil</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">nil</span>, <span class="id">_</span> =&gt; <span class="id">None</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">_</span>, <span class="id">nil</span> =&gt; <span class="id">None</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| ((<span class="id">f</span>, <span class="id">d</span>)::<span class="id">ds</span>), ((<span class="id">_</span>, <span class="id">t</span>)::<span class="id">ts</span>) =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">typed_data_to_json</span> <span class="id">d</span> <span class="id">t</span>, <span class="id">convert_fields</span> <span class="id">ds</span> <span class="id">ts</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">Some</span> <span class="id">json</span>, <span class="id">Some</span> <span class="id">tail</span> =&gt; <span class="id">Some</span> ((<span class="id">f</span>, <span class="id">json</span>)::<span class="id">tail</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">_</span>, <span class="id">_</span> =&gt; <span class="id">None</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">lift</span> (<span class="kwd">fun</span> <span class="id">fields</span> =&gt; <span class="id">jobject</span> (("$<span class="id">blob</span>"%<span class="id">string</span>, <span class="id">jstring</span> "")<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:: ("$<span class="id">known</span>"%<span class="id">string</span>, <span class="id">jobject</span> <span class="id">fields</span>) :: <span class="id">nil</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">convert_fields</span> <span class="id">fs</span> <span class="id">ft</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">drec</span> <span class="id">fs</span>, <span class="id">Rec</span>₀ <span class="kwd">Open</span> <span class="id">ft</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">fix</span> <span class="id">convert_known_fields</span> <span class="id">ds</span> <span class="id">ts</span> <span class="id">us</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">ts</span>, <span class="id">ds</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">nil</span>, <span class="id">ds</span> =&gt; <span class="id">Some</span> (<span class="id">nil</span>, <span class="id">us</span> ++ <span class="id">ds</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">_</span>, <span class="id">nil</span> =&gt; <span class="id">None</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| ((<span class="id">tf</span>, <span class="id">t</span>)::<span class="id">ts</span>), ((<span class="id">df</span>, <span class="id">d</span>)::<span class="id">ds</span>) =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">if</span> <span class="id">string_dec</span> <span class="id">tf</span> <span class="id">df</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">then</span> <span class="kwd">match</span> <span class="id">typed_data_to_json</span> <span class="id">d</span> <span class="id">t</span>, <span class="id">convert_known_fields</span> <span class="id">ds</span> <span class="id">ts</span> <span class="id">us</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">Some</span> <span class="id">json</span>, <span class="id">Some</span> (<span class="id">tail</span>, <span class="id">us</span>) =&gt; <span class="id">Some</span> (((<span class="id">tf</span>, <span class="id">json</span>)::<span class="id">tail</span>), <span class="id">us</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">_</span>, <span class="id">_</span> =&gt; <span class="id">None</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">else</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">convert_known_fields</span> <span class="id">ds</span> <span class="id">ts</span> ((<span class="id">df</span>, <span class="id">d</span>)::<span class="id">us</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">convert_known_fields</span> <span class="id">fs</span> <span class="id">ft</span> <span class="id">nil</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">Some</span> (<span class="id">typed_fields</span>, <span class="id">dotdot</span>) =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Some</span> (<span class="id">jobject</span> (("$<span class="id">blob</span>"%<span class="id">string</span>, <span class="id">jstring</span> (<span class="id">data_to_blob</span> (<span class="id">drec</span> <span class="id">dotdot</span>)))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:: ("$<span class="id">known</span>"%<span class="id">string</span>, <span class="id">jobject</span> <span class="id">typed_fields</span>) :: <span class="id">nil</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">None</span> =&gt; <span class="id">None</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">dleft</span> <span class="id">l</span>, <span class="id">Either</span>₀ <span class="id">lt</span> <span class="id">rt</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">lift</span> (<span class="kwd">fun</span> <span class="id">l</span> =&gt; <span class="id">jobject</span> (("$<span class="id">left</span>"%<span class="id">string</span>, <span class="id">l</span>)::("$<span class="id">right</span>"%<span class="id">string</span>, <span class="id">jnil</span>)::<span class="id">nil</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">typed_data_to_json</span> <span class="id">l</span> <span class="id">lt</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">dright</span> <span class="id">r</span>, <span class="id">Either</span>₀ <span class="id">lt</span> <span class="id">rt</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">lift</span> (<span class="kwd">fun</span> <span class="id">r</span> =&gt; <span class="id">jobject</span> (("$<span class="id">left</span>"%<span class="id">string</span>, <span class="id">jnil</span>)::("$<span class="id">right</span>"%<span class="id">string</span>, <span class="id">r</span>)::<span class="id">nil</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">typed_data_to_json</span> <span class="id">r</span> <span class="id">rt</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">dbrand</span> <span class="id">bs</span> <span class="id">v</span>, <span class="id">Brand</span>₀ <span class="id">bts</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Some</span> (<span class="id">jobject</span> (("$<span class="id">data</span>"%<span class="id">string</span>, <span class="id">jstring</span> (<span class="id">data_to_blob</span> <span class="id">v</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:: ("$<span class="id">type</span>"%<span class="id">string</span>, <span class="id">jarray</span> (<span class="id">map</span> <span class="id">jstring</span> <span class="id">bs</span>)) :: <span class="id">nil</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">_</span>, <span class="id">_</span> =&gt; <span class="id">None</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id">typed_data_to_json_string</span> (<span class="id">d</span>: <span class="id">data</span>) (<span class="id">r</span>: <span class="id">rtype</span>): <span class="id">string</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">typed_data_to_json</span> <span class="id">d</span> (<span class="id">proj1_sig</span> <span class="id">r</span>) <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">Some</span> <span class="id">json</span> =&gt; <span class="id">jsonToJS</span> """" <span class="id">json</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">None</span> =&gt; "<span class="id">typed_data_to_json_string</span> <span class="id">failed</span>. <span class="id">This</span> <span class="id">cannot</span> <span class="id">happen</span>. <span class="id">Get</span> <span class="id">rid</span> <span class="id">of</span> <span class="id">this</span> <span class="tactic">case</span> <span class="tactic">by</span> <span class="id">proving</span> <span class="id">that</span> <span class="id">typed_data_to_json</span> <span class="id">always</span> <span class="id">succeeds</span> <span class="kwd">for</span> <span class="id">well</span>-<span class="id">typed</span> <span class="id">data</span>."<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">test_json_with_toplevel_brand</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">typed_data_to_json</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">dbrand</span> ("<span class="id">Person</span>"%<span class="id">string</span>::<span class="id">nil</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">drec</span> (("<span class="id">age</span>"%<span class="id">string</span>, <span class="id">dnat</span> 35)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:: ("<span class="id">name</span>"%<span class="id">string</span>, <span class="id">dstring</span> "<span class="id">Fred</span>")<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:: ("<span class="id">friends</span>"%<span class="id">string</span>, <span class="id">dcoll</span> ((<span class="id">dbrand</span> ("<span class="id">Person</span>"%<span class="id">string</span>::<span class="id">nil</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">drec</span> (("<span class="id">age</span>"%<span class="id">string</span>, <span class="id">dnat</span> 42)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:: ("<span class="id">name</span>"%<span class="id">string</span>, <span class="id">dstring</span> "<span class="id">Berta</span>")<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:: ("<span class="id">friends</span>"%<span class="id">string</span>, <span class="id">dcoll</span> <span class="id">nil</span>) :: <span class="id">nil</span>))) :: <span class="id">nil</span>)) :: <span class="id">nil</span>)))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Brand</span>₀ ("<span class="id">Person</span>"%<span class="id">string</span>::<span class="id">nil</span>)))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;= <span class="id">Some</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">jobject</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(("$<span class="id">data</span>"%<span class="id">string</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">jstring</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"{""<span class="id">age</span>"": 35, ""<span class="id">name</span>"": ""<span class="id">Fred</span>"", ""<span class="id">friends</span>"": [{""<span class="id">type</span>"": [""<span class="id">Person</span>""], ""<span class="id">data</span>"": {""<span class="id">age</span>"": 42, ""<span class="id">name</span>"": ""<span class="id">Berta</span>"", ""<span class="id">friends</span>"": []}}]}")<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:: ("$<span class="id">type</span>"%<span class="id">string</span>, <span class="id">jarray</span> (<span class="id">jstring</span> "<span class="id">Person</span>" :: <span class="id">nil</span>)) :: <span class="id">nil</span>)).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof3028')">Proof.</div>
<div class="proofscript" id="proof3028">
 <span class="id">vm_compute</span>. <span class="tactic">reflexivity</span>. Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">test_json_with_nested_brand</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">typed_data_to_json</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">drec</span> (("<span class="id">age</span>"%<span class="id">string</span>, <span class="id">dnat</span> 35)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:: ("<span class="id">name</span>"%<span class="id">string</span>, <span class="id">dstring</span> "<span class="id">Fred</span>")<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:: ("<span class="id">friends</span>"%<span class="id">string</span>, <span class="id">dcoll</span> ((<span class="id">dbrand</span> ("<span class="id">Person</span>"%<span class="id">string</span>::<span class="id">nil</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">drec</span> (("<span class="id">age</span>"%<span class="id">string</span>, <span class="id">dnat</span> 42)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:: ("<span class="id">name</span>"%<span class="id">string</span>, <span class="id">dstring</span> "<span class="id">Berta</span>")<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:: ("<span class="id">friends</span>"%<span class="id">string</span>, <span class="id">dcoll</span> <span class="id">nil</span>) :: <span class="id">nil</span>))) :: <span class="id">nil</span>)) :: <span class="id">nil</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Rec</span>₀ <span class="id">Closed</span> (("<span class="id">age</span>"%<span class="id">string</span>, <span class="id">Nat</span>₀)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:: ("<span class="id">name</span>"%<span class="id">string</span>, <span class="id">String</span>₀)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:: ("<span class="id">friends</span>"%<span class="id">string</span>, (<span class="id">Coll</span>₀ (<span class="id">Brand</span>₀ ("<span class="id">Person</span>"%<span class="id">string</span>::<span class="id">nil</span>)))) :: <span class="id">nil</span>)))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;= <span class="id">Some</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">jobject</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(("$<span class="id">blob</span>"%<span class="id">string</span>, <span class="id">jstring</span> "")<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:: ("$<span class="id">known</span>"%<span class="id">string</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">jobject</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(("<span class="id">age</span>"%<span class="id">string</span>, <span class="id">jnumber</span> 35)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:: ("<span class="id">name</span>"%<span class="id">string</span>, <span class="id">jstring</span> "<span class="id">Fred</span>")<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:: ("<span class="id">friends</span>"%<span class="id">string</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">jarray</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">jobject</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(("$<span class="id">data</span>"%<span class="id">string</span>, <span class="id">jstring</span> "{""<span class="id">age</span>"": 42, ""<span class="id">name</span>"": ""<span class="id">Berta</span>"", ""<span class="id">friends</span>"": []}")<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:: ("$<span class="id">type</span>"%<span class="id">string</span>, <span class="id">jarray</span> (<span class="id">jstring</span> "<span class="id">Person</span>" :: <span class="id">nil</span>)) :: <span class="id">nil</span>) :: <span class="id">nil</span>)) :: <span class="id">nil</span>)) :: <span class="id">nil</span>)).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof3029')">Proof.</div>
<div class="proofscript" id="proof3029">
 <span class="id">vm_compute</span>. <span class="tactic">reflexivity</span>. Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Context</span> {<span class="id">ftojson</span>:<span class="id">foreign_to_JSON</span>}.<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id">data_to_sjson</span> (<span class="id">d</span>:<span class="id">data</span>) (<span class="id">r</span>:<span class="id">rtype</span>) : <span class="id">option</span> <span class="id">string</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">lift</span> (<span class="id">jsonToJS</span> """") (<span class="id">typed_data_to_json</span> <span class="id">d</span> (<span class="id">proj1_sig</span> <span class="id">r</span>)).<br/>
<br/>
<span class="kwd">End</span> <span class="id">DatatoSparkDF</span>.<br/>
<br/>

</div>
<div class="footer"><hr/>Generated by <a href="https://github.com/xavierleroy/coq2html/">coq2html</div>
</body>
</html>
