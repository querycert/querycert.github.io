
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Module Qcert.SQL.Lang.SQL</title>
<meta name="description" content="Documentation of Coq module Qcert.SQL.Lang.SQL" />
<link href="coq2html.css" rel="stylesheet" type="text/css" />
<script type="text/javascript" src="coq2html.js"> </script>
</head>

<body onload="hideAll('proofscript')">
<h1 class="title">Module Qcert.SQL.Lang.SQL</h1>
<div class="coq">
<br/>
<br/>
<span class="kwd">Section</span> <span class="id">SQL</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id">String</span>.<br/>
&nbsp;&nbsp;<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id">ZArith</span>.<br/>
&nbsp;&nbsp;<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id">List</span>.<br/>
&nbsp;&nbsp;<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id">Arith</span>.<br/>
&nbsp;&nbsp;<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id">EquivDec</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id">Utils</span> <span class="id">BasicSystem</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Context</span> {<span class="id">fruntime</span>:<span class="id">foreign_runtime</span>}.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id">RDataSort</span>. <br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Unset</span> <span class="id">Elimination</span> <span class="id">Schemes</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id">sql_env</span> := <span class="id">list</span> (<span class="id">string</span> * <span class="id">data</span>). <br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id">sql_table_spec</span> : <span class="kwd">Set</span> := <span class="id">string</span> * (<span class="id">option</span> (<span class="id">list</span> <span class="id">string</span>)).<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id">sql_order_spec</span> : <span class="kwd">Set</span> := <span class="id">SortCriterias</span>.<br/>
&nbsp;&nbsp;<span class="kwd">Inductive</span> <span class="id">sql_bin_cond</span> : <span class="kwd">Set</span> :=<br/>
&nbsp;&nbsp;| <span class="id">SEq</span> | <span class="id">SLe</span> | <span class="id">SLt</span> | <span class="id">SGe</span> | <span class="id">SGt</span> | <span class="id">SDiff</span><br/>
&nbsp;&nbsp;| <span class="id">SBinaryForeignCond</span> (<span class="id">fb</span> : <span class="id">foreign_binary_op_type</span>) : <span class="id">sql_bin_cond</span>.<br/>
&nbsp;&nbsp;<span class="kwd">Inductive</span> <span class="id">sql_un_expr</span> : <span class="kwd">Set</span> :=<br/>
&nbsp;&nbsp;| <span class="id">SMinus</span> : <span class="id">sql_un_expr</span><br/>
&nbsp;&nbsp;| <span class="id">SSubstring</span> : <span class="id">Z</span> -&gt; <span class="id">option</span> <span class="id">Z</span> -&gt; <span class="id">sql_un_expr</span><br/>
&nbsp;&nbsp;| <span class="id">SUnaryForeignExpr</span> (<span class="id">fu</span>:<span class="id">foreign_unary_op_type</span>) : <span class="id">sql_un_expr</span>.<br/>
&nbsp;&nbsp;<span class="kwd">Inductive</span> <span class="id">sql_bin_expr</span> : <span class="kwd">Set</span> :=<br/>
&nbsp;&nbsp;| <span class="id">SPlus</span> | <span class="id">SSubtract</span> | <span class="id">SMult</span> | <span class="id">SDivide</span><br/>
&nbsp;&nbsp;| <span class="id">SConcat</span><br/>
&nbsp;&nbsp;| <span class="id">SBinaryForeignExpr</span> (<span class="id">fb</span> : <span class="id">foreign_binary_op_type</span>) : <span class="id">sql_bin_expr</span>.<br/>
&nbsp;&nbsp;<span class="kwd">Inductive</span> <span class="id">sql_agg</span> : <span class="kwd">Set</span> := | <span class="id">SSum</span> | <span class="id">SAvg</span> | <span class="id">SCount</span> | <span class="id">SMin</span> | <span class="id">SMax</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Inductive</span> <span class="id">sql_distinct</span> : <span class="kwd">Set</span> := <span class="id">SDistinct</span> | <span class="id">SAll</span>.<br/>
&nbsp;&nbsp;<br/>
&nbsp;&nbsp;<span class="kwd">Inductive</span> <span class="id">sql_query</span> : <span class="kwd">Set</span> :=<br/>
&nbsp;&nbsp;| <span class="id">SQuery</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">list</span> <span class="id">sql_select</span> -&gt;                                 <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">list</span> <span class="id">sql_from</span> -&gt;                                   <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">option</span> <span class="id">sql_condition</span> -&gt;                            <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">option</span> ((<span class="id">list</span> <span class="id">string</span>) * (<span class="id">option</span> <span class="id">sql_condition</span>)) -&gt; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">option</span> <span class="id">sql_order_spec</span> -&gt; <span class="id">sql_query</span>                 <br/>
&nbsp;&nbsp;| <span class="id">SUnion</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">sql_distinct</span> -&gt; <span class="id">sql_query</span> -&gt; <span class="id">sql_query</span> -&gt; <span class="id">sql_query</span><br/>
&nbsp;&nbsp;| <span class="id">SIntersect</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">sql_distinct</span> -&gt; <span class="id">sql_query</span> -&gt; <span class="id">sql_query</span> -&gt; <span class="id">sql_query</span><br/>
&nbsp;&nbsp;| <span class="id">SExcept</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">sql_distinct</span> -&gt; <span class="id">sql_query</span> -&gt; <span class="id">sql_query</span> -&gt; <span class="id">sql_query</span><br/>
&nbsp;&nbsp;<span class="kwd">with</span> <span class="id">sql_select</span> : <span class="kwd">Set</span> :=<br/>
&nbsp;&nbsp;| <span class="id">SSelectColumn</span> : <span class="id">string</span> -&gt; <span class="id">sql_select</span><br/>
&nbsp;&nbsp;| <span class="id">SSelectColumnDeref</span> : <span class="id">string</span> -&gt; <span class="id">string</span> -&gt; <span class="id">sql_select</span><br/>
&nbsp;&nbsp;| <span class="id">SSelectStar</span> : <span class="id">sql_select</span><br/>
&nbsp;&nbsp;| <span class="id">SSelectExpr</span> : <span class="id">string</span> -&gt; <span class="id">sql_expr</span> -&gt; <span class="id">sql_select</span><br/>
&nbsp;&nbsp;<span class="kwd">with</span> <span class="id">sql_from</span> : <span class="kwd">Set</span> :=<br/>
&nbsp;&nbsp;| <span class="id">SFromTable</span> : <span class="id">string</span> -&gt; <span class="id">sql_from</span><br/>
&nbsp;&nbsp;| <span class="id">SFromTableAlias</span> : <span class="id">string</span> -&gt; <span class="id">string</span> -&gt; <span class="id">sql_from</span><br/>
&nbsp;&nbsp;| <span class="id">SFromQuery</span> : <span class="id">sql_table_spec</span> -&gt; <span class="id">sql_query</span> -&gt; <span class="id">sql_from</span><br/>
&nbsp;&nbsp;<span class="kwd">with</span> <span class="id">sql_condition</span> : <span class="kwd">Set</span> :=<br/>
&nbsp;&nbsp;| <span class="id">SCondAnd</span> : <span class="id">sql_condition</span> -&gt; <span class="id">sql_condition</span> -&gt; <span class="id">sql_condition</span><br/>
&nbsp;&nbsp;| <span class="id">SCondOr</span> : <span class="id">sql_condition</span> -&gt; <span class="id">sql_condition</span> -&gt; <span class="id">sql_condition</span><br/>
&nbsp;&nbsp;| <span class="id">SCondNot</span> : <span class="id">sql_condition</span> -&gt; <span class="id">sql_condition</span><br/>
&nbsp;&nbsp;| <span class="id">SCondBinary</span> : <span class="id">sql_bin_cond</span> -&gt; <span class="id">sql_expr</span> -&gt; <span class="id">sql_expr</span> -&gt; <span class="id">sql_condition</span><br/>
&nbsp;&nbsp;| <span class="id">SCondExists</span> : <span class="id">sql_query</span> -&gt; <span class="id">sql_condition</span><br/>
&nbsp;&nbsp;| <span class="id">SCondIn</span> : <span class="id">sql_expr</span> -&gt; <span class="id">sql_expr</span> -&gt; <span class="id">sql_condition</span><br/>
&nbsp;&nbsp;| <span class="id">SCondLike</span> : <span class="id">sql_expr</span> -&gt; <span class="id">string</span> -&gt; <span class="id">sql_condition</span><br/>
&nbsp;&nbsp;| <span class="id">SCondBetween</span> : <span class="id">sql_expr</span> -&gt; <span class="id">sql_expr</span> -&gt; <span class="id">sql_expr</span> -&gt; <span class="id">sql_condition</span><br/>
&nbsp;&nbsp;<span class="kwd">with</span> <span class="id">sql_expr</span> : <span class="kwd">Set</span> :=<br/>
&nbsp;&nbsp;| <span class="id">SExprConst</span> : <span class="id">data</span> -&gt; <span class="id">sql_expr</span><br/>
&nbsp;&nbsp;| <span class="id">SExprColumn</span> : <span class="id">string</span> -&gt; <span class="id">sql_expr</span><br/>
&nbsp;&nbsp;| <span class="id">SExprColumnDeref</span> : <span class="id">string</span> -&gt; <span class="id">string</span> -&gt; <span class="id">sql_expr</span><br/>
&nbsp;&nbsp;| <span class="id">SExprStar</span> : <span class="id">sql_expr</span><br/>
&nbsp;&nbsp;| <span class="id">SExprUnary</span> : <span class="id">sql_un_expr</span> -&gt; <span class="id">sql_expr</span> -&gt; <span class="id">sql_expr</span><br/>
&nbsp;&nbsp;| <span class="id">SExprBinary</span> : <span class="id">sql_bin_expr</span> -&gt; <span class="id">sql_expr</span> -&gt; <span class="id">sql_expr</span> -&gt; <span class="id">sql_expr</span><br/>
&nbsp;&nbsp;| <span class="id">SExprCase</span> : <span class="id">sql_condition</span> -&gt; <span class="id">sql_expr</span> -&gt; <span class="id">sql_expr</span> -&gt; <span class="id">sql_expr</span><br/>
&nbsp;&nbsp;| <span class="id">SExprAggExpr</span> : <span class="id">sql_agg</span> -&gt; <span class="id">sql_expr</span> -&gt; <span class="id">sql_expr</span><br/>
&nbsp;&nbsp;| <span class="id">SExprQuery</span> : <span class="id">sql_query</span> -&gt; <span class="id">sql_expr</span> <br/>
&nbsp;&nbsp;.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Inductive</span> <span class="id">sql_statement</span> : <span class="kwd">Set</span> :=<br/>
&nbsp;&nbsp;| <span class="id">SRunQuery</span> : <span class="id">sql_query</span> -&gt; <span class="id">sql_statement</span><br/>
&nbsp;&nbsp;| <span class="id">SCreateView</span> : <span class="id">string</span> -&gt; <span class="id">sql_query</span> -&gt; <span class="id">sql_statement</span><br/>
&nbsp;&nbsp;| <span class="id">SDropView</span> : <span class="id">string</span> -&gt; <span class="id">sql_statement</span><br/>
&nbsp;&nbsp;.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id">sql</span> : <span class="kwd">Set</span> := <span class="id">list</span> <span class="id">sql_statement</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Fixpoint</span> <span class="id">is_singleton_sql_query</span> (<span class="id">q</span>:<span class="id">sql_query</span>) : <span class="id">bool</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">q</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">SUnion</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> =&gt; <span class="id">false</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">SIntersect</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> =&gt; <span class="id">false</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">SExcept</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> =&gt; <span class="id">false</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">SQuery</span> (<span class="id">SSelectExpr</span> <span class="id">_</span> <span class="id">expr</span> :: <span class="id">nil</span>) <span class="id">_</span> <span class="id">_</span> <span class="id">None</span> <span class="id">None</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">is_singleton_sql_expr</span> <span class="id">expr</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">SQuery</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> =&gt; <span class="id">false</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span><br/>
&nbsp;&nbsp;<span class="kwd">with</span> <span class="id">is_singleton_sql_expr</span> (<span class="id">expr</span>:<span class="id">sql_expr</span>) : <span class="id">bool</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">expr</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">SExprConst</span> <span class="id">_</span> =&gt; <span class="id">true</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">SExprColumn</span> <span class="id">_</span> =&gt; <span class="id">false</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">SExprColumnDeref</span> <span class="id">_</span> <span class="id">_</span> =&gt; <span class="id">false</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">SExprStar</span> =&gt; <span class="id">false</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">SExprUnary</span> <span class="id">_</span> <span class="id">expr1</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">is_singleton_sql_expr</span> <span class="id">expr1</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">SExprBinary</span> <span class="id">_</span> <span class="id">expr1</span> <span class="id">expr2</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">is_singleton_sql_expr</span> <span class="id">expr1</span> &amp;&amp; <span class="id">is_singleton_sql_expr</span> <span class="id">expr2</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">SExprCase</span> <span class="id">_</span> <span class="id">expr1</span> <span class="id">expr2</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">is_singleton_sql_expr</span> <span class="id">expr1</span> &amp;&amp; <span class="id">is_singleton_sql_expr</span> <span class="id">expr2</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">SExprAggExpr</span> <span class="id">_</span> <span class="id">_</span> =&gt; <span class="id">true</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">SExprQuery</span> <span class="id">q</span> =&gt; <span class="id">is_singleton_sql_query</span> <span class="id">q</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
&nbsp;&nbsp;<br/>
&nbsp;&nbsp;<br/>
&nbsp;&nbsp;<span class="kwd">Fixpoint</span> <span class="id">is_value_sequence_sql_query</span> (<span class="id">q</span>:<span class="id">sql_query</span>) : <span class="id">bool</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">q</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">SUnion</span> <span class="id">_</span> <span class="id">q1</span> <span class="id">q2</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">if</span> <span class="id">is_value_sequence_sql_query</span> <span class="id">q1</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">then</span> <span class="id">is_value_sequence_sql_query</span> <span class="id">q2</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">else</span> <span class="id">false</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">SIntersect</span> <span class="id">_</span> <span class="id">q1</span> <span class="id">q2</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">if</span> <span class="id">is_value_sequence_sql_query</span> <span class="id">q1</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">then</span> <span class="id">is_value_sequence_sql_query</span> <span class="id">q2</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">else</span> <span class="id">false</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">SExcept</span> <span class="id">_</span> <span class="id">q1</span> <span class="id">q2</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">if</span> <span class="id">is_value_sequence_sql_query</span> <span class="id">q1</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">then</span> <span class="id">is_value_sequence_sql_query</span> <span class="id">q2</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">else</span> <span class="id">false</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">SQuery</span> (<span class="id">SSelectExpr</span> <span class="id">_</span> <span class="id">expr</span> :: <span class="id">nil</span>) <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">if</span> (<span class="id">is_singleton_sql_expr</span> <span class="id">expr</span>) <span class="kwd">then</span> <span class="id">false</span> <span class="kwd">else</span> <span class="id">true</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">SQuery</span> (<span class="id">SSelectColumn</span> <span class="id">_</span> :: <span class="id">nil</span>) <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> =&gt; <span class="id">true</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">SQuery</span> (<span class="id">SSelectColumnDeref</span> <span class="id">_</span> <span class="id">_</span> :: <span class="id">nil</span>) <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> =&gt; <span class="id">true</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">SQuery</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> =&gt; <span class="id">false</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Section</span> <span class="id">FreeVars</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Fixpoint</span> <span class="id">sql_query_free_variables</span> (<span class="id">q</span>:<span class="id">sql_query</span>) : <span class="id">list</span> <span class="id">string</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">q</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">SQuery</span> <span class="id">q_select_clause</span> <span class="id">q_from_clause</span> (<span class="id">Some</span> <span class="id">q_where_cond</span>) (<span class="id">Some</span> (<span class="id">ls</span>,<span class="id">Some</span> <span class="id">q_groupby_cond</span>)) <span class="id">_</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">concat</span> (<span class="id">map</span> <span class="id">sql_select_free_variables</span> <span class="id">q_select_clause</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;++ (<span class="id">concat</span> (<span class="id">map</span> <span class="id">sql_from_free_variables</span> <span class="id">q_from_clause</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;++ (<span class="id">sql_condition_free_variables</span> <span class="id">q_where_cond</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;++ (<span class="id">sql_condition_free_variables</span> <span class="id">q_groupby_cond</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">SQuery</span> <span class="id">q_select_clause</span> <span class="id">q_from_clause</span> <span class="id">None</span> (<span class="id">Some</span> (<span class="id">ls</span>,<span class="id">Some</span> <span class="id">q_groupby_cond</span>)) <span class="id">_</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">concat</span> (<span class="id">map</span> <span class="id">sql_select_free_variables</span> <span class="id">q_select_clause</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;++ (<span class="id">concat</span> (<span class="id">map</span> <span class="id">sql_from_free_variables</span> <span class="id">q_from_clause</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;++ (<span class="id">sql_condition_free_variables</span> <span class="id">q_groupby_cond</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">SQuery</span> <span class="id">q_select_clause</span> <span class="id">q_from_clause</span> (<span class="id">Some</span> <span class="id">q_where_cond</span>) <span class="id">_</span> <span class="id">_</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">concat</span> (<span class="id">map</span> <span class="id">sql_select_free_variables</span> <span class="id">q_select_clause</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;++ (<span class="id">concat</span> (<span class="id">map</span> <span class="id">sql_from_free_variables</span> <span class="id">q_from_clause</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;++ (<span class="id">sql_condition_free_variables</span> <span class="id">q_where_cond</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">SQuery</span> <span class="id">q_select_clause</span> <span class="id">q_from_clause</span> <span class="id">None</span> <span class="id">_</span> <span class="id">_</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">concat</span> (<span class="id">map</span> <span class="id">sql_select_free_variables</span> <span class="id">q_select_clause</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;++ (<span class="id">concat</span> (<span class="id">map</span> <span class="id">sql_from_free_variables</span> <span class="id">q_from_clause</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">SUnion</span> <span class="id">_</span> <span class="id">q1</span> <span class="id">q2</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">sql_query_free_variables</span> <span class="id">q1</span> ++ <span class="id">sql_query_free_variables</span> <span class="id">q2</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">SIntersect</span> <span class="id">_</span> <span class="id">q1</span> <span class="id">q2</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">sql_query_free_variables</span> <span class="id">q1</span> ++ <span class="id">sql_query_free_variables</span> <span class="id">q2</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">SExcept</span> <span class="id">_</span> <span class="id">q1</span> <span class="id">q2</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">sql_query_free_variables</span> <span class="id">q1</span> ++ <span class="id">sql_query_free_variables</span> <span class="id">q2</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">with</span> <span class="id">sql_expr_free_variables</span> (<span class="id">q_expr</span>:<span class="id">sql_expr</span>) : <span class="id">list</span> <span class="id">string</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">q_expr</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">SExprConst</span> <span class="id">d</span> =&gt; <span class="id">nil</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">SExprColumn</span> <span class="id">s</span> =&gt; <span class="id">nil</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">SExprColumnDeref</span> <span class="id">s1</span> <span class="id">s2</span> =&gt; <span class="id">nil</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">SExprStar</span> =&gt; <span class="id">nil</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">SExprUnary</span> <span class="id">un</span> <span class="id">q_expr1</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">sql_expr_free_variables</span> <span class="id">q_expr1</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">SExprBinary</span> <span class="id">bin</span> <span class="id">q_expr1</span> <span class="id">q_expr2</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">sql_expr_free_variables</span> <span class="id">q_expr1</span> ++ <span class="id">sql_expr_free_variables</span> <span class="id">q_expr2</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">SExprCase</span> <span class="id">q_cond</span> <span class="id">q_expr1</span> <span class="id">q_expr2</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">sql_condition_free_variables</span> <span class="id">q_cond</span> ++<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">sql_expr_free_variables</span> <span class="id">q_expr1</span> ++ <span class="id">sql_expr_free_variables</span> <span class="id">q_expr2</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">SExprAggExpr</span> <span class="id">agg</span> <span class="id">q_expr1</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">sql_expr_free_variables</span> <span class="id">q_expr1</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">SExprQuery</span> <span class="id">q</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">sql_query_free_variables</span> <span class="id">q</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">with</span> <span class="id">sql_select_free_variables</span> (<span class="id">q_select</span>:<span class="id">sql_select</span>) : <span class="id">list</span> <span class="id">string</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">q_select</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">SSelectColumn</span> <span class="id">s</span> =&gt; <span class="id">nil</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">SSelectColumnDeref</span> <span class="id">s1</span> <span class="id">s2</span> =&gt; <span class="id">nil</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">SSelectStar</span> =&gt; <span class="id">nil</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">SSelectExpr</span> <span class="id">s</span> <span class="id">q_expr</span> =&gt; <span class="id">sql_expr_free_variables</span> <span class="id">q_expr</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">with</span> <span class="id">sql_from_free_variables</span> (<span class="id">q_from</span>:<span class="id">sql_from</span>) : <span class="id">list</span> <span class="id">string</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">q_from</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">SFromTable</span> <span class="id">tablename</span> =&gt; <span class="id">tablename</span> :: <span class="id">nil</span> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">SFromTableAlias</span> <span class="id">aliasname</span> <span class="id">tablename</span> =&gt; <span class="id">tablename</span> :: <span class="id">nil</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">SFromQuery</span> <span class="id">ts</span> <span class="id">q</span> =&gt; <span class="id">sql_query_free_variables</span> <span class="id">q</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">with</span> <span class="id">sql_condition_free_variables</span> (<span class="id">q_cond</span>:<span class="id">sql_condition</span>) : <span class="id">list</span> <span class="id">string</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">q_cond</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">SCondAnd</span> <span class="id">q_cond1</span> <span class="id">q_cond2</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">sql_condition_free_variables</span> <span class="id">q_cond1</span> ++ <span class="id">sql_condition_free_variables</span> <span class="id">q_cond2</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">SCondOr</span> <span class="id">q_cond1</span> <span class="id">q_cond2</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">sql_condition_free_variables</span> <span class="id">q_cond1</span> ++ <span class="id">sql_condition_free_variables</span> <span class="id">q_cond2</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">SCondNot</span> <span class="id">q_cond1</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">sql_condition_free_variables</span> <span class="id">q_cond1</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">SCondBinary</span> <span class="id">bin</span> <span class="id">q_expr1</span> <span class="id">q_expr2</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">sql_expr_free_variables</span> <span class="id">q_expr1</span> ++ <span class="id">sql_expr_free_variables</span> <span class="id">q_expr2</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">SCondExists</span> <span class="id">q_query</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">sql_query_free_variables</span> <span class="id">q_query</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">SCondIn</span> <span class="id">q_expr1</span> <span class="id">q_expr2</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">sql_expr_free_variables</span> <span class="id">q_expr1</span> ++ <span class="id">sql_expr_free_variables</span> <span class="id">q_expr2</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">SCondLike</span> <span class="id">q_expr1</span> <span class="id">s</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">sql_expr_free_variables</span> <span class="id">q_expr1</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">SCondBetween</span> <span class="id">q_expr1</span> <span class="id">q_expr2</span> <span class="id">q_expr3</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">sql_expr_free_variables</span> <span class="id">q_expr1</span> ++ <span class="id">sql_expr_free_variables</span> <span class="id">q_expr2</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;++ <span class="id">sql_expr_free_variables</span> <span class="id">q_expr3</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id">sql_statement_free_variables</span> (<span class="id">q</span>:<span class="id">sql_statement</span>) : <span class="id">list</span> <span class="id">string</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">q</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">SRunQuery</span> <span class="id">q</span> =&gt; <span class="id">sql_query_free_variables</span> <span class="id">q</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">SCreateView</span> <span class="id">s</span> <span class="id">q</span> =&gt; <span class="id">sql_query_free_variables</span> <span class="id">q</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">SDropView</span> <span class="id">s</span> =&gt; <span class="id">nil</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id">sql_free_vars</span> (<span class="id">q</span>:<span class="id">sql</span>) : <span class="id">list</span> <span class="id">string</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">bdistinct</span> (<span class="id">concat</span> (<span class="id">map</span> <span class="id">sql_statement_free_variables</span> <span class="id">q</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<br/>
&nbsp;&nbsp;<span class="kwd">End</span> <span class="id">FreeVars</span>.<br/>
<span class="kwd">End</span> <span class="id">SQL</span>.<br/>
<br/>

</div>
<div class="footer"><hr/>Generated by <a href="https://github.com/xavierleroy/coq2html/">coq2html</div>
</body>
</html>
