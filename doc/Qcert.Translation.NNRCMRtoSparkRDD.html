
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Module Qcert.Translation.NNRCMRtoSparkRDD</title>
<meta name="description" content="Documentation of Coq module Qcert.Translation.NNRCMRtoSparkRDD" />
<link href="coq2html.css" rel="stylesheet" type="text/css" />
<script type="text/javascript" src="coq2html.js"> </script>
</head>

<body onload="hideAll('proofscript')">
<h1 class="title">Module Qcert.Translation.NNRCMRtoSparkRDD</h1>
<div class="coq">
<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id">List</span>.<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id">String</span>.<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id">EquivDec</span>.<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id">BasicRuntime</span>.<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id">NNRCRuntime</span>.<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id">NNRCMRRuntime</span>.<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id">NNRCtoJavaScript</span>.<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id">ForeignToJavaScript</span>.<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id">ForeignToSpark</span>.<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id">SparkRDDRuntime</span>.<br/>
<br/>
<span class="kwd">Local</span> <span class="kwd">Open</span> <span class="kwd">Scope</span> <span class="id">string_scope</span>.<br/>
<br/>
<span class="kwd">Section</span> <span class="id">NNRCMRtoSparkRDD</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Context</span> {<span class="id">fruntime</span>:<span class="id">foreign_runtime</span>}.<br/>
&nbsp;&nbsp;<span class="kwd">Context</span> {<span class="id">fredop</span>:<span class="id">foreign_reduce_op</span>}.<br/>
&nbsp;&nbsp;<span class="kwd">Context</span> {<span class="id">ftojavascript</span>:<span class="id">foreign_to_javascript</span>}.<br/>
&nbsp;&nbsp;<span class="kwd">Context</span> {<span class="id">ftospark</span>:<span class="id">foreign_to_spark</span>}.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id">js_endl</span> := <span class="id">eol_backn</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Section</span> <span class="id">sanitize</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Import</span> <span class="id">ListNotations</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id">Ascii</span> <span class="id">String</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id">scalaAllowedIdentifierInitialCharacters</span> := ["<span class="id">A</span>";"<span class="id">B</span>";"<span class="id">C</span>";"<span class="id">D</span>";"<span class="id">E</span>";"<span class="id">F</span>";"<span class="id">G</span>";"<span class="id">H</span>";"<span class="id">I</span>";"<span class="id">J</span>";"<span class="id">K</span>";"<span class="id">L</span>";"<span class="id">M</span>";"<span class="id">N</span>";"<span class="id">O</span>";"<span class="id">P</span>";"<span class="id">Q</span>";"<span class="id">R</span>";"<span class="id">S</span>";"<span class="id">T</span>";"<span class="id">U</span>";"<span class="id">V</span>";"<span class="id">W</span>";"<span class="id">X</span>";"<span class="id">Y</span>";"<span class="id">Z</span>";"<span class="id">a</span>";"<span class="id">b</span>";"<span class="id">c</span>";"<span class="id">d</span>";"<span class="id">e</span>";"<span class="id">f</span>";"<span class="id">g</span>";"<span class="id">h</span>";"<span class="id">i</span>";"<span class="id">j</span>";"<span class="id">k</span>";"<span class="id">l</span>";"<span class="id">m</span>";"<span class="id">n</span>";"<span class="id">o</span>";"<span class="id">p</span>";"<span class="id">q</span>";"<span class="id">r</span>";"<span class="id">s</span>";"<span class="id">t</span>";"<span class="id">u</span>";"<span class="id">v</span>";"<span class="id">w</span>";"<span class="id">x</span>";"<span class="id">y</span>";"<span class="id">z</span>"]%<span class="id">char</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id">scalaAllowedIdentifierCharacters</span> := ["<span class="id">A</span>";"<span class="id">B</span>";"<span class="id">C</span>";"<span class="id">D</span>";"<span class="id">E</span>";"<span class="id">F</span>";"<span class="id">G</span>";"<span class="id">H</span>";"<span class="id">I</span>";"<span class="id">J</span>";"<span class="id">K</span>";"<span class="id">L</span>";"<span class="id">M</span>";"<span class="id">N</span>";"<span class="id">O</span>";"<span class="id">P</span>";"<span class="id">Q</span>";"<span class="id">R</span>";"<span class="id">S</span>";"<span class="id">T</span>";"<span class="id">U</span>";"<span class="id">V</span>";"<span class="id">W</span>";"<span class="id">X</span>";"<span class="id">Y</span>";"<span class="id">Z</span>";"<span class="id">a</span>";"<span class="id">b</span>";"<span class="id">c</span>";"<span class="id">d</span>";"<span class="id">e</span>";"<span class="id">f</span>";"<span class="id">g</span>";"<span class="id">h</span>";"<span class="id">i</span>";"<span class="id">j</span>";"<span class="id">k</span>";"<span class="id">l</span>";"<span class="id">m</span>";"<span class="id">n</span>";"<span class="id">o</span>";"<span class="id">p</span>";"<span class="id">q</span>";"<span class="id">r</span>";"<span class="id">s</span>";"<span class="id">t</span>";"<span class="id">u</span>";"<span class="id">v</span>";"<span class="id">w</span>";"<span class="id">x</span>";"<span class="id">y</span>";"<span class="id">z</span>";"0";"1";"2";"3";"4";"5";"6";"7";"8";"9";"<span class="id">_</span>"]%<span class="id">char</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id">scalaIdentifierInitialCharacterToAdd</span> := "<span class="id">X</span>"%<span class="id">char</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id">scalaIdenitiferCharacterForReplacement</span> := "<span class="id">X</span>"%<span class="id">char</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id">scalaIdentifierFixInitial</span> (<span class="id">ident</span>:<span class="id">string</span>) : <span class="id">string</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:= <span class="kwd">match</span> <span class="id">ident</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">EmptyString</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">String</span> <span class="id">scalaIdentifierInitialCharacterToAdd</span> <span class="id">EmptyString</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">String</span> <span class="id">a</span> <span class="id">_</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">if</span> <span class="id">in_dec</span> <span class="id">ascii_dec</span> <span class="id">a</span> <span class="id">scalaAllowedIdentifierInitialCharacters</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">then</span> <span class="id">ident</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">else</span> <span class="id">String</span> <span class="id">scalaIdentifierInitialCharacterToAdd</span> <span class="id">ident</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id">scalaIdentifierSanitizeChar</span> (<span class="id">a</span>:<span class="id">ascii</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:= <span class="kwd">if</span> <span class="id">a</span> == "$"%<span class="id">char</span> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">then</span> "<span class="id">_</span>"%<span class="id">char</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">else</span> <span class="kwd">if</span> <span class="id">in_dec</span> <span class="id">ascii_dec</span> <span class="id">a</span> <span class="id">scalaAllowedIdentifierCharacters</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">then</span> <span class="id">a</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">else</span> <span class="id">scalaIdenitiferCharacterForReplacement</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id">scalaIdentifierSanitizeBody</span> (<span class="id">ident</span>:<span class="id">string</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:= <span class="id">map_string</span> <span class="id">scalaIdentifierSanitizeChar</span> <span class="id">ident</span>.<br/>
&nbsp;&nbsp;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id">scalaIdentifierSanitize</span> (<span class="id">ident</span>:<span class="id">string</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:= <span class="id">scalaIdentifierFixInitial</span> (<span class="id">scalaIdentifierSanitizeBody</span> <span class="id">ident</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id">scalaSafeSeparator</span> := "<span class="id">_</span>".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id">scalaAvoidList</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;["<span class="id">abstract</span>"; "<span class="tactic">case</span>"; "<span class="id">catch</span>"; "<span class="id">class</span>"; "<span class="id">def</span>"; "<span class="tactic">do</span>" ; "<span class="kwd">else</span>"; "<span class="id">extends</span>"<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;; "<span class="id">false</span>"; "<span class="id">final</span>"; "<span class="id">finally</span>"; "<span class="kwd">for</span>"; "<span class="id">forSome</span>"; "<span class="kwd">if</span>" ; "<span class="id">implicit</span>"; "<span class="id">import</span>"<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;; "<span class="id">lazy</span>"; "<span class="kwd">match</span>"; "<span class="id">new</span>"; "<span class="id">null</span>"; "<span class="id">object</span>"; "<span class="id">override</span>"<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;; "<span class="id">package</span>"; "<span class="id">private</span>"; "<span class="id">protected</span>"; "<span class="kwd">return</span>"; "<span class="id">sealed</span>"; "<span class="id">super</span>";<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"<span class="id">this</span>"; "<span class="id">throw</span>"; "<span class="id">trait</span>"; "<span class="tactic">try</span>"; "<span class="id">true</span>"; "<span class="id">type</span>"; "<span class="id">val</span>"; "<span class="id">var</span>"<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;; "<span class="id">while</span>"; "<span class="kwd">with</span>"; "<span class="id">yield</span>"].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id">nnrcmr_rename_local_for_js</span> (<span class="id">mrl</span>:<span class="id">nnrcmr</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:= <span class="id">nnrcmr_rename_local</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">jsSafeSeparator</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">jsIdentifierSanitize</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">jsAvoidList</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">mrl</span>.<br/>
&nbsp;&nbsp;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id">nnrcmr_rename_graph_for_scala</span> (<span class="id">mrl</span>:<span class="id">nnrcmr</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:= <span class="id">nnrcmr_rename_graph</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">scalaSafeSeparator</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">scalaIdentifierSanitize</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">scalaAvoidList</span> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">mrl</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id">nnrcmr_rename_for_spark</span> (<span class="id">mrl</span>:<span class="id">nnrcmr</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:= <span class="id">nnrcmr_rename_graph_for_scala</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">nnrcmr_rename_local_for_js</span> <span class="id">mrl</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<br/>
&nbsp;&nbsp;<span class="kwd">End</span> <span class="id">sanitize</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<br/>
&nbsp;&nbsp;<span class="kwd">Section</span> <span class="id">MRSpark</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id">rdd_env_id</span> (<span class="id">x</span>: <span class="id">string</span>) :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"<span class="id">RDD</span>"++(<span class="id">scalaIdentifierSanitize</span> <span class="id">x</span>).<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id">rdd_map_id</span> (<span class="id">x</span>: <span class="id">string</span>) :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"<span class="id">RDDMap_</span>"++(<span class="id">scalaIdentifierSanitize</span> <span class="id">x</span>).<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id">rdd_reduce_id</span> (<span class="id">x</span>: <span class="id">string</span>) :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"<span class="id">RDDReduce_</span>"++(<span class="id">scalaIdentifierSanitize</span> <span class="id">x</span>).<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id">attr_id</span> (<span class="id">x</span>: <span class="id">string</span>) :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"'"++<span class="id">x</span>++"'".<br/>
<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id">get_engine_func</span> (<span class="id">scala_endl</span>:<span class="id">string</span>) :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"<span class="id">var</span> <span class="id">engine</span> : <span class="id">Option</span>[<span class="id">javax.script.ScriptEngine</span>] = <span class="id">None</span>" ++ <span class="id">scala_endl</span> ++<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"<span class="id">def</span> <span class="id">get_engine</span>() : <span class="id">javax.script.ScriptEngine</span> = {" ++ <span class="id">scala_endl</span> ++<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"  <span class="id">val</span> <span class="id">factory</span> = <span class="id">new</span> <span class="id">javax.script.ScriptEngineManager</span>" ++ <span class="id">scala_endl</span> ++<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"  <span class="id">val</span> <span class="id">new_engine</span> = <span class="id">factory.getEngineByName</span>(""<span class="id">JavaScript</span>"")" ++ <span class="id">scala_endl</span> ++<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"  <span class="id">load_harness</span>(<span class="id">new_engine</span>)" ++ <span class="id">scala_endl</span> ++<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"  <span class="kwd">return</span> (<span class="id">new_engine</span>)" ++ <span class="id">scala_endl</span> ++<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"}" ++ <span class="id">scala_endl</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id">array_of_js_func_v7</span> (<span class="id">scala_endl</span>:<span class="id">string</span>) :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"<span class="id">def</span> <span class="id">array_of_js</span>(<span class="id">e</span>: <span class="id">javax.script.ScriptEngine</span>, <span class="id">js_arr</span>: <span class="id">Object</span>): <span class="id">Array</span>[<span class="id">String</span>] = {" ++ <span class="id">scala_endl</span> ++<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"  <span class="id">e.put</span>(""<span class="id">js_arr</span>"", <span class="id">js_arr</span>)" ++ <span class="id">scala_endl</span> ++<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"  <span class="id">val</span> <span class="id">jarr</span> = <span class="id">e.eval</span>(""<span class="id">js_arr.map</span>(<span class="id">function</span>(<span class="id">elem</span>){ <span class="kwd">return</span> <span class="id">JSON.stringify</span>(<span class="id">elem</span>); })"").<span class="id">asInstanceOf</span>[<span class="id">jdk.nashorn.api.scripting.ScriptObjectMirror</span>].<span class="id">to</span>(<span class="id">classOf</span>[<span class="id">jdk.nashorn.internal.runtime.ScriptObject</span>])" ++ <span class="id">scala_endl</span> ++<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"  <span class="id">val</span> <span class="id">arr</span> = <span class="id">jarr.getArray</span>().<span class="id">asObjectArray</span>()" ++ <span class="id">scala_endl</span> ++<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"  <span class="id">val</span> <span class="id">sarr</span> = <span class="id">arr.map</span>(<span class="id">_.toString</span>())" ++ <span class="id">scala_endl</span> ++<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"  <span class="kwd">return</span> <span class="id">sarr</span>" ++ <span class="id">scala_endl</span> ++<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"}" ++ <span class="id">scala_endl</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id">array_of_js_func_v8</span> (<span class="id">scala_endl</span>:<span class="id">string</span>) :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"<span class="id">def</span> <span class="id">array_of_js</span>(<span class="id">e</span>: <span class="id">javax.script.ScriptEngine</span>, <span class="id">js_arr</span>: <span class="id">Object</span>): <span class="id">Array</span>[<span class="id">String</span>] = {" ++ <span class="id">scala_endl</span> ++<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"  <span class="id">e.put</span>(""<span class="id">js_arr</span>"", <span class="id">js_arr</span>)" ++ <span class="id">scala_endl</span> ++<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"  <span class="id">val</span> <span class="id">jarr</span> = <span class="id">e.eval</span>(""<span class="id">js_arr.map</span>(<span class="id">function</span>(<span class="id">elem</span>){ <span class="kwd">return</span> <span class="id">JSON.stringify</span>(<span class="id">elem</span>); })"").<span class="id">asInstanceOf</span>[<span class="id">jdk.nashorn.api.scripting.ScriptObjectMirror</span>].<span class="id">to</span>(<span class="id">classOf</span>[<span class="id">jdk.nashorn.internal.runtime.ScriptObject</span>])" ++ <span class="id">scala_endl</span> ++<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"  <span class="id">val</span> <span class="id">arr</span> = <span class="id">jarr.getArray</span>().<span class="id">asObjectArray</span>()" ++ <span class="id">scala_endl</span> ++<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"  <span class="id">val</span> <span class="id">sarr</span> = <span class="id">arr.map</span>(<span class="id">_.toString</span>())" ++ <span class="id">scala_endl</span> ++<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"  <span class="kwd">return</span> <span class="id">sarr</span>" ++ <span class="id">scala_endl</span> ++<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"}" ++ <span class="id">scala_endl</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id">array_of_js_func</span> := <span class="id">array_of_js_func_v8</span>.<br/>
<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id">js_of_iterable_func</span> (<span class="id">scala_endl</span>:<span class="id">string</span>) :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"<span class="id">def</span> <span class="id">js_of_iterable</span>(<span class="id">coll</span>: <span class="id">Iterable</span>[<span class="id">String</span>]): <span class="id">String</span> = {" ++ <span class="id">scala_endl</span> ++<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"  /* <span class="id">Hack</span>! */" ++ <span class="id">scala_endl</span> ++<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"  <span class="id">var</span> <span class="id">values</span> = ""[ """ ++ <span class="id">scala_endl</span> ++<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"  <span class="id">var</span> <span class="id">first</span> = <span class="id">true</span>" ++ <span class="id">scala_endl</span> ++<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"  <span class="kwd">for</span> (<span class="id">elem</span> &lt;- <span class="id">coll</span>) {" ++ <span class="id">scala_endl</span> ++<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"    <span class="kwd">if</span> (!<span class="id">first</span>) {" ++ <span class="id">scala_endl</span> ++<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"      <span class="id">values</span> = <span class="id">values</span> + "", """ ++ <span class="id">scala_endl</span> ++<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"    }" ++ <span class="id">scala_endl</span> ++<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"    <span class="id">values</span> = <span class="id">values</span> + <span class="id">elem</span>" ++ <span class="id">scala_endl</span> ++<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"    <span class="id">first</span> = <span class="id">false</span>" ++ <span class="id">scala_endl</span> ++<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"  }" ++ <span class="id">scala_endl</span> ++<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"  <span class="id">values</span> = <span class="id">values</span> + "" ]""" ++ <span class="id">scala_endl</span> ++<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"  <span class="id">values</span>" ++ <span class="id">scala_endl</span> ++<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"}" ++ <span class="id">scala_endl</span>.<br/>
<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id">load_harness_from_file_func</span> (<span class="id">scala_endl</span>:<span class="id">string</span>) (<span class="id">quotel</span>:<span class="id">string</span>) :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"<span class="id">def</span> <span class="id">load_harness</span>(<span class="id">e</span>:<span class="id">javax.script.ScriptEngine</span>) {" ++ <span class="id">scala_endl</span> ++<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"  <span class="id">e.eval</span>(<span class="id">new</span> <span class="id">java.io.FileReader</span>(<span class="id">dataFile</span>))" ++ <span class="id">scala_endl</span> ++<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"  <span class="id">e.eval</span>(<span class="id">new</span> <span class="id">java.io.FileReader</span>(<span class="id">harnessFile</span>))" ++ <span class="id">scala_endl</span> ++<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"}" ++ <span class="id">scala_endl</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id">load_env_defs</span> (<span class="id">init</span>: <span class="id">string</span>) (<span class="id">scala_endl</span>:<span class="id">string</span>) (<span class="id">quotel</span>:<span class="id">string</span>) :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"<span class="id">def</span> <span class="id">mkWorld</span>(<span class="id">e</span>: <span class="id">javax.script.ScriptEngine</span>) : <span class="id">Object</span> = {" ++ <span class="id">scala_endl</span> ++<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"  /* <span class="id">XXX</span> <span class="id">Should</span> <span class="id">be</span> <span class="id">updated</span> <span class="id">to</span> <span class="id">use</span> <span class="id">the</span> <span class="id">new</span> <span class="id">io</span> <span class="id">format</span> <span class="id">XXX</span> */" ++ <span class="id">scala_endl</span> ++<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"  <span class="id">e.eval</span>(<span class="id">new</span> <span class="id">java.io.FileReader</span>(<span class="id">dataFile</span>))" ++ <span class="id">scala_endl</span> ++<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"  <span class="id">e.eval</span>(""<span class="id">var</span> <span class="id">world</span> = <span class="id">mkWorld</span>(<span class="id">input</span>)"")" ++ <span class="id">scala_endl</span> ++<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"  <span class="id">e.eval</span>(""<span class="id">world</span>["++(<span class="id">attr_id</span> <span class="id">init</span>)++"] = <span class="id">null</span>"")" ++ <span class="id">scala_endl</span> ++<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"  <span class="id">e.eval</span>(""<span class="id">world</span>"")" ++ <span class="id">scala_endl</span> ++<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"}" ++ <span class="id">scala_endl</span> ++<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"<span class="id">def</span> <span class="id">loadScalar</span>(<span class="id">e</span>: <span class="id">javax.script.ScriptEngine</span>, <span class="id">sc</span>: <span class="id">SparkContext</span>, <span class="id">world</span>: <span class="id">Object</span>, <span class="id">attr</span>: <span class="id">String</span>) : <span class="id">org.apache.spark.rdd.RDD</span>[<span class="id">String</span>] = {" ++ <span class="id">scala_endl</span> ++<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"  <span class="id">e.put</span>(""<span class="id">world</span>"", <span class="id">world</span>)" ++ <span class="id">scala_endl</span> ++<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"  <span class="id">val</span> <span class="id">coll</span> = <span class="id">array_of_js</span>(<span class="id">e</span>, <span class="id">e.eval</span>(""[ <span class="id">world</span>[""+<span class="id">attr</span>+""] ]""))" ++ <span class="id">scala_endl</span> ++<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"  <span class="id">sc.parallelize</span>(<span class="id">coll</span>)" ++ <span class="id">scala_endl</span> ++<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"}" ++ <span class="id">scala_endl</span> ++<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"<span class="id">def</span> <span class="id">loadDistributed</span>(<span class="id">e</span>: <span class="id">javax.script.ScriptEngine</span>, <span class="id">sc</span>: <span class="id">SparkContext</span>, <span class="id">world</span>: <span class="id">Object</span>, <span class="id">attr</span>: <span class="id">String</span>): <span class="id">org.apache.spark.rdd.RDD</span>[<span class="id">String</span>] = {" ++ <span class="id">scala_endl</span> ++<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"  <span class="id">e.put</span>(""<span class="id">world</span>"", <span class="id">world</span>)" ++ <span class="id">scala_endl</span> ++<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"  <span class="id">val</span> <span class="id">coll</span> = <span class="id">array_of_js</span>(<span class="id">e</span>, <span class="id">e.eval</span>(""<span class="id">world</span>[""+<span class="id">attr</span>+""]""))" ++ <span class="id">scala_endl</span> ++<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"  <span class="id">sc.parallelize</span>(<span class="id">coll</span>)" ++ <span class="id">scala_endl</span> ++<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"}" ++ <span class="id">scala_endl</span>.<br/>
<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">var_loc_eq_dec</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">x_loc</span> <span class="id">y_loc</span> : (<span class="id">var</span> * <span class="id">dlocalization</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">x_loc</span> = <span class="id">y_loc</span> } + { <span class="id">x_loc</span> &lt;&gt; <span class="id">y_loc</span> }.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof3026')">Proof.</div>
<div class="proofscript" id="proof3026">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">x_loc</span> <span class="kwd">as</span> [ <span class="id">x</span> <span class="id">loc1</span> ]; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">y_loc</span> <span class="kwd">as</span> [ <span class="id">y</span> <span class="id">loc2</span> ]; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">pair_eq_dec</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">apply</span> <span class="id">string_dec</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">apply</span> <span class="id">dlocalization_eq_dec</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Defined.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id">load_env</span> (<span class="id">env_vars</span>: <span class="id">list</span> (<span class="id">var</span> * <span class="id">dlocalization</span>)) (<span class="id">scala_endl</span>:<span class="id">string</span>) (<span class="id">quotel</span>:<span class="id">string</span>) :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">env_vars</span> := <span class="id">List.nodup</span> <span class="id">var_loc_eq_dec</span> <span class="id">env_vars</span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"<span class="id">val</span> <span class="id">e</span> = <span class="id">get_engine</span>()" ++ <span class="id">scala_endl</span> ++<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"<span class="id">val</span> <span class="id">world</span> = <span class="id">mkWorld</span>(<span class="id">e</span>)" ++ <span class="id">scala_endl</span> ++<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">List.fold_left</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">fun</span> <span class="id">acc</span> (<span class="id">x_loc</span>: <span class="id">var</span> * <span class="id">dlocalization</span>) =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> (<span class="id">x</span>, <span class="id">loc</span>) := <span class="id">x_loc</span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">load_func</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">loc</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">Vlocal</span> =&gt; "<span class="id">loadScalar</span>"<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">Vdistr</span> =&gt; "<span class="id">loadDistributed</span>"<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">acc</span> ++<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"<span class="id">val</span> "++(<span class="id">rdd_env_id</span> <span class="id">x</span>)++" = "++<span class="id">load_func</span>++"(<span class="id">e</span>, <span class="id">sc</span>, <span class="id">world</span>, """++(<span class="id">attr_id</span> <span class="id">x</span>)++""")" ++ <span class="id">scala_endl</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">env_vars</span> "".<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id">check_result_from_file_func</span> (<span class="id">scala_endl</span>:<span class="id">string</span>) (<span class="id">quotel</span>:<span class="id">string</span>) :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"<span class="id">def</span> <span class="id">check_result</span>(<span class="id">actual</span>: <span class="id">String</span>) {" ++ <span class="id">scala_endl</span> ++<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"  <span class="id">val</span> <span class="id">factory</span> = <span class="id">new</span> <span class="id">javax.script.ScriptEngineManager</span>" ++ <span class="id">scala_endl</span> ++<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"  <span class="id">val</span> <span class="id">e</span> = <span class="id">factory.getEngineByName</span>(""<span class="id">JavaScript</span>"")" ++ <span class="id">scala_endl</span> ++<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"  <span class="id">load_harness</span>(<span class="id">e</span>)" ++ <span class="id">scala_endl</span> ++<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"  <span class="id">e.eval</span>(""<span class="id">var</span> <span class="id">actual</span> = ""+<span class="id">actual</span>+"";"")" ++ <span class="id">scala_endl</span> ++<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"  <span class="id">e.eval</span>(""<span class="id">var</span> <span class="id">expected</span> = [[<span class="id">output</span>]];"")" ++ <span class="id">scala_endl</span> ++<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"  <span class="id">e.eval</span>(""<span class="kwd">if</span> (<span class="id">equal</span>(<span class="id">expected</span>, <span class="id">actual</span>)) { <span class="id">print</span>(\""<span class="id">OK</span>\\<span class="id">n</span>\""); } <span class="kwd">else</span> { <span class="id">print</span>(\""<span class="id">ERROR</span>\\<span class="id">n</span>\""); }"");" ++ <span class="id">scala_endl</span> ++<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"}" ++ <span class="id">scala_endl</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id">scala_of_mr_map</span> (<span class="id">mr_id</span>: <span class="id">string</span>) (<span class="id">input</span>: <span class="id">string</span>) (<span class="id">mr_map</span>: <span class="id">map_fun</span>) (<span class="id">scala_endl</span>:<span class="id">string</span>) (<span class="id">quotel</span>:<span class="id">string</span>) :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">mr_map</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">MapDist</span> (<span class="id">map_v</span>, <span class="id">map_f</span>) =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">map_v_js</span> := "<span class="id">map_arg</span>" <span class="kwd">in</span>  <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> '(<span class="id">j</span>, <span class="id">v</span>, <span class="id">t</span>) := <span class="id">nnrcToJSunshadow</span> <span class="id">map_f</span> 3 1 <span class="id">js_endl</span> <span class="id">quotel</span> (<span class="id">map_v</span>::<span class="id">nil</span>) ((<span class="id">map_v</span>, <span class="id">map_v_js</span>)::<span class="id">nil</span>) <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"<span class="id">val</span> "++(<span class="id">rdd_map_id</span> <span class="id">mr_id</span>)++" = "++(<span class="id">rdd_env_id</span> <span class="id">input</span>)++".<span class="id">map</span>(<span class="id">x</span> =&gt; {" ++ <span class="id">scala_endl</span> ++<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"  <span class="id">val</span> <span class="id">e</span> = <span class="id">get_engine</span>()" ++ <span class="id">scala_endl</span> ++<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"  <span class="id">val</span> <span class="id">x_js</span> = <span class="id">e.eval</span>(""<span class="id">var</span> <span class="id">tmp</span> = ""+<span class="id">x.asInstanceOf</span>[<span class="id">String</span>]+""; <span class="id">tmp</span>"")" ++ <span class="id">scala_endl</span> ++<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"  <span class="id">e.put</span>(""<span class="id">x</span>"", <span class="id">x_js</span>)" ++ <span class="id">scala_endl</span> ++<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"  <span class="id">e.eval</span>(""<span class="kwd">if</span> (<span class="id">typeof</span> <span class="id">map_</span>"++(<span class="id">mr_id</span>)++" === '<span class="id">undefined</span>') {"++<span class="id">js_endl</span>++"""+" ++ <span class="id">scala_endl</span> ++<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"         ""  <span class="id">function</span> <span class="id">map_</span>"++(<span class="id">mr_id</span>)++"("++<span class="id">map_v_js</span>++") {"++<span class="id">js_endl</span>++"""+"++ <span class="id">scala_endl</span> ++<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"         """++<span class="id">j</span>++<span class="id">js_endl</span>++"""+" ++ <span class="id">scala_endl</span> ++<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"         ""    <span class="kwd">return</span> "++<span class="id">v</span>++";"++<span class="id">js_endl</span>++"""+" ++ <span class="id">scala_endl</span> ++<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"         ""  }"++<span class="id">js_endl</span>++"""+" ++ <span class="id">scala_endl</span> ++<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"         ""}"++<span class="id">js_endl</span>++"""+" ++ <span class="id">scala_endl</span> ++<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"         ""<span class="id">JSON.stringify</span>(<span class="id">map_</span>"++(<span class="id">mr_id</span>)++"(<span class="id">x</span>))"").<span class="id">asInstanceOf</span>[<span class="id">String</span>]" ++ <span class="id">scala_endl</span> ++<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"})" ++ <span class="id">scala_endl</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">MapDistFlatten</span> (<span class="id">map_v</span>, <span class="id">map_f</span>) =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">map_v_js</span> := "<span class="id">map_arg</span>" <span class="kwd">in</span>  <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> '(<span class="id">j</span>, <span class="id">v</span>, <span class="id">t</span>) := <span class="id">nnrcToJSunshadow</span> <span class="id">map_f</span> 3 1 <span class="id">js_endl</span> <span class="id">quotel</span> (<span class="id">map_v</span>::<span class="id">nil</span>) ((<span class="id">map_v</span>, <span class="id">map_v_js</span>)::<span class="id">nil</span>) <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"<span class="id">val</span> "++(<span class="id">rdd_map_id</span> <span class="id">mr_id</span>)++" = "++(<span class="id">rdd_env_id</span> <span class="id">input</span>)++".<span class="id">flatMap</span>(<span class="id">x</span> =&gt; {" ++ <span class="id">scala_endl</span> ++<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"  <span class="id">val</span> <span class="id">e</span> = <span class="id">get_engine</span>()" ++ <span class="id">scala_endl</span> ++<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"  <span class="id">val</span> <span class="id">x_js</span> = <span class="id">e.eval</span>(""<span class="id">var</span> <span class="id">tmp</span> = ""+<span class="id">x.asInstanceOf</span>[<span class="id">String</span>]+""; <span class="id">tmp</span>"")" ++ <span class="id">scala_endl</span> ++<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"  <span class="id">e.put</span>(""<span class="id">x</span>"", <span class="id">x_js</span>)" ++ <span class="id">scala_endl</span> ++<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"  <span class="id">array_of_js</span>(<span class="id">e</span>, <span class="id">e.eval</span>(""<span class="kwd">if</span> (<span class="id">typeof</span> <span class="id">map_</span>"++(<span class="id">mr_id</span>)++" === '<span class="id">undefined</span>') {"++<span class="id">js_endl</span>++"""+" ++ <span class="id">scala_endl</span> ++<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"         ""  <span class="id">function</span> <span class="id">map_</span>"++(<span class="id">mr_id</span>)++"("++<span class="id">map_v_js</span>++") {"++<span class="id">js_endl</span>++"""+"++ <span class="id">scala_endl</span> ++<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"         """++<span class="id">j</span>++<span class="id">js_endl</span>++"""+" ++ <span class="id">scala_endl</span> ++<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"         ""    <span class="kwd">return</span> "++<span class="id">v</span>++";"++<span class="id">js_endl</span>++"""+" ++ <span class="id">scala_endl</span> ++<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"         ""  }"++<span class="id">js_endl</span>++"""+" ++ <span class="id">scala_endl</span> ++<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"         ""}"++<span class="id">js_endl</span>++"""+" ++ <span class="id">scala_endl</span> ++<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"         ""<span class="id">map_</span>"++(<span class="id">mr_id</span>)++"(<span class="id">x</span>)""))" ++ <span class="id">scala_endl</span> ++<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"})" ++ <span class="id">scala_endl</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">MapScalar</span> (<span class="id">map_v</span>, <span class="id">map_f</span>) =&gt; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">map_v_js</span> := "<span class="id">map_arg</span>" <span class="kwd">in</span>  <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> '(<span class="id">j</span>, <span class="id">v</span>, <span class="id">t</span>) := <span class="id">nnrcToJSunshadow</span> <span class="id">map_f</span> 3 1 <span class="id">js_endl</span> <span class="id">quotel</span> (<span class="id">map_v</span>::<span class="id">nil</span>) ((<span class="id">map_v</span>, <span class="id">map_v_js</span>)::<span class="id">nil</span>) <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"<span class="id">val</span> "++(<span class="id">rdd_map_id</span> <span class="id">mr_id</span>)++" = "++(<span class="id">rdd_env_id</span> <span class="id">input</span>)++".<span class="id">flatMap</span>(<span class="id">x</span> =&gt; {" ++ <span class="id">scala_endl</span> ++<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"  <span class="id">val</span> <span class="id">e</span> = <span class="id">get_engine</span>()" ++ <span class="id">scala_endl</span> ++<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"  <span class="id">val</span> <span class="id">x_js</span> = <span class="id">e.eval</span>(""<span class="id">var</span> <span class="id">tmp</span> = ""+<span class="id">x.asInstanceOf</span>[<span class="id">String</span>]+""; <span class="id">tmp</span>"")" ++ <span class="id">scala_endl</span> ++<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"  <span class="id">e.put</span>(""<span class="id">x</span>"", <span class="id">x_js</span>)" ++ <span class="id">scala_endl</span> ++<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"  <span class="id">array_of_js</span>(<span class="id">e</span>, <span class="id">e.eval</span>(""<span class="kwd">if</span> (<span class="id">typeof</span> <span class="id">map_</span>"++(<span class="id">mr_id</span>)++" === '<span class="id">undefined</span>') {"++<span class="id">js_endl</span>++"""+" ++ <span class="id">scala_endl</span> ++<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"         ""  <span class="id">function</span> <span class="id">map_</span>"++(<span class="id">mr_id</span>)++"("++<span class="id">map_v_js</span>++") {"++<span class="id">js_endl</span>++"""+"++ <span class="id">scala_endl</span> ++<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"         """++<span class="id">j</span>++<span class="id">js_endl</span>++"""+" ++ <span class="id">scala_endl</span> ++<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"         ""    <span class="kwd">return</span> "++<span class="id">v</span>++";"++<span class="id">js_endl</span>++"""+" ++ <span class="id">scala_endl</span> ++<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"         ""  }"++<span class="id">js_endl</span>++"""+" ++ <span class="id">scala_endl</span> ++<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"         ""}"++<span class="id">js_endl</span>++"""+" ++ <span class="id">scala_endl</span> ++<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"         ""<span class="id">map_</span>"++(<span class="id">mr_id</span>)++"(<span class="id">x</span>)""))" ++ <span class="id">scala_endl</span> ++<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"})" ++ <span class="id">scala_endl</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<div class="doc">functions to compute stats </div>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id">stats_funcs</span> <span class="id">scala_endl</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"<span class="id">def</span> <span class="id">statsReduce</span> (<span class="id">x</span>: <span class="id">String</span>, <span class="id">y</span>: <span class="id">String</span>): <span class="id">String</span> = {" ++ <span class="id">scala_endl</span> ++<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"  <span class="id">val</span> <span class="id">e</span> = <span class="id">get_engine</span>()" ++ <span class="id">scala_endl</span> ++<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"  <span class="id">var</span> <span class="id">res</span>:<span class="id">String</span> = """"" ++ <span class="id">scala_endl</span> ++<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"  <span class="kwd">if</span> (<span class="id">x.equals</span>("""")) {" ++ <span class="id">scala_endl</span> ++<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"    <span class="id">val</span> <span class="id">y_js</span> = <span class="id">e.eval</span>(""<span class="id">var</span> <span class="id">tmp</span> = ""+<span class="id">y</span>+""; <span class="id">tmp</span>"")" ++ <span class="id">scala_endl</span> ++<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"    <span class="id">e.put</span>(""<span class="id">y</span>"", <span class="id">y_js</span>)" ++ <span class="id">scala_endl</span> ++<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"    <span class="id">res</span> = <span class="id">e.eval</span>(""<span class="id">var</span> <span class="id">res</span> = { '<span class="id">count</span>': 1, '<span class="id">sum</span>': <span class="id">y</span>, '<span class="id">min</span>': <span class="id">y</span>, '<span class="id">max</span>': <span class="id">y</span> };"++<span class="id">js_endl</span>++"""+" ++ <span class="id">scala_endl</span> ++<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"                 ""<span class="id">JSON.stringify</span>(<span class="id">res</span>)"").<span class="id">asInstanceOf</span>[<span class="id">String</span>]" ++ <span class="id">scala_endl</span> ++<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"  } <span class="kwd">else</span> {" ++ <span class="id">scala_endl</span> ++<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"    <span class="id">val</span> <span class="id">x_js</span> = <span class="id">e.eval</span>(""<span class="id">var</span> <span class="id">tmp</span> = ""+<span class="id">x</span>+""; <span class="id">tmp</span>"")" ++ <span class="id">scala_endl</span> ++<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"    <span class="id">e.put</span>(""<span class="id">x</span>"", <span class="id">x_js</span>)" ++ <span class="id">scala_endl</span> ++<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"    <span class="id">val</span> <span class="id">y_js</span> = <span class="id">e.eval</span>(""<span class="id">var</span> <span class="id">tmp</span> = ""+<span class="id">y</span>+""; <span class="id">tmp</span>"")" ++ <span class="id">scala_endl</span> ++<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"    <span class="id">e.put</span>(""<span class="id">y</span>"", <span class="id">y_js</span>)" ++ <span class="id">scala_endl</span> ++<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"    <span class="id">res</span> = <span class="id">e.eval</span>(""<span class="id">var</span> <span class="id">res</span> = { '<span class="id">count</span>': <span class="id">x</span>['<span class="id">count</span>'] + 1,"++<span class="id">js_endl</span>++"""+" ++ <span class="id">scala_endl</span> ++<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"                 ""            '<span class="id">sum</span>': <span class="id">x</span>['<span class="id">sum</span>'] + <span class="id">y</span>,"++<span class="id">js_endl</span>++"""+" ++ <span class="id">scala_endl</span> ++<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"                 ""            '<span class="id">min</span>': <span class="id">Math.min</span>(<span class="id">x</span>['<span class="id">min</span>'], <span class="id">y</span>),"++<span class="id">js_endl</span>++"""+" ++ <span class="id">scala_endl</span> ++<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"                 ""            '<span class="id">max</span>': <span class="id">Math.max</span>(<span class="id">x</span>['<span class="id">max</span>'], <span class="id">y</span>) };"++<span class="id">js_endl</span>++"""+" ++ <span class="id">scala_endl</span> ++<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"                 ""<span class="id">JSON.stringify</span>(<span class="id">res</span>)"").<span class="id">asInstanceOf</span>[<span class="id">String</span>]" ++ <span class="id">scala_endl</span> ++<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"  }" ++ <span class="id">scala_endl</span> ++<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"  <span class="kwd">return</span> <span class="id">res</span>" ++ <span class="id">scala_endl</span> ++<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"}" ++ <span class="id">scala_endl</span> ++<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"<span class="id">def</span> <span class="id">statsRereduce</span> (<span class="id">x</span>: <span class="id">String</span>, <span class="id">y</span>: <span class="id">String</span>): <span class="id">String</span> = {" ++ <span class="id">scala_endl</span> ++<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"  <span class="id">val</span> <span class="id">e</span> = <span class="id">get_engine</span>()" ++ <span class="id">scala_endl</span> ++<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"  <span class="id">var</span> <span class="id">res</span>:<span class="id">String</span> = """"" ++ <span class="id">scala_endl</span> ++<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"  <span class="kwd">if</span> (<span class="id">x.equals</span>("""")) {" ++ <span class="id">scala_endl</span> ++<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"    <span class="kwd">if</span> (<span class="id">y.equals</span>("""")) {" ++ <span class="id">scala_endl</span> ++<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"      <span class="id">res</span> = ""{ '<span class="id">count</span>': 0, '<span class="id">sum</span>': 0, '<span class="id">min</span>': 0, '<span class="id">max</span>': 0 }""" ++ <span class="id">scala_endl</span> ++<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"    } <span class="kwd">else</span> {" ++ <span class="id">scala_endl</span> ++<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"      <span class="id">res</span> = <span class="id">y</span>" ++ <span class="id">scala_endl</span> ++<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"    }" ++ <span class="id">scala_endl</span> ++<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"  } <span class="kwd">else</span> {" ++ <span class="id">scala_endl</span> ++<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"    <span class="kwd">if</span> (<span class="id">y.equals</span>("""")) {" ++ <span class="id">scala_endl</span> ++<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"      <span class="id">res</span> = <span class="id">x</span>" ++ <span class="id">scala_endl</span> ++<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"    } <span class="kwd">else</span> {" ++ <span class="id">scala_endl</span> ++<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"      <span class="id">val</span> <span class="id">x_js</span> = <span class="id">e.eval</span>(""<span class="id">var</span> <span class="id">tmp</span> = ""+<span class="id">x</span>+""; <span class="id">tmp</span>"")" ++ <span class="id">scala_endl</span> ++<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"      <span class="id">e.put</span>(""<span class="id">x</span>"", <span class="id">x_js</span>)" ++ <span class="id">scala_endl</span> ++<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"      <span class="id">val</span> <span class="id">y_js</span> = <span class="id">e.eval</span>(""<span class="id">var</span> <span class="id">tmp</span> = ""+<span class="id">y</span>+""; <span class="id">tmp</span>"")" ++ <span class="id">scala_endl</span> ++<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"      <span class="id">e.put</span>(""<span class="id">y</span>"", <span class="id">y_js</span>)" ++ <span class="id">scala_endl</span> ++<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"      <span class="id">res</span> = <span class="id">e.eval</span>(""<span class="id">var</span> <span class="id">res</span> = { '<span class="id">count</span>': <span class="id">x</span>['<span class="id">count</span>'] + <span class="id">y</span>['<span class="id">count</span>'],"++<span class="id">js_endl</span>++"""+" ++ <span class="id">scala_endl</span> ++<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"                   ""            '<span class="id">sum</span>': <span class="id">x</span>['<span class="id">sum</span>'] + <span class="id">y</span>['<span class="id">sum</span>'],"++<span class="id">js_endl</span>++"""+" ++ <span class="id">scala_endl</span> ++<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"                   ""            '<span class="id">min</span>': <span class="id">Math.min</span>(<span class="id">x</span>['<span class="id">min</span>'], <span class="id">y</span>['<span class="id">min</span>']),"++<span class="id">js_endl</span>++"""+" ++ <span class="id">scala_endl</span> ++<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"                   ""            '<span class="id">max</span>': <span class="id">Math.max</span>(<span class="id">x</span>['<span class="id">max</span>'], <span class="id">y</span>['<span class="id">max</span>']) };"++<span class="id">js_endl</span>++"""+" ++ <span class="id">scala_endl</span> ++<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"                   ""<span class="id">JSON.stringify</span>(<span class="id">res</span>)"").<span class="id">asInstanceOf</span>[<span class="id">String</span>]" ++ <span class="id">scala_endl</span> ++<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"    }" ++ <span class="id">scala_endl</span> ++<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"  }" ++ <span class="id">scala_endl</span> ++<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"  <span class="kwd">return</span> <span class="id">res</span>" ++ <span class="id">scala_endl</span> ++<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"}" ++ <span class="id">scala_endl</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id">scala_of_mr_reduce</span> (<span class="id">mr_id</span>: <span class="id">string</span>) (<span class="id">mr_reduce</span>: <span class="id">reduce_fun</span>) (<span class="id">scala_endl</span>:<span class="id">string</span>) (<span class="id">quotel</span>:<span class="id">string</span>) :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">mr_reduce</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">RedId</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"<span class="id">var</span> "++(<span class="id">rdd_reduce_id</span> <span class="id">mr_id</span>)++" = "++(<span class="id">rdd_map_id</span> <span class="id">mr_id</span>) ++ <span class="id">scala_endl</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">RedCollect</span> <span class="id">reduce</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> (<span class="id">red_values_v</span>, <span class="id">red_f</span>) := <span class="id">reduce</span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">red_values_v_js</span> := "<span class="id">values</span>" <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> '(<span class="id">j</span>, <span class="id">v</span>, <span class="id">t</span>) := <span class="id">nnrcToJSunshadow</span> <span class="id">red_f</span> 1 1 <span class="id">js_endl</span> <span class="id">quotel</span> (<span class="id">red_values_v</span> :: <span class="id">nil</span>) ((<span class="id">red_values_v</span>, <span class="id">red_values_v_js</span>)::<span class="id">nil</span>) <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"<span class="id">val</span> "++(<span class="id">rdd_reduce_id</span> <span class="id">mr_id</span>)++" = (() =&gt; {" ++ <span class="id">scala_endl</span> ++<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"  <span class="id">val</span> <span class="id">e</span> = <span class="id">get_engine</span>()" ++ <span class="id">scala_endl</span> ++<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"  <span class="id">val</span> <span class="id">values</span> = "++(<span class="id">rdd_map_id</span> <span class="id">mr_id</span>)++".<span class="id">collect</span>()" ++ <span class="id">scala_endl</span> ++<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"  <span class="id">val</span> <span class="id">values_js</span> = <span class="id">e.eval</span>(""<span class="id">var</span> <span class="id">tmp</span> = ""+(<span class="id">js_of_iterable</span>(<span class="id">values</span>))+""; <span class="id">tmp</span>"")" ++ <span class="id">scala_endl</span> ++<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"  <span class="id">e.put</span>(""<span class="id">values</span>"", <span class="id">values_js</span>)" ++ <span class="id">scala_endl</span> ++<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"  <span class="id">val</span> <span class="id">res</span> = <span class="id">e.eval</span>(""<span class="kwd">if</span> (<span class="id">typeof</span> <span class="id">reduce_</span>"++(<span class="id">mr_id</span>)++" === '<span class="id">undefined</span>') {""+" ++ <span class="id">scala_endl</span> ++<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"		   ""  <span class="id">function</span> <span class="id">reduce_</span>"++(<span class="id">mr_id</span>)++"("++<span class="id">red_values_v_js</span>++") {"++<span class="id">js_endl</span>++"""+"++ <span class="id">scala_endl</span> ++<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"            """++<span class="id">j</span>++<span class="id">js_endl</span>++"""+" ++ <span class="id">scala_endl</span> ++<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"            ""    <span class="kwd">return</span> "++<span class="id">v</span>++";"++<span class="id">js_endl</span>++"""+" ++ <span class="id">scala_endl</span> ++<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"            ""  }""+" ++ <span class="id">scala_endl</span> ++<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"		   ""}""+" ++ <span class="id">scala_endl</span> ++<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"		   ""<span class="id">JSON.stringify</span>(<span class="id">reduce_</span>"++(<span class="id">mr_id</span>)++"(<span class="id">values</span>))"").<span class="id">asInstanceOf</span>[<span class="id">String</span>]" ++ <span class="id">scala_endl</span> ++<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"  <span class="id">sc.parallelize</span>(<span class="id">Array</span>(<span class="id">res</span>))" ++ <span class="id">scala_endl</span> ++<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"}: <span class="id">org.apache.spark.rdd.RDD</span>[<span class="id">String</span>]) ()" ++ <span class="id">scala_endl</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">RedOp</span> <span class="id">rop</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">rop</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">RedOpForeign</span> <span class="id">frop</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"<span class="id">val</span> "++(<span class="id">rdd_reduce_id</span> <span class="id">mr_id</span>)++" = (() =&gt; {" ++ <span class="id">scala_endl</span> ++<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"  <span class="id">val</span> <span class="id">res</span> = "++(<span class="id">rdd_map_id</span> <span class="id">mr_id</span>) ++ (<span class="id">foreign_to_spark_reduce_op</span> <span class="id">frop</span> <span class="id">scala_endl</span> <span class="id">quotel</span>) ++ <span class="id">scala_endl</span> ++<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"  <span class="id">sc.parallelize</span>(<span class="id">Array</span>(<span class="id">res</span>))" ++ <span class="id">scala_endl</span> ++<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"}: <span class="id">org.apache.spark.rdd.RDD</span>[<span class="id">String</span>]) ()" ++ <span class="id">scala_endl</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">RedSingleton</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"<span class="id">val</span> "++(<span class="id">rdd_reduce_id</span> <span class="id">mr_id</span>)++" = "++(<span class="id">rdd_map_id</span> <span class="id">mr_id</span>) ++ <span class="id">scala_endl</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id">scala_of_mr</span> (<span class="id">mr_id</span>: <span class="id">string</span>) (<span class="id">mr</span>: <span class="id">mr</span>) (<span class="id">outputs</span>: <span class="id">list</span> <span class="id">var</span>) (<span class="id">scala_endl</span>:<span class="id">string</span>) (<span class="id">quotel</span>:<span class="id">string</span>) :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">scala_of_mr_map</span> <span class="id">mr_id</span> <span class="id">mr</span>.(<span class="id">mr_input</span>) <span class="id">mr</span>.(<span class="id">mr_map</span>) <span class="id">scala_endl</span> <span class="id">quotel</span> ++<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">scala_of_mr_reduce</span> <span class="id">mr_id</span> <span class="id">mr</span>.(<span class="id">mr_reduce</span>) <span class="id">scala_endl</span> <span class="id">quotel</span> ++<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">if</span> <span class="id">in_dec</span> <span class="id">equiv_dec</span> <span class="id">mr</span>.(<span class="id">mr_output</span>) <span class="id">outputs</span> <span class="kwd">then</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">rdd_env_id</span> <span class="id">mr</span>.(<span class="id">mr_output</span>))++" = "++(<span class="id">rdd_env_id</span> <span class="id">mr</span>.(<span class="id">mr_output</span>))++"++"++(<span class="id">rdd_reduce_id</span> <span class="id">mr_id</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">else</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"<span class="id">var</span> "++(<span class="id">rdd_env_id</span> <span class="id">mr</span>.(<span class="id">mr_output</span>))++" = "++(<span class="id">rdd_reduce_id</span> <span class="id">mr_id</span>).<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id">scala_of_mr_chain</span> (<span class="id">l</span>:<span class="id">list</span> <span class="id">mr</span>) (<span class="id">scala_endl</span>:<span class="id">string</span>) (<span class="id">quotel</span>:<span class="id">string</span>) :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> '(<span class="id">_</span>, <span class="id">_</span>, <span class="id">scala</span>) :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">List.fold_left</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">fun</span> (<span class="id">acc</span>: <span class="id">string</span> * <span class="id">list</span> <span class="id">var</span> * <span class="id">string</span>) <span class="id">mr</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> '(<span class="id">mr_id</span>, <span class="id">outputs</span>, <span class="id">s</span>) := <span class="id">acc</span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">mr_scala</span> := <span class="id">scala_of_mr</span> <span class="id">mr_id</span> <span class="id">mr</span> <span class="id">outputs</span> <span class="id">scala_endl</span> <span class="id">quotel</span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;((<span class="id">append</span> <span class="id">mr_id</span> "<span class="id">_next</span>"), <span class="id">mr</span>.(<span class="id">mr_output</span>)::<span class="id">outputs</span>, <span class="id">s</span>++<span class="id">scala_endl</span>++<span class="id">mr_scala</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">l</span> ("<span class="id">something_</span>", <span class="id">nil</span>, "")<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">scala</span> ++ <span class="id">scala_endl</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Fixpoint</span> <span class="id">string_of_list</span> <span class="id">sep</span> <span class="id">l</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">l</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">nil</span> =&gt; ""<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">s</span>::<span class="id">nil</span> =&gt; <span class="id">s</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">s</span>::<span class="id">l</span> =&gt; <span class="id">s</span>++<span class="id">sep</span>++(<span class="id">string_of_list</span> <span class="id">sep</span> <span class="id">l</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id">scala_of_mr_last</span> (<span class="id">mr_last</span>: ((<span class="id">list</span> <span class="id">var</span> * <span class="id">nnrc</span>) * <span class="id">list</span> (<span class="id">var</span> * <span class="id">dlocalization</span>))) (<span class="id">scala_endl</span>:<span class="id">string</span>) (<span class="id">quotel</span>:<span class="id">string</span>) :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">params_js</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">List.map</span> (<span class="kwd">fun</span> <span class="id">x</span> =&gt; "<span class="id">v</span>"++<span class="id">x</span>) (<span class="id">fst</span> (<span class="id">fst</span> <span class="id">mr_last</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">args_js</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">List.map</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">fun</span> <span class="id">x_loc</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">x_loc</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| (<span class="id">x</span>, <span class="id">Vlocal</span>) =&gt; """+"++(<span class="id">rdd_env_id</span> <span class="id">x</span>)++".<span class="id">collect</span>()(0)"++"+"""<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| (<span class="id">x</span>, <span class="id">Vdistr</span>) =&gt; """+"++(<span class="id">rdd_env_id</span> <span class="id">x</span>)++".<span class="id">collect</span>()"++"+"""<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">snd</span> <span class="id">mr_last</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">result</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> '(<span class="id">j</span>, <span class="id">v</span>, <span class="id">_</span>) := <span class="id">nnrcToJSunshadow</span> (<span class="id">snd</span> (<span class="id">fst</span> <span class="id">mr_last</span>)) 3 1 <span class="id">js_endl</span> <span class="id">quotel</span> <span class="id">nil</span> <span class="id">nil</span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"<span class="id">e.eval</span>(""(<span class="id">function</span> ("++(<span class="id">string_of_list</span> ", " <span class="id">params_js</span>)++"){"++<span class="id">js_endl</span>++"""+"++ <span class="id">scala_endl</span> ++<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"       """++<span class="id">j</span>++<span class="id">js_endl</span>++"""+" ++ <span class="id">scala_endl</span> ++<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"       ""    <span class="kwd">return</span> <span class="id">JSON.stringify</span>("++<span class="id">v</span>++");"++<span class="id">js_endl</span>++"""+" ++ <span class="id">scala_endl</span> ++<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"       ""})("++(<span class="id">string_of_list</span> ", " <span class="id">args_js</span>)++")"").<span class="id">asInstanceOf</span>[<span class="id">String</span>]"++ <span class="id">scala_endl</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">result</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id">scala_of_nnrcmr</span> (<span class="id">mrl</span>:<span class="id">nnrcmr</span>) (<span class="id">scala_endl</span>:<span class="id">string</span>) (<span class="id">quotel</span>:<span class="id">string</span>) :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">scala_of_mr_chain</span> <span class="id">mrl</span>.(<span class="id">mr_chain</span>) <span class="id">scala_endl</span> <span class="id">quotel</span> ++<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">scala_of_mr_last</span> <span class="id">mrl</span>.(<span class="id">mr_last</span>) <span class="id">scala_endl</span> <span class="id">quotel</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id">nnrcmrToSparkTopDataFromFile</span> (<span class="id">test_name</span>: <span class="id">string</span>) (<span class="id">init</span>: <span class="id">var</span>) (<span class="id">l</span>:<span class="id">nnrcmr</span>) (<span class="id">scala_endl</span>:<span class="id">string</span>) (<span class="id">quotel</span>: <span class="id">string</span>) :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"<span class="id">import</span> <span class="id">org.apache.spark.SparkContext</span>" ++ <span class="id">scala_endl</span> ++<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"<span class="id">import</span> <span class="id">org.apache.spark.SparkContext._</span>" ++ <span class="id">scala_endl</span> ++<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"<span class="id">import</span> <span class="id">org.apache.spark.SparkConf</span>" ++ <span class="id">scala_endl</span> ++<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"<span class="id">import</span> <span class="id">java.io._</span>" ++ <span class="id">scala_endl</span> ++<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">scala_endl</span> ++<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"<span class="id">object</span> "++<span class="id">test_name</span>++" {" ++ <span class="id">scala_endl</span> ++<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">scala_endl</span> ++<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"<span class="id">var</span> <span class="id">harnessFile</span>: <span class="id">String</span> = """"" ++ <span class="id">scala_endl</span> ++<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"<span class="id">var</span> <span class="id">dataFile</span>: <span class="id">String</span> = """"" ++ <span class="id">scala_endl</span> ++<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">get_engine_func</span> <span class="id">scala_endl</span> ++<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">scala_endl</span> ++<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">js_of_iterable_func</span> <span class="id">scala_endl</span> ++<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">scala_endl</span> ++<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">array_of_js_func</span> <span class="id">scala_endl</span> ++<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">scala_endl</span> ++<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">stats_funcs</span> <span class="id">scala_endl</span> ++<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">scala_endl</span> ++<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">load_harness_from_file_func</span> <span class="id">scala_endl</span> <span class="id">quotel</span> ++ <span class="id">scala_endl</span> ++<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">scala_endl</span> ++<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">load_env_defs</span> <span class="id">init</span> <span class="id">scala_endl</span> <span class="id">quotel</span> ++<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">scala_endl</span> ++<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">check_result_from_file_func</span> <span class="id">scala_endl</span> <span class="id">quotel</span> ++<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">scala_endl</span> ++<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"<span class="id">def</span> <span class="id">run</span>(<span class="id">sc</span>: <span class="id">SparkContext</span>): <span class="id">String</span> = {" ++ <span class="id">scala_endl</span> ++<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">get_engine_func</span> <span class="id">scala_endl</span> ++ <span class="id">scala_endl</span> ++<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">load_env</span> <span class="id">l</span>.(<span class="id">mr_inputs_loc</span>) <span class="id">scala_endl</span> <span class="id">quotel</span> ++ <span class="id">scala_endl</span> ++<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">scala_of_nnrcmr</span> <span class="id">l</span> <span class="id">scala_endl</span> <span class="id">quotel</span> ++<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"}" ++ <span class="id">scala_endl</span> ++<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">scala_endl</span> ++<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"<span class="id">def</span> <span class="id">main</span>(<span class="id">args</span>: <span class="id">Array</span>[<span class="id">String</span>]) {" ++ <span class="id">scala_endl</span> ++<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"  <span class="kwd">if</span> (<span class="id">args.length</span> != 2 &amp;&amp; <span class="id">args.length</span> != 3) {" ++ <span class="id">scala_endl</span> ++<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"    <span class="id">println</span>(""<span class="id">Expected</span> <span class="id">arguments</span>: <span class="id">harness.js</span>, <span class="id">test.js.io</span> [<span class="id">and</span> <span class="id">output.io</span>]"")" ++ <span class="id">scala_endl</span> ++<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"    <span class="id">sys.exit</span>(1)" ++ <span class="id">scala_endl</span> ++<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"  }" ++ <span class="id">scala_endl</span> ++<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"  <span class="id">harnessFile</span> = <span class="id">args</span>(0)" ++ <span class="id">scala_endl</span> ++<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"  <span class="id">dataFile</span> = <span class="id">args</span>(1)" ++ <span class="id">scala_endl</span> ++<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"  <span class="id">val</span> <span class="id">conf</span> = <span class="id">new</span> <span class="id">SparkConf</span>().<span class="id">setAppName</span>("""++<span class="id">test_name</span>++""")" ++ <span class="id">scala_endl</span> ++<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"  <span class="id">val</span> <span class="id">sc</span> = <span class="id">new</span> <span class="id">SparkContext</span>(<span class="id">conf</span>)" ++ <span class="id">scala_endl</span> ++<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"  <span class="id">val</span> <span class="id">json_result</span> = <span class="id">run</span>(<span class="id">sc</span>)" ++ <span class="id">scala_endl</span> ++<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"  <span class="kwd">if</span> (<span class="id">args.length</span> == 3) {" ++ <span class="id">scala_endl</span> ++<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"    <span class="id">val</span> <span class="id">pw</span> = <span class="id">new</span> <span class="id">PrintWriter</span>(<span class="id">new</span> <span class="id">File</span>(<span class="id">args</span>(2)))" ++ <span class="id">scala_endl</span> ++<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"    <span class="id">pw.write</span>(<span class="id">json_result</span>)" ++ <span class="id">scala_endl</span> ++<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"    <span class="id">pw.close</span>" ++ <span class="id">scala_endl</span> ++<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"  }" ++ <span class="id">scala_endl</span> ++<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"  <span class="id">println</span>(<span class="id">json_result</span>)" ++ <span class="id">scala_endl</span> ++<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"  <span class="kwd">if</span> (<span class="id">args.length</span> ==2)" ++ <span class="id">scala_endl</span> ++<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"    <span class="id">check_result</span>(<span class="id">json_result</span>)"  ++ <span class="id">scala_endl</span> ++<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"}" ++ <span class="id">scala_endl</span> ++<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"}" ++ <span class="id">scala_endl</span>.<br/>
<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">End</span> <span class="id">MRSpark</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id">nnrcmrToSparkTopDataFromFileTop</span> (<span class="id">test_name</span>: <span class="id">string</span>) (<span class="id">init</span>: <span class="id">var</span>) (<span class="id">l</span>:<span class="id">nnrcmr</span>) : <span class="id">string</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">nnrcmrToSparkTopDataFromFile</span> <span class="id">test_name</span> <span class="id">init</span> <span class="id">l</span> <span class="id">eol_newline</span> "'".<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Section</span> <span class="id">Top</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id">NNRCMROptim</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id">OptimizerLogger</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Context</span> {<span class="id">nnrc_logger</span>:<span class="id">optimizer_logger</span> <span class="id">string</span> <span class="id">nnrc</span>}.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id">nnrcmr_to_nnrcmr_spark_rdd_prepare</span> (<span class="id">q</span>: <span class="id">nnrcmr</span>) : <span class="id">nnrcmr</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">q</span> := <span class="id">foreign_to_spark_prepare_nnrcmr</span> <span class="id">q</span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">q</span> := <span class="id">run_nnrcmr_optims</span> <span class="id">q</span> <span class="kwd">in</span>                         <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">q</span> := <span class="id">foreign_to_spark_prepare_nnrcmr</span> <span class="id">q</span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">nnrcmr_rename_for_spark</span> <span class="id">q</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id">nnrcmr_prepared_to_spark_rdd</span> (<span class="id">vinit</span>:<span class="id">var</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">rulename</span>: <span class="id">string</span>) (<span class="id">q</span>: <span class="id">nnrcmr</span>) : <span class="id">spark_rdd</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">nnrcmrToSparkTopDataFromFileTop</span> <span class="id">rulename</span> <span class="id">vinit</span> <span class="id">q</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id">nnrcmr_to_spark_rdd_top</span> (<span class="id">vinit</span>:<span class="id">var</span>) (<span class="id">rulename</span>: <span class="id">string</span>) (<span class="id">q</span>: <span class="id">nnrcmr</span>) : <span class="id">spark_rdd</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">nnrcmr_prepared_to_spark_rdd</span> <span class="id">vinit</span> <span class="id">rulename</span> (<span class="id">nnrcmr_to_nnrcmr_spark_rdd_prepare</span> <span class="id">q</span>).<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">End</span> <span class="id">Top</span>.<br/>
<br/>
<span class="kwd">End</span> <span class="id">NNRCMRtoSparkRDD</span>.<br/>
<br/>

</div>
<div class="footer"><hr/>Generated by <a href="https://github.com/xavierleroy/coq2html/">coq2html</div>
</body>
</html>
