
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Module Qcert.CAMP.Lang.CAMP</title>
<meta name="description" content="Documentation of Coq module Qcert.CAMP.Lang.CAMP" />
<link href="coq2html.css" rel="stylesheet" type="text/css" />
<script type="text/javascript" src="coq2html.js"> </script>
</head>

<body onload="hideAll('proofscript')">
<h1 class="title">Module Qcert.CAMP.Lang.CAMP</h1>
<div class="coq">
<br/>
<div class="doc">CAMP is a small calculus for pattern matching. Its purpose is to
  capture the semantics of rules languages that rely on the ability to
  recover from match failure. </div>
<br/>
<div class="doc">Two distinct evaluation functions for CAMP are defined. The first
  is a standard evaluation function and serves as semantic
  definition. The second is equivalent but maintains a trace of the
  evaluation for debugging purposes. </div>
&nbsp;&nbsp;<br/>
<div class="doc">Summary:
<ul>
<li>
 Language: CAMP (Calculus for Aggregating Matching Patterns)
</li>
<li>
 Based on: "A Pattern Calculus for Rule Languages:
  Expressiveness, Compilation, and Mechanization" Avraham
  Shinnar, Jérôme Siméon, and Martin Hirzel. ECOOP'2015.
</li>
<li>
 URL: http://drops.dagstuhl.de/opus/volltexte/2015/5237/
</li>
<li>
 Languages translating to CAMP: TechRule, DesignRule, CAMPRule, cNNRC
</li>
<li>
 Languages translating from CAMP: NRA, cNRAEnv, NRAEnv
</li>
</ul>
</div>
&nbsp;&nbsp;<br/>
<span class="kwd">Section</span> <span class="id">CAMP</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id">String</span>.<br/>
&nbsp;&nbsp;<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id">List</span>.<br/>
&nbsp;&nbsp;<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id">EquivDec</span>.<br/>
&nbsp;&nbsp;<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id">Morphisms</span>.<br/>
&nbsp;&nbsp;<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id">BasicRuntime</span>.<br/>
&nbsp;&nbsp;<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id">CAMPUtil</span>.<br/>
&nbsp;&nbsp;<br/>
&nbsp;&nbsp;<span class="kwd">Local</span> <span class="kwd">Open</span> <span class="kwd">Scope</span> <span class="id">string</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Context</span> {<span class="id">fruntime</span>:<span class="id">foreign_runtime</span>}.<br/>
<br/>
<h1> Abstract Syntax Tree </h1>
<br/>
<div class="doc">CAMP patterns are pure expressions. They match against a current
  value in the context of an environment. The environment has a
  globale component which is static, and a local component which can
  be modified in the course of evaluation. </div>
<br/>
<div class="doc">Operations include: pmap, a functional map which skips match
  failure; passert, which turns match failure into a terminal failure,
  and porElse which allows to continue to a new pattern in case of
  match failure. </div>
<br/>
<div class="doc">Compared to the published material, three new operators are
  added: pgetConstant which accesses the global environment, pleft and
  pright which support pattern matching against choice values. </div>
&nbsp;&nbsp;<br/>
&nbsp;&nbsp;<span class="kwd">Inductive</span> <span class="id">camp</span> : <span class="kwd">Set</span> :=<br/>
&nbsp;&nbsp;| <span class="id">pconst</span> : <span class="id">data</span> -&gt; <span class="id">camp</span>                  <span class="docright">(* Constant value  *)</span><br/>
&nbsp;&nbsp;| <span class="id">punop</span> : <span class="id">unaryOp</span> -&gt; <span class="id">camp</span> -&gt; <span class="id">camp</span>        <span class="docright">(* Unary operators  *)</span><br/>
&nbsp;&nbsp;| <span class="id">pbinop</span> : <span class="id">binOp</span> -&gt; <span class="id">camp</span> -&gt; <span class="id">camp</span> -&gt; <span class="id">camp</span> <span class="docright">(* Binary operators  *)</span><br/>
&nbsp;&nbsp;| <span class="id">pmap</span> : <span class="id">camp</span> -&gt; <span class="id">camp</span>                    <span class="docright">(* Functional map  *)</span><br/>
&nbsp;&nbsp;| <span class="id">passert</span> : <span class="id">camp</span> -&gt; <span class="id">camp</span>                 <span class="docright">(* Assert pattern-matching success  *)</span><br/>
&nbsp;&nbsp;| <span class="id">porElse</span> : <span class="id">camp</span> -&gt; <span class="id">camp</span> -&gt; <span class="id">camp</span>         <span class="docright">(* Recover from failure  *)</span><br/>
&nbsp;&nbsp;| <span class="id">pit</span> : <span class="id">camp</span>                             <span class="docright">(* Current value being matched  *)</span><br/>
&nbsp;&nbsp;| <span class="id">pletIt</span> : <span class="id">camp</span> -&gt; <span class="id">camp</span> -&gt; <span class="id">camp</span>          <span class="docright">(* Set the current value  *)</span><br/>
&nbsp;&nbsp;| <span class="id">pgetConstant</span> : <span class="id">string</span> -&gt; <span class="id">camp</span>          <span class="docright">(* Access to a global variable  *)</span><br/>
&nbsp;&nbsp;| <span class="id">penv</span> : <span class="id">camp</span>                            <span class="docright">(* Current environment  *)</span><br/>
&nbsp;&nbsp;| <span class="id">pletEnv</span> : <span class="id">camp</span> -&gt; <span class="id">camp</span> -&gt; <span class="id">camp</span>         <span class="docright">(* Add bindings to the environment  *)</span><br/>
&nbsp;&nbsp;| <span class="id">pleft</span> : <span class="id">camp</span>                           <span class="docright">(* Matches if the value is a left choice  *)</span><br/>
&nbsp;&nbsp;| <span class="id">pright</span> : <span class="id">camp</span>.                         <span class="docright">(* Matches if the value is a right choice  *)</span><br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Tactic</span> <span class="kwd">Notation</span> "<span class="id">camp_cases</span>" <span class="id">tactic</span>(<span class="id">first</span>) <span class="id">ident</span>(<span class="id">c</span>) :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">first</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;[ <span class="id">Case_aux</span> <span class="id">c</span> "<span class="id">pconst</span>"%<span class="id">string</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">Case_aux</span> <span class="id">c</span> "<span class="id">punop</span>"%<span class="id">string</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">Case_aux</span> <span class="id">c</span> "<span class="id">pbinop</span>"%<span class="id">string</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">Case_aux</span> <span class="id">c</span> "<span class="id">pmap</span>"%<span class="id">string</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">Case_aux</span> <span class="id">c</span> "<span class="id">passert</span>"%<span class="id">string</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">Case_aux</span> <span class="id">c</span> "<span class="id">porElse</span>"%<span class="id">string</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">Case_aux</span> <span class="id">c</span> "<span class="id">pit</span>"%<span class="id">string</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">Case_aux</span> <span class="id">c</span> "<span class="id">pletIt</span>"%<span class="id">string</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">Case_aux</span> <span class="id">c</span> "<span class="id">pgetConstant</span>"%<span class="id">string</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">Case_aux</span> <span class="id">c</span> "<span class="id">penv</span>"%<span class="id">string</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">Case_aux</span> <span class="id">c</span> "<span class="id">pletEnv</span>"%<span class="id">string</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">Case_aux</span> <span class="id">c</span> "<span class="id">pleft</span>"%<span class="id">string</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">Case_aux</span> <span class="id">c</span> "<span class="id">pright</span>"%<span class="id">string</span>].<br/>
<br/>
<div class="doc">Equality between two CAMP patterns is decidable. </div>
&nbsp;&nbsp;<br/>
&nbsp;&nbsp;<span class="kwd">Global</span> <span class="kwd">Instance</span> <span class="id">camp_eqdec</span> : <span class="id">EqDec</span> <span class="id">camp</span> <span class="id">eq</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2675')">Proof.</div>
<div class="proofscript" id="proof2675">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">change</span> (<span class="kwd">forall</span> <span class="id">x</span> <span class="id">y</span> : <span class="id">camp</span>, {<span class="id">x</span> = <span class="id">y</span>} + {<span class="id">x</span> &lt;&gt; <span class="id">y</span>}).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">decide</span> <span class="id">equality</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">data_eqdec</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">unaryOp_eqdec</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">binOp_eqdec</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">string_dec</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
<h1> Evaluation Semantics </h1>
&nbsp;&nbsp;<br/>
<div class="doc">Evaluation takes a camp pattern, a global environment, a local
    environment and a current value. It returns a presult which can be
    either a successful evaluation holding a value, a match failure,
    or a terminal failure. </div>
<br/>
<div class="doc">The external context for evaluation includes a brand relation,
    and a global environment. </div>
&nbsp;&nbsp;<br/>
&nbsp;&nbsp;<span class="kwd">Section</span> <span class="id">Evaluation</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Context</span> (<span class="id">h</span>:<span class="id">brand_relation_t</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Context</span> (<span class="id">constant_env</span>:<span class="id">bindings</span>).<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Fixpoint</span> <span class="id">camp_eval</span> (<span class="id">p</span>:<span class="id">camp</span>) (<span class="id">bind</span>:<span class="id">bindings</span>) (<span class="id">d</span>:<span class="id">data</span>) : <span class="id">presult</span> <span class="id">data</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:= <span class="kwd">match</span> <span class="id">p</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">pconst</span> <span class="id">d</span>' =&gt; <span class="id">Success</span> (<span class="id">normalize_data</span> <span class="id">h</span> <span class="id">d</span>')<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">punop</span> <span class="id">op</span> <span class="id">p</span>₁ =&gt; <span class="id">bindpr</span> (<span class="id">camp_eval</span> <span class="id">p</span>₁ <span class="id">bind</span> <span class="id">d</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">fun</span> <span class="id">d</span>' =&gt; (<span class="id">op2tpr</span> (<span class="id">fun_of_unaryop</span> <span class="id">h</span> <span class="id">op</span> <span class="id">d</span>')))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">pbinop</span> <span class="id">op</span> <span class="id">p</span>₁ <span class="id">p</span>₂ =&gt; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">bindpr</span> (<span class="id">camp_eval</span> <span class="id">p</span>₁ <span class="id">bind</span> <span class="id">d</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">fun</span> <span class="id">d</span>'₁ =&gt; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">bindpr</span> (<span class="id">camp_eval</span> <span class="id">p</span>₂ <span class="id">bind</span> <span class="id">d</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">fun</span> <span class="id">d</span>'₂ =&gt;  (<span class="id">op2tpr</span> (<span class="id">fun_of_binop</span> <span class="id">h</span> <span class="id">op</span> <span class="id">d</span>'₁ <span class="id">d</span>'₂))))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">pmap</span> <span class="id">p</span>₁ =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">d</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">dcoll</span> <span class="id">l</span> =&gt; <span class="id">liftpr</span> <span class="id">dcoll</span> (<span class="id">gather_successes</span> (<span class="id">map</span> (<span class="id">camp_eval</span> <span class="id">p</span>₁ <span class="id">bind</span>) <span class="id">l</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">_</span> =&gt; <span class="id">TerminalError</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">passert</span> <span class="id">p</span>₁ =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">bindpr</span> (<span class="id">camp_eval</span> <span class="id">p</span>₁ <span class="id">bind</span> <span class="id">d</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">fun</span> <span class="id">d</span>' =&gt; <span class="kwd">match</span> <span class="id">d</span>' <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">dbool</span> <span class="id">true</span> =&gt; <span class="id">Success</span> (<span class="id">drec</span> <span class="id">nil</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">dbool</span> <span class="id">false</span> =&gt; <span class="id">RecoverableError</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">_</span> =&gt; <span class="id">TerminalError</span> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">porElse</span> <span class="id">p</span>₁ <span class="id">p</span>₂ =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">camp_eval</span> <span class="id">p</span>₁ <span class="id">bind</span> <span class="id">d</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">TerminalError</span> =&gt; <span class="id">TerminalError</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">RecoverableError</span> =&gt; <span class="id">camp_eval</span> <span class="id">p</span>₂ <span class="id">bind</span> <span class="id">d</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">Success</span> <span class="id">x</span> =&gt; <span class="id">Success</span> <span class="id">x</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">pit</span> =&gt; <span class="id">Success</span> <span class="id">d</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">pletIt</span> <span class="id">p</span>₁ <span class="id">p</span>₂ =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">bindpr</span> (<span class="id">camp_eval</span> <span class="id">p</span>₁ <span class="id">bind</span> <span class="id">d</span>) (<span class="id">camp_eval</span> <span class="id">p</span>₂ <span class="id">bind</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">pgetConstant</span> <span class="id">s</span> =&gt; <span class="id">op2tpr</span> (<span class="id">edot</span> <span class="id">constant_env</span> <span class="id">s</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">penv</span> =&gt; <span class="id">Success</span> (<span class="id">drec</span> <span class="id">bind</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">pletEnv</span> <span class="id">p</span>₁ <span class="id">p</span>₂ =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">bindpr</span> (<span class="id">camp_eval</span> <span class="id">p</span>₁ <span class="id">bind</span> <span class="id">d</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">fun</span> <span class="id">rd</span>'₁ =&gt; <span class="kwd">match</span> <span class="id">rd</span>'₁ <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">drec</span> <span class="id">d</span>'₁ =&gt; <span class="kwd">match</span> <span class="id">merge_bindings</span> <span class="id">bind</span> <span class="id">d</span>'₁ <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">Some</span> <span class="id">bind</span>' =&gt; <span class="id">camp_eval</span> <span class="id">p</span>₂ <span class="id">bind</span>' <span class="id">d</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">None</span> =&gt; <span class="id">RecoverableError</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">_</span> =&gt; <span class="id">TerminalError</span> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">pleft</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">d</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">dleft</span> <span class="id">d</span>' =&gt; <span class="id">Success</span> <span class="id">d</span>'<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">dright</span> <span class="id">_</span> =&gt; <span class="id">RecoverableError</span> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">_</span> =&gt; <span class="id">TerminalError</span> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">pright</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">d</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">dright</span> <span class="id">d</span>' =&gt; <span class="id">Success</span> <span class="id">d</span>'<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">dleft</span> <span class="id">_</span> =&gt; <span class="id">RecoverableError</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">_</span> =&gt; <span class="id">TerminalError</span> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">End</span> <span class="id">Evaluation</span>.<br/>
<br/>
<h1> Pretty Printing </h1>
<br/>
<div class="doc">Evaluation traces rely on printing support for CAMP's abstract syntax. </div>
&nbsp;&nbsp;&nbsp;&nbsp;<br/>
&nbsp;&nbsp;<span class="kwd">Global</span> <span class="kwd">Instance</span> <span class="id">ToString_camp</span> : <span class="id">ToString</span> <span class="id">camp</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;:= { <span class="id">toString</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">fix</span> <span class="id">toStringp</span> (<span class="id">p</span>:<span class="id">camp</span>) : <span class="id">string</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">p</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">pconst</span> <span class="id">d</span> =&gt; "(<span class="id">pconst</span> " ++ <span class="id">toString</span> <span class="id">d</span> ++ ")"<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">punop</span> <span class="id">u</span> <span class="id">p1</span> =&gt; "(<span class="id">punop</span> " ++ <span class="id">toString</span> <span class="id">u</span> ++ " " ++ <span class="id">toStringp</span> <span class="id">p1</span> ++ ")"<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">pbinop</span> <span class="id">b</span> <span class="id">p1</span> <span class="id">p2</span> =&gt; "(<span class="id">pbinop</span> " ++ <span class="id">toString</span> <span class="id">b</span> ++ " " ++ <span class="id">toStringp</span> <span class="id">p1</span>++ " " ++ <span class="id">toStringp</span> <span class="id">p2</span> ++ ")"<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">pmap</span> <span class="id">p1</span> =&gt; "(<span class="id">pmap</span> " ++ <span class="id">toStringp</span> <span class="id">p1</span> ++ ")"<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">passert</span> <span class="id">p1</span> =&gt; "(<span class="id">passert</span> " ++ <span class="id">toStringp</span> <span class="id">p1</span> ++ ")"<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">porElse</span> <span class="id">p1</span> <span class="id">p2</span> =&gt; "(<span class="id">porElse</span> " ++ <span class="id">toStringp</span> <span class="id">p1</span>++ " " ++ <span class="id">toStringp</span> <span class="id">p2</span> ++ ")"<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">pit</span>  =&gt; "<span class="id">pit</span>"<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">pletIt</span> <span class="id">p1</span> <span class="id">p2</span> =&gt; "(<span class="id">pletIt</span> " ++ <span class="id">toStringp</span> <span class="id">p1</span>++ " " ++ <span class="id">toStringp</span> <span class="id">p2</span> ++ ")"<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">pgetConstant</span> <span class="id">s</span> =&gt; "(<span class="id">pgetConstant</span> " ++ <span class="id">s</span> ++ ")"<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">penv</span> =&gt; "<span class="id">penv</span>"<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">pletEnv</span> <span class="id">p1</span> <span class="id">p2</span> =&gt; "(<span class="id">pletEnv</span> " ++ <span class="id">toStringp</span> <span class="id">p1</span>++ " " ++ <span class="id">toStringp</span> <span class="id">p2</span> ++ ")"<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">pleft</span> =&gt; "<span class="id">pleft</span>"<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">pright</span> =&gt; "<span class="id">pright</span>"<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}.<br/>
&nbsp;&nbsp;<br/>
&nbsp;&nbsp;<span class="kwd">Fixpoint</span> <span class="id">toString_camp_with_path</span> (<span class="id">p</span>:<span class="id">camp</span>) (<span class="id">loc</span>:<span class="id">camp_src_path</span>) :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">loc</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">nil</span> =&gt; <span class="id">bracketString</span> "&lt;&lt;&lt;"  (<span class="id">toString</span> <span class="id">p</span>) "&gt;&gt;&gt;"<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">pos</span>::<span class="id">loc</span>' =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">p</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">pconst</span> <span class="id">d</span> =&gt; "(<span class="id">pconst</span> " ++ <span class="id">toString</span> <span class="id">d</span> ++ ")"<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">punop</span> <span class="id">u</span> <span class="id">p1</span> =&gt; "(<span class="id">punop</span> " ++ <span class="id">toString</span> <span class="id">u</span> ++ " " ++<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">toString_camp_with_path</span> <span class="id">p1</span> <span class="id">loc</span>' ++ ")"<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">pbinop</span> <span class="id">b</span> <span class="id">p1</span> <span class="id">p2</span> =&gt; "(<span class="id">pbinop</span> "<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;++ <span class="id">toString</span> <span class="id">b</span> ++ " " ++<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">if</span> <span class="id">pos</span> == 0<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">then</span> <span class="id">toString_camp_with_path</span> <span class="id">p1</span> <span class="id">loc</span>'<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">else</span> <span class="id">toString</span> <span class="id">p1</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;++ " " ++<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">if</span> <span class="id">pos</span> == 1<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">then</span> <span class="id">toString_camp_with_path</span> <span class="id">p2</span> <span class="id">loc</span>'<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">else</span> <span class="id">toString</span> <span class="id">p2</span>) ++ ")"<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">pmap</span> <span class="id">p1</span> =&gt; "(<span class="id">pmap</span> " ++ <span class="id">toString_camp_with_path</span> <span class="id">p1</span> <span class="id">loc</span>' ++ ")"<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">passert</span> <span class="id">p1</span> =&gt; "(<span class="id">passert</span> " ++ <span class="id">toString_camp_with_path</span> <span class="id">p1</span> <span class="id">loc</span>' ++ ")"<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">porElse</span> <span class="id">p1</span> <span class="id">p2</span> =&gt; "(<span class="id">porElse</span> " ++<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">if</span> <span class="id">pos</span> == 0<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">then</span> <span class="id">toString_camp_with_path</span> <span class="id">p1</span> <span class="id">loc</span>'<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">else</span> <span class="id">toString</span> <span class="id">p1</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;++ " " ++<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">if</span> <span class="id">pos</span> == 1<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">then</span> <span class="id">toString_camp_with_path</span> <span class="id">p2</span> <span class="id">loc</span>'<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">else</span> <span class="id">toString</span> <span class="id">p2</span>) ++ ")"<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">pit</span>  =&gt; "<span class="id">pit</span>"<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">pletIt</span> <span class="id">p1</span> <span class="id">p2</span> =&gt; "(<span class="id">pletIt</span> " ++<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">if</span> <span class="id">pos</span> == 0<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">then</span> <span class="id">toString_camp_with_path</span> <span class="id">p1</span> <span class="id">loc</span>'<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">else</span> <span class="id">toString</span> <span class="id">p1</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;++ " " ++<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">if</span> <span class="id">pos</span> == 1<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">then</span> <span class="id">toString_camp_with_path</span> <span class="id">p2</span> <span class="id">loc</span>'<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">else</span> <span class="id">toString</span> <span class="id">p2</span>) ++ ")"<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">pgetConstant</span> <span class="id">s</span> =&gt; "(<span class="id">pgetConstant</span> " ++ <span class="id">s</span> ++ ")"<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">penv</span> =&gt; "<span class="id">penv</span>"<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">pletEnv</span> <span class="id">p1</span> <span class="id">p2</span> =&gt; "(<span class="id">pletEnv</span> " ++ <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">if</span> <span class="id">pos</span> == 0<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">then</span> <span class="id">toString_camp_with_path</span> <span class="id">p1</span> <span class="id">loc</span>'<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">else</span> <span class="id">toString</span> <span class="id">p1</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;++ " " ++<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">if</span> <span class="id">pos</span> == 1<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">then</span> <span class="id">toString_camp_with_path</span> <span class="id">p2</span> <span class="id">loc</span>'<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">else</span> <span class="id">toString</span> <span class="id">p2</span>) ++ ")"<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">pleft</span> =&gt; "<span class="id">pleft</span>"<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">pright</span> =&gt; "<span class="id">pright</span>"<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<br/>
<h1> Traced Evaluation </h1>
&nbsp;&nbsp;<br/>
<div class="doc">An alternative version of the compiler that keeps debug
     information. While this forces some code duplication, this is
     mitigated by the fact that the evaluation code is relatively
     small and simple. </div>
<br/>
<div class="doc">The context is the same as for default evaluation, with an
  additional printing flag. </div>
<br/>
&nbsp;&nbsp;<span class="kwd">Section</span> <span class="id">EvaluationDebug</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Context</span> (<span class="id">h</span>:<span class="id">brand_relation_t</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Context</span> (<span class="id">constant_env</span>:<span class="id">list</span>(<span class="id">string</span>*<span class="id">data</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Context</span> (<span class="id">print_env</span>:<span class="id">bool</span>).<br/>
<br/>
<div class="doc">The following functions are used to produce error messages. </div>
&nbsp;&nbsp;&nbsp;&nbsp;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id">mk_err</span> (<span class="id">desc</span>:<span class="id">string</span>) (<span class="id">p</span>:<span class="id">camp</span>) (<span class="id">bind</span>:<span class="id">bindings</span>) (<span class="id">it</span>:<span class="id">data</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:= <span class="id">toString</span> <span class="id">p</span> ++ " <span class="id">failed</span>" ++ <span class="id">desc</span> ++ "." ++<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">if</span> <span class="id">print_env</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">then</span> "\<span class="id">n</span> <span class="id">Current</span> <span class="id">environment</span> (<span class="id">env</span>): "<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;++ <span class="id">toString</span> (<span class="id">drec</span> <span class="id">bind</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">else</span> "") ++<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"\<span class="id">n</span> <span class="id">Current</span> <span class="id">scrutinee</span> (<span class="id">it</span>): "<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;++ <span class="id">toString</span> <span class="id">it</span> ++<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"\<span class="id">n</span>".<br/>
&nbsp;&nbsp;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id">punop_err</span> (<span class="id">p</span>:<span class="id">camp</span>) (<span class="id">bind</span>:<span class="id">bindings</span>) (<span class="id">it</span>:<span class="id">data</span>) (<span class="id">d</span>:<span class="id">data</span>) : <span class="id">string</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:= (<span class="id">mk_err</span> "" <span class="id">p</span> <span class="id">bind</span> <span class="id">it</span> ++ " <span class="id">The</span> <span class="id">operator</span>'<span class="id">s</span> <span class="id">argument</span> <span class="id">was</span>: " ++ <span class="id">toString</span> <span class="id">d</span> ++ "\<span class="id">n</span>").<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id">binop_err</span> (<span class="id">p</span>:<span class="id">camp</span>) (<span class="id">bind</span>:<span class="id">bindings</span>) (<span class="id">it</span>:<span class="id">data</span>) (<span class="id">d</span>'₁ <span class="id">d</span>'₂:<span class="id">data</span>) : <span class="id">string</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:= (<span class="id">mk_err</span> "" <span class="id">p</span> <span class="id">bind</span> <span class="id">it</span> ++ " <span class="id">The</span> <span class="id">operator</span>'<span class="id">s</span> <span class="id">first</span> <span class="id">argument</span> <span class="id">was</span>: " ++ <span class="id">toString</span> <span class="id">d</span>'₁<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;++ "\<span class="id">n</span> <span class="id">The</span> <span class="id">operator</span>'<span class="id">s</span> <span class="id">second</span> <span class="id">argument</span> <span class="id">was</span>: " ++ <span class="id">toString</span> <span class="id">d</span>'₂<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;++ "\<span class="id">n</span>").<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id">pmap_err</span> (<span class="id">p</span>:<span class="id">camp</span>) (<span class="id">bind</span>:<span class="id">bindings</span>) (<span class="id">it</span>:<span class="id">data</span>) : <span class="id">string</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:= <span class="id">mk_err</span> " <span class="id">because</span> <span class="id">the</span> <span class="id">scrutinee</span> <span class="id">was</span> <span class="id">not</span> <span class="id">a</span> <span class="id">collection</span>" <span class="id">p</span> <span class="id">bind</span> <span class="id">it</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id">passert_err</span> (<span class="id">p</span>:<span class="id">camp</span>) (<span class="id">bind</span>:<span class="id">bindings</span>) (<span class="id">it</span> <span class="id">d</span>:<span class="id">data</span>) : <span class="id">string</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:= <span class="id">mk_err</span> " <span class="id">because</span> <span class="id">the</span> <span class="id">argument</span> <span class="id">was</span> <span class="id">not</span> <span class="id">a</span> <span class="id">boolean</span>" <span class="id">p</span> <span class="id">bind</span> <span class="id">it</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;++ " <span class="id">The</span> <span class="id">argument</span> <span class="id">to</span> <span class="id">passert</span> <span class="id">was</span>: " ++ <span class="id">toString</span> <span class="id">d</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;++ "\<span class="id">n</span>".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id">pletEnv_err</span> (<span class="id">p</span>:<span class="id">camp</span>) (<span class="id">bind</span>:<span class="id">bindings</span>) (<span class="id">it</span> <span class="id">d</span>:<span class="id">data</span>) : <span class="id">string</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:= <span class="id">mk_err</span> " <span class="id">because</span> <span class="id">its</span> <span class="id">first</span> <span class="id">argument</span> <span class="id">was</span> <span class="id">not</span> <span class="id">a</span> <span class="id">record</span>" <span class="id">p</span> <span class="id">bind</span> <span class="id">it</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;++ " <span class="id">The</span> <span class="id">first</span> <span class="id">argument</span> <span class="id">to</span> <span class="id">pletEnv</span> <span class="id">was</span>: " ++ <span class="id">toString</span> <span class="id">d</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id">pleft_err</span> (<span class="id">bind</span>:<span class="id">bindings</span>) (<span class="id">it</span>:<span class="id">data</span>) : <span class="id">string</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:= <span class="id">mk_err</span> " <span class="id">because</span> <span class="id">the</span> <span class="id">scrutinee</span> <span class="id">was</span> <span class="id">an</span> <span class="id">incompatible</span> <span class="id">type</span>" <span class="id">pleft</span> <span class="id">bind</span> <span class="id">it</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id">pright_err</span> (<span class="id">bind</span>:<span class="id">bindings</span>) (<span class="id">it</span>:<span class="id">data</span>) : <span class="id">string</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:= <span class="id">mk_err</span> " <span class="id">because</span> <span class="id">the</span> <span class="id">scrutinee</span> <span class="id">was</span> <span class="id">an</span> <span class="id">incompatible</span> <span class="id">type</span>" <span class="id">pright</span> <span class="id">bind</span> <span class="id">it</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id">pgetConstant_err</span> <span class="id">s</span> (<span class="id">bind</span>:<span class="id">bindings</span>) (<span class="id">it</span>:<span class="id">data</span>) : <span class="id">string</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:= <span class="id">mk_err</span> (" <span class="id">because</span> <span class="id">the</span> <span class="id">given</span> <span class="id">field</span> (" ++ <span class="id">s</span> ++<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;") <span class="id">is</span> <span class="id">not</span> <span class="id">a</span> <span class="id">valid</span> <span class="id">constant</span>") (<span class="id">pgetConstant</span> <span class="id">s</span>) <span class="id">bind</span> <span class="id">it</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;++ " <span class="id">The</span> <span class="tactic">set</span> <span class="id">of</span> <span class="id">constants</span> <span class="kwd">for</span> <span class="id">this</span> <span class="id">execution</span> <span class="id">is</span>: " ++<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">bracketString</span> "{" (<span class="id">joinStrings</span> "; " (<span class="id">domain</span> <span class="id">constant_env</span>)) "}")<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;++ "\<span class="id">n</span>".<br/>
<br/>
<div class="doc">The alternative traced evaluation is defined as follows. </div>
&nbsp;&nbsp;&nbsp;&nbsp;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Fixpoint</span> <span class="id">camp_eval_debug</span> (<span class="id">loc</span>:<span class="id">camp_src_path</span>) (<span class="id">p</span>:<span class="id">camp</span>) (<span class="id">bind</span>:<span class="id">bindings</span>) (<span class="id">d</span>:<span class="id">data</span>) : <span class="id">presult_debug</span> <span class="id">data</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:= <span class="kwd">match</span> <span class="id">p</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">pconst</span> <span class="id">d</span>' =&gt; <span class="id">Success_debug</span> (<span class="id">normalize_data</span> <span class="id">h</span> <span class="id">d</span>')<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">punop</span> <span class="id">op</span> <span class="id">p</span>₁ =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">camp_eval_debug</span> (0::<span class="id">loc</span>) <span class="id">p</span>₁ <span class="id">bind</span> <span class="id">d</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">TerminalError_debug</span> <span class="id">s</span> <span class="id">loc</span>' =&gt; <span class="id">TerminalError_debug</span> <span class="id">s</span> <span class="id">loc</span>'<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">RecoverableError_debug</span> <span class="id">s</span> =&gt; <span class="id">RecoverableError_debug</span> <span class="id">s</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">Success_debug</span> <span class="id">d</span>' =&gt; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">fun_of_unaryop</span> <span class="id">h</span> <span class="id">op</span> <span class="id">d</span>' <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">None</span> =&gt; <span class="id">TerminalError_debug</span> (<span class="id">punop_err</span> (<span class="id">punop</span> <span class="id">op</span> <span class="id">p</span>₁) <span class="id">bind</span> <span class="id">d</span> <span class="id">d</span>')  <span class="id">loc</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">Some</span> <span class="id">x</span> =&gt; <span class="id">Success_debug</span> <span class="id">x</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">pbinop</span> <span class="id">op</span> <span class="id">p</span>₁ <span class="id">p</span>₂ =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">camp_eval_debug</span> (0::<span class="id">loc</span>) <span class="id">p</span>₁ <span class="id">bind</span> <span class="id">d</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">TerminalError_debug</span> <span class="id">s</span> <span class="id">loc</span>' =&gt; <span class="id">TerminalError_debug</span> <span class="id">s</span> <span class="id">loc</span>'<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">RecoverableError_debug</span> <span class="id">s</span> =&gt; <span class="id">RecoverableError_debug</span> <span class="id">s</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">Success_debug</span> <span class="id">d</span>'₁ =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">camp_eval_debug</span> (1::<span class="id">loc</span>) <span class="id">p</span>₂ <span class="id">bind</span> <span class="id">d</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">TerminalError_debug</span> <span class="id">s</span> <span class="id">loc</span>' =&gt; <span class="id">TerminalError_debug</span> <span class="id">s</span> <span class="id">loc</span>'<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">RecoverableError_debug</span> <span class="id">s</span> =&gt; <span class="id">RecoverableError_debug</span> <span class="id">s</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">Success_debug</span> <span class="id">d</span>'₂ =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">fun_of_binop</span> <span class="id">h</span> <span class="id">op</span> <span class="id">d</span>'₁ <span class="id">d</span>'₂ <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">None</span> =&gt; <span class="id">TerminalError_debug</span> (<span class="id">binop_err</span> (<span class="id">pbinop</span> <span class="id">op</span> <span class="id">p</span>₁ <span class="id">p</span>₂) <span class="id">bind</span> <span class="id">d</span> <span class="id">d</span>'₁ <span class="id">d</span>'₂)  <span class="id">loc</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">Some</span> <span class="id">x</span> =&gt; <span class="id">Success_debug</span> <span class="id">x</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">pmap</span> <span class="id">p</span>₁ =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">d</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">dcoll</span> <span class="id">l</span> =&gt; <span class="id">liftpr_debug</span> <span class="id">dcoll</span> (<span class="id">gather_successes_debug</span> (<span class="id">map</span> (<span class="id">camp_eval_debug</span> (0::<span class="id">loc</span>) <span class="id">p</span>₁ <span class="id">bind</span>) <span class="id">l</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">_</span> =&gt; <span class="id">TerminalError_debug</span> (<span class="id">pmap_err</span> (<span class="id">pmap</span> <span class="id">p</span>₁) <span class="id">bind</span> <span class="id">d</span>) <span class="id">loc</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">passert</span> <span class="id">p</span>₁ =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">camp_eval_debug</span> (0::<span class="id">loc</span>) <span class="id">p</span>₁ <span class="id">bind</span> <span class="id">d</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">TerminalError_debug</span> <span class="id">s</span> <span class="id">loc</span>' =&gt; <span class="id">TerminalError_debug</span> <span class="id">s</span> <span class="id">loc</span>'<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">RecoverableError_debug</span> <span class="id">s</span> =&gt; <span class="id">RecoverableError_debug</span> <span class="id">s</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">Success_debug</span> <span class="id">d</span>' =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">d</span>' <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">dbool</span> <span class="id">true</span> =&gt; <span class="id">Success_debug</span> (<span class="id">drec</span> <span class="id">nil</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">dbool</span> <span class="id">false</span> =&gt; <span class="id">RecoverableError_debug</span> "<span class="id">assertion</span> <span class="id">failure</span>"<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">_</span> =&gt; <span class="id">TerminalError_debug</span> (<span class="id">passert_err</span> (<span class="id">passert</span> <span class="id">p</span>₁) <span class="id">bind</span> <span class="id">d</span> <span class="id">d</span>') <span class="id">loc</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">porElse</span> <span class="id">p</span>₁ <span class="id">p</span>₂ =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">camp_eval_debug</span> (0::<span class="id">loc</span>) <span class="id">p</span>₁ <span class="id">bind</span> <span class="id">d</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">TerminalError_debug</span> <span class="id">s</span> <span class="id">loc</span>' =&gt; <span class="id">TerminalError_debug</span> <span class="id">s</span> <span class="id">loc</span>'<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">RecoverableError_debug</span> <span class="id">_</span> =&gt; <span class="id">camp_eval_debug</span> (1::<span class="id">loc</span>) <span class="id">p</span>₂ <span class="id">bind</span> <span class="id">d</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">Success_debug</span> <span class="id">x</span> =&gt; <span class="id">Success_debug</span> <span class="id">x</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">pit</span> =&gt; <span class="id">Success_debug</span> <span class="id">d</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">pletIt</span> <span class="id">p</span>₁ <span class="id">p</span>₂ =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">camp_eval_debug</span> (0::<span class="id">loc</span>) <span class="id">p</span>₁ <span class="id">bind</span> <span class="id">d</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">TerminalError_debug</span> <span class="id">s</span> <span class="id">loc</span>' =&gt; <span class="id">TerminalError_debug</span> <span class="id">s</span> <span class="id">loc</span>'<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">RecoverableError_debug</span> <span class="id">s</span> =&gt; <span class="id">RecoverableError_debug</span> <span class="id">s</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">Success_debug</span> <span class="id">x</span> =&gt; <span class="id">camp_eval_debug</span> (1::<span class="id">loc</span>) <span class="id">p</span>₂ <span class="id">bind</span> <span class="id">x</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">pgetConstant</span> <span class="id">s</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">edot</span> <span class="id">constant_env</span> <span class="id">s</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">Some</span> <span class="id">x</span> =&gt; <span class="id">Success_debug</span> <span class="id">x</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">None</span> =&gt; <span class="id">TerminalError_debug</span> (<span class="id">pgetConstant_err</span> <span class="id">s</span> <span class="id">bind</span> <span class="id">d</span>) <span class="id">loc</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">penv</span> =&gt; <span class="id">Success_debug</span> (<span class="id">drec</span> <span class="id">bind</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">pletEnv</span> <span class="id">p</span>₁ <span class="id">p</span>₂ =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">camp_eval_debug</span> (0::<span class="id">loc</span>) <span class="id">p</span>₁ <span class="id">bind</span> <span class="id">d</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">TerminalError_debug</span> <span class="id">s</span> <span class="id">loc</span>' =&gt; <span class="id">TerminalError_debug</span> <span class="id">s</span> <span class="id">loc</span>'<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">RecoverableError_debug</span> <span class="id">s</span> =&gt; <span class="id">RecoverableError_debug</span> <span class="id">s</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">Success_debug</span> <span class="id">rd</span>'₁ =&gt; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">rd</span>'₁ <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">drec</span> <span class="id">d</span>'₁ =&gt; <span class="kwd">match</span> <span class="id">merge_bindings</span> <span class="id">bind</span> <span class="id">d</span>'₁ <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">Some</span> <span class="id">bind</span>' =&gt; <span class="id">camp_eval_debug</span> (1::<span class="id">loc</span>) <span class="id">p</span>₂ <span class="id">bind</span>' <span class="id">d</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">None</span> =&gt; <span class="id">RecoverableError_debug</span> "<span class="id">bindings</span> <span class="id">could</span> <span class="id">not</span> <span class="id">be</span> <span class="id">unfied</span>"<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">_</span> =&gt; <span class="id">TerminalError_debug</span> (<span class="id">pletEnv_err</span> (<span class="id">pletEnv</span> <span class="id">p</span>₁ <span class="id">p</span>₂) <span class="id">bind</span> <span class="id">d</span> <span class="id">rd</span>'₁) <span class="id">loc</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">pleft</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">d</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">dleft</span> <span class="id">d</span>' =&gt; <span class="id">Success_debug</span> <span class="id">d</span>'<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">dright</span> <span class="id">_</span> =&gt; <span class="id">RecoverableError_debug</span> "<span class="id">pleft</span> <span class="id">called</span> <span class="id">on</span> <span class="id">a</span> <span class="id">pright</span>"<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">_</span> =&gt; <span class="id">TerminalError_debug</span> (<span class="id">pleft_err</span> <span class="id">bind</span> <span class="id">d</span>) <span class="id">loc</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">pright</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">d</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">dright</span> <span class="id">d</span>' =&gt; <span class="id">Success_debug</span> <span class="id">d</span>'<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">dleft</span> <span class="id">_</span> =&gt; <span class="id">RecoverableError_debug</span> "<span class="id">pright</span> <span class="id">called</span> <span class="id">on</span> <span class="id">a</span> <span class="id">pleft</span>"<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">_</span> =&gt; <span class="id">TerminalError_debug</span> (<span class="id">pright_err</span> <span class="id">bind</span> <span class="id">d</span>) <span class="id">loc</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<div class="doc">The following theorem states that traced evaluation is equivalent to regular evaluation. </div>
&nbsp;&nbsp;&nbsp;&nbsp;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Theorem</span> <span class="id">camp_eval_debug_correct</span> (<span class="id">loc</span>:<span class="id">camp_src_path</span>) (<span class="id">p</span>:<span class="id">camp</span>) (<span class="id">bind</span>:<span class="id">bindings</span>) (<span class="id">d</span>:<span class="id">data</span>) :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">presult_same</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">camp_eval</span> <span class="id">h</span> <span class="id">constant_env</span> <span class="id">p</span> <span class="id">bind</span> <span class="id">d</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">camp_eval_debug</span> <span class="id">loc</span> <span class="id">p</span> <span class="id">bind</span> <span class="id">d</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2676')">Proof.</div>
<div class="proofscript" id="proof2676">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">revert</span> <span class="id">loc</span> <span class="id">bind</span> <span class="id">d</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">camp_cases</span> (<span class="tactic">induction</span> <span class="id">p</span>) <span class="id">Case</span>; <span class="tactic">simpl</span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">trivial</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">apply</span> <span class="id">bindpr_presult_same</span>; [<span class="tactic">eauto</span> | ]; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">fun_of_unaryop</span> <span class="id">h</span> <span class="id">u</span> <span class="id">x</span>); <span class="tactic">simpl</span>; <span class="tactic">trivial</span>. <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">apply</span> <span class="id">bindpr_presult_same</span>; [<span class="tactic">eauto</span> | ]; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">bindpr_presult_same</span>; [<span class="tactic">eauto</span> | ]; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">fun_of_binop</span> <span class="id">h</span> <span class="id">b</span> <span class="id">x</span> <span class="id">x0</span>); <span class="tactic">simpl</span>; <span class="tactic">trivial</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">destruct</span> <span class="id">d</span>; <span class="tactic">simpl</span>; <span class="tactic">trivial</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">liftpr_presult_same</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">gather_successes_presult_same</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">Forall2_map</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">Forall2_refl</span>; <span class="tactic">red</span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">IHp</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">apply</span> <span class="id">bindpr_presult_same</span>; [<span class="tactic">eauto</span> | ]; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">x</span>; <span class="tactic">simpl</span>; <span class="tactic">trivial</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">b</span>; <span class="tactic">simpl</span>; <span class="tactic">trivial</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">specialize</span> (<span class="id">IHp1</span> (0::<span class="id">loc</span>) <span class="id">bind</span> <span class="id">d</span>); <span class="tactic">red</span> <span class="kwd">in</span> <span class="id">IHp1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="id">match_destr_in</span> <span class="id">IHp1</span>; <span class="tactic">try</span> <span class="tactic">tauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">trivial</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">apply</span> <span class="id">bindpr_presult_same</span>; [<span class="tactic">eauto</span> | ]; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">unfold</span> <span class="id">op2tpr</span>. <span class="id">match_destr</span>; <span class="tactic">simpl</span>; <span class="tactic">trivial</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">trivial</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">apply</span> <span class="id">bindpr_presult_same</span>; [<span class="tactic">eauto</span> | ]; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">x</span>; <span class="tactic">simpl</span>; <span class="tactic">trivial</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">merge_bindings</span> <span class="id">bind</span> <span class="id">l</span>); <span class="tactic">simpl</span>; <span class="tactic">trivial</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">destruct</span> <span class="id">d</span>; <span class="tactic">simpl</span>; <span class="tactic">trivial</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">destruct</span> <span class="id">d</span>; <span class="tactic">simpl</span>; <span class="tactic">trivial</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">End</span> <span class="id">EvaluationDebug</span>.<br/>
<br/>
<h1> Toplevel </h1>
&nbsp;&nbsp;<br/>
<div class="doc">Top-level evaluation functions are used externally by the Q*cert
  compiler. They take a CAMP pattern and a global environment as
  input. The initial local environment is set to an empty record, and
  the initial current value to unit. </div>
<br/>
<div class="doc">The result of evaluation is lifted back from presult to and
  optional value for consistency with evaluation functions for the
  other intermediate languages. </div>
&nbsp;&nbsp;<br/>
&nbsp;&nbsp;<span class="kwd">Section</span> <span class="id">Top</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Context</span> (<span class="id">h</span>:<span class="id">brand_relation_t</span>).<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id">presult_to_result</span> (<span class="id">pr</span>:<span class="id">presult</span> <span class="id">data</span>) : <span class="id">option</span> <span class="id">data</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">pr</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">Success</span> <span class="id">l</span> =&gt; <span class="id">Some</span> (<span class="id">dcoll</span> (<span class="id">l</span>::<span class="id">nil</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">RecoverableError</span> =&gt; <span class="id">Some</span> (<span class="id">dcoll</span> <span class="id">nil</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">TerminalError</span> =&gt; <span class="id">None</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id">camp_eval_top_to_presult</span> (<span class="id">q</span>:<span class="id">camp</span>) (<span class="id">global_env</span>:<span class="id">bindings</span>) : <span class="id">presult</span> <span class="id">data</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">camp_eval</span> <span class="id">h</span> (<span class="id">rec_sort</span> <span class="id">global_env</span>) <span class="id">q</span> <span class="id">nil</span> <span class="id">dunit</span>.<br/>
<br/>
<div class="doc">The main top-level evaluation function for CAMP is as follows. </div>
&nbsp;&nbsp;&nbsp;&nbsp;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id">camp_eval_top</span> (<span class="id">q</span>:<span class="id">camp</span>) (<span class="id">global_env</span>:<span class="id">bindings</span>) : <span class="id">option</span> <span class="id">data</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">presult_to_result</span> (<span class="id">camp_eval_top_to_presult</span> <span class="id">q</span> <span class="id">global_env</span>).<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id">presult_to_result_debug</span> (<span class="id">pr</span>:<span class="id">presult_debug</span> <span class="id">data</span>) : <span class="id">option</span> <span class="id">data</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">pr</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">Success_debug</span> <span class="id">l</span> =&gt; <span class="id">Some</span> (<span class="id">dcoll</span> (<span class="id">l</span>::<span class="id">nil</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">RecoverableError_debug</span> <span class="id">_</span> =&gt; <span class="id">Some</span> (<span class="id">dcoll</span> <span class="id">nil</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">TerminalError_debug</span> <span class="id">_</span> <span class="id">_</span> =&gt; <span class="id">None</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id">pr2op_debug</span> (<span class="id">pr</span>:<span class="id">presult_debug</span> <span class="id">data</span>) : <span class="id">option</span> <span class="id">data</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">pr</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">Success_debug</span> <span class="id">l</span> =&gt; <span class="id">Some</span> (<span class="id">dsome</span> <span class="id">l</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">RecoverableError_debug</span> <span class="id">_</span> =&gt; <span class="id">Some</span> <span class="id">dnone</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">TerminalError_debug</span> <span class="id">_</span> <span class="id">_</span> =&gt; <span class="id">None</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id">camp_eval_top_debug_to_presult_debug</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">debug</span>:<span class="id">bool</span>) (<span class="id">q</span>:<span class="id">camp</span>) (<span class="id">global_env</span>:<span class="id">bindings</span>) : <span class="id">presult_debug</span> <span class="id">data</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">camp_eval_debug</span> <span class="id">h</span> (<span class="id">rec_sort</span> <span class="id">global_env</span>) <span class="id">debug</span> <span class="id">nil</span> <span class="id">q</span> <span class="id">nil</span> <span class="id">dunit</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Theorem</span> <span class="id">camp_eval_top_debug_correct</span> (<span class="id">debug</span>:<span class="id">bool</span>) (<span class="id">p</span>:<span class="id">camp</span>) (<span class="id">global_env</span>:<span class="id">bindings</span>) (<span class="id">d</span>:<span class="id">data</span>) :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">presult_same</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">camp_eval_top_to_presult</span> <span class="id">p</span> <span class="id">global_env</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">camp_eval_top_debug_to_presult_debug</span> <span class="id">debug</span> <span class="id">p</span> <span class="id">global_env</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2677')">Proof.</div>
<div class="proofscript" id="proof2677">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">camp_eval_top_to_presult</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">camp_eval_top_debug_to_presult_debug</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">camp_eval_debug_correct</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
&nbsp;&nbsp;&nbsp;&nbsp;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id">camp_eval_top_debug_to_data</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">debug</span>:<span class="id">bool</span>) (<span class="id">q</span>:<span class="id">camp</span>) (<span class="id">global_env</span>:<span class="id">bindings</span>) : <span class="id">option</span> <span class="id">data</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">presult_to_result_debug</span> (<span class="id">camp_eval_debug</span> <span class="id">h</span> (<span class="id">rec_sort</span> <span class="id">global_env</span>) <span class="id">debug</span> <span class="id">nil</span> <span class="id">q</span> <span class="id">nil</span> <span class="id">dunit</span>).<br/>
<br/>
<div class="doc">The main top-level traced evaluation function for CAMP is as follows. </div>
&nbsp;&nbsp;&nbsp;&nbsp;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id">camp_eval_top_debug</span> (<span class="id">debug</span>:<span class="id">bool</span>) (<span class="id">q</span>:<span class="id">camp</span>) (<span class="id">global_env</span>:<span class="id">bindings</span>) : <span class="id">string</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">print_presult_debug</span> <span class="id">q</span> <span class="id">toString_camp_with_path</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">camp_eval_top_debug_to_presult_debug</span> <span class="id">debug</span> <span class="id">q</span> <span class="id">global_env</span>).<br/>
&nbsp;&nbsp;<span class="kwd">End</span> <span class="id">Top</span>.<br/>
<br/>
<span class="kwd">End</span> <span class="id">CAMP</span>.<br/>
<br/>
<span class="kwd">Tactic</span> <span class="kwd">Notation</span> "<span class="id">camp_cases</span>" <span class="id">tactic</span>(<span class="id">first</span>) <span class="id">ident</span>(<span class="id">c</span>) :=<br/>
&nbsp;&nbsp;<span class="id">first</span>;<br/>
&nbsp;&nbsp;[ <span class="id">Case_aux</span> <span class="id">c</span> "<span class="id">pconst</span>"%<span class="id">string</span><br/>
&nbsp;&nbsp;| <span class="id">Case_aux</span> <span class="id">c</span> "<span class="id">punop</span>"%<span class="id">string</span><br/>
&nbsp;&nbsp;| <span class="id">Case_aux</span> <span class="id">c</span> "<span class="id">pbinop</span>"%<span class="id">string</span><br/>
&nbsp;&nbsp;| <span class="id">Case_aux</span> <span class="id">c</span> "<span class="id">pmap</span>"%<span class="id">string</span><br/>
&nbsp;&nbsp;| <span class="id">Case_aux</span> <span class="id">c</span> "<span class="id">passert</span>"%<span class="id">string</span><br/>
&nbsp;&nbsp;| <span class="id">Case_aux</span> <span class="id">c</span> "<span class="id">porElse</span>"%<span class="id">string</span><br/>
&nbsp;&nbsp;| <span class="id">Case_aux</span> <span class="id">c</span> "<span class="id">pit</span>"%<span class="id">string</span><br/>
&nbsp;&nbsp;| <span class="id">Case_aux</span> <span class="id">c</span> "<span class="id">pletIt</span>"%<span class="id">string</span><br/>
&nbsp;&nbsp;| <span class="id">Case_aux</span> <span class="id">c</span> "<span class="id">pgetConstant</span>"%<span class="id">string</span><br/>
&nbsp;&nbsp;| <span class="id">Case_aux</span> <span class="id">c</span> "<span class="id">penv</span>"%<span class="id">string</span><br/>
&nbsp;&nbsp;| <span class="id">Case_aux</span> <span class="id">c</span> "<span class="id">pletEnv</span>"%<span class="id">string</span><br/>
&nbsp;&nbsp;| <span class="id">Case_aux</span> <span class="id">c</span> "<span class="id">pleft</span>"%<span class="id">string</span><br/>
&nbsp;&nbsp;| <span class="id">Case_aux</span> <span class="id">c</span> "<span class="id">pright</span>"%<span class="id">string</span>].<br/>
<br/>

</div>
<div class="footer"><hr/>Generated by <a href="https://github.com/xavierleroy/coq2html/">coq2html</div>
</body>
</html>
