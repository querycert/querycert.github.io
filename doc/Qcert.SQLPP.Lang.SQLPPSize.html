
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Module Qcert.SQLPP.Lang.SQLPPSize</title>
<meta name="description" content="Documentation of Coq module Qcert.SQLPP.Lang.SQLPPSize" />
<link href="coq2html.css" rel="stylesheet" type="text/css" />
<script type="text/javascript" src="coq2html.js"> </script>
</head>

<body onload="hideAll('proofscript')">
<h1 class="title">Module Qcert.SQLPP.Lang.SQLPPSize</h1>
<div class="coq">
<br/>
<span class="kwd">Section</span> <span class="id">SQLPPSize</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id">String</span>.<br/>
&nbsp;&nbsp;<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id">ZArith</span>.<br/>
&nbsp;&nbsp;<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id">List</span>.<br/>
&nbsp;&nbsp;<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id">Arith</span>.<br/>
&nbsp;&nbsp;<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id">EquivDec</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id">Utils</span> <span class="id">BasicSystem</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id">SQLPP</span>.<br/>
&nbsp;&nbsp;<br/>
&nbsp;&nbsp;<span class="kwd">Context</span> {<span class="id">fruntime</span>:<span class="id">foreign_runtime</span>}.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Section</span> <span class="id">size</span>.<br/>
&nbsp;&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id">sqlpp_string_option_size</span> (<span class="id">name</span> : <span class="id">option</span> <span class="id">string</span>) :=<br/>
&nbsp;<span class="kwd">match</span> <span class="id">name</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id">None</span> =&gt; 0<br/>
&nbsp;&nbsp;| <span class="id">Some</span> <span class="id">_</span> =&gt; 1<br/>
&nbsp;<span class="kwd">end</span>.<br/>
&nbsp;&nbsp;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Fixpoint</span> <span class="id">sqlpp_expr_size</span> (<span class="id">q</span>:<span class="id">sqlpp_expr</span>) :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">q</span> <span class="kwd">with</span><br/>
&nbsp;| <span class="id">SPPositive</span> <span class="id">expr</span><br/>
&nbsp;| <span class="id">SPNegative</span> <span class="id">expr</span><br/>
&nbsp;&nbsp;&nbsp;| <span class="id">SPExists</span> <span class="id">expr</span><br/>
&nbsp;&nbsp;&nbsp;| <span class="id">SPNot</span> <span class="id">expr</span><br/>
&nbsp;&nbsp;&nbsp;| <span class="id">SPIsNull</span> <span class="id">expr</span><br/>
&nbsp;&nbsp;&nbsp;| <span class="id">SPIsMissing</span> <span class="id">expr</span><br/>
&nbsp;&nbsp;&nbsp;| <span class="id">SPIsUnknown</span> <span class="id">expr</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;=&gt; 1 + (<span class="id">sqlpp_expr_size</span>  <span class="id">expr</span>)<br/>
&nbsp;| <span class="id">SPPlus</span>  <span class="id">e1</span> <span class="id">e2</span><br/>
&nbsp;&nbsp;&nbsp;| <span class="id">SPMinus</span>  <span class="id">e1</span> <span class="id">e2</span><br/>
&nbsp;&nbsp;&nbsp;| <span class="id">SPMult</span>  <span class="id">e1</span> <span class="id">e2</span><br/>
&nbsp;&nbsp;&nbsp;| <span class="id">SPDiv</span>  <span class="id">e1</span> <span class="id">e2</span><br/>
&nbsp;&nbsp;&nbsp;| <span class="id">SPMod</span>  <span class="id">e1</span> <span class="id">e2</span><br/>
&nbsp;&nbsp;&nbsp;| <span class="id">SPExp</span>  <span class="id">e1</span> <span class="id">e2</span><br/>
&nbsp;&nbsp;&nbsp;| <span class="id">SPConcat</span>  <span class="id">e1</span> <span class="id">e2</span><br/>
&nbsp;&nbsp;&nbsp;| <span class="id">SPIn</span>  <span class="id">e1</span> <span class="id">e2</span><br/>
&nbsp;&nbsp;&nbsp;| <span class="id">SPEq</span>  <span class="id">e1</span> <span class="id">e2</span><br/>
&nbsp;&nbsp;&nbsp;| <span class="id">SPFuzzyEq</span> <span class="id">e1</span> <span class="id">e2</span><br/>
&nbsp;&nbsp;&nbsp;| <span class="id">SPNeq</span>  <span class="id">e1</span> <span class="id">e2</span><br/>
&nbsp;&nbsp;&nbsp;| <span class="id">SPLt</span>  <span class="id">e1</span> <span class="id">e2</span><br/>
&nbsp;&nbsp;&nbsp;| <span class="id">SPGt</span>  <span class="id">e1</span> <span class="id">e2</span><br/>
&nbsp;&nbsp;&nbsp;| <span class="id">SPLe</span>  <span class="id">e1</span> <span class="id">e2</span><br/>
&nbsp;&nbsp;&nbsp;| <span class="id">SPGe</span>  <span class="id">e1</span> <span class="id">e2</span><br/>
&nbsp;&nbsp;&nbsp;| <span class="id">SPAnd</span>  <span class="id">e1</span> <span class="id">e2</span><br/>
&nbsp;&nbsp;&nbsp;| <span class="id">SPOr</span>  <span class="id">e1</span> <span class="id">e2</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;=&gt; 1 + (<span class="id">sqlpp_expr_size</span>  <span class="id">e1</span>) + (<span class="id">sqlpp_expr_size</span>  <span class="id">e2</span>)<br/>
&nbsp;&nbsp;&nbsp;| <span class="id">SPLike</span>  <span class="id">e1</span> <span class="id">e2</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;=&gt; 1 + (<span class="id">sqlpp_expr_size</span>  <span class="id">e1</span>)<br/>
&nbsp;| <span class="id">SPBetween</span>  <span class="id">e1</span> <span class="id">e2</span> <span class="id">e3</span><br/>
&nbsp;&nbsp;=&gt; 1 + (<span class="id">sqlpp_expr_size</span>  <span class="id">e1</span>) + (<span class="id">sqlpp_expr_size</span>  <span class="id">e2</span>) + (<span class="id">sqlpp_expr_size</span>  <span class="id">e3</span>)<br/>
&nbsp;| <span class="id">SPSimpleCase</span>  <span class="id">e</span> <span class="id">l</span> <span class="id">o</span><br/>
&nbsp;&nbsp;=&gt; <span class="kwd">match</span> <span class="id">o</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id">None</span> =&gt; 1 + (<span class="id">sqlpp_expr_size</span> <span class="id">e</span>) + (<span class="id">List.fold_left</span> (<span class="kwd">fun</span> <span class="id">acc</span> <span class="id">whenthen</span> =&gt; <span class="id">acc</span> + (<span class="id">whenthen_size</span> <span class="id">whenthen</span>)) <span class="id">l</span> 0)<br/>
&nbsp;&nbsp;| <span class="id">Some</span> <span class="id">oe</span> =&gt; 1 + (<span class="id">sqlpp_expr_size</span> <span class="id">e</span>) + (<span class="id">List.fold_left</span> (<span class="kwd">fun</span> <span class="id">acc</span> <span class="id">whenthen</span> =&gt; <span class="id">acc</span> + (<span class="id">whenthen_size</span> <span class="id">whenthen</span>)) <span class="id">l</span> 0) + (<span class="id">sqlpp_expr_size</span> <span class="id">oe</span>)<br/>
&nbsp;&nbsp;<span class="kwd">end</span><br/>
&nbsp;| <span class="id">SPSearchedCase</span> <span class="id">l</span> <span class="id">o</span><br/>
&nbsp;&nbsp;=&gt; <span class="kwd">match</span> <span class="id">o</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id">None</span> =&gt; 1 + (<span class="id">List.fold_left</span> (<span class="kwd">fun</span> <span class="id">acc</span> <span class="id">whenthen</span> =&gt; <span class="id">acc</span> + (<span class="id">whenthen_size</span> <span class="id">whenthen</span>)) <span class="id">l</span> 0)<br/>
&nbsp;&nbsp;| <span class="id">Some</span> <span class="id">oe</span> =&gt; 1 + (<span class="id">List.fold_left</span> (<span class="kwd">fun</span> <span class="id">acc</span> <span class="id">whenthen</span> =&gt; <span class="id">acc</span> + (<span class="id">whenthen_size</span> <span class="id">whenthen</span>)) <span class="id">l</span> 0) + (<span class="id">sqlpp_expr_size</span> <span class="id">oe</span>)<br/>
&nbsp;&nbsp;<span class="kwd">end</span><br/>
&nbsp;| <span class="id">SPSome</span>  <span class="id">l</span> <span class="id">e</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">SPEvery</span> <span class="id">l</span> <span class="id">e</span><br/>
&nbsp;&nbsp;=&gt; 1 + (<span class="id">List.fold_left</span> (<span class="kwd">fun</span> <span class="id">acc</span> <span class="id">p</span> =&gt; <span class="id">acc</span> + (1 + (<span class="id">sqlpp_expr_size</span> (<span class="id">snd</span> <span class="id">p</span>)))) <span class="id">l</span> 0) + (<span class="id">sqlpp_expr_size</span>  <span class="id">e</span>)<br/>
&nbsp;| <span class="id">SPDot</span>  <span class="id">expr</span> <span class="id">_</span><br/>
&nbsp;&nbsp;=&gt; 1 + (<span class="id">sqlpp_expr_size</span>  <span class="id">expr</span>)                                                              <br/>
&nbsp;| <span class="id">SPIndex</span>  <span class="id">e</span> <span class="id">i</span><br/>
&nbsp;&nbsp;=&gt; 1 + (<span class="id">sqlpp_expr_size</span>  <span class="id">e</span>) + (<span class="id">sqlpp_expr_size</span>  <span class="id">i</span>)<br/>
&nbsp;| <span class="id">SPIndexAny</span> <span class="id">e</span><br/>
&nbsp;&nbsp;=&gt; 1 + (<span class="id">sqlpp_expr_size</span> <span class="id">e</span>)<br/>
&nbsp;| <span class="id">SPLiteral</span> <span class="id">_</span> =&gt; 1<br/>
&nbsp;&nbsp;&nbsp;| <span class="id">SPNull</span><br/>
&nbsp;&nbsp;&nbsp;| <span class="id">SPMissing</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;=&gt; 1                       <br/>
&nbsp;| <span class="id">SPVarRef</span> <span class="id">_</span><br/>
&nbsp;&nbsp;=&gt; 1                                  <br/>
&nbsp;| <span class="id">SPFunctionCall</span> <span class="id">_</span> <span class="id">l</span><br/>
&nbsp;&nbsp;=&gt; 1 + (<span class="id">List.fold_left</span> (<span class="kwd">fun</span> <span class="id">acc</span> <span class="id">expr</span> =&gt; <span class="id">acc</span> + 1 + <span class="id">sqlpp_expr_size</span> <span class="id">expr</span>) <span class="id">l</span> 0)<br/>
&nbsp;| <span class="id">SPArray</span> <span class="id">l</span><br/>
&nbsp;| <span class="id">SPBag</span> <span class="id">l</span><br/>
&nbsp;&nbsp;=&gt; 1 + (<span class="id">List.fold_left</span> (<span class="kwd">fun</span> <span class="id">acc</span> <span class="id">expr</span> =&gt; <span class="id">acc</span> + 1 + <span class="id">sqlpp_expr_size</span> <span class="id">expr</span>) <span class="id">l</span> 0)<br/>
&nbsp;| <span class="id">SPObject</span> <span class="id">l</span><br/>
&nbsp;&nbsp;=&gt; 1 + (<span class="id">List.fold_left</span> (<span class="kwd">fun</span> <span class="id">acc</span> <span class="id">pair</span> =&gt; <span class="id">acc</span> + (1 + (<span class="id">sqlpp_expr_size</span> (<span class="id">snd</span> <span class="id">pair</span>)))) <span class="id">l</span> 0)<br/>
&nbsp;| <span class="id">SPQuery</span> <span class="id">stmt</span><br/>
&nbsp;&nbsp;=&gt; 1 + (<span class="id">sqlpp_statement_size</span> <span class="id">stmt</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br/>
&nbsp;&nbsp;<span class="kwd">with</span> <span class="id">sqlpp_statement_size</span> (<span class="id">stmt</span>: <span class="id">sqlpp_select_statement</span>) :=<br/>
&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">stmt</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;| <span class="id">SPSelectStmt</span> <span class="id">lets</span> <span class="id">block</span> <span class="id">unions</span> (<span class="id">SPOrderBy</span> <span class="id">orders</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;=&gt; 1 + (<span class="id">List.fold_left</span> (<span class="kwd">fun</span> <span class="id">acc</span> <span class="id">p</span> =&gt; <span class="id">acc</span> + (1 + (<span class="id">sqlpp_expr_size</span> (<span class="id">snd</span> <span class="id">p</span>)))) <span class="id">lets</span> 0) + (<span class="id">sqlpp_select_block_size</span> <span class="id">block</span>) +<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">List.fold_left</span> (<span class="kwd">fun</span> <span class="id">acc</span> <span class="id">u</span> =&gt; <span class="id">acc</span> + <span class="id">sqlpp_union_size</span> <span class="id">u</span>) <span class="id">unions</span> 0) + <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">List.fold_left</span> (<span class="kwd">fun</span> <span class="id">acc</span> <span class="id">o</span> =&gt; <span class="id">acc</span> + (<span class="kwd">let</span> '(<span class="id">oo</span>,<span class="id">_</span>) := <span class="id">o</span> <span class="kwd">in</span> 1 + (<span class="id">sqlpp_expr_size</span> <span class="id">oo</span>))) <span class="id">orders</span> 0)<br/>
&nbsp;&nbsp;&nbsp;| <span class="id">SPSelectStmt</span> <span class="id">lets</span> <span class="id">block</span> <span class="id">unions</span> <span class="id">SPNoOrderBy</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;=&gt; 1 + (<span class="id">List.fold_left</span> (<span class="kwd">fun</span> <span class="id">acc</span> <span class="id">p</span> =&gt; <span class="id">acc</span> + (1 + (<span class="id">sqlpp_expr_size</span> (<span class="id">snd</span> <span class="id">p</span>)))) <span class="id">lets</span> 0) + (<span class="id">sqlpp_select_block_size</span> <span class="id">block</span>) +<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">List.fold_left</span> (<span class="kwd">fun</span> <span class="id">acc</span> <span class="id">u</span> =&gt; <span class="id">acc</span> + <span class="id">sqlpp_union_size</span> <span class="id">u</span>) <span class="id">unions</span> 0)<br/>
&nbsp;&nbsp;&nbsp;<span class="kwd">end</span><br/>
&nbsp;&nbsp;&nbsp;<br/>
&nbsp;&nbsp;<span class="kwd">with</span> <span class="id">sqlpp_select_block_size</span> (<span class="id">block</span> : <span class="id">sqlpp_select_block</span>) := <br/>
&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">block</span> <span class="kwd">with</span><br/>
&nbsp;| <span class="id">SPSelectBlock</span> <span class="id">select</span> <span class="id">froms</span> <span class="id">lets1</span> <span class="id">whr</span> <span class="id">groupby</span> <span class="id">lets2</span> <span class="id">having</span><br/>
&nbsp;&nbsp;=&gt; 1 + (<span class="id">sqlpp_select_clause_size</span> <span class="id">select</span>) + (<span class="id">List.fold_left</span> (<span class="kwd">fun</span> <span class="id">acc</span> <span class="id">fr</span> =&gt; <span class="id">acc</span> + (<span class="id">sqlpp_from_size</span> <span class="id">fr</span>)) <span class="id">froms</span> 0) + <br/>
&nbsp;&nbsp;&nbsp;(<span class="id">List.fold_left</span> (<span class="kwd">fun</span> <span class="id">acc</span> <span class="id">p</span> =&gt; <span class="id">acc</span> + (1 + (<span class="id">sqlpp_expr_size</span> (<span class="id">snd</span> <span class="id">p</span>)))) <span class="id">lets1</span> 0) +<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">whr</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">SPNoWhere</span> =&gt; 0<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">SPWhere</span> <span class="id">e</span> =&gt;	1 + (<span class="id">sqlpp_expr_size</span> <span class="id">e</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span> + <br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">sqlpp_group_by_size</span> <span class="id">groupby</span>) + (<span class="id">List.fold_left</span> (<span class="kwd">fun</span> <span class="id">acc</span> <span class="id">p</span> =&gt; <span class="id">acc</span> + (1 + (<span class="id">sqlpp_expr_size</span> (<span class="id">snd</span> <span class="id">p</span>)))) <span class="id">lets1</span> 0) +<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">having</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id">None</span> =&gt; 0<br/>
&nbsp;&nbsp;| <span class="id">Some</span> <span class="id">expr</span> =&gt; <span class="id">sqlpp_expr_size</span> <span class="id">expr</span><br/>
&nbsp;&nbsp;<span class="kwd">end</span><br/>
&nbsp;&nbsp;&nbsp;<span class="kwd">end</span><br/>
&nbsp;&nbsp;<br/>
&nbsp;&nbsp;<span class="kwd">with</span> <span class="id">sqlpp_union_size</span> (<span class="id">union</span> : <span class="id">sqlpp_union_element</span>) :=<br/>
&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">union</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;| <span class="id">SPBlock</span> <span class="id">block</span> =&gt; 1 + (<span class="id">sqlpp_select_block_size</span> <span class="id">block</span>)<br/>
&nbsp;&nbsp;&nbsp;| <span class="id">SPSubquery</span> <span class="id">q</span> =&gt; 1 + (<span class="id">sqlpp_statement_size</span> <span class="id">q</span>)<br/>
&nbsp;&nbsp;&nbsp;<span class="kwd">end</span><br/>
<br/>
&nbsp;&nbsp;<span class="kwd">with</span> <span class="id">sqlpp_select_clause_size</span> (<span class="id">select</span> : <span class="id">sqlpp_select</span>) := <br/>
&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">select</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;| <span class="id">SPSelectSQL</span> <span class="id">_</span> <span class="id">prs</span> =&gt; 1 + (<span class="id">List.fold_left</span> (<span class="kwd">fun</span> <span class="id">acc</span> <span class="id">pr</span> =&gt; <span class="id">acc</span> + (<span class="id">sqlpp_project_size</span> <span class="id">pr</span>)) <span class="id">prs</span> 0)<br/>
&nbsp;&nbsp;&nbsp;| <span class="id">SPSelectValue</span> <span class="id">_</span> <span class="id">val</span> =&gt; 1 + (<span class="id">sqlpp_expr_size</span> <span class="id">val</span>)<br/>
&nbsp;&nbsp;&nbsp;<span class="kwd">end</span><br/>
&nbsp;&nbsp;&nbsp;<br/>
&nbsp;&nbsp;<span class="kwd">with</span> <span class="id">sqlpp_project_size</span> (<span class="id">proj</span> : <span class="id">sqlpp_project</span>) :=<br/>
&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">proj</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;| <span class="id">SPProject</span> <span class="id">p</span> =&gt; 1 + (<span class="id">sqlpp_expr_size</span> (<span class="id">fst</span> <span class="id">p</span>))<br/>
&nbsp;&nbsp;&nbsp;| <span class="id">SPProjecStar</span> =&gt; 1<br/>
&nbsp;&nbsp;&nbsp;<span class="kwd">end</span><br/>
<br/>
&nbsp;&nbsp;<span class="kwd">with</span> <span class="id">sqlpp_group_by_size</span> (<span class="id">groupby</span> : <span class="id">sqlpp_group_by</span>) :=<br/>
&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">groupby</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;| <span class="id">SPNoGroupBy</span> =&gt; 0<br/>
&nbsp;&nbsp;&nbsp;| <span class="id">SPGroupBy</span> <span class="id">groups</span> <span class="id">aspart</span> =&gt; 1 + (<span class="id">List.fold_left</span> (<span class="kwd">fun</span> <span class="id">acc</span> <span class="id">g</span> =&gt; <span class="id">acc</span> + (<span class="kwd">let</span> '(<span class="id">gg</span>,<span class="id">_</span>) := <span class="id">g</span> <span class="kwd">in</span> 1 + (<span class="id">sqlpp_expr_size</span> <span class="id">gg</span>))) <span class="id">groups</span> 0) +<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">aspart</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">None</span> =&gt; 0<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">Some</span> (<span class="id">_</span> , <span class="id">pairs</span>) =&gt; 1 + 2 * (<span class="id">List.length</span> <span class="id">pairs</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span><br/>
&nbsp;<span class="kwd">end</span><br/>
<br/>
&nbsp;&nbsp;<span class="kwd">with</span> <span class="id">sqlpp_from_size</span> (<span class="id">from</span> : <span class="id">sqlpp_from</span>) := <br/>
&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">from</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;| <span class="id">SPFrom</span> <span class="id">expr</span> <span class="id">name</span> <span class="id">joins</span> =&gt; 1 + (<span class="id">sqlpp_expr_size</span> <span class="id">expr</span>) + (<span class="id">sqlpp_string_option_size</span> <span class="id">name</span>) + <br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">List.fold_left</span> (<span class="kwd">fun</span> <span class="id">acc</span> <span class="id">join</span> =&gt; <span class="id">acc</span> + (<span class="id">sqlpp_join_size</span> <span class="id">join</span>)) <span class="id">joins</span> 0)<br/>
&nbsp;&nbsp;&nbsp;<span class="kwd">end</span><br/>
&nbsp;&nbsp;&nbsp;<br/>
&nbsp;&nbsp;<span class="kwd">with</span> <span class="id">sqlpp_join_size</span> (<span class="id">join</span> : <span class="id">sqlpp_join_clause</span>) :=<br/>
&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">join</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;| <span class="id">SPJoin</span> <span class="id">_</span> <span class="id">expr</span> <span class="id">name</span> <span class="id">onexpr</span> =&gt; 2 + (<span class="id">sqlpp_expr_size</span> <span class="id">expr</span>) + (<span class="id">sqlpp_string_option_size</span> <span class="id">name</span>) + (<span class="id">sqlpp_expr_size</span> <span class="id">onexpr</span>)<br/>
&nbsp;&nbsp;&nbsp;| <span class="id">SPUnnest</span> <span class="id">_</span> <span class="id">expr</span> <span class="id">asname</span> <span class="id">atname</span> =&gt; 2 + (<span class="id">sqlpp_expr_size</span> <span class="id">expr</span>) + (<span class="id">sqlpp_string_option_size</span> <span class="id">asname</span>) + (<span class="id">sqlpp_string_option_size</span> <span class="id">atname</span>)<br/>
&nbsp;&nbsp;&nbsp;<span class="kwd">end</span><br/>
<br/>
&nbsp;&nbsp;<span class="kwd">with</span> <span class="id">whenthen_size</span> (<span class="id">wt</span> : <span class="id">sqlpp_when_then</span>) :=<br/>
&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">wt</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;| <span class="id">SPWhenThen</span> <span class="id">w</span> <span class="id">t</span><br/>
&nbsp;&nbsp;=&gt; 1 + (<span class="id">sqlpp_expr_size</span> <span class="id">w</span>) + (<span class="id">sqlpp_expr_size</span> <span class="id">t</span>)<br/>
&nbsp;<span class="kwd">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id">sqlpp_size</span> (<span class="id">e</span> : <span class="id">sqlpp_expr</span>) := <span class="id">sqlpp_expr_size</span> <span class="id">e</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">End</span> <span class="id">size</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Section</span> <span class="id">depth</span>.<br/>
&nbsp;<span class="kwd">Fixpoint</span> <span class="id">sqlpp_expr_depth</span> (<span class="id">e</span> : <span class="id">sqlpp_expr</span>) :=<br/>
&nbsp;<span class="kwd">match</span> <span class="id">e</span> <span class="kwd">with</span><br/>
&nbsp;| <span class="id">SPPositive</span> <span class="id">expr</span><br/>
&nbsp;| <span class="id">SPNegative</span> <span class="id">expr</span><br/>
&nbsp;&nbsp;&nbsp;| <span class="id">SPExists</span> <span class="id">expr</span><br/>
&nbsp;&nbsp;&nbsp;| <span class="id">SPNot</span> <span class="id">expr</span><br/>
&nbsp;&nbsp;&nbsp;| <span class="id">SPIsNull</span> <span class="id">expr</span><br/>
&nbsp;&nbsp;&nbsp;| <span class="id">SPIsMissing</span> <span class="id">expr</span><br/>
&nbsp;&nbsp;&nbsp;| <span class="id">SPIsUnknown</span> <span class="id">expr</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;=&gt; <span class="id">sqlpp_expr_depth</span> <span class="id">expr</span><br/>
&nbsp;| <span class="id">SPPlus</span>  <span class="id">e1</span> <span class="id">e2</span><br/>
&nbsp;&nbsp;&nbsp;| <span class="id">SPMinus</span>  <span class="id">e1</span> <span class="id">e2</span><br/>
&nbsp;&nbsp;&nbsp;| <span class="id">SPMult</span>  <span class="id">e1</span> <span class="id">e2</span><br/>
&nbsp;&nbsp;&nbsp;| <span class="id">SPDiv</span>  <span class="id">e1</span> <span class="id">e2</span><br/>
&nbsp;&nbsp;&nbsp;| <span class="id">SPMod</span>  <span class="id">e1</span> <span class="id">e2</span><br/>
&nbsp;&nbsp;&nbsp;| <span class="id">SPExp</span>  <span class="id">e1</span> <span class="id">e2</span><br/>
&nbsp;&nbsp;&nbsp;| <span class="id">SPConcat</span>  <span class="id">e1</span> <span class="id">e2</span><br/>
&nbsp;&nbsp;&nbsp;| <span class="id">SPIn</span>  <span class="id">e1</span> <span class="id">e2</span><br/>
&nbsp;&nbsp;&nbsp;| <span class="id">SPEq</span>  <span class="id">e1</span> <span class="id">e2</span><br/>
&nbsp;&nbsp;&nbsp;| <span class="id">SPFuzzyEq</span> <span class="id">e1</span> <span class="id">e2</span><br/>
&nbsp;&nbsp;&nbsp;| <span class="id">SPNeq</span>  <span class="id">e1</span> <span class="id">e2</span><br/>
&nbsp;&nbsp;&nbsp;| <span class="id">SPLt</span>  <span class="id">e1</span> <span class="id">e2</span><br/>
&nbsp;&nbsp;&nbsp;| <span class="id">SPGt</span>  <span class="id">e1</span> <span class="id">e2</span><br/>
&nbsp;&nbsp;&nbsp;| <span class="id">SPLe</span>  <span class="id">e1</span> <span class="id">e2</span><br/>
&nbsp;&nbsp;&nbsp;| <span class="id">SPGe</span>  <span class="id">e1</span> <span class="id">e2</span><br/>
&nbsp;&nbsp;&nbsp;| <span class="id">SPAnd</span>  <span class="id">e1</span> <span class="id">e2</span><br/>
&nbsp;&nbsp;&nbsp;| <span class="id">SPOr</span>  <span class="id">e1</span> <span class="id">e2</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;=&gt; <span class="id">max</span> (<span class="id">sqlpp_expr_depth</span> <span class="id">e1</span>) (<span class="id">sqlpp_expr_depth</span> <span class="id">e2</span>)<br/>
&nbsp;&nbsp;&nbsp;| <span class="id">SPLike</span>  <span class="id">e1</span> <span class="id">e2</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;=&gt; <span class="id">sqlpp_expr_depth</span> <span class="id">e1</span><br/>
&nbsp;| <span class="id">SPBetween</span>  <span class="id">e1</span> <span class="id">e2</span> <span class="id">e3</span><br/>
&nbsp;&nbsp;=&gt; <span class="id">max</span> (<span class="id">sqlpp_expr_depth</span> <span class="id">e1</span>) (<span class="id">max</span> (<span class="id">sqlpp_expr_depth</span> <span class="id">e2</span>) (<span class="id">sqlpp_expr_depth</span> <span class="id">e3</span>))<br/>
&nbsp;| <span class="id">SPSimpleCase</span>  <span class="id">e</span> <span class="id">l</span> <span class="id">o</span><br/>
&nbsp;&nbsp;=&gt; <span class="kwd">match</span> <span class="id">o</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id">None</span> =&gt; <span class="id">max</span> (<span class="id">sqlpp_expr_depth</span> <span class="id">e</span>) (<span class="id">List.fold_left</span> (<span class="kwd">fun</span> <span class="id">acc</span> <span class="id">whenthen</span> =&gt; <span class="id">max</span> <span class="id">acc</span> (<span class="id">whenthen_depth</span> <span class="id">whenthen</span>)) <span class="id">l</span> 0)<br/>
&nbsp;&nbsp;| <span class="id">Some</span> <span class="id">oe</span> =&gt; <span class="id">max</span> (<span class="id">sqlpp_expr_depth</span> <span class="id">e</span>) <br/>
&nbsp;&nbsp;&nbsp;(<span class="id">max</span> (<span class="id">List.fold_left</span> (<span class="kwd">fun</span> <span class="id">acc</span> <span class="id">whenthen</span> =&gt; <span class="id">max</span> <span class="id">acc</span> (<span class="id">whenthen_depth</span> <span class="id">whenthen</span>)) <span class="id">l</span> 0) (<span class="id">sqlpp_expr_depth</span> <span class="id">oe</span>))<br/>
&nbsp;&nbsp;<span class="kwd">end</span><br/>
&nbsp;| <span class="id">SPSearchedCase</span> <span class="id">l</span> <span class="id">o</span><br/>
&nbsp;&nbsp;=&gt; <span class="kwd">match</span> <span class="id">o</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id">None</span> =&gt; (<span class="id">List.fold_left</span> (<span class="kwd">fun</span> <span class="id">acc</span> <span class="id">whenthen</span> =&gt; <span class="id">max</span> <span class="id">acc</span> (<span class="id">whenthen_depth</span> <span class="id">whenthen</span>)) <span class="id">l</span> 0)<br/>
&nbsp;&nbsp;| <span class="id">Some</span> <span class="id">oe</span> =&gt; <span class="id">max</span> (<span class="id">List.fold_left</span> (<span class="kwd">fun</span> <span class="id">acc</span> <span class="id">whenthen</span> =&gt; <span class="id">max</span> <span class="id">acc</span> (<span class="id">whenthen_depth</span> <span class="id">whenthen</span>)) <span class="id">l</span> 0) (<span class="id">sqlpp_expr_depth</span> <span class="id">oe</span>)<br/>
&nbsp;&nbsp;<span class="kwd">end</span><br/>
&nbsp;| <span class="id">SPSome</span>  <span class="id">l</span> <span class="id">e</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">SPEvery</span> <span class="id">l</span> <span class="id">e</span><br/>
&nbsp;&nbsp;=&gt; <span class="id">max</span> (<span class="id">List.fold_left</span> (<span class="kwd">fun</span> <span class="id">acc</span> <span class="id">p</span> =&gt; <span class="id">max</span> <span class="id">acc</span> (<span class="id">sqlpp_expr_depth</span> (<span class="id">snd</span> <span class="id">p</span>))) <span class="id">l</span> 0) (<span class="id">sqlpp_expr_depth</span>  <span class="id">e</span>)<br/>
&nbsp;| <span class="id">SPDot</span>  <span class="id">expr</span> <span class="id">_</span><br/>
&nbsp;&nbsp;=&gt; <span class="id">sqlpp_expr_depth</span>  <span class="id">expr</span>                                                              <br/>
&nbsp;| <span class="id">SPIndex</span>  <span class="id">e</span> <span class="id">i</span><br/>
&nbsp;&nbsp;=&gt; <span class="id">max</span>  (<span class="id">sqlpp_expr_depth</span>  <span class="id">e</span>) (<span class="id">sqlpp_expr_depth</span>  <span class="id">i</span>)<br/>
&nbsp;| <span class="id">SPIndexAny</span> <span class="id">e</span><br/>
&nbsp;&nbsp;=&gt; <span class="id">sqlpp_expr_depth</span> <span class="id">e</span><br/>
&nbsp;| <span class="id">SPLiteral</span> <span class="id">_</span> =&gt; 0<br/>
&nbsp;&nbsp;&nbsp;| <span class="id">SPNull</span><br/>
&nbsp;&nbsp;&nbsp;| <span class="id">SPMissing</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;=&gt; 0             <br/>
&nbsp;| <span class="id">SPVarRef</span> <span class="id">_</span><br/>
&nbsp;&nbsp;=&gt; 0                                  <br/>
&nbsp;| <span class="id">SPFunctionCall</span> <span class="id">_</span> <span class="id">l</span><br/>
&nbsp;&nbsp;=&gt; (<span class="id">List.fold_left</span> (<span class="kwd">fun</span> <span class="id">acc</span> <span class="id">expr</span> =&gt; <span class="id">max</span> <span class="id">acc</span> (<span class="id">sqlpp_expr_depth</span> <span class="id">expr</span>)) <span class="id">l</span> 0)<br/>
&nbsp;| <span class="id">SPArray</span> <span class="id">l</span><br/>
&nbsp;| <span class="id">SPBag</span> <span class="id">l</span><br/>
&nbsp;&nbsp;=&gt; (<span class="id">List.fold_left</span> (<span class="kwd">fun</span> <span class="id">acc</span> <span class="id">expr</span> =&gt; <span class="id">max</span> <span class="id">acc</span> (<span class="id">sqlpp_expr_depth</span> <span class="id">expr</span>)) <span class="id">l</span> 0)<br/>
&nbsp;| <span class="id">SPObject</span> <span class="id">l</span><br/>
&nbsp;&nbsp;=&gt; <span class="id">List.fold_left</span> (<span class="kwd">fun</span> <span class="id">acc</span> <span class="id">pair</span> =&gt; <span class="id">max</span> <span class="id">acc</span> (<span class="id">sqlpp_expr_depth</span> (<span class="id">snd</span> <span class="id">pair</span>))) <span class="id">l</span> 0<br/>
&nbsp;| <span class="id">SPQuery</span> <span class="id">stmt</span><br/>
&nbsp;&nbsp;=&gt; <span class="id">sqlpp_statement_depth</span> <span class="id">stmt</span><br/>
&nbsp;<span class="kwd">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br/>
&nbsp;&nbsp;<span class="kwd">with</span> <span class="id">sqlpp_statement_depth</span> (<span class="id">stmt</span>: <span class="id">sqlpp_select_statement</span>) :=<br/>
&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">stmt</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;| <span class="id">SPSelectStmt</span> <span class="id">lets</span> <span class="id">block</span> <span class="id">unions</span> (<span class="id">SPOrderBy</span> <span class="id">orders</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;=&gt; <span class="id">max</span> (<span class="id">max</span> (<span class="id">max</span> (<span class="id">List.fold_left</span> (<span class="kwd">fun</span> <span class="id">acc</span> <span class="id">p</span> =&gt; <span class="id">max</span> <span class="id">acc</span> (<span class="id">sqlpp_expr_depth</span> (<span class="id">snd</span> <span class="id">p</span>))) <span class="id">lets</span> 0) (<span class="id">sqlpp_select_block_depth</span> <span class="id">block</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">List.fold_left</span> (<span class="kwd">fun</span> <span class="id">acc</span> <span class="id">u</span> =&gt; <span class="id">max</span> <span class="id">acc</span> (<span class="id">sqlpp_union_depth</span> <span class="id">u</span>)) <span class="id">unions</span> 0)) <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">List.fold_left</span> (<span class="kwd">fun</span> <span class="id">acc</span> <span class="id">o</span> =&gt; <span class="id">max</span> <span class="id">acc</span> (<span class="kwd">let</span> '(<span class="id">oo</span>,<span class="id">_</span>) := <span class="id">o</span> <span class="kwd">in</span> (<span class="id">sqlpp_expr_depth</span> <span class="id">oo</span>))) <span class="id">orders</span> 0)<br/>
&nbsp;&nbsp;&nbsp;| <span class="id">SPSelectStmt</span> <span class="id">lets</span> <span class="id">block</span> <span class="id">unions</span> <span class="id">SPNoOrderBy</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;=&gt; <span class="id">max</span> (<span class="id">max</span> (<span class="id">List.fold_left</span> (<span class="kwd">fun</span> <span class="id">acc</span> <span class="id">p</span> =&gt; <span class="id">max</span> <span class="id">acc</span> (<span class="id">sqlpp_expr_depth</span> (<span class="id">snd</span> <span class="id">p</span>))) <span class="id">lets</span> 0) (<span class="id">sqlpp_select_block_depth</span> <span class="id">block</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">List.fold_left</span> (<span class="kwd">fun</span> <span class="id">acc</span> <span class="id">u</span> =&gt; <span class="id">max</span> <span class="id">acc</span> (<span class="id">sqlpp_union_depth</span> <span class="id">u</span>)) <span class="id">unions</span> 0)<br/>
&nbsp;&nbsp;&nbsp;<span class="kwd">end</span><br/>
&nbsp;&nbsp;&nbsp;<br/>
&nbsp;&nbsp;<span class="kwd">with</span> <span class="id">sqlpp_select_block_depth</span> (<span class="id">block</span> : <span class="id">sqlpp_select_block</span>) := <br/>
&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">block</span> <span class="kwd">with</span><br/>
&nbsp;| <span class="id">SPSelectBlock</span> <span class="id">select</span> <span class="id">froms</span> <span class="id">lets1</span> <span class="id">whr</span> <span class="id">groupby</span> <span class="id">lets2</span> <span class="id">having</span><br/>
&nbsp;&nbsp;=&gt; <span class="id">max</span> (<span class="id">sqlpp_select_clause_depth</span> <span class="id">select</span>) <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">max</span> (<span class="id">List.fold_left</span> (<span class="kwd">fun</span> <span class="id">acc</span> <span class="id">fr</span> =&gt; <span class="id">max</span> <span class="id">acc</span> (<span class="id">sqlpp_from_depth</span> <span class="id">fr</span>)) <span class="id">froms</span> 0) <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">max</span> (<span class="id">List.fold_left</span> (<span class="kwd">fun</span> <span class="id">acc</span> <span class="id">p</span> =&gt; <span class="id">max</span> <span class="id">acc</span> (<span class="id">sqlpp_expr_depth</span> (<span class="id">snd</span> <span class="id">p</span>))) <span class="id">lets1</span> 0)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">max</span> (<span class="kwd">match</span> <span class="id">whr</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">SPNoWhere</span> =&gt; 0<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">SPWhere</span> <span class="id">e</span> =&gt;	<span class="id">sqlpp_expr_depth</span> <span class="id">e</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>)  <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">max</span> (<span class="id">sqlpp_group_by_depth</span> <span class="id">groupby</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">max</span> (<span class="id">List.fold_left</span> (<span class="kwd">fun</span> <span class="id">acc</span> <span class="id">p</span> =&gt; <span class="id">max</span> <span class="id">acc</span> (<span class="id">sqlpp_expr_depth</span> (<span class="id">snd</span> <span class="id">p</span>))) <span class="id">lets1</span> 0)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">match</span> <span class="id">having</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">None</span> =&gt; 0<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">Some</span> <span class="id">expr</span> =&gt; <span class="id">sqlpp_expr_depth</span> <span class="id">expr</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>))))))<br/>
&nbsp;&nbsp;&nbsp;<span class="kwd">end</span><br/>
&nbsp;&nbsp;<br/>
&nbsp;&nbsp;<span class="kwd">with</span> <span class="id">sqlpp_union_depth</span> (<span class="id">union</span> : <span class="id">sqlpp_union_element</span>) :=<br/>
&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">union</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;| <span class="id">SPBlock</span> <span class="id">block</span> =&gt; <span class="id">sqlpp_select_block_depth</span> <span class="id">block</span><br/>
&nbsp;&nbsp;&nbsp;| <span class="id">SPSubquery</span> <span class="id">q</span> =&gt; <span class="id">sqlpp_statement_depth</span> <span class="id">q</span><br/>
&nbsp;&nbsp;&nbsp;<span class="kwd">end</span><br/>
<br/>
&nbsp;&nbsp;<span class="kwd">with</span> <span class="id">sqlpp_select_clause_depth</span> (<span class="id">select</span> : <span class="id">sqlpp_select</span>) := <br/>
&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">select</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;| <span class="id">SPSelectSQL</span> <span class="id">_</span> <span class="id">prs</span> =&gt; <span class="id">List.fold_left</span> (<span class="kwd">fun</span> <span class="id">acc</span> <span class="id">pr</span> =&gt; <span class="id">max</span> <span class="id">acc</span> (<span class="id">sqlpp_project_depth</span> <span class="id">pr</span>)) <span class="id">prs</span> 0<br/>
&nbsp;&nbsp;&nbsp;| <span class="id">SPSelectValue</span> <span class="id">_</span> <span class="id">val</span> =&gt; <span class="id">sqlpp_expr_depth</span> <span class="id">val</span><br/>
&nbsp;&nbsp;&nbsp;<span class="kwd">end</span><br/>
&nbsp;&nbsp;&nbsp;<br/>
&nbsp;&nbsp;<span class="kwd">with</span> <span class="id">sqlpp_project_depth</span> (<span class="id">proj</span> : <span class="id">sqlpp_project</span>) :=<br/>
&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">proj</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;| <span class="id">SPProject</span> <span class="id">p</span> =&gt; <span class="id">sqlpp_expr_depth</span> (<span class="id">fst</span> <span class="id">p</span>)<br/>
&nbsp;&nbsp;&nbsp;| <span class="id">SPProjectStar</span> =&gt; 1<br/>
&nbsp;&nbsp;&nbsp;<span class="kwd">end</span><br/>
<br/>
&nbsp;&nbsp;<span class="kwd">with</span> <span class="id">sqlpp_group_by_depth</span> (<span class="id">groupby</span> : <span class="id">sqlpp_group_by</span>) :=<br/>
&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">groupby</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;| <span class="id">SPNoGroupBy</span> =&gt; 0<br/>
&nbsp;&nbsp;&nbsp;| <span class="id">SPGroupBy</span> <span class="id">groups</span> <span class="id">aspart</span> =&gt; <span class="id">max</span> (<span class="id">List.fold_left</span> (<span class="kwd">fun</span> <span class="id">acc</span> <span class="id">g</span> =&gt; <span class="id">acc</span> + (<span class="kwd">let</span> '(<span class="id">gg</span>,<span class="id">_</span>) := <span class="id">g</span> <span class="kwd">in</span> 1 + (<span class="id">sqlpp_expr_depth</span> <span class="id">gg</span>))) <span class="id">groups</span> 0)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">aspart</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">None</span> =&gt; 0<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">Some</span> (<span class="id">_</span> , <span class="id">pairs</span>) =&gt; 1 + 2 * (<span class="id">List.length</span> <span class="id">pairs</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span><br/>
&nbsp;<span class="kwd">end</span><br/>
<br/>
&nbsp;&nbsp;<span class="kwd">with</span> <span class="id">sqlpp_from_depth</span> (<span class="id">from</span> : <span class="id">sqlpp_from</span>) := <br/>
&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">from</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;| <span class="id">SPFrom</span> <span class="id">expr</span> <span class="id">_</span> <span class="id">joins</span> =&gt; <span class="id">max</span> (<span class="id">sqlpp_expr_depth</span> <span class="id">expr</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">List.fold_left</span> (<span class="kwd">fun</span> <span class="id">acc</span> <span class="id">join</span> =&gt; <span class="id">max</span> <span class="id">acc</span> (<span class="id">sqlpp_join_depth</span> <span class="id">join</span>)) <span class="id">joins</span> 0)<br/>
&nbsp;&nbsp;&nbsp;<span class="kwd">end</span><br/>
&nbsp;&nbsp;&nbsp;<br/>
&nbsp;&nbsp;<span class="kwd">with</span> <span class="id">sqlpp_join_depth</span> (<span class="id">join</span> : <span class="id">sqlpp_join_clause</span>) :=<br/>
&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">join</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;| <span class="id">SPJoin</span> <span class="id">_</span> <span class="id">expr</span> <span class="id">_</span> <span class="id">onexpr</span> =&gt; <span class="id">max</span> (<span class="id">sqlpp_expr_depth</span> <span class="id">expr</span>) (<span class="id">sqlpp_expr_depth</span> <span class="id">onexpr</span>)<br/>
&nbsp;&nbsp;&nbsp;| <span class="id">SPUnnest</span> <span class="id">_</span> <span class="id">expr</span> <span class="id">_</span> <span class="id">_</span> =&gt; <span class="id">sqlpp_expr_depth</span> <span class="id">expr</span><br/>
&nbsp;&nbsp;&nbsp;<span class="kwd">end</span><br/>
<br/>
&nbsp;&nbsp;<span class="kwd">with</span> <span class="id">whenthen_depth</span> (<span class="id">wt</span> : <span class="id">sqlpp_when_then</span>) :=<br/>
&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">wt</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;| <span class="id">SPWhenThen</span> <span class="id">w</span> <span class="id">t</span><br/>
&nbsp;&nbsp;=&gt; <span class="id">max</span> (<span class="id">sqlpp_expr_depth</span> <span class="id">w</span>) (<span class="id">sqlpp_expr_depth</span> <span class="id">t</span>)<br/>
&nbsp;<span class="kwd">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br/>
&nbsp;&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id">sqlpp_depth</span> (<span class="id">e</span> : <span class="id">sqlpp_expr</span>) := <span class="id">sqlpp_expr_depth</span> <span class="id">e</span>. <br/>
<br/>
&nbsp;&nbsp;<span class="kwd">End</span> <span class="id">depth</span>.<br/>
<br/>
<span class="kwd">End</span> <span class="id">SQLPPSize</span>.<br/>
<br/>

</div>
<div class="footer"><hr/>Generated by <a href="https://github.com/xavierleroy/coq2html/">coq2html</div>
</body>
</html>
