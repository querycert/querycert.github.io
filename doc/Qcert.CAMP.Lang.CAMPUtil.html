
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Module Qcert.CAMP.Lang.CAMPUtil</title>
<meta name="description" content="Documentation of Coq module Qcert.CAMP.Lang.CAMPUtil" />
<link href="coq2html.css" rel="stylesheet" type="text/css" />
<script type="text/javascript" src="coq2html.js"> </script>
</head>

<body onload="hideAll('proofscript')">
<h1 class="title">Module Qcert.CAMP.Lang.CAMPUtil</h1>
<div class="coq">
<br/>
<div class="doc">Encoding and utility functions to support the result of evaluation
over CAMP patterns. </div>
<br/>
<span class="kwd">Section</span> <span class="id">CAMPUtil</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id">String</span>.<br/>
&nbsp;&nbsp;<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id">List</span>.<br/>
&nbsp;&nbsp;<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id">EquivDec</span>.<br/>
&nbsp;&nbsp;<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id">Morphisms</span>.<br/>
&nbsp;&nbsp;<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id">BasicRuntime</span>.<br/>
&nbsp;&nbsp;<span class="kwd">Local</span> <span class="kwd">Open</span> <span class="kwd">Scope</span> <span class="id">string</span>.<br/>
<br/>
<div class="doc">Evaluating a CAMP pattern returns a presult, which includes two
  kinds of errors: either a match failure, which is recoverable, or a
  terminal error. </div>
&nbsp;&nbsp;<br/>
&nbsp;&nbsp;<span class="kwd">Inductive</span> <span class="id">presult</span> <span class="id">A</span> :=<br/>
&nbsp;&nbsp;| <span class="id">TerminalError</span> : <span class="id">presult</span> <span class="id">A</span><br/>
&nbsp;&nbsp;| <span class="id">RecoverableError</span> : <span class="id">presult</span> <span class="id">A</span><br/>
&nbsp;&nbsp;| <span class="id">Success</span> (<span class="id">res</span>:<span class="id">A</span>) : <span class="id">presult</span> <span class="id">A</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="id">Arguments</span> <span class="id">TerminalError</span> {<span class="id">A</span>}.<br/>
&nbsp;&nbsp;<span class="id">Arguments</span> <span class="id">RecoverableError</span> {<span class="id">A</span>}.<br/>
&nbsp;&nbsp;<span class="id">Arguments</span> <span class="id">Success</span> {<span class="id">A</span>} <span class="id">res</span>.<br/>
<br/>
<div class="doc">Equality between two presult is decidable </div>
&nbsp;&nbsp;<br/>
&nbsp;&nbsp;<span class="kwd">Global</span> <span class="kwd">Instance</span> <span class="id">presult_eqdec</span> {<span class="id">A</span>} {<span class="id">dec</span>:<span class="id">EqDec</span> <span class="id">A</span> <span class="id">eq</span>} :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">EqDec</span> (<span class="id">presult</span> <span class="id">A</span>) <span class="id">eq</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2665')">Proof.</div>
<div class="proofscript" id="proof2665">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">red</span>; <span class="tactic">unfold</span> <span class="id">equiv</span>, <span class="id">complement</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">x</span>; <span class="tactic">destruct</span> <span class="id">y</span>; <span class="tactic">simpl</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">try</span> <span class="id">solve</span> [<span class="id">right</span>; <span class="tactic">inversion</span> 1]; <span class="tactic">eauto</span> 2.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">res</span> == <span class="id">res0</span>); <span class="tactic">unfold</span> <span class="id">equiv</span>, <span class="id">complement</span> <span class="kwd">in</span> *;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[<span class="id">left</span> | <span class="id">right</span>; <span class="tactic">inversion</span> 1]; <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;Defined.</div>
&nbsp;&nbsp;<br/>
<div class="doc">Prints a presult </div>
&nbsp;&nbsp;<br/>
&nbsp;&nbsp;<span class="kwd">Global</span> <span class="kwd">Instance</span> <span class="id">print_presult</span> {<span class="id">A</span>} {<span class="id">tos</span>:<span class="id">ToString</span> <span class="id">A</span>} : <span class="id">ToString</span> (<span class="id">presult</span> <span class="id">A</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;:= { <span class="id">toString</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">fun</span> <span class="id">pr</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">pr</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">TerminalError</span> =&gt; "<span class="id">TerminalError</span> (<span class="kwd">for</span> <span class="id">more</span> <span class="id">info</span>, <span class="id">use</span> <span class="id">debug</span> <span class="id">mode</span>)"<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">RecoverableError</span> =&gt; "<span class="id">RecoverableError</span> (<span class="kwd">for</span> <span class="id">more</span> <span class="id">info</span>, <span class="id">use</span> <span class="id">debug</span> <span class="id">mode</span>)"<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">Success</span> <span class="id">res</span> =&gt; "<span class="id">Success</span>: " ++ <span class="id">toString</span> <span class="id">res</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}.<br/>
&nbsp;&nbsp;<br/>
<div class="doc">Lifting functions used in the evaluation of patterns. Used to handle the various possible presults during evaluation. </div>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id">liftpr</span> {<span class="id">A</span> <span class="id">B</span>:<span class="kwd">Type</span>} (<span class="id">f</span>:<span class="id">A</span>-&gt;<span class="id">B</span>) (<span class="id">pr</span>:<span class="id">presult</span> <span class="id">A</span>) : <span class="id">presult</span> <span class="id">B</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;:= <span class="kwd">match</span> <span class="id">pr</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">TerminalError</span> =&gt; <span class="id">TerminalError</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">RecoverableError</span> =&gt; <span class="id">RecoverableError</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">Success</span> <span class="id">a</span> =&gt; <span class="id">Success</span> (<span class="id">f</span> <span class="id">a</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id">bindpr</span> {<span class="id">A</span> <span class="id">B</span>:<span class="kwd">Type</span>} (<span class="id">pr</span>:<span class="id">presult</span> <span class="id">A</span>) (<span class="id">f</span>:<span class="id">A</span>-&gt;<span class="id">presult</span> <span class="id">B</span>) : <span class="id">presult</span> <span class="id">B</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;:= <span class="kwd">match</span> <span class="id">pr</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">TerminalError</span> =&gt; <span class="id">TerminalError</span> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">RecoverableError</span> =&gt; <span class="id">RecoverableError</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">Success</span> <span class="id">a</span> =&gt; (<span class="id">f</span> <span class="id">a</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">liftpr_bindpr</span> {<span class="id">A</span> <span class="id">B</span>:<span class="kwd">Type</span>} (<span class="id">f</span>:<span class="id">A</span>-&gt;<span class="id">B</span>) <span class="id">pr</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">liftpr</span> <span class="id">f</span> <span class="id">pr</span> = <span class="id">bindpr</span> <span class="id">pr</span> (<span class="kwd">fun</span> <span class="id">x</span> =&gt; <span class="id">Success</span> (<span class="id">f</span> <span class="id">x</span>)).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2666')">Proof.</div>
<div class="proofscript" id="proof2666">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">pr</span>; <span class="tactic">simpl</span>; <span class="tactic">trivial</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
<div class="doc">Accumulates successful evaluation, skipping match failures. A terminal error is always final. </div>
&nbsp;&nbsp;<br/>
&nbsp;&nbsp;<span class="kwd">Fixpoint</span> <span class="id">gather_successes</span> {<span class="id">A</span>:<span class="kwd">Type</span>} (<span class="id">os</span>:<span class="id">list</span> (<span class="id">presult</span> <span class="id">A</span>)) : <span class="id">presult</span> (<span class="id">list</span> <span class="id">A</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;:= <span class="kwd">match</span> <span class="id">os</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">nil</span> =&gt; <span class="id">Success</span> <span class="id">nil</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| (<span class="id">TerminalError</span>)::<span class="id">xs</span> =&gt; <span class="id">TerminalError</span> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| (<span class="id">RecoverableError</span>)::<span class="id">xs</span> =&gt; <span class="id">gather_successes</span> <span class="id">xs</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| (<span class="id">Success</span> <span class="id">a</span>)::<span class="id">xs</span> =&gt; <span class="id">liftpr</span> (<span class="id">cons</span> <span class="id">a</span>) (<span class="id">gather_successes</span> <span class="id">xs</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<div class="doc">Accumulates successful evaluation, but propagating match failure to the top </div>
&nbsp;&nbsp;<br/>
&nbsp;&nbsp;<span class="kwd">Fixpoint</span> <span class="id">enforce_successes</span> {<span class="id">A</span>:<span class="kwd">Type</span>} (<span class="id">os</span>:<span class="id">list</span> (<span class="id">presult</span> <span class="id">A</span>)) : <span class="id">presult</span> (<span class="id">list</span> <span class="id">A</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;:= <span class="kwd">match</span> <span class="id">os</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">nil</span> =&gt; <span class="id">Success</span> <span class="id">nil</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| (<span class="id">TerminalError</span>)::<span class="id">xs</span> =&gt; <span class="id">TerminalError</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| (<span class="id">RecoverableError</span>)::<span class="id">xs</span> =&gt; <span class="id">RecoverableError</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| (<span class="id">Success</span> <span class="id">a</span>)::<span class="id">xs</span> =&gt; <span class="id">liftpr</span> (<span class="id">cons</span> <span class="id">a</span>) (<span class="id">gather_successes</span> <span class="id">xs</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
&nbsp;&nbsp;<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id">op2tpr</span> {<span class="id">A</span>:<span class="kwd">Type</span>} (<span class="id">o</span>:<span class="id">option</span> <span class="id">A</span>) : <span class="id">presult</span> <span class="id">A</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;:= <span class="kwd">match</span> <span class="id">o</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">None</span> =&gt; <span class="id">TerminalError</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">Some</span> <span class="id">x</span> =&gt; <span class="id">Success</span> <span class="id">x</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id">op2rpr</span> {<span class="id">A</span>:<span class="kwd">Type</span>} (<span class="id">o</span>:<span class="id">option</span> <span class="id">A</span>) : <span class="id">presult</span> <span class="id">A</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;:= <span class="kwd">match</span> <span class="id">o</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">None</span> =&gt; <span class="id">RecoverableError</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">Some</span> <span class="id">x</span> =&gt; <span class="id">Success</span> <span class="id">x</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Section</span> <span class="id">Debug</span>.<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id">camp_src_path</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;:= <span class="id">list</span> <span class="id">nat</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Inductive</span> <span class="id">presult_debug</span> <span class="id">A</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">TerminalError_debug</span> (<span class="id">s</span>:<span class="id">string</span>) (<span class="id">loc</span>:<span class="id">camp_src_path</span>) : <span class="id">presult_debug</span> <span class="id">A</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">RecoverableError_debug</span> (<span class="id">s</span>:<span class="id">string</span>) : <span class="id">presult_debug</span> <span class="id">A</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">Success_debug</span> (<span class="id">res</span>:<span class="id">A</span>) : <span class="id">presult_debug</span> <span class="id">A</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Arguments</span> <span class="id">TerminalError_debug</span> {<span class="id">A</span>} <span class="id">s</span> <span class="id">loc</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Arguments</span> <span class="id">RecoverableError_debug</span> {<span class="id">A</span>} <span class="id">s</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Arguments</span> <span class="id">Success_debug</span> {<span class="id">A</span>} <span class="id">res</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id">print_presult_debug</span> {<span class="id">A</span>} {<span class="id">B</span>} {<span class="id">tos</span>:<span class="id">ToString</span> <span class="id">A</span>} (<span class="id">p</span>:<span class="id">B</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">pPrint</span>:<span class="id">B</span> -&gt; <span class="id">camp_src_path</span> -&gt; <span class="id">string</span>) (<span class="id">pr</span>:<span class="id">presult_debug</span> <span class="id">A</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:= <span class="kwd">match</span> <span class="id">pr</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">TerminalError_debug</span> <span class="id">s</span> <span class="id">loc</span> =&gt; "<span class="id">TerminalError</span>: " ++ <span class="id">s</span> ++ ". <span class="id">This</span> <span class="id">error</span> <span class="id">occurred</span> <span class="kwd">in</span> <span class="id">the</span> <span class="id">bracketed</span> <span class="id">code</span>: \<span class="id">n</span>" ++ (<span class="id">pPrint</span> <span class="id">p</span> (<span class="id">rev</span> <span class="id">loc</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">RecoverableError_debug</span> <span class="id">s</span> =&gt; "<span class="id">RecoverableError</span>: " ++ <span class="id">s</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">Success_debug</span> <span class="id">res</span> =&gt; "<span class="id">Success</span>: " ++ <span class="id">toString</span> <span class="id">res</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<br/>
<div class="doc">Useful lifting functions used in the evaluation of patterns. Used to handle the various possible presults </div>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id">liftpr_debug</span> {<span class="id">A</span> <span class="id">B</span>:<span class="kwd">Type</span>} (<span class="id">f</span>:<span class="id">A</span>-&gt;<span class="id">B</span>) (<span class="id">pr</span>:<span class="id">presult_debug</span> <span class="id">A</span>) : <span class="id">presult_debug</span> <span class="id">B</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:= <span class="kwd">match</span> <span class="id">pr</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">TerminalError_debug</span> <span class="id">s</span> <span class="id">loc</span> =&gt; <span class="id">TerminalError_debug</span> <span class="id">s</span> <span class="id">loc</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">RecoverableError_debug</span> <span class="id">s</span> =&gt; <span class="id">RecoverableError_debug</span> <span class="id">s</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">Success_debug</span> <span class="id">a</span> =&gt; <span class="id">Success_debug</span> (<span class="id">f</span> <span class="id">a</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id">bindpr_debug</span> {<span class="id">A</span> <span class="id">B</span>:<span class="kwd">Type</span>} (<span class="id">pr</span>:<span class="id">presult_debug</span> <span class="id">A</span>) (<span class="id">f</span>:<span class="id">A</span>-&gt;<span class="id">presult_debug</span> <span class="id">B</span>) : <span class="id">presult_debug</span> <span class="id">B</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:= <span class="kwd">match</span> <span class="id">pr</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">TerminalError_debug</span> <span class="id">s</span> <span class="id">loc</span> =&gt; <span class="id">TerminalError_debug</span> <span class="id">s</span> <span class="id">loc</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">RecoverableError_debug</span> <span class="id">s</span> =&gt; <span class="id">RecoverableError_debug</span> <span class="id">s</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">Success_debug</span> <span class="id">a</span> =&gt; (<span class="id">f</span> <span class="id">a</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">liftpr_debug_bindpr_debug</span> {<span class="id">A</span> <span class="id">B</span>:<span class="kwd">Type</span>} (<span class="id">f</span>:<span class="id">A</span>-&gt;<span class="id">B</span>) <span class="id">pr</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">liftpr_debug</span> <span class="id">f</span> <span class="id">pr</span> = <span class="id">bindpr_debug</span> <span class="id">pr</span> (<span class="kwd">fun</span> <span class="id">x</span> =&gt; <span class="id">Success_debug</span> (<span class="id">f</span> <span class="id">x</span>)).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2667')">Proof.</div>
<div class="proofscript" id="proof2667">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">pr</span>; <span class="tactic">simpl</span>; <span class="tactic">trivial</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Fixpoint</span> <span class="id">gather_successes_debug</span> {<span class="id">A</span>:<span class="kwd">Type</span>} (<span class="id">os</span>:<span class="id">list</span> (<span class="id">presult_debug</span> <span class="id">A</span>)) : <span class="id">presult_debug</span> (<span class="id">list</span> <span class="id">A</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:= <span class="kwd">match</span> <span class="id">os</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">nil</span> =&gt; <span class="id">Success_debug</span> <span class="id">nil</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| (<span class="id">TerminalError_debug</span> <span class="id">s</span> <span class="id">loc</span>)::<span class="id">xs</span> =&gt; <span class="id">TerminalError_debug</span> <span class="id">s</span> <span class="id">loc</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| (<span class="id">RecoverableError_debug</span> <span class="id">s</span>)::<span class="id">xs</span> =&gt; <span class="id">gather_successes_debug</span> <span class="id">xs</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| (<span class="id">Success_debug</span> <span class="id">a</span>)::<span class="id">xs</span> =&gt; <span class="id">liftpr_debug</span> (<span class="id">cons</span> <span class="id">a</span>) (<span class="id">gather_successes_debug</span> <span class="id">xs</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Fixpoint</span> <span class="id">enforce_successes_debug</span> {<span class="id">A</span>:<span class="kwd">Type</span>} (<span class="id">os</span>:<span class="id">list</span> (<span class="id">presult_debug</span> <span class="id">A</span>)) : <span class="id">presult_debug</span> (<span class="id">list</span> <span class="id">A</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:= <span class="kwd">match</span> <span class="id">os</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">nil</span> =&gt; <span class="id">Success_debug</span> <span class="id">nil</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| (<span class="id">TerminalError_debug</span> <span class="id">s</span> <span class="id">loc</span>)::<span class="id">xs</span> =&gt; <span class="id">TerminalError_debug</span> <span class="id">s</span> <span class="id">loc</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| (<span class="id">RecoverableError_debug</span> <span class="id">s</span>)::<span class="id">xs</span> =&gt; <span class="id">RecoverableError_debug</span> <span class="id">s</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| (<span class="id">Success_debug</span> <span class="id">a</span>)::<span class="id">xs</span> =&gt; <span class="id">liftpr_debug</span> (<span class="id">cons</span> <span class="id">a</span>) (<span class="id">gather_successes_debug</span> <span class="id">xs</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
&nbsp;&nbsp;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id">op2tpr_debug</span> {<span class="id">A</span>:<span class="kwd">Type</span>} (<span class="id">err</span>:<span class="id">string</span>) (<span class="id">loc</span>:<span class="id">camp_src_path</span>) (<span class="id">o</span>:<span class="id">option</span> <span class="id">A</span>) : <span class="id">presult_debug</span> <span class="id">A</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:= <span class="kwd">match</span> <span class="id">o</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">None</span> =&gt; <span class="id">TerminalError_debug</span> <span class="id">err</span> <span class="id">loc</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">Some</span> <span class="id">x</span> =&gt; <span class="id">Success_debug</span> <span class="id">x</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id">op2rpr_debug</span> {<span class="id">A</span>:<span class="kwd">Type</span>} (<span class="id">err</span>:<span class="id">string</span>) (<span class="id">o</span>:<span class="id">option</span> <span class="id">A</span>) : <span class="id">presult_debug</span> <span class="id">A</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:= <span class="kwd">match</span> <span class="id">o</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">None</span> =&gt; <span class="id">RecoverableError_debug</span> <span class="id">err</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">Some</span> <span class="id">x</span> =&gt; <span class="id">Success_debug</span> <span class="id">x</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id">presult_same</span> {<span class="id">A</span>} (<span class="id">res</span>:<span class="id">presult</span> <span class="id">A</span>) (<span class="id">res_debug</span>:<span class="id">presult_debug</span> <span class="id">A</span>) :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">res</span>, <span class="id">res_debug</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">TerminalError</span>, <span class="id">TerminalError_debug</span> <span class="id">_</span> <span class="id">_</span> =&gt; <span class="id">True</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">RecoverableError</span>, <span class="id">RecoverableError_debug</span> <span class="id">_</span> =&gt; <span class="id">True</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">Success</span> <span class="id">x</span>, <span class="id">Success_debug</span> <span class="id">y</span> =&gt; <span class="id">x</span> = <span class="id">y</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">_</span>, <span class="id">_</span> =&gt; <span class="id">False</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">liftpr_presult_same</span> {<span class="id">A</span> <span class="id">B</span>} (<span class="id">f</span>:<span class="id">A</span>-&gt;<span class="id">B</span>) <span class="id">d1</span> <span class="id">d2</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">presult_same</span> <span class="id">d1</span> <span class="id">d2</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">presult_same</span> (<span class="id">liftpr</span> <span class="id">f</span> <span class="id">d1</span>) (<span class="id">liftpr_debug</span> <span class="id">f</span> <span class="id">d2</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2668')">Proof.</div>
<div class="proofscript" id="proof2668">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">presult_same</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">d1</span>; <span class="tactic">destruct</span> <span class="id">d2</span>; <span class="tactic">simpl</span>; <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">gather_successes_presult_same</span> {<span class="id">A</span>} <span class="id">d1</span> <span class="id">d2</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Forall2</span> (@<span class="id">presult_same</span> <span class="id">A</span>) <span class="id">d1</span> <span class="id">d2</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">presult_same</span> (<span class="id">gather_successes</span> <span class="id">d1</span>) (<span class="id">gather_successes_debug</span> <span class="id">d2</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2669')">Proof.</div>
<div class="proofscript" id="proof2669">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">presult_same</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> 1; <span class="tactic">simpl</span>; <span class="tactic">trivial</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">x</span>; <span class="tactic">destruct</span> <span class="id">y</span>; <span class="tactic">destruct</span> (<span class="id">gather_successes</span> <span class="id">l</span>); <span class="tactic">destruct</span> (<span class="id">gather_successes_debug</span> <span class="id">l</span>'); <span class="tactic">simpl</span> <span class="kwd">in</span> *; <span class="tactic">subst</span>; <span class="tactic">intuition</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
&nbsp;&nbsp;&nbsp;&nbsp;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">bindpr_presult_same</span> {<span class="id">A</span> <span class="id">B</span>} <span class="id">d1</span> <span class="id">d2</span> <span class="id">f1</span> <span class="id">f2</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">presult_same</span> <span class="id">d1</span> <span class="id">d2</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">x</span>, <span class="id">presult_same</span> (<span class="id">f1</span> <span class="id">x</span>) (<span class="id">f2</span> <span class="id">x</span>)) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">presult_same</span> (@<span class="id">bindpr</span> <span class="id">A</span> <span class="id">B</span> <span class="id">d1</span> <span class="id">f1</span>) (<span class="id">bindpr_debug</span> <span class="id">d2</span> <span class="id">f2</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2670')">Proof.</div>
<div class="proofscript" id="proof2670">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">d1</span>; <span class="tactic">destruct</span> <span class="id">d2</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> *; <span class="tactic">try</span> <span class="tactic">tauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>; <span class="tactic">subst</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
&nbsp;&nbsp;&nbsp;&nbsp;<br/>
&nbsp;&nbsp;<span class="kwd">End</span> <span class="id">Debug</span>.<br/>
<br/>
<div class="doc">Maps the input/output(s) between NNRC and CAMP </div>
<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id">pr2op</span> {<span class="id">A</span>:<span class="kwd">Type</span>} (<span class="id">pr</span>:<span class="id">presult</span> <span class="id">A</span>) : <span class="id">option</span> <span class="id">A</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;:= <span class="kwd">match</span> <span class="id">pr</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">Success</span> <span class="id">a</span> =&gt; <span class="id">Some</span> <span class="id">a</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">_</span> =&gt; <span class="id">None</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">pr2op_op2tpr</span> {<span class="id">A</span>:<span class="kwd">Type</span>} (<span class="id">op</span>:<span class="id">option</span> <span class="id">A</span>) :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">pr2op</span> (<span class="id">op2tpr</span> <span class="id">op</span>) = <span class="id">op</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2671')">Proof.</div>
<div class="proofscript" id="proof2671">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">op</span>; <span class="tactic">trivial</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">pr2op_op2rpr</span> {<span class="id">A</span>:<span class="kwd">Type</span>} (<span class="id">op</span>:<span class="id">option</span> <span class="id">A</span>) :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">pr2op</span> (<span class="id">op2rpr</span> <span class="id">op</span>) = <span class="id">op</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2672')">Proof.</div>
<div class="proofscript" id="proof2672">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">op</span>; <span class="tactic">trivial</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id">isRecoverableError</span> {<span class="id">A</span>:<span class="kwd">Type</span>} (<span class="id">pr</span>:<span class="id">presult</span> <span class="id">A</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;:= <span class="kwd">match</span> <span class="id">pr</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">RecoverableError</span> =&gt; <span class="id">true</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">_</span> =&gt; <span class="id">false</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
&nbsp;&nbsp;<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">op2tpr_not_recoverable</span> {<span class="id">A</span>:<span class="kwd">Type</span>} (<span class="id">op</span>:<span class="id">option</span> <span class="id">A</span>) :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">isRecoverableError</span> (<span class="id">op2tpr</span> <span class="id">op</span>) = <span class="id">false</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2673')">Proof.</div>
<div class="proofscript" id="proof2673">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">op</span>; <span class="tactic">trivial</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">isRecoverableError_liftpr</span> {<span class="id">A</span> <span class="id">B</span>:<span class="kwd">Type</span>} (<span class="id">f</span>:<span class="id">A</span>-&gt;<span class="id">B</span>) (<span class="id">pr</span>:<span class="id">presult</span> <span class="id">A</span>) <br/>
&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id">isRecoverableError</span> (<span class="id">liftpr</span> <span class="id">f</span> <span class="id">pr</span>) = <span class="id">isRecoverableError</span> <span class="id">pr</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2674')">Proof.</div>
<div class="proofscript" id="proof2674">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">pr</span>; <span class="tactic">trivial</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
<span class="kwd">End</span> <span class="id">CAMPUtil</span>.<br/>
<br/>
<span class="id">Arguments</span> <span class="id">TerminalError</span> {<span class="id">A</span>}.<br/>
<span class="id">Arguments</span> <span class="id">RecoverableError</span> {<span class="id">A</span>}.<br/>
<span class="id">Arguments</span> <span class="id">Success</span> {<span class="id">A</span>} <span class="id">res</span>.<br/>
<br/>
<span class="id">Arguments</span> <span class="id">TerminalError</span> {<span class="id">A</span>}.<br/>
<span class="id">Arguments</span> <span class="id">RecoverableError</span> {<span class="id">A</span>}.<br/>
<span class="id">Arguments</span> <span class="id">Success</span> {<span class="id">A</span>} <span class="id">res</span>.<br/>
<span class="id">Arguments</span> <span class="id">TerminalError_debug</span> {<span class="id">A</span>} <span class="id">s</span> <span class="id">loc</span>.<br/>
<span class="id">Arguments</span> <span class="id">RecoverableError_debug</span> {<span class="id">A</span>} <span class="id">s</span>.<br/>
<span class="id">Arguments</span> <span class="id">Success_debug</span> {<span class="id">A</span>} <span class="id">res</span>.<br/>
<br/>

</div>
<div class="footer"><hr/>Generated by <a href="https://github.com/xavierleroy/coq2html/">coq2html</div>
</body>
</html>
