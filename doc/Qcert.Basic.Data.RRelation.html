
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Module Qcert.Basic.Data.RRelation</title>
<meta name="description" content="Documentation of Coq module Qcert.Basic.Data.RRelation" />
<link href="coq2html.css" rel="stylesheet" type="text/css" />
<script type="text/javascript" src="coq2html.js"> </script>
</head>

<body onload="hideAll('proofscript')">
<h1 class="title">Module Qcert.Basic.Data.RRelation</h1>
<div class="coq">
<br/>
<span class="kwd">Section</span> <span class="id">RRelation</span>.<br/>
&nbsp;&nbsp;<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id">List</span> <span class="id">ListSet</span> <span class="id">String</span> <span class="id">ZArith</span>.<br/>
&nbsp;&nbsp;<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id">Permutation</span>.<br/>
&nbsp;&nbsp;<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id">Equivalence</span>.<br/>
&nbsp;&nbsp;<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id">Morphisms</span>.<br/>
&nbsp;&nbsp;<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="kwd">Program</span>.<br/>
&nbsp;&nbsp;<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id">EquivDec</span>.<br/>
&nbsp;&nbsp;<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id">Bool</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id">Utils</span>.<br/>
&nbsp;&nbsp;<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id">RBag</span>.<br/>
&nbsp;&nbsp;<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id">RDomain</span>.<br/>
&nbsp;&nbsp;<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id">ForeignData</span>.<br/>
&nbsp;&nbsp;<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id">RData</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Context</span> {<span class="id">fdata</span>:<span class="id">foreign_data</span>}.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id">ldeq</span> := (@<span class="id">Permutation</span> <span class="id">data</span>).<br/>
&nbsp;&nbsp;<span class="kwd">Notation</span> "<span class="id">X</span> ≅ <span class="id">Y</span>" := (<span class="id">ldeq</span> <span class="id">X</span> <span class="id">Y</span>) (<span class="tactic">at</span> <span class="id">level</span> 70).                             <br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id">edot</span> {<span class="id">A</span>} (<span class="id">r</span>:<span class="id">list</span> (<span class="id">string</span>*<span class="id">A</span>)) (<span class="id">a</span>:<span class="id">string</span>) : <span class="id">option</span> <span class="id">A</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">assoc_lookupr</span> <span class="id">ODT_eqdec</span> <span class="id">r</span> <span class="id">a</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">edot_nodup_perm</span> {<span class="id">A</span>:<span class="kwd">Type</span>} (<span class="id">l</span> <span class="id">l</span>':<span class="id">list</span> (<span class="id">string</span>*<span class="id">A</span>)) <span class="id">x</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">NoDup</span> (<span class="id">domain</span> <span class="id">l</span>) -&gt; <span class="id">Permutation</span> <span class="id">l</span> <span class="id">l</span>' -&gt; <span class="id">edot</span> <span class="id">l</span> <span class="id">x</span> = <span class="id">edot</span> <span class="id">l</span>' <span class="id">x</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof874')">Proof.</div>
<div class="proofscript" id="proof874">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">assoc_lookupr_nodup_perm</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">edot_fresh_concat</span> {<span class="id">A</span>} <span class="id">x</span> (<span class="id">d</span>:<span class="id">A</span>) <span class="id">b</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;~ <span class="id">In</span> <span class="id">x</span> (<span class="id">domain</span> <span class="id">b</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">edot</span> (<span class="id">rec_concat_sort</span> <span class="id">b</span> ((<span class="id">x</span>,<span class="id">d</span>)::<span class="id">nil</span>)) <span class="id">x</span> = <span class="id">Some</span> <span class="id">d</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof875')">Proof.</div>
<div class="proofscript" id="proof875">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> (@<span class="id">assoc_lookupr_insertion_sort_fresh</span> <span class="id">string</span> <span class="id">ODT_string</span>); <span class="tactic">trivial</span>.<br/>
&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id">unbdbool</span> (<span class="id">f</span>:<span class="id">bool</span> -&gt; <span class="id">bool</span> -&gt; <span class="id">bool</span>) (<span class="id">d1</span> <span class="id">d2</span>:<span class="id">data</span>) : <span class="id">option</span> <span class="id">data</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">d1</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">dbool</span> <span class="id">b1</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">d2</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">dbool</span> <span class="id">b2</span> =&gt; <span class="id">Some</span> (<span class="id">dbool</span> (<span class="id">f</span> <span class="id">b1</span> <span class="id">b2</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">_</span> =&gt; <span class="id">None</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">_</span> =&gt; <span class="id">None</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id">unudbool</span> (<span class="id">f</span>:<span class="id">bool</span> -&gt; <span class="id">bool</span>) (<span class="id">d</span>:<span class="id">data</span>) : <span class="id">option</span> <span class="id">data</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">d</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">dbool</span> <span class="id">b</span> =&gt;<span class="id">Some</span> (<span class="id">dbool</span> (<span class="id">f</span> <span class="id">b</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">_</span> =&gt; <span class="id">None</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id">unbdnat</span> (<span class="id">f</span>:<span class="id">Z</span> -&gt; <span class="id">Z</span> -&gt; <span class="id">bool</span>) (<span class="id">d1</span> <span class="id">d2</span>:<span class="id">data</span>) : <span class="id">option</span> <span class="id">data</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">d1</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">dnat</span> <span class="id">n1</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">d2</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">dnat</span> <span class="id">n2</span> =&gt; <span class="id">Some</span> (<span class="id">dbool</span> (<span class="id">f</span> <span class="id">n1</span> <span class="id">n2</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">_</span> =&gt; <span class="id">None</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">_</span> =&gt; <span class="id">None</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id">unbdata</span> (<span class="id">f</span>:<span class="id">data</span> -&gt; <span class="id">data</span> -&gt; <span class="id">bool</span>) (<span class="id">d1</span> <span class="id">d2</span>:<span class="id">data</span>) : <span class="id">option</span> <span class="id">data</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Some</span> (<span class="id">dbool</span> (<span class="id">f</span> <span class="id">d1</span> <span class="id">d2</span>)).<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id">unsdstring</span> (<span class="id">f</span>:<span class="id">string</span> -&gt; <span class="id">string</span> -&gt; <span class="id">string</span>) (<span class="id">d1</span> <span class="id">d2</span>:<span class="id">data</span>) : <span class="id">option</span> <span class="id">data</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">d1</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">dstring</span> <span class="id">s1</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">d2</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">dstring</span> <span class="id">s2</span> =&gt; <span class="id">Some</span> (<span class="id">dstring</span> (<span class="id">f</span> <span class="id">s1</span> <span class="id">s2</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">_</span> =&gt; <span class="id">None</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">_</span> =&gt; <span class="id">None</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">unsdstring_is_string</span> <span class="id">f</span> <span class="id">d1</span> <span class="id">d2</span> <span class="id">d3</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unsdstring</span> <span class="id">f</span> <span class="id">d1</span> <span class="id">d2</span> = <span class="id">Some</span> <span class="id">d3</span> -&gt; <span class="id">exists</span> <span class="id">s</span>:<span class="id">string</span>, <span class="id">d3</span> = <span class="id">dstring</span> <span class="id">s</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof876')">Proof.</div>
<div class="proofscript" id="proof876">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">d1</span>; <span class="tactic">destruct</span> <span class="id">d2</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> *; <span class="tactic">try</span> <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> (<span class="id">f</span> <span class="id">s</span> <span class="id">s0</span>); <span class="tactic">inversion</span> <span class="id">H</span>; <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id">ondcoll2</span> {<span class="id">A</span>} : (<span class="id">list</span> <span class="id">data</span> -&gt; <span class="id">list</span> <span class="id">data</span> -&gt; <span class="id">A</span>) -&gt; <span class="id">data</span> -&gt; <span class="id">data</span> -&gt; <span class="id">option</span> <span class="id">A</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">f</span> <span class="id">d1</span> <span class="id">d2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">d1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">exact</span> <span class="id">None</span>. <span class="tactic">exact</span> <span class="id">None</span>. <span class="tactic">exact</span> <span class="id">None</span>. <span class="tactic">exact</span> <span class="id">None</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;2: <span class="tactic">exact</span> <span class="id">None</span>. 2: <span class="tactic">exact</span> <span class="id">None</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;2: <span class="tactic">exact</span> <span class="id">None</span>. 2: <span class="tactic">exact</span> <span class="id">None</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">d2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">exact</span> <span class="id">None</span>. <span class="tactic">exact</span> <span class="id">None</span>. <span class="tactic">exact</span> <span class="id">None</span>. <span class="tactic">exact</span> <span class="id">None</span>. 2: <span class="tactic">exact</span> <span class="id">None</span>. 2: <span class="tactic">exact</span> <span class="id">None</span>. 2: <span class="tactic">exact</span> <span class="id">None</span>. 2: <span class="tactic">exact</span> <span class="id">None</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">exact</span> (<span class="id">Some</span> (<span class="id">f</span> <span class="id">l</span> <span class="id">l0</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">exact</span> <span class="id">None</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">exact</span> <span class="id">None</span>.<br/>
&nbsp;&nbsp;Defined.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id">rondcoll2</span> (<span class="id">f</span>:(<span class="id">list</span> <span class="id">data</span> -&gt; <span class="id">list</span> <span class="id">data</span> -&gt; <span class="id">list</span> <span class="id">data</span>)) (<span class="id">d1</span> <span class="id">d2</span>:<span class="id">data</span>) : <span class="id">option</span> <span class="id">data</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">lift</span> <span class="id">dcoll</span> (<span class="id">ondcoll2</span> <span class="id">f</span> <span class="id">d1</span> <span class="id">d2</span>).<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id">ondnat</span> {<span class="id">A</span>} (<span class="id">f</span> : <span class="id">Z</span> -&gt; <span class="id">A</span>) (<span class="id">d</span> : <span class="id">data</span>) :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">d</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">dnat</span> <span class="id">n</span> =&gt; <span class="id">Some</span> (<span class="id">f</span> <span class="id">n</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">_</span> =&gt; <span class="id">None</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id">ondcoll</span> {<span class="id">A</span>} (<span class="id">f</span> : <span class="id">list</span> <span class="id">data</span> -&gt; <span class="id">A</span>) (<span class="id">d</span> : <span class="id">data</span>) :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">d</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">dcoll</span> <span class="id">l</span> =&gt; <span class="id">Some</span> (<span class="id">f</span> <span class="id">l</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">_</span> =&gt; <span class="id">None</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id">lift_oncoll</span> {<span class="id">A</span>} (<span class="id">f</span> : <span class="id">list</span> <span class="id">data</span> -&gt; <span class="id">option</span> <span class="id">A</span>) (<span class="id">d</span> : <span class="id">data</span>) :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">d</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">dcoll</span> <span class="id">l</span> =&gt; <span class="id">f</span> <span class="id">l</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">_</span> =&gt; <span class="id">None</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">lift_oncoll_dcoll</span> {<span class="id">A</span>} (<span class="id">f</span> : <span class="id">list</span> <span class="id">data</span> -&gt; <span class="id">option</span> <span class="id">A</span>) (<span class="id">dl</span> : <span class="id">list</span> <span class="id">data</span>) :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">lift_oncoll</span> <span class="id">f</span> (<span class="id">dcoll</span> <span class="id">dl</span>) = <span class="id">f</span> <span class="id">dl</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof877')">Proof.</div>
<div class="proofscript" id="proof877">
 <span class="tactic">reflexivity</span>. Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">olift_on_lift_dcoll</span> (<span class="id">f</span>:<span class="id">list</span> <span class="id">data</span>-&gt;<span class="id">option</span> <span class="id">data</span>) (<span class="id">d1</span>:<span class="id">option</span> (<span class="id">list</span> <span class="id">data</span>)):<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">olift</span> (<span class="id">lift_oncoll</span> <span class="id">f</span>) (<span class="id">lift</span> <span class="id">dcoll</span> <span class="id">d1</span>) =<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">olift</span> <span class="id">f</span> <span class="id">d1</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof878')">Proof.</div>
<div class="proofscript" id="proof878">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">d1</span>; <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">olift_lift_dcoll</span> (<span class="id">f</span>:<span class="id">list</span> <span class="id">data</span> -&gt; <span class="id">option</span> (<span class="id">list</span> <span class="id">data</span>)) (<span class="id">d1</span>:<span class="id">option</span> (<span class="id">list</span> <span class="id">data</span>)):<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">olift</span> (<span class="kwd">fun</span> <span class="id">c1</span> : <span class="id">list</span> <span class="id">data</span> =&gt; <span class="id">lift</span> <span class="id">dcoll</span> (<span class="id">f</span> <span class="id">c1</span>)) <span class="id">d1</span> =<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">lift</span> <span class="id">dcoll</span> (<span class="id">olift</span> <span class="id">f</span> <span class="id">d1</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof879')">Proof.</div>
<div class="proofscript" id="proof879">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">d1</span>; <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">lift_dcoll_inversion</span> <span class="id">d1</span> <span class="id">d2</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">d1</span> = <span class="id">d2</span> -&gt; <span class="id">lift</span> <span class="id">dcoll</span> <span class="id">d1</span> = <span class="id">lift</span> <span class="id">dcoll</span> <span class="id">d2</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof880')">Proof.</div>
<div class="proofscript" id="proof880">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>; <span class="tactic">rewrite</span> <span class="id">H</span>; <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id">rondcoll</span> (<span class="id">f</span>:<span class="id">list</span> <span class="id">data</span> -&gt; <span class="id">list</span> <span class="id">data</span>) (<span class="id">d</span>:<span class="id">data</span>) : <span class="id">option</span> <span class="id">data</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">lift</span> <span class="id">dcoll</span> (<span class="id">ondcoll</span> <span class="id">f</span> <span class="id">d</span>).<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">lift_filter_Forall</span> {<span class="id">A</span>} {<span class="id">f</span>:<span class="id">A</span>-&gt;<span class="id">option</span> <span class="id">bool</span>} {<span class="id">P</span>} {<span class="id">l</span> <span class="id">x</span>} :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">lift_filter</span> <span class="id">f</span> <span class="id">l</span> = <span class="id">Some</span> <span class="id">x</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Forall</span> <span class="id">P</span> <span class="id">l</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Forall</span> <span class="id">P</span> <span class="id">x</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof881')">Proof.</div>
<div class="proofscript" id="proof881">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">revert</span> <span class="id">x</span>; <span class="tactic">induction</span> <span class="id">l</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">inversion</span> 1; <span class="tactic">subst</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">match_case</span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H1</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">lift_filter</span> <span class="id">f</span> <span class="id">l</span>); <span class="tactic">simpl</span> <span class="kwd">in</span> *; <span class="tactic">try</span> <span class="tactic">discriminate</span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">b</span>; <span class="tactic">inversion</span> <span class="id">H0</span>; <span class="tactic">subst</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;Qed.</div>
&nbsp;&nbsp;<br/>
&nbsp;&nbsp;<span class="kwd">Fixpoint</span> <span class="id">oflat_map</span> {<span class="id">A</span> <span class="id">B</span>} (<span class="id">f</span> : <span class="id">A</span> -&gt; <span class="id">option</span> (<span class="id">list</span> <span class="id">B</span>)) (<span class="id">l</span>:<span class="id">list</span> <span class="id">A</span>) : <span class="id">option</span> (<span class="id">list</span> <span class="id">B</span>) :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">l</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">nil</span> =&gt; <span class="id">Some</span> <span class="id">nil</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">x</span> :: <span class="id">t</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">f</span> <span class="id">x</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">None</span> =&gt; <span class="id">None</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">Some</span> <span class="id">x</span>' =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">lift</span> (<span class="kwd">fun</span> <span class="id">t</span>' =&gt; <span class="id">x</span>' ++ <span class="id">t</span>') (<span class="id">oflat_map</span> <span class="id">f</span> <span class="id">t</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Fixpoint</span> <span class="id">rmap</span> {<span class="id">A</span> <span class="id">B</span>} (<span class="id">f</span> : <span class="id">A</span> -&gt; <span class="id">option</span> <span class="id">B</span>) (<span class="id">l</span>:<span class="id">list</span> <span class="id">A</span>) : <span class="id">option</span> (<span class="id">list</span> <span class="id">B</span>) :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">l</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">nil</span> =&gt; <span class="id">Some</span> <span class="id">nil</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">x</span> :: <span class="id">t</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">f</span> <span class="id">x</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">None</span> =&gt; <span class="id">None</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">Some</span> <span class="id">x</span>' =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">lift</span> (<span class="kwd">fun</span> <span class="id">t</span>' =&gt; <span class="id">x</span>' :: <span class="id">t</span>') (<span class="id">rmap</span> <span class="id">f</span> <span class="id">t</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">rmap_Forall</span> {<span class="id">A</span> <span class="id">B</span>} {<span class="id">f</span>:<span class="id">A</span>-&gt;<span class="id">option</span> <span class="id">B</span>} {<span class="id">P</span>} {<span class="id">l</span> <span class="id">x</span>} :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rmap</span> <span class="id">f</span> <span class="id">l</span> = <span class="id">Some</span> <span class="id">x</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Forall</span> <span class="id">P</span> <span class="id">l</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">P2</span>:<span class="id">B</span>-&gt;<span class="kwd">Prop</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">x</span> <span class="id">z</span>, <span class="id">f</span> <span class="id">x</span> = <span class="id">Some</span> <span class="id">z</span> -&gt; <span class="id">P</span> <span class="id">x</span> -&gt; <span class="id">P2</span> <span class="id">z</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Forall</span> <span class="id">P2</span> <span class="id">x</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof882')">Proof.</div>
<div class="proofscript" id="proof882">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">revert</span> <span class="id">x</span>. <span class="tactic">induction</span> <span class="id">l</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">inversion</span> 1; <span class="tactic">subst</span>; <span class="tactic">trivial</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">match_case</span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H1</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">rmap</span> <span class="id">f</span> <span class="id">l</span>); <span class="tactic">simpl</span> <span class="kwd">in</span> *; <span class="tactic">try</span> <span class="tactic">discriminate</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H0</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">oflat_map_Forall</span> {<span class="id">A</span> <span class="id">B</span>} {<span class="id">f</span>:<span class="id">A</span>-&gt;<span class="id">option</span> (<span class="id">list</span> <span class="id">B</span>)} {<span class="id">P</span>} {<span class="id">l</span> <span class="id">x</span>} :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">oflat_map</span> <span class="id">f</span> <span class="id">l</span> = <span class="id">Some</span> <span class="id">x</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Forall</span> <span class="id">P</span> <span class="id">l</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">P2</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">x</span> <span class="id">z</span>, <span class="id">f</span> <span class="id">x</span> = <span class="id">Some</span> <span class="id">z</span> -&gt; <span class="id">P</span> <span class="id">x</span> -&gt; <span class="id">Forall</span> <span class="id">P2</span> <span class="id">z</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Forall</span> <span class="id">P2</span> <span class="id">x</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof883')">Proof.</div>
<div class="proofscript" id="proof883">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">revert</span> <span class="id">x</span>. <span class="tactic">induction</span> <span class="id">l</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">inversion</span> 1; <span class="tactic">subst</span>; <span class="tactic">trivial</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">match_case</span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H1</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">oflat_map</span> <span class="id">f</span> <span class="id">l</span>); <span class="tactic">simpl</span> <span class="kwd">in</span> *; <span class="tactic">try</span> <span class="tactic">discriminate</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H0</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">Forall_app</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">rmap_id</span> <span class="id">l</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rmap</span> (<span class="kwd">fun</span> <span class="id">d</span> : <span class="id">data</span> =&gt; <span class="id">Some</span> <span class="id">d</span>) <span class="id">l</span> = <span class="id">Some</span> <span class="id">l</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof884')">Proof.</div>
<div class="proofscript" id="proof884">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">l</span>; <span class="tactic">try</span> <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">lift</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">IHl</span>; <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;Qed.</div>
&nbsp;&nbsp;<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">rmap_map</span> {<span class="id">A</span>} (<span class="id">f</span>:<span class="id">data</span> -&gt; <span class="id">A</span>) <span class="id">l</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rmap</span> (<span class="kwd">fun</span> <span class="id">d</span> : <span class="id">data</span> =&gt; <span class="id">Some</span> (<span class="id">f</span> <span class="id">d</span>)) <span class="id">l</span> = <span class="id">Some</span> (<span class="id">map</span> <span class="id">f</span> <span class="id">l</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof885')">Proof.</div>
<div class="proofscript" id="proof885">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">l</span>; <span class="tactic">try</span> <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">lift</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">IHl</span>; <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;Qed.</div>
&nbsp;&nbsp;<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">rmap_map_merge</span> {<span class="id">A</span>} {<span class="id">B</span>} {<span class="id">C</span>} (<span class="id">f1</span>:<span class="id">A</span> -&gt; <span class="id">B</span>) (<span class="id">f2</span>:<span class="id">B</span> -&gt; <span class="id">option</span> <span class="id">C</span>) (<span class="id">l</span>: <span class="id">list</span> <span class="id">A</span>):<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">rmap</span> (<span class="kwd">fun</span> <span class="id">d</span> =&gt; <span class="id">f2</span> (<span class="id">f1</span> <span class="id">d</span>)) <span class="id">l</span>) =<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rmap</span> <span class="id">f2</span> (<span class="id">map</span> <span class="id">f1</span> <span class="id">l</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof886')">Proof.</div>
<div class="proofscript" id="proof886">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">l</span>; <span class="tactic">intros</span>; <span class="tactic">simpl</span>; [<span class="tactic">reflexivity</span>| ].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">f2</span> (<span class="id">f1</span> <span class="id">a</span>)); [|<span class="tactic">reflexivity</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">IHl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">lift_dcoll_cons_rmap</span> <span class="id">d</span> <span class="id">l1</span> <span class="id">l2</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">lift</span> <span class="id">dcoll</span> <span class="id">l1</span> = <span class="id">lift</span> <span class="id">dcoll</span> <span class="id">l2</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">lift</span> <span class="id">dcoll</span> (<span class="id">lift</span> (<span class="kwd">fun</span> <span class="id">t</span> =&gt; <span class="id">d</span> :: <span class="id">t</span>) <span class="id">l1</span>) = <span class="id">lift</span> <span class="id">dcoll</span> (<span class="id">lift</span> (<span class="kwd">fun</span> <span class="id">t</span> =&gt; <span class="id">d</span> :: <span class="id">t</span>) <span class="id">l2</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof887')">Proof.</div>
<div class="proofscript" id="proof887">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">lift</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">l1</span>; <span class="tactic">destruct</span> <span class="id">l2</span>; <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">rmap_over_app</span> {<span class="id">A</span> <span class="id">B</span>} (<span class="id">f</span>:<span class="id">A</span> -&gt; <span class="id">option</span> <span class="id">B</span>) (<span class="id">l1</span>:<span class="id">list</span> <span class="id">A</span>) (<span class="id">l2</span>:<span class="id">list</span> <span class="id">A</span>) :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rmap</span> <span class="id">f</span> (<span class="id">l1</span> ++ <span class="id">l2</span>) = <span class="id">olift2</span> (<span class="kwd">fun</span> <span class="id">x</span> <span class="id">y</span> =&gt; <span class="id">Some</span> (<span class="id">x</span>++<span class="id">y</span>)) (<span class="id">rmap</span> <span class="id">f</span> <span class="id">l1</span>) (<span class="id">rmap</span> <span class="id">f</span> <span class="id">l2</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof888')">Proof.</div>
<div class="proofscript" id="proof888">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">revert</span> <span class="id">l2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">l1</span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">simpl</span>; <span class="tactic">destruct</span> (<span class="id">rmap</span> <span class="id">f</span> <span class="id">l2</span>); <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">f</span> <span class="id">a</span>); <span class="tactic">try</span> <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">IHl1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">generalize</span> (<span class="id">rmap</span> <span class="id">f</span> <span class="id">l1</span>); <span class="tactic">generalize</span> (<span class="id">rmap</span> <span class="id">f</span> <span class="id">l2</span>); <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">o0</span>; <span class="tactic">destruct</span> <span class="id">o</span>; <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Fixpoint</span> <span class="id">listo_to_olist</span> {<span class="id">a</span>: <span class="kwd">Type</span>} (<span class="id">l</span>: <span class="id">list</span> (<span class="id">option</span> <span class="id">a</span>)) : <span class="id">option</span> (<span class="id">list</span> <span class="id">a</span>) :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">l</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">nil</span> =&gt; <span class="id">Some</span> <span class="id">nil</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">Some</span> <span class="id">x</span> :: <span class="id">xs</span> =&gt; <span class="kwd">match</span> <span class="id">listo_to_olist</span> <span class="id">xs</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">None</span> =&gt; <span class="id">None</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">Some</span> <span class="id">xs</span> =&gt; <span class="id">Some</span> (<span class="id">x</span>::<span class="id">xs</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">None</span> :: <span class="id">xs</span> =&gt; <span class="id">None</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">listo_to_olist_simpl_rmap</span> {<span class="id">A</span> <span class="id">B</span>:<span class="kwd">Type</span>} (<span class="id">f</span>:<span class="id">A</span> -&gt; <span class="id">option</span> <span class="id">B</span>) (<span class="id">l</span>:<span class="id">list</span> <span class="id">A</span>) :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rmap</span> <span class="id">f</span> <span class="id">l</span> = (<span class="id">listo_to_olist</span> (<span class="id">map</span> <span class="id">f</span> <span class="id">l</span>)).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof889')">Proof.</div>
<div class="proofscript" id="proof889">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">l</span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">f</span> <span class="id">a</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">rewrite</span> <span class="id">IHl</span>; <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">listo_to_olist_some</span> {<span class="id">A</span>:<span class="kwd">Type</span>} (<span class="id">l</span>:<span class="id">list</span> (<span class="id">option</span> <span class="id">A</span>)) (<span class="id">l</span>':<span class="id">list</span> <span class="id">A</span>) :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">listo_to_olist</span> <span class="id">l</span> = <span class="id">Some</span> <span class="id">l</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">l</span> = (<span class="id">map</span> <span class="id">Some</span> <span class="id">l</span>').<br/>
<div class="toggleproof" onclick="toggleDisplay('proof890')">Proof.</div>
<div class="proofscript" id="proof890">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">revert</span> <span class="id">l</span>'.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">l</span>; <span class="tactic">simpl</span>; <span class="tactic">intros</span> <span class="id">l</span>' <span class="id">eqq</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">invcs</span> <span class="id">eqq</span>; <span class="tactic">simpl</span>; <span class="tactic">trivial</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">destruct</span> <span class="id">a</span>; <span class="tactic">try</span> <span class="tactic">discriminate</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">match_destr_in</span> <span class="id">eqq</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">invcs</span> <span class="id">eqq</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">IHl</span>; <span class="tactic">trivial</span>.<br/>
&nbsp;&nbsp;Qed.</div>
&nbsp;&nbsp;&nbsp;&nbsp;<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id">rfilter</span> {<span class="id">A</span>} (<span class="id">f</span>:(<span class="id">string</span>*<span class="id">A</span>) -&gt; <span class="id">bool</span>) (<span class="id">l</span>:<span class="id">list</span> (<span class="id">string</span>*<span class="id">A</span>)) : <span class="id">list</span> (<span class="id">string</span>*<span class="id">A</span>) :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">filter</span> <span class="id">f</span> <span class="id">l</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id">rremove</span> {<span class="id">A</span>} (<span class="id">l</span>:<span class="id">list</span> (<span class="id">string</span>*<span class="id">A</span>)) (<span class="id">s</span>:<span class="id">string</span>) : <span class="id">list</span> (<span class="id">string</span>*<span class="id">A</span>) :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">filter</span> (<span class="kwd">fun</span> <span class="id">x</span> =&gt; <span class="kwd">if</span> <span class="id">string_dec</span> <span class="id">s</span> (<span class="id">fst</span> <span class="id">x</span>) <span class="kwd">then</span> <span class="id">false</span> <span class="kwd">else</span> <span class="id">true</span>) <span class="id">l</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id">rproject</span> {<span class="id">A</span>} (<span class="id">l</span>:<span class="id">list</span> (<span class="id">string</span>*<span class="id">A</span>)) (<span class="id">s</span>:<span class="id">list</span> <span class="id">string</span>) : <span class="id">list</span> (<span class="id">string</span>*<span class="id">A</span>) :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">filter</span> (<span class="kwd">fun</span> <span class="id">x</span> =&gt; <span class="kwd">if</span> <span class="id">in_dec</span> <span class="id">string_dec</span> (<span class="id">fst</span> <span class="id">x</span>) <span class="id">s</span> <span class="kwd">then</span> <span class="id">true</span> <span class="kwd">else</span> <span class="id">false</span>) <span class="id">l</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">rproject_nil_l</span> {<span class="id">A</span>} (<span class="id">s</span>:<span class="id">list</span> <span class="id">string</span>) :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;@<span class="id">rproject</span> <span class="id">A</span> [] <span class="id">s</span> = [].<br/>
<div class="toggleproof" onclick="toggleDisplay('proof891')">Proof.</div>
<div class="proofscript" id="proof891">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;Qed.</div>
&nbsp;&nbsp;<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">rproject_nil_r</span> {<span class="id">A</span>} (<span class="id">l</span>:<span class="id">list</span> (<span class="id">string</span>*<span class="id">A</span>)) :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;@<span class="id">rproject</span> <span class="id">A</span> <span class="id">l</span> [] = [].<br/>
<div class="toggleproof" onclick="toggleDisplay('proof892')">Proof.</div>
<div class="proofscript" id="proof892">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">l</span>. <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>. <span class="tactic">apply</span> <span class="id">IHl</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">rproject_rec_sort_commute</span> {<span class="id">B</span>} (<span class="id">l1</span>:<span class="id">list</span> (<span class="id">string</span>*<span class="id">B</span>)) <span class="id">sl</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rproject</span> (<span class="id">rec_sort</span> <span class="id">l1</span>) <span class="id">sl</span> = <span class="id">rec_sort</span> (<span class="id">rproject</span> <span class="id">l1</span> <span class="id">sl</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof893')">Proof.</div>
<div class="proofscript" id="proof893">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">rproject</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">rec_sort_filter_fst_commute</span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">match_destr</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">rproject_map_fst_same</span> {<span class="id">B</span> <span class="id">C</span>} (<span class="id">f</span>:<span class="id">string</span>*<span class="id">B</span>-&gt;<span class="id">string</span>*<span class="id">C</span>) (<span class="id">l</span>:<span class="id">list</span> (<span class="id">string</span>*<span class="id">B</span>)) <span class="id">sl</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">samedom</span>:<span class="kwd">forall</span> <span class="id">a</span>, <span class="id">In</span> <span class="id">a</span> <span class="id">l</span> -&gt; <span class="id">fst</span> (<span class="id">f</span> <span class="id">a</span>) = <span class="id">fst</span> <span class="id">a</span>) :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rproject</span> (<span class="id">map</span> <span class="id">f</span> <span class="id">l</span>) <span class="id">sl</span> = <span class="id">map</span> <span class="id">f</span> (<span class="id">rproject</span> <span class="id">l</span> <span class="id">sl</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof894')">Proof.</div>
<div class="proofscript" id="proof894">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">l</span>; <span class="tactic">simpl</span>; <span class="tactic">trivial</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">samedom</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">in_dec</span> <span class="id">string_dec</span> (<span class="id">fst</span> (<span class="id">f</span> <span class="id">a</span>)) <span class="id">sl</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">in_dec</span> <span class="id">string_dec</span> (<span class="id">fst</span> <span class="id">a</span>) <span class="id">sl</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">rewrite</span> <span class="id">IHl</span>; <span class="tactic">intuition</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">rewrite</span> <span class="id">samedom</span> <span class="kwd">in</span> <span class="id">i</span>; <span class="tactic">intuition</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">rewrite</span> &lt;- <span class="id">samedom</span> <span class="kwd">in</span> <span class="id">i</span>; <span class="tactic">intuition</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">rewrite</span> <span class="id">IHl</span>; <span class="tactic">intuition</span>.<br/>
&nbsp;&nbsp;Qed.</div>
&nbsp;&nbsp;<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">rproject_app</span> {<span class="id">B</span>} (<span class="id">l1</span> <span class="id">l2</span>:<span class="id">list</span> (<span class="id">string</span>*<span class="id">B</span>)) <span class="id">sl</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rproject</span> (<span class="id">l1</span> ++ <span class="id">l2</span>) <span class="id">sl</span> = (<span class="id">rproject</span> <span class="id">l1</span> <span class="id">sl</span>) ++ (<span class="id">rproject</span> <span class="id">l2</span> <span class="id">sl</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof895')">Proof.</div>
<div class="proofscript" id="proof895">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">rproject</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">filter_app</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">rproject_rproject</span>  {<span class="id">B</span>} (<span class="id">l</span>:<span class="id">list</span> (<span class="id">string</span>*<span class="id">B</span>)) <span class="id">sl1</span> <span class="id">sl2</span>:<br/>
&nbsp;&nbsp;&nbsp;<span class="id">rproject</span> (<span class="id">rproject</span> <span class="id">l</span> <span class="id">sl2</span>) <span class="id">sl1</span> = <span class="id">rproject</span> <span class="id">l</span> (<span class="id">set_inter</span> <span class="id">string_dec</span> <span class="id">sl2</span> <span class="id">sl1</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof896')">Proof.</div>
<div class="proofscript" id="proof896">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">rproject</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">filter_and</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">filter_ext</span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="id">match_destr</span>; <span class="tactic">simpl</span>; <span class="tactic">trivial</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">specialize</span> (<span class="id">set_inter_intro</span> <span class="id">string_dec</span> (<span class="id">fst</span> <span class="id">x</span>) <span class="id">sl2</span> <span class="id">sl1</span>); <span class="tactic">intuition</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">specialize</span> (<span class="id">set_inter_elim1</span> <span class="id">string_dec</span> (<span class="id">fst</span> <span class="id">x</span>) <span class="id">sl2</span> <span class="id">sl1</span>); <span class="tactic">intuition</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">specialize</span> (<span class="id">set_inter_elim2</span> <span class="id">string_dec</span> (<span class="id">fst</span> <span class="id">x</span>) <span class="id">sl2</span> <span class="id">sl1</span>); <span class="tactic">intuition</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">apply</span> <span class="id">set_inter_elim</span> <span class="kwd">in</span> <span class="id">i</span>; <span class="tactic">intuition</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">rproject_Forall2_same_domain</span> {<span class="id">B</span> <span class="id">C</span>} <span class="id">P</span> (<span class="id">l1</span>:<span class="id">list</span>(<span class="id">string</span>*<span class="id">B</span>)) (<span class="id">l2</span>:<span class="id">list</span> (<span class="id">string</span>*<span class="id">C</span>)) <span class="id">ls</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Forall2</span> <span class="id">P</span> <span class="id">l1</span> <span class="id">l2</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">domain</span> <span class="id">l1</span> = <span class="id">domain</span> <span class="id">l2</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Forall2</span> <span class="id">P</span> (<span class="id">rproject</span> <span class="id">l1</span> <span class="id">ls</span>) (<span class="id">rproject</span> <span class="id">l2</span> <span class="id">ls</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof897')">Proof.</div>
<div class="proofscript" id="proof897">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">rproject</span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">filter_Forall2_same</span>; <span class="tactic">trivial</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">revert</span> <span class="id">H0</span>; <span class="tactic">clear</span>. <span class="id">revert</span> <span class="id">l2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">l1</span>; <span class="tactic">destruct</span> <span class="id">l2</span>; <span class="tactic">simpl</span>; <span class="tactic">trivial</span>; <span class="tactic">try</span> <span class="tactic">discriminate</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> 1.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">match_destr</span>; <span class="tactic">f_equal</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">sublist_rproject</span> {<span class="id">A</span>} (<span class="id">l</span>:<span class="id">list</span>(<span class="id">string</span>*<span class="id">A</span>)) <span class="id">sl</span>: <span class="id">sublist</span> (<span class="id">rproject</span> <span class="id">l</span> <span class="id">sl</span>) <span class="id">l</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof898')">Proof.</div>
<div class="proofscript" id="proof898">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">l</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">constructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">match_destr</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">apply</span> <span class="id">sublist_cons</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">apply</span> <span class="id">sublist_skip</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;Qed.</div>
&nbsp;&nbsp;<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">rproject_remove_all</span> {<span class="id">B</span>} <span class="id">s</span> <span class="id">sl</span> (<span class="id">l1</span>:<span class="id">list</span>(<span class="id">string</span>*<span class="id">B</span>)):<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rproject</span> <span class="id">l1</span> (<span class="id">remove_all</span> <span class="id">s</span> <span class="id">sl</span>) =<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">filter</span> (<span class="kwd">fun</span> <span class="id">x</span> =&gt; <span class="id">nequiv_decb</span> <span class="id">s</span> (<span class="id">fst</span> <span class="id">x</span>)) (<span class="id">rproject</span> <span class="id">l1</span> <span class="id">sl</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof899')">Proof.</div>
<div class="proofscript" id="proof899">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">remove_all_filter</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">l1</span>; <span class="tactic">simpl</span>; <span class="tactic">trivial</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">IHl1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">in_dec</span> <span class="id">string_dec</span> (<span class="id">fst</span> <span class="id">a</span>) <span class="id">sl</span>); <span class="tactic">destruct</span> (<span class="id">in_dec</span> <span class="id">string_dec</span> (<span class="id">fst</span> <span class="id">a</span>) (<span class="id">filter</span> (<span class="id">nequiv_decb</span> <span class="id">s</span>) <span class="id">sl</span>)); <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">apply</span> <span class="id">filter_In</span> <span class="kwd">in</span> <span class="id">i0</span>. <span class="tactic">destruct</span> <span class="id">i0</span> <span class="kwd">as</span> [<span class="id">inn</span> <span class="id">neq</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">neq</span>; <span class="tactic">trivial</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">match_case</span>; <span class="tactic">intros</span> <span class="id">eqq</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">elim</span> <span class="id">n</span>. <span class="tactic">apply</span> <span class="id">filter_In</span>; <span class="tactic">intuition</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">apply</span> <span class="id">filter_In</span> <span class="kwd">in</span> <span class="id">i</span>; <span class="tactic">intuition</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">trivial</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">rec_sort_rproject_remove_all_in</span> {<span class="id">B</span>} <span class="id">s</span> <span class="id">sl</span> <span class="id">l1</span> <span class="id">l2</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">In</span> <span class="id">s</span> <span class="id">sl</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">In</span> <span class="id">s</span> (@<span class="id">domain</span> <span class="id">_</span> <span class="id">B</span> <span class="id">l2</span>) -&gt; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rec_sort</span> (<span class="id">rproject</span> <span class="id">l1</span> <span class="id">sl</span> ++ <span class="id">l2</span>) = <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rec_sort</span> (<span class="id">rproject</span> <span class="id">l1</span> (<span class="id">remove_all</span> <span class="id">s</span> <span class="id">sl</span>) ++ <span class="id">l2</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof900')">Proof.</div>
<div class="proofscript" id="proof900">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">rproject_remove_all</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> (<span class="id">rec_sort_filter_latter_from_former</span> <span class="id">s</span>); <span class="tactic">trivial</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">rec_sort_rproject_remove_in</span> {<span class="id">B</span>} <span class="id">s</span> <span class="id">sl</span> <span class="id">l1</span> <span class="id">l2</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">In</span> <span class="id">s</span> <span class="id">sl</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">In</span> <span class="id">s</span> (@<span class="id">domain</span> <span class="id">_</span> <span class="id">B</span> <span class="id">l2</span>) -&gt; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rec_sort</span> (<span class="id">rproject</span> <span class="id">l1</span> <span class="id">sl</span> ++ <span class="id">l2</span>) = <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rec_sort</span> (<span class="id">rproject</span> <span class="id">l1</span> (<span class="id">remove</span> <span class="id">string_dec</span> <span class="id">s</span> <span class="id">sl</span>) ++ <span class="id">l2</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof901')">Proof.</div>
<div class="proofscript" id="proof901">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> (<span class="id">rec_sort_rproject_remove_all_in</span> <span class="id">s</span>); <span class="tactic">trivial</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">rondcoll2_dcoll</span> <span class="id">f</span> (<span class="id">l1</span> <span class="id">l2</span>:<span class="id">list</span> <span class="id">data</span>):<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rondcoll2</span> <span class="id">f</span> (<span class="id">dcoll</span> <span class="id">l1</span>) (<span class="id">dcoll</span> <span class="id">l2</span>) = <span class="id">Some</span> (<span class="id">dcoll</span> (<span class="id">f</span> <span class="id">l1</span> <span class="id">l2</span>)).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof902')">Proof.</div>
<div class="proofscript" id="proof902">
 <span class="tactic">reflexivity</span>. Qed.</div>
&nbsp;&nbsp;<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">rondcoll_dcoll</span> <span class="id">f</span> (<span class="id">l</span>:<span class="id">list</span> <span class="id">data</span>):<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rondcoll</span> <span class="id">f</span> (<span class="id">dcoll</span> <span class="id">l</span>) = <span class="id">Some</span> (<span class="id">dcoll</span> (<span class="id">f</span> <span class="id">l</span>)).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof903')">Proof.</div>
<div class="proofscript" id="proof903">
 <span class="tactic">reflexivity</span>. Qed.</div>
&nbsp;&nbsp;<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">ondcoll_dcoll</span> {<span class="id">A</span>} (<span class="id">f</span>:<span class="id">list</span> <span class="id">data</span> -&gt; <span class="id">A</span>) (<span class="id">l</span>:<span class="id">list</span> <span class="id">data</span>):<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ondcoll</span> <span class="id">f</span> (<span class="id">dcoll</span> <span class="id">l</span>) = <span class="id">Some</span> (<span class="id">f</span> <span class="id">l</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof904')">Proof.</div>
<div class="proofscript" id="proof904">
 <span class="tactic">reflexivity</span>. Qed.</div>
&nbsp;&nbsp;<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">dcoll_map_app</span> {<span class="id">A</span>} (<span class="id">f</span>:<span class="id">A</span> -&gt; <span class="id">data</span>) (<span class="id">l1</span> <span class="id">l2</span>:<span class="id">list</span> <span class="id">A</span>) :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Some</span> (<span class="id">dcoll</span> (<span class="id">map</span> <span class="id">f</span> <span class="id">l1</span> ++ <span class="id">map</span> <span class="id">f</span> <span class="id">l2</span>)) = <span class="id">rondcoll2</span> <span class="id">bunion</span> (<span class="id">dcoll</span> (<span class="id">map</span> <span class="id">f</span> <span class="id">l1</span>)) (<span class="id">dcoll</span> (<span class="id">map</span> <span class="id">f</span> <span class="id">l2</span>)).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof905')">Proof.</div>
<div class="proofscript" id="proof905">
 <span class="tactic">reflexivity</span>. Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id">orecconcat</span> (<span class="id">a</span>:<span class="id">data</span>) (<span class="id">x</span>:<span class="id">data</span>) :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">a</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">drec</span> <span class="id">r2</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">x</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">drec</span> <span class="id">r1</span> =&gt; <span class="id">Some</span> (<span class="id">drec</span> (<span class="id">rec_concat_sort</span> <span class="id">r2</span> <span class="id">r1</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">_</span> =&gt; <span class="id">None</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">_</span> =&gt; <span class="id">None</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
&nbsp;&nbsp;<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id">omap_concat</span> (<span class="id">a</span>:<span class="id">data</span>) (<span class="id">d1</span>:<span class="id">list</span> <span class="id">data</span>) : <span class="id">option</span> (<span class="id">list</span> <span class="id">data</span>) :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rmap</span> (<span class="kwd">fun</span> <span class="id">x</span> =&gt; <span class="id">orecconcat</span> <span class="id">a</span> <span class="id">x</span>) <span class="id">d1</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id">oomap_concat</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">f</span>:<span class="id">data</span> -&gt; <span class="id">option</span> <span class="id">data</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">a</span>:<span class="id">data</span>) :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">f</span> <span class="id">a</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">Some</span> (<span class="id">dcoll</span> <span class="id">y</span>) =&gt; <span class="id">omap_concat</span> <span class="id">a</span> <span class="id">y</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">_</span> =&gt; <span class="id">None</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id">rmap_concat</span> (<span class="id">f</span>:<span class="id">data</span> -&gt; <span class="id">option</span> <span class="id">data</span>) (<span class="id">d</span>:<span class="id">list</span> <span class="id">data</span>) : <span class="id">option</span> (<span class="id">list</span> <span class="id">data</span>) :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">oflat_map</span> (<span class="id">oomap_concat</span> <span class="id">f</span>) <span class="id">d</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">rmap_concat_cons</span> <span class="id">f</span> <span class="id">d</span> <span class="id">a</span> <span class="id">x</span> <span class="id">y</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rmap_concat</span> <span class="id">f</span> <span class="id">d</span> = <span class="id">Some</span> <span class="id">x</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">oomap_concat</span> <span class="id">f</span> <span class="id">a</span>) = <span class="id">Some</span> <span class="id">y</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rmap_concat</span> <span class="id">f</span> (<span class="id">a</span> :: <span class="id">d</span>) = <span class="id">Some</span> (<span class="id">y</span> ++ <span class="id">x</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof906')">Proof.</div>
<div class="proofscript" id="proof906">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">d</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">unfold</span> <span class="id">rmap_concat</span> <span class="kwd">in</span> *; <span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H0</span>; <span class="tactic">inversion</span> <span class="id">H</span>; <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">unfold</span> <span class="id">rmap_concat</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">revert</span> <span class="id">H</span>; <span class="tactic">elim</span> (<span class="id">oomap_concat</span> <span class="id">f</span> <span class="id">a0</span>); <span class="tactic">intros</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> *; <span class="tactic">try</span> <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H0</span> <span class="kwd">in</span> *; <span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">rmap_concat_cons_none</span> <span class="id">f</span> <span class="id">d</span> <span class="id">a</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rmap_concat</span> <span class="id">f</span> <span class="id">d</span> = <span class="id">None</span> -&gt; <span class="id">rmap_concat</span> <span class="id">f</span> ((<span class="id">drec</span> <span class="id">a</span>) :: <span class="id">d</span>) = <span class="id">None</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof907')">Proof.</div>
<div class="proofscript" id="proof907">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">rmap_concat</span>, <span class="id">oflat_map</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">oomap_concat</span> <span class="id">f</span> (<span class="id">drec</span> <span class="id">a</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">revert</span> <span class="id">H</span>. <span class="tactic">elim</span> (<span class="id">oflat_map</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">fun</span> <span class="id">x</span> : <span class="id">data</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">oomap_concat</span> <span class="id">f</span> <span class="id">x</span>) <span class="id">d</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> *; <span class="tactic">rewrite</span> <span class="id">H</span>; <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">rmap_concat_cons_none_first</span> <span class="id">f</span> <span class="id">d</span> <span class="id">a</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">oomap_concat</span> <span class="id">f</span> <span class="id">a</span>) = <span class="id">None</span> -&gt; <span class="id">rmap_concat</span> <span class="id">f</span> (<span class="id">a</span> :: <span class="id">d</span>) = <span class="id">None</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof908')">Proof.</div>
<div class="proofscript" id="proof908">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">rmap_concat</span>, <span class="id">oflat_map</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">oomap_concat</span> <span class="id">f</span> <span class="id">a</span>); [<span class="tactic">congruence</span>|<span class="tactic">reflexivity</span>].<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id">rproduct</span> (<span class="id">d1</span> <span class="id">d2</span>:<span class="id">list</span> <span class="id">data</span>) : <span class="id">option</span> (<span class="id">list</span> <span class="id">data</span>) :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">oflat_map</span> (<span class="kwd">fun</span> <span class="id">x</span> =&gt; <span class="id">omap_concat</span> <span class="id">x</span> <span class="id">d2</span>) <span class="id">d1</span>.<br/>
&nbsp;&nbsp;<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">rproduct_cons</span> (<span class="id">d1</span> <span class="id">d2</span>:<span class="id">list</span> <span class="id">data</span>) <span class="id">a</span> <span class="id">x</span> <span class="id">y</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rproduct</span> <span class="id">d1</span> <span class="id">d2</span> = <span class="id">Some</span> <span class="id">x</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">omap_concat</span> <span class="id">a</span> <span class="id">d2</span>) = <span class="id">Some</span> <span class="id">y</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rproduct</span> (<span class="id">a</span>::<span class="id">d1</span>) <span class="id">d2</span> = <span class="id">Some</span> (<span class="id">y</span> ++ <span class="id">x</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof909')">Proof.</div>
<div class="proofscript" id="proof909">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">d2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">unfold</span> <span class="id">rproduct</span> <span class="kwd">in</span> *; <span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H</span>; <span class="tactic">inversion</span> <span class="id">H0</span>; <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">unfold</span> <span class="id">rproduct</span> <span class="kwd">in</span> *. <span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H</span> <span class="kwd">in</span> *; <span class="tactic">simpl</span> <span class="kwd">in</span> *; <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id">rflatten</span> (<span class="id">d</span>:<span class="id">list</span> <span class="id">data</span>) : <span class="id">option</span> (<span class="id">list</span> <span class="id">data</span>) :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">oflat_map</span> (<span class="kwd">fun</span> <span class="id">x</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">x</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">dcoll</span> <span class="id">y</span> =&gt; <span class="id">Some</span> <span class="id">y</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">_</span> =&gt; <span class="id">None</span> <span class="kwd">end</span>) <span class="id">d</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">rflatten_cons</span> (<span class="id">l</span>:<span class="id">list</span> <span class="id">data</span>) <span class="id">rest</span> <span class="id">r</span>' :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rflatten</span> <span class="id">rest</span> = <span class="id">Some</span> <span class="id">r</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rflatten</span> ((<span class="id">dcoll</span> <span class="id">l</span>) :: <span class="id">rest</span>) = <span class="id">Some</span> (<span class="id">l</span> ++ <span class="id">r</span>').<br/>
<div class="toggleproof" onclick="toggleDisplay('proof910')">Proof.</div>
<div class="proofscript" id="proof910">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">l</span>; <span class="tactic">unfold</span> <span class="id">rflatten</span> <span class="kwd">in</span> *; <span class="tactic">simpl</span>; <span class="tactic">rewrite</span> <span class="id">H</span>; <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">rflatten_app</span> (<span class="id">l1</span> <span class="id">l2</span>:<span class="id">list</span> <span class="id">data</span>) <span class="id">r1</span> <span class="id">r2</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rflatten</span> <span class="id">l1</span> = <span class="id">Some</span> <span class="id">r1</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rflatten</span> <span class="id">l2</span> = <span class="id">Some</span> <span class="id">r2</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rflatten</span> (<span class="id">l1</span> ++ <span class="id">l2</span>) = <span class="id">Some</span> (<span class="id">r1</span> ++ <span class="id">r2</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof911')">Proof.</div>
<div class="proofscript" id="proof911">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">revert</span> <span class="id">l2</span> <span class="id">r1</span> <span class="id">r2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">l1</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> *; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">inversion</span> <span class="id">H</span>; <span class="tactic">subst</span>. <span class="tactic">simpl</span>. <span class="tactic">trivial</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;-  <span class="tactic">destruct</span> <span class="id">a</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> *; <span class="tactic">inversion</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">rflatten</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">H2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">some_lift</span> <span class="kwd">in</span> <span class="id">H2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H2</span> <span class="kwd">as</span> [? <span class="id">eqq</span> ?]; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">erewrite</span> <span class="id">IHl1</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">ass_app</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">trivial</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">rflatten_map_dcoll_id</span> <span class="id">coll</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rflatten</span> (<span class="id">map</span> (<span class="kwd">fun</span> <span class="id">d</span> : <span class="id">data</span> =&gt; <span class="id">dcoll</span> (<span class="id">d</span>::<span class="id">nil</span>)) <span class="id">coll</span>) = <span class="id">Some</span> <span class="id">coll</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof912')">Proof.</div>
<div class="proofscript" id="proof912">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">coll</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">a</span>::<span class="id">coll</span> = (<span class="id">a</span>::<span class="id">nil</span>)++<span class="id">coll</span>) <span class="tactic">by</span> <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">rflatten_cons</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">rflatten_cons_none</span> (<span class="id">d</span>:<span class="id">data</span>) <span class="id">rest</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rflatten</span> <span class="id">rest</span> = <span class="id">None</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rflatten</span> (<span class="id">d</span> :: <span class="id">rest</span>) = <span class="id">None</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof913')">Proof.</div>
<div class="proofscript" id="proof913">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">d</span>; <span class="tactic">try</span> <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">rflatten</span> <span class="kwd">in</span> *; <span class="tactic">unfold</span> <span class="id">oflat_map</span> <span class="kwd">in</span> *; <span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H</span>. <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">rflatten_app_none1</span> <span class="id">l1</span> <span class="id">l2</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rflatten</span> <span class="id">l1</span> = <span class="id">None</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rflatten</span> (<span class="id">l1</span> ++ <span class="id">l2</span>) = <span class="id">None</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof914')">Proof.</div>
<div class="proofscript" id="proof914">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">revert</span> <span class="id">l2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">l1</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">inversion</span> 1.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">a</span>; <span class="tactic">simpl</span>; <span class="tactic">try</span> <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">rflatten</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">none_lift</span> <span class="kwd">in</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">IHl1</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">rflatten_app_none2</span> <span class="id">l1</span> <span class="id">l2</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rflatten</span> <span class="id">l2</span> = <span class="id">None</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rflatten</span> (<span class="id">l1</span> ++ <span class="id">l2</span>) = <span class="id">None</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof915')">Proof.</div>
<div class="proofscript" id="proof915">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">revert</span> <span class="id">l2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">l1</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">trivial</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">a</span>; <span class="tactic">simpl</span>; <span class="tactic">try</span> <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">rflatten</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">lift_none</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;Qed.</div>
&nbsp;&nbsp;<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id">rif</span> {<span class="id">A</span>} (<span class="id">e</span>:<span class="id">A</span> -&gt; <span class="id">option</span> <span class="id">bool</span>) (<span class="id">a</span>:<span class="id">A</span>) : <span class="id">option</span> (<span class="id">list</span> <span class="id">A</span>) :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> (<span class="id">e</span> <span class="id">a</span>) <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">None</span> =&gt; <span class="id">None</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">Some</span> <span class="id">b</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">if</span> <span class="id">b</span> <span class="kwd">then</span> <span class="id">Some</span> (<span class="id">a</span>::<span class="id">nil</span>) <span class="kwd">else</span> <span class="id">Some</span> <span class="id">nil</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id">lrflatten</span> {<span class="id">A</span>} : <span class="id">option</span> (<span class="id">list</span> (<span class="id">list</span> <span class="id">A</span>)) -&gt; <span class="id">option</span> (<span class="id">list</span> <span class="id">A</span>) :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">lift</span> <span class="id">lflatten</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id">orfilter</span> {<span class="id">A</span>} (<span class="id">f</span>:<span class="id">A</span> -&gt; <span class="id">option</span> <span class="id">bool</span>) (<span class="id">ol</span>:<span class="id">option</span> (<span class="id">list</span> <span class="id">A</span>)) : <span class="id">option</span> (<span class="id">list</span> <span class="id">A</span>) :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">olift</span> (<span class="id">lift_filter</span> <span class="id">f</span>) <span class="id">ol</span>.<br/>
&nbsp;<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">filter_eq_flatten_if</span> {<span class="id">A</span>} (<span class="id">e</span>:<span class="id">A</span> -&gt; <span class="id">option</span> <span class="id">bool</span>) (<span class="id">ol</span>:<span class="id">option</span> (<span class="id">list</span> <span class="id">A</span>)) :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">orfilter</span> <span class="id">e</span> <span class="id">ol</span> = <span class="id">lrflatten</span> (<span class="id">olift</span> (<span class="id">rmap</span> (<span class="id">rif</span> <span class="id">e</span>)) <span class="id">ol</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof916')">Proof.</div>
<div class="proofscript" id="proof916">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">ol</span>; <span class="tactic">try</span> <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">l</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">rif</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">e</span> <span class="id">a</span>); <span class="tactic">try</span> <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">b</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> *; <span class="tactic">rewrite</span> <span class="id">IHl</span>; <span class="tactic">clear</span> <span class="id">IHl</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">generalize</span> ((<span class="id">rmap</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">fun</span> <span class="id">a0</span> : <span class="id">A</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">e</span> <span class="id">a0</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">Some</span> <span class="id">true</span> =&gt; <span class="id">Some</span> [<span class="id">a0</span>]<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">Some</span> <span class="id">false</span> =&gt; <span class="id">Some</span> []<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">None</span> =&gt; <span class="id">None</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>) <span class="id">l</span>)); <span class="tactic">intros</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">o</span>; <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;<span class="kwd">Definition</span> <span class="id">oand</span> (<span class="id">x1</span> <span class="id">x2</span>: <span class="id">option</span> <span class="id">bool</span>) : <span class="id">option</span> <span class="id">bool</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">x1</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">None</span> =&gt; <span class="id">None</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">Some</span> <span class="id">b1</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">x2</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">None</span> =&gt; <span class="id">None</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">Some</span> <span class="id">b2</span> =&gt; <span class="id">Some</span> (<span class="id">andb</span> <span class="id">b1</span> <span class="id">b2</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">rmap_ext</span>  {<span class="id">A</span> <span class="id">B</span> : <span class="kwd">Type</span>} (<span class="id">f</span> <span class="id">g</span> : <span class="id">A</span> -&gt; <span class="id">option</span> <span class="id">B</span>) (<span class="id">l</span> : <span class="id">list</span> <span class="id">A</span>) :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">x</span>, <span class="id">In</span> <span class="id">x</span> <span class="id">l</span> -&gt; <span class="id">f</span> <span class="id">x</span> = <span class="id">g</span> <span class="id">x</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rmap</span> <span class="id">f</span> <span class="id">l</span> = <span class="id">rmap</span> <span class="id">g</span> <span class="id">l</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof917')">Proof.</div>
<div class="proofscript" id="proof917">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">l</span>; <span class="tactic">simpl</span>; <span class="tactic">trivial</span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">IHl</span> <span class="tactic">by</span> <span class="tactic">intuition</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> (<span class="id">H</span> <span class="id">a</span>) <span class="tactic">by</span> <span class="tactic">intuition</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">trivial</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">oflat_map_ext</span> {<span class="id">A</span> <span class="id">B</span>} (<span class="id">f</span> <span class="id">g</span>:<span class="id">A</span>-&gt;<span class="id">option</span> (<span class="id">list</span> <span class="id">B</span>)) <span class="id">l</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">x</span>, <span class="id">In</span> <span class="id">x</span> <span class="id">l</span> -&gt; <span class="id">f</span> <span class="id">x</span> = <span class="id">g</span> <span class="id">x</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">oflat_map</span> <span class="id">f</span> <span class="id">l</span> = <span class="id">oflat_map</span> <span class="id">g</span> <span class="id">l</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof918')">Proof.</div>
<div class="proofscript" id="proof918">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">l</span>; <span class="tactic">simpl</span>; <span class="tactic">trivial</span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">IHl</span> <span class="tactic">by</span> <span class="tactic">intuition</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> (<span class="id">H</span> <span class="id">a</span>) <span class="tactic">by</span> <span class="tactic">intuition</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">trivial</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">oomap_concat_ext_weak</span> <span class="id">f</span> <span class="id">g</span> <span class="id">a</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">f</span> <span class="id">a</span> = <span class="id">g</span> <span class="id">a</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">oomap_concat</span> <span class="id">f</span> <span class="id">a</span> = <span class="id">oomap_concat</span> <span class="id">g</span> <span class="id">a</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof919')">Proof.</div>
<div class="proofscript" id="proof919">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">oomap_concat</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H</span>. <span class="tactic">trivial</span>.<br/>
&nbsp;&nbsp;Qed.</div>
&nbsp;&nbsp;<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">rmap_concat_ext</span>  <span class="id">f</span> <span class="id">g</span> <span class="id">l</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">x</span>, <span class="id">In</span> <span class="id">x</span> <span class="id">l</span> -&gt; <span class="id">f</span> <span class="id">x</span> = <span class="id">g</span> <span class="id">x</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rmap_concat</span> <span class="id">f</span> <span class="id">l</span> = <span class="id">rmap_concat</span> <span class="id">g</span> <span class="id">l</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof920')">Proof.</div>
<div class="proofscript" id="proof920">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">rmap_concat</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">oflat_map_ext</span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">oomap_concat_ext_weak</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">olift_ext</span> {<span class="id">A</span> <span class="id">B</span> : <span class="kwd">Type</span>} (<span class="id">f</span> <span class="id">g</span> : <span class="id">A</span> -&gt; <span class="id">option</span> <span class="id">B</span>) (<span class="id">x</span> : <span class="id">option</span> <span class="id">A</span>) :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">a</span>, <span class="id">x</span> = <span class="id">Some</span> <span class="id">a</span> -&gt; <span class="id">f</span> <span class="id">a</span> = <span class="id">g</span> <span class="id">a</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">olift</span> <span class="id">f</span> <span class="id">x</span> = <span class="id">olift</span> <span class="id">g</span> <span class="id">x</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof921')">Proof.</div>
<div class="proofscript" id="proof921">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">x</span>; <span class="tactic">simpl</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">lift_oncoll_ext</span> {<span class="id">A</span> : <span class="kwd">Type</span>} (<span class="id">f</span> <span class="id">g</span> : <span class="id">list</span> <span class="id">data</span> -&gt; <span class="id">option</span> <span class="id">A</span>) (<span class="id">d</span> : <span class="id">data</span>) :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">a</span>, <span class="id">d</span> = <span class="id">dcoll</span> <span class="id">a</span> -&gt; <span class="id">f</span> <span class="id">a</span> = <span class="id">g</span> <span class="id">a</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">lift_oncoll</span> <span class="id">f</span> <span class="id">d</span> = <span class="id">lift_oncoll</span> <span class="id">g</span> <span class="id">d</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof922')">Proof.</div>
<div class="proofscript" id="proof922">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">d</span>; <span class="tactic">simpl</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">lift_filter_ext</span> {<span class="id">A</span> : <span class="kwd">Type</span>} (<span class="id">f</span> <span class="id">g</span> : <span class="id">A</span> -&gt; <span class="id">option</span> <span class="id">bool</span>) (<span class="id">l</span> : <span class="id">list</span> <span class="id">A</span>) : <br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">x</span>, <span class="id">In</span> <span class="id">x</span> <span class="id">l</span> -&gt; <span class="id">f</span> <span class="id">x</span> = <span class="id">g</span> <span class="id">x</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">lift_filter</span> <span class="id">f</span> <span class="id">l</span> = <span class="id">lift_filter</span> <span class="id">g</span> <span class="id">l</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof923')">Proof.</div>
<div class="proofscript" id="proof923">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">l</span>; <span class="tactic">simpl</span>; <span class="tactic">trivial</span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">IHl</span> <span class="tactic">by</span> <span class="tactic">intuition</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> (<span class="id">H</span> <span class="id">a</span>) <span class="tactic">by</span> <span class="tactic">intuition</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">trivial</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">rmap_map_fusion</span> {<span class="id">A</span> <span class="id">B</span> <span class="id">C</span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">f</span>:<span class="id">B</span>-&gt;<span class="id">option</span> <span class="id">C</span>) (<span class="id">g</span>:<span class="id">A</span> -&gt; <span class="id">B</span>) (<span class="id">l</span>:<span class="id">list</span> <span class="id">A</span>) :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rmap</span> <span class="id">f</span> (<span class="id">map</span> <span class="id">g</span> <span class="id">l</span>) = <span class="id">rmap</span> (<span class="kwd">fun</span> <span class="id">x</span> =&gt; <span class="id">f</span> (<span class="id">g</span> <span class="id">x</span>)) <span class="id">l</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof924')">Proof.</div>
<div class="proofscript" id="proof924">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">l</span>; <span class="tactic">simpl</span>; <span class="tactic">trivial</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">match_destr</span>. <span class="tactic">rewrite</span> <span class="id">IHl</span>; <span class="tactic">trivial</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id">recconcat</span> (<span class="id">r1</span> <span class="id">r2</span>:<span class="id">list</span> (<span class="id">string</span>*<span class="id">data</span>)) :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rec_concat_sort</span> <span class="id">r1</span> <span class="id">r2</span>.<br/>
&nbsp;&nbsp;<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id">map_concat</span> (<span class="id">r2</span>:<span class="id">list</span> (<span class="id">string</span>*<span class="id">data</span>)) (<span class="id">d</span>:<span class="id">list</span> (<span class="id">list</span> (<span class="id">string</span>*<span class="id">data</span>))) :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">map</span> (<span class="kwd">fun</span> <span class="id">x</span> =&gt; <span class="id">recconcat</span> <span class="id">r2</span> <span class="id">x</span>) <span class="id">d</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id">product</span> (<span class="id">d1</span> <span class="id">d2</span>:<span class="id">list</span> (<span class="id">list</span> (<span class="id">string</span>*<span class="id">data</span>))) :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">flat_map</span> (<span class="kwd">fun</span> <span class="id">x</span> =&gt; <span class="id">map_concat</span> <span class="id">x</span> <span class="id">d2</span>) <span class="id">d1</span>).<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id">ldeqt</span> := (@<span class="id">Permutation</span> (<span class="id">list</span> (<span class="id">string</span>*<span class="id">data</span>))).<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Notation</span> "<span class="id">b1</span> ⊖ <span class="id">b2</span>" := (<span class="id">bminus</span> <span class="id">b2</span> <span class="id">b1</span>) (<span class="id">right</span> <span class="id">associativity</span>, <span class="tactic">at</span> <span class="id">level</span> 70) : <span class="id">rbag_scope</span>.    <br/>
&nbsp;&nbsp;<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">lift_empty_dcoll</span> <span class="id">l</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">olift</span> <span class="id">rflatten</span> (<span class="id">lift</span> (<span class="kwd">fun</span> <span class="id">t</span>' : <span class="id">list</span> <span class="id">data</span> =&gt; <span class="id">dcoll</span> <span class="id">nil</span> :: <span class="id">t</span>') <span class="id">l</span>) = <span class="id">olift</span> <span class="id">rflatten</span> <span class="id">l</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof925')">Proof.</div>
<div class="proofscript" id="proof925">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">l</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">rflatten</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">lift_id</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">lift_cons_dcoll</span> <span class="id">a</span> <span class="id">l</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">olift</span> <span class="id">rflatten</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">lift</span> (<span class="kwd">fun</span> <span class="id">t</span>' : <span class="id">list</span> <span class="id">data</span> =&gt; <span class="id">dcoll</span> [<span class="id">a</span>] :: <span class="id">t</span>') <span class="id">l</span>) =<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">lift</span> (<span class="kwd">fun</span> <span class="id">t</span>' =&gt; <span class="id">a</span>::<span class="id">t</span>') (<span class="id">olift</span> <span class="id">rflatten</span> <span class="id">l</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof926')">Proof.</div>
<div class="proofscript" id="proof926">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">l</span>; <span class="tactic">simpl</span>; <span class="tactic">try</span> <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">rflatten_through_match</span> <span class="id">l1</span> <span class="id">l2</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">olift</span> <span class="id">rflatten</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">lift</span> <span class="id">dcoll</span> (<span class="id">Some</span> <span class="id">l1</span>) <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">Some</span> <span class="id">x</span>' =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">lift</span> (<span class="kwd">fun</span> <span class="id">t</span>' : <span class="id">list</span> <span class="id">data</span> =&gt; <span class="id">x</span>' :: <span class="id">t</span>') <span class="id">l2</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">None</span> =&gt; <span class="id">None</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span> =<br/>
&nbsp;&nbsp;&nbsp;<span class="id">lift</span> (<span class="kwd">fun</span> <span class="id">t</span>' : <span class="id">list</span> <span class="id">data</span> =&gt; <span class="id">l1</span> ++ <span class="id">t</span>')<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">olift</span> <span class="id">rflatten</span> <span class="id">l2</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof927')">Proof.</div>
<div class="proofscript" id="proof927">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">olift</span>, <span class="id">lift</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">l2</span>; [<span class="tactic">unfold</span> <span class="id">rflatten</span>|<span class="id">idtac</span>]; <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
<span class="kwd">End</span> <span class="id">RRelation</span>.<br/>
<br/>
<span class="kwd">Section</span> <span class="id">Misc</span>.<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">in_rec_sort_insert</span> {<span class="id">A</span>} `{<span class="id">EqDec</span> <span class="id">A</span> <span class="id">eq</span>} (<span class="id">x</span>:<span class="id">string</span> * <span class="id">A</span>) (<span class="id">s</span>:<span class="id">string</span>) (<span class="id">a</span>:<span class="id">A</span>) <span class="id">l</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">In</span> <span class="id">x</span> (<span class="id">insertion_sort_insert</span> <span class="id">rec_field_lt_dec</span> (<span class="id">s</span>, <span class="id">a</span>) <span class="id">l</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">x</span> = (<span class="id">s</span>, <span class="id">a</span>) \/ <span class="id">In</span> <span class="id">x</span> <span class="id">l</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof928')">Proof.</div>
<div class="proofscript" id="proof928">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">revert</span> <span class="id">x</span> <span class="id">a</span>. <span class="tactic">induction</span> <span class="id">l</span>; <span class="tactic">simpl</span>; [<span class="tactic">intuition</span> | ].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">x</span> <span class="id">a0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">a</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">StringOrder.lt_dec</span> <span class="id">s</span> <span class="id">s0</span>); <span class="tactic">simpl</span>; <span class="tactic">intros</span>; <span class="tactic">trivial</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">elim</span> <span class="id">H0</span>; <span class="tactic">clear</span> <span class="id">H0</span>; <span class="tactic">intros</span>; [<span class="id">left</span>|]; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">destruct</span> (<span class="id">StringOrder.lt_dec</span> <span class="id">s0</span> <span class="id">s</span>); <span class="tactic">simpl</span>; <span class="tactic">intros</span>; <span class="tactic">intuition</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">elim</span> <span class="id">H0</span>; <span class="tactic">clear</span> <span class="id">H0</span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">intuition</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">destruct</span> (<span class="id">IHl</span> <span class="id">_</span> <span class="id">_</span> <span class="id">H0</span>); <span class="tactic">intuition</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
<span class="kwd">End</span> <span class="id">Misc</span>.<br/>
<br/>
<br/>
<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id">Permutation</span>.<br/>
<br/>
<span class="kwd">Section</span> <span class="id">MergeBindings</span>.<br/>
<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id">merge_bindings</span> {<span class="id">A</span>} `{<span class="id">EqDec</span> <span class="id">A</span> <span class="id">eq</span>} (<span class="id">l</span>₁ <span class="id">l</span>₂:<span class="id">list</span> (<span class="id">string</span> * <span class="id">A</span>)) : <span class="id">option</span> (<span class="id">list</span> (<span class="id">string</span> * <span class="id">A</span>)) :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">if</span> <span class="id">compatible</span> <span class="id">l</span>₁ <span class="id">l</span>₂<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">then</span> <span class="id">Some</span> (<span class="id">rec_concat_sort</span> <span class="id">l</span>₁ <span class="id">l</span>₂)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">else</span> <span class="id">None</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">merge_bindings_nil_r</span> {<span class="id">A</span>} `{<span class="id">EqDec</span> <span class="id">A</span> <span class="id">eq</span>} <span class="id">l</span> : <span class="id">merge_bindings</span> <span class="id">l</span> <span class="id">nil</span> = <span class="id">Some</span> (<span class="id">rec_sort</span> <span class="id">l</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof929')">Proof.</div>
<div class="proofscript" id="proof929">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">merge_bindings</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">compatible_nil_r</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">rec_concat_sort</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">app_nil_r</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">trivial</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">merge_bindings_single_nin</span> {<span class="id">A</span>} `{<span class="id">EqDec</span> <span class="id">A</span> <span class="id">eq</span>} <span class="id">b</span> <span class="id">x</span> <span class="id">d</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;~ <span class="id">In</span> <span class="id">x</span> (<span class="id">domain</span> <span class="id">b</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">merge_bindings</span> <span class="id">b</span> ((<span class="id">x</span>,<span class="id">d</span>)::<span class="id">nil</span>) =<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Some</span> (<span class="id">rec_concat_sort</span> <span class="id">b</span> ((<span class="id">x</span>,<span class="id">d</span>)::<span class="id">nil</span>)).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof930')">Proof.</div>
<div class="proofscript" id="proof930">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intro</span> <span class="id">nin</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">merge_bindings</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">compatible_single_nin</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">merge_bindings_sorted</span> {<span class="id">A</span>} `{<span class="id">EqDec</span> <span class="id">A</span> <span class="id">eq</span>} {<span class="id">g</span> <span class="id">g1</span> <span class="id">g2</span>} :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Some</span> <span class="id">g</span> = <span class="id">merge_bindings</span> <span class="id">g1</span> <span class="id">g2</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">is_list_sorted</span> <span class="id">ODT_lt_dec</span> (@<span class="id">domain</span> <span class="id">string</span> <span class="id">A</span> <span class="id">g</span>) = <span class="id">true</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof931')">Proof.</div>
<div class="proofscript" id="proof931">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">merge_bindings</span>. <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">compatible</span> <span class="id">g1</span> <span class="id">g2</span>); <span class="tactic">try</span> <span class="tactic">discriminate</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H0</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">rec_concat_sort</span>, <span class="id">rec_concat_sort</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">edot_merge_bindings</span> {<span class="id">A</span>} `{<span class="id">EqDec</span> <span class="id">A</span> <span class="id">eq</span>} (<span class="id">l1</span> <span class="id">l2</span>:<span class="id">list</span> (<span class="id">string</span>*<span class="id">A</span>)) (<span class="id">s</span>:<span class="id">string</span>) (<span class="id">x</span>:<span class="id">A</span>) :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">merge_bindings</span> <span class="id">l1</span> [(<span class="id">s</span>, <span class="id">x</span>)] = <span class="id">Some</span> <span class="id">l2</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">edot</span> <span class="id">l2</span> <span class="id">s</span> = <span class="id">Some</span> <span class="id">x</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof932')">Proof.</div>
<div class="proofscript" id="proof932">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">merge_bindings</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">case_eq</span> (<span class="id">compatible</span> <span class="id">l1</span> [(<span class="id">s</span>, <span class="id">x</span>)]); <span class="tactic">intros</span>; <span class="tactic">rewrite</span> <span class="id">H1</span> <span class="kwd">in</span> *; <span class="tactic">try</span> <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H0</span>; <span class="tactic">clear</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">edot</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">rec_concat_sort</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> (@<span class="id">assoc_lookupr_drec_sort</span> <span class="id">string</span> <span class="id">ODT_string</span>) <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> (@<span class="id">assoc_lookupr_app</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">string_eqdec</span> <span class="id">s</span> <span class="id">s</span>); [<span class="tactic">reflexivity</span>|<span class="tactic">congruence</span>].<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">merge_bindings_nodup</span> {<span class="id">A</span>} `{<span class="id">EqDec</span> <span class="id">A</span> <span class="id">eq</span>} (<span class="id">l</span> <span class="id">l0</span> <span class="id">l1</span>:<span class="id">list</span> (<span class="id">string</span>*<span class="id">A</span>)):<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">merge_bindings</span> <span class="id">l</span> <span class="id">l0</span> = <span class="id">Some</span> <span class="id">l1</span> -&gt; <span class="id">NoDup</span> (<span class="id">domain</span> <span class="id">l1</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof933')">Proof.</div>
<div class="proofscript" id="proof933">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">merge_bindings</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">compatible</span> <span class="id">l</span> <span class="id">l0</span>); <span class="tactic">try</span> <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">is_list_sorted_NoDup_strlt</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> (<span class="id">rec_concat_sort_sorted</span> <span class="id">l</span> <span class="id">l0</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">merge_bindings_compatible</span> {<span class="id">A</span>} `{<span class="id">EqDec</span> <span class="id">A</span> <span class="id">eq</span>} (<span class="id">l</span> <span class="id">l0</span> <span class="id">l1</span>:<span class="id">list</span> (<span class="id">string</span>*<span class="id">A</span>)):<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">merge_bindings</span> <span class="id">l</span> <span class="id">l0</span> = <span class="id">Some</span> <span class="id">l1</span> -&gt; <span class="id">compatible</span> <span class="id">l</span> <span class="id">l0</span> = <span class="id">true</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof934')">Proof.</div>
<div class="proofscript" id="proof934">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">merge_bindings</span> <span class="kwd">in</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">compatible</span> <span class="id">l</span> <span class="id">l0</span>); <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">sorted_cons_is_compatible</span> {<span class="id">A</span>} `{<span class="id">EqDec</span> <span class="id">A</span> <span class="id">eq</span>} (<span class="id">l</span>:<span class="id">list</span> (<span class="id">string</span>*<span class="id">A</span>)) (<span class="id">a</span>:<span class="id">string</span>*<span class="id">A</span>):<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">is_list_sorted</span> <span class="id">ODT_lt_dec</span> (<span class="id">domain</span> (<span class="id">a</span> :: <span class="id">l</span>)) = <span class="id">true</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">compatible_with</span> (<span class="id">fst</span> <span class="id">a</span>) (<span class="id">snd</span> <span class="id">a</span>) <span class="id">l</span> = <span class="id">true</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof935')">Proof.</div>
<div class="proofscript" id="proof935">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">NoDup</span> (<span class="id">domain</span> (<span class="id">a</span> :: <span class="id">l</span>)))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">by</span> (<span class="tactic">apply</span> <span class="id">is_list_sorted_NoDup_strlt</span>; <span class="tactic">assumption</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">compatible_with</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">a</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H1</span>. <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">assoc_lookupr</span> <span class="id">equiv_dec</span> <span class="id">l</span> <span class="id">s</span> = <span class="id">None</span>) <span class="tactic">by</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="tactic">apply</span> <span class="id">assoc_lookupr_nin_none</span>; <span class="tactic">assumption</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">compatible_self</span> {<span class="id">A</span>} `{<span class="id">EqDec</span> <span class="id">A</span> <span class="id">eq</span>} (<span class="id">l</span>:<span class="id">list</span> (<span class="id">string</span>*<span class="id">A</span>)):<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">is_list_sorted</span> <span class="id">ODT_lt_dec</span> (<span class="id">domain</span> <span class="id">l</span>) = <span class="id">true</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">compatible</span> <span class="id">l</span> <span class="id">l</span> = <span class="id">true</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof936')">Proof.</div>
<div class="proofscript" id="proof936">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">l</span>; <span class="tactic">try</span> <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">is_list_sorted</span> <span class="id">ODT_lt_dec</span> (<span class="id">domain</span> <span class="id">l</span>) = <span class="id">true</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">by</span> (<span class="tactic">apply</span> (@<span class="id">rec_sorted_skip_first</span> <span class="id">string</span> <span class="id">ODT_string</span> <span class="id">_</span> <span class="id">l</span> <span class="id">a</span>); <span class="tactic">assumption</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">NoDup</span> (<span class="id">domain</span> (<span class="id">a</span>::<span class="id">l</span>)))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">by</span> (<span class="tactic">apply</span> <span class="id">is_list_sorted_NoDup_strlt</span>; <span class="tactic">assumption</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H2</span>. <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id">IHl</span> <span class="id">H1</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>. <span class="tactic">rewrite</span> <span class="id">andb_true_inversion</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">a</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">compatible_with</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">assoc_lookupr</span> <span class="id">equiv_dec</span> <span class="id">l</span> <span class="id">s</span> = <span class="id">None</span>) <span class="tactic">by</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="tactic">apply</span> <span class="id">assoc_lookupr_nin_none</span>; <span class="tactic">assumption</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H3</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">equiv_dec</span> <span class="id">s</span> <span class="id">s</span>); <span class="tactic">try</span> <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">equiv_dec</span> <span class="id">a</span> <span class="id">a</span>); <span class="tactic">try</span> <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>; <span class="tactic">try</span> <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">compatible_cons_r</span>; <span class="tactic">try</span> <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">compatible_with</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">assoc_lookupr</span> <span class="id">equiv_dec</span> <span class="id">l</span> <span class="id">s</span> = <span class="id">None</span>) <span class="tactic">by</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="tactic">apply</span> <span class="id">assoc_lookupr_nin_none</span>; <span class="tactic">assumption</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H4</span>; <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">merge_self_sorted</span> {<span class="id">A</span>} `{<span class="id">EqDec</span> <span class="id">A</span> <span class="id">eq</span>} (<span class="id">l</span>:<span class="id">list</span> (<span class="id">string</span>*<span class="id">A</span>)):<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">is_list_sorted</span> <span class="id">ODT_lt_dec</span> (<span class="id">domain</span> <span class="id">l</span>) = <span class="id">true</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">merge_bindings</span> <span class="id">l</span> <span class="id">l</span> = <span class="id">Some</span> <span class="id">l</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof937')">Proof.</div>
<div class="proofscript" id="proof937">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">merge_bindings</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">compatible_self</span>; <span class="tactic">try</span> <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">f_equal</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">rec_concat_sort_self</span>; <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">merge_self_sorted_r</span> {<span class="id">A</span>} `{<span class="id">EqDec</span> <span class="id">A</span> <span class="id">eq</span>} (<span class="id">l</span>:<span class="id">list</span> (<span class="id">string</span>*<span class="id">A</span>)):<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">is_list_sorted</span> <span class="id">ODT_lt_dec</span> (<span class="id">domain</span> <span class="id">l</span>) = <span class="id">true</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">merge_bindings</span> <span class="id">l</span> (<span class="id">rec_sort</span> <span class="id">l</span>) = <span class="id">Some</span> (<span class="id">rec_sort</span> <span class="id">l</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof938')">Proof.</div>
<div class="proofscript" id="proof938">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">rec_sorted_id</span>; <span class="tactic">try</span> <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">merge_self_sorted</span>; <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">same_domain_merge_bindings_eq</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<span class="id">A</span>} `{<span class="id">EqDec</span> <span class="id">A</span> <span class="id">eq</span>} (<span class="id">l</span>₁ <span class="id">l</span>₂ <span class="id">l</span>₃:<span class="id">list</span> (<span class="id">string</span>*<span class="id">A</span>)) :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">NoDup</span> (<span class="id">domain</span> <span class="id">l</span>₁) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">domain</span> <span class="id">l</span>₁ = <span class="id">domain</span> <span class="id">l</span>₂ -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">merge_bindings</span> <span class="id">l</span>₁ <span class="id">l</span>₂ = <span class="id">Some</span> <span class="id">l</span>₃ -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">l</span>₁ = <span class="id">l</span>₂.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof939')">Proof.</div>
<div class="proofscript" id="proof939">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">merge_bindings</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">match_case</span>; <span class="tactic">intros</span> <span class="id">compat</span> <span class="id">nd</span> <span class="id">eqd</span> <span class="id">eqq</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">invcs</span> <span class="id">eqq</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> (<span class="id">same_domain_compatible</span> <span class="id">_</span> <span class="id">_</span> <span class="id">nd</span> <span class="id">eqd</span> <span class="id">compat</span>).<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id">compatible</span> {<span class="id">A</span>:<span class="kwd">Type</span>} `{<span class="id">x</span>:<span class="id">EqDec</span> <span class="id">A</span> <span class="id">eq</span>} := @<span class="id">compatible</span> <span class="id">string</span> <span class="id">A</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span>.<br/>
&nbsp;&nbsp;<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">merge_returns_compatible</span> {<span class="id">A</span>} `{<span class="id">equiv</span>:<span class="id">EqDec</span> <span class="id">A</span> <span class="id">eq</span>} (<span class="id">l1</span> <span class="id">l2</span> <span class="id">l3</span>:<span class="id">list</span> (<span class="id">string</span>*<span class="id">A</span>)):<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">is_list_sorted</span> <span class="id">ODT_lt_dec</span> (<span class="id">domain</span> <span class="id">l1</span>) = <span class="id">true</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">is_list_sorted</span> <span class="id">ODT_lt_dec</span> (<span class="id">domain</span> <span class="id">l2</span>) = <span class="id">true</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">compatible</span> <span class="id">l1</span> <span class="id">l2</span> = <span class="id">true</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rec_concat_sort</span> <span class="id">l1</span> <span class="id">l2</span> = <span class="id">l3</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">compatible</span> <span class="id">l1</span> <span class="id">l3</span> = <span class="id">true</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof940')">Proof.</div>
<div class="proofscript" id="proof940">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">NoDup</span> (<span class="id">domain</span> <span class="id">l1</span>)) <span class="tactic">by</span> (<span class="tactic">apply</span> <span class="id">is_list_sorted_NoDup_strlt</span>; <span class="tactic">assumption</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">NoDup</span> (<span class="id">domain</span> <span class="id">l2</span>)) <span class="tactic">by</span> (<span class="tactic">apply</span> <span class="id">is_list_sorted_NoDup_strlt</span>; <span class="tactic">assumption</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">merge_bindings</span> <span class="kwd">in</span> <span class="id">H2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">compatible</span>, <span class="id">RCompat.compatible</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">forallb_forall</span> <span class="kwd">in</span> <span class="id">H1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">forallb_forall</span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">x</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id">H1</span> (<span class="id">s</span>,<span class="id">a</span>) <span class="id">H5</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">H2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">compatible_with</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">rec_concat_sort</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> (@<span class="id">assoc_lookupr_drec_sort</span> <span class="id">string</span> <span class="id">ODT_string</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> *; <span class="tactic">unfold</span> <span class="id">equiv_dec</span>, <span class="id">string_eqdec</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> (@<span class="id">assoc_lookupr_app</span> <span class="id">string</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">case_eq</span> (<span class="id">assoc_lookupr</span> <span class="id">string_dec</span> <span class="id">l2</span> <span class="id">s</span>); <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> ((@<span class="id">assoc_lookupr</span> <span class="id">string</span> <span class="id">A</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(@<span class="id">Equivalence.equiv</span> <span class="id">string</span> (@<span class="id">eq</span> <span class="id">string</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(@<span class="id">eq_equivalence</span> <span class="id">string</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(@<span class="id">complement</span> <span class="id">string</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(@<span class="id">Equivalence.equiv</span> <span class="id">string</span> (@<span class="id">eq</span> <span class="id">string</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(@<span class="id">eq_equivalence</span> <span class="id">string</span>))) <span class="id">string_dec</span> <span class="id">l2</span> <span class="id">s</span> ) =<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(@<span class="id">assoc_lookupr</span> <span class="id">string</span> <span class="id">A</span> (@<span class="id">eq</span> <span class="id">string</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">fun</span> <span class="id">s1</span> <span class="id">s2</span> : <span class="id">string</span> =&gt; <span class="id">not</span> (@<span class="id">eq</span> <span class="id">string</span> <span class="id">s1</span> <span class="id">s2</span>)) <span class="id">string_dec</span> <span class="id">l2</span> <span class="id">s</span>)) <span class="tactic">by</span> <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H7</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H6</span> <span class="kwd">in</span> <span class="id">H1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">assert</span> (<span class="id">assoc_lookupr</span> <span class="id">string_dec</span> <span class="id">l1</span> <span class="id">s</span> = <span class="id">Some</span> <span class="id">a</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">in_assoc_lookupr_nodup</span>; <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">string_eqdec</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H7</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">equiv</span> <span class="id">a</span> <span class="id">a</span>); <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;Qed.</div>
&nbsp;&nbsp;<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">merge_idem</span> {<span class="id">A</span>} `{<span class="id">EqDec</span> <span class="id">A</span> <span class="id">eq</span>} (<span class="id">l</span> <span class="id">l0</span> <span class="id">l1</span>:<span class="id">list</span> (<span class="id">string</span>*<span class="id">A</span>)):<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">is_list_sorted</span> <span class="id">ODT_lt_dec</span> (<span class="id">domain</span> <span class="id">l</span>) = <span class="id">true</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">is_list_sorted</span> <span class="id">ODT_lt_dec</span> (<span class="id">domain</span> <span class="id">l0</span>) = <span class="id">true</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">merge_bindings</span> <span class="id">l</span> <span class="id">l0</span> = <span class="id">Some</span> <span class="id">l1</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">merge_bindings</span> <span class="id">l</span> <span class="id">l1</span> = <span class="id">Some</span> <span class="id">l1</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof941')">Proof.</div>
<div class="proofscript" id="proof941">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">merge_bindings</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">case_eq</span> (<span class="id">compatible</span> <span class="id">l</span> <span class="id">l0</span>); <span class="tactic">intros</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">compatible</span> <span class="kwd">in</span> *; <span class="tactic">rewrite</span> <span class="id">H3</span> <span class="kwd">in</span> <span class="id">H2</span>; <span class="tactic">try</span> <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H2</span>; <span class="tactic">clear</span> <span class="id">H2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">compatible</span> <span class="id">l</span> (<span class="id">rec_concat_sort</span> <span class="id">l</span> <span class="id">l0</span>) = <span class="id">true</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">by</span> (<span class="tactic">apply</span> (<span class="id">merge_returns_compatible</span> <span class="id">l</span> <span class="id">l0</span> (<span class="id">rec_concat_sort</span> <span class="id">l</span> <span class="id">l0</span>) <span class="id">H0</span> <span class="id">H1</span> <span class="id">H3</span>); <span class="tactic">reflexivity</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">compatible</span> <span class="kwd">in</span> *. <span class="tactic">rewrite</span> <span class="id">H2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">rec_concat_sort_idem</span>; <span class="tactic">try</span> <span class="tactic">assumption</span>; <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
<br/>
<span class="kwd">End</span> <span class="id">MergeBindings</span>.<br/>
<br/>
<span class="kwd">Section</span> <span class="id">RRemove</span>.<br/>
&nbsp;&nbsp;<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id">RBindings</span>.<br/>
&nbsp;&nbsp;<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">is_sorted_rremove</span> {<span class="id">A</span>} (<span class="id">l</span>:<span class="id">list</span> (<span class="id">string</span> * <span class="id">A</span>)) (<span class="id">s</span>:<span class="id">string</span>):<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">is_list_sorted</span> <span class="id">ODT_lt_dec</span> (<span class="id">domain</span> <span class="id">l</span>) = <span class="id">true</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">is_list_sorted</span> <span class="id">ODT_lt_dec</span> (<span class="id">domain</span> (<span class="id">rremove</span> <span class="id">l</span> <span class="id">s</span>)) = <span class="id">true</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof942')">Proof.</div>
<div class="proofscript" id="proof942">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">rremove</span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> (@<span class="id">sorted_over_filter</span> <span class="id">string</span> <span class="id">ODT_string</span>); <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">domain_rremove</span> {<span class="id">A</span>} <span class="id">s</span> (<span class="id">l</span>:<span class="id">list</span> (<span class="id">string</span>*<span class="id">A</span>)) :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">domain</span> (<span class="id">rremove</span> <span class="id">l</span> <span class="id">s</span>) = <span class="id">remove_all</span> <span class="id">s</span> (<span class="id">domain</span> <span class="id">l</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof943')">Proof.</div>
<div class="proofscript" id="proof943">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">l</span>; <span class="tactic">simpl</span>; <span class="tactic">trivial</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">equiv_dec</span>, <span class="id">string_eqdec</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">string_dec</span> <span class="id">s</span> (<span class="id">fst</span> <span class="id">a</span>)); <span class="tactic">simpl</span>; <span class="tactic">trivial</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">f_equal</span>; <span class="tactic">trivial</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">rremove_rec_sort_commute</span> {<span class="id">B</span>} (<span class="id">l1</span>:<span class="id">list</span> (<span class="id">string</span>*<span class="id">B</span>)) <span class="id">s</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rremove</span> (<span class="id">rec_sort</span> <span class="id">l1</span>) <span class="id">s</span> = <span class="id">rec_sort</span> (<span class="id">rremove</span> <span class="id">l1</span> <span class="id">s</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof944')">Proof.</div>
<div class="proofscript" id="proof944">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">rremove</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">rec_sort_filter_fst_commute</span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">match_destr</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">rremove_app</span> {<span class="id">B</span>} (<span class="id">l1</span> <span class="id">l2</span>:<span class="id">list</span> (<span class="id">string</span>*<span class="id">B</span>)) <span class="id">s</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rremove</span> (<span class="id">l1</span> ++ <span class="id">l2</span>) <span class="id">s</span> = <span class="id">rremove</span> <span class="id">l1</span> <span class="id">s</span> ++ <span class="id">rremove</span> <span class="id">l2</span> <span class="id">s</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof945')">Proof.</div>
<div class="proofscript" id="proof945">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">rremove</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">filter_app</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">nin_rremove</span> {<span class="id">B</span>} (<span class="id">l</span>:<span class="id">list</span> (<span class="id">string</span>*<span class="id">B</span>)) <span class="id">s</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;~ <span class="id">In</span> <span class="id">s</span> (<span class="id">domain</span> <span class="id">l</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rremove</span> <span class="id">l</span> <span class="id">s</span> = <span class="id">l</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof946')">Proof.</div>
<div class="proofscript" id="proof946">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">nin</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">true_filter</span>; <span class="tactic">intros</span> ? <span class="id">inn</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">x</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">in_dom</span> <span class="kwd">in</span> <span class="id">inn</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">match_destr</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
<span class="kwd">End</span> <span class="id">RRemove</span>.<br/>
<br/>
<span class="kwd">Section</span> <span class="id">RProject</span>.<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">rproject_with_lookup</span> {<span class="id">A</span>} (<span class="id">l1</span> <span class="id">l2</span>:<span class="id">list</span> (<span class="id">string</span> * <span class="id">A</span>)) (<span class="id">s</span>:<span class="id">list</span> <span class="id">string</span>):<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">is_list_sorted</span> <span class="id">ODT_lt_dec</span> (<span class="id">domain</span> <span class="id">l1</span>) = <span class="id">true</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">is_list_sorted</span> <span class="id">ODT_lt_dec</span> (<span class="id">domain</span> <span class="id">l2</span>) = <span class="id">true</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">sublist</span> <span class="id">l1</span> <span class="id">l2</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">x</span>, <span class="id">In</span> <span class="id">x</span> <span class="id">s</span> -&gt; <span class="id">assoc_lookupr</span> <span class="id">string_dec</span> <span class="id">l1</span> <span class="id">x</span> = <span class="id">assoc_lookupr</span> <span class="id">string_dec</span> <span class="id">l2</span> <span class="id">x</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rproject</span> <span class="id">l1</span> <span class="id">s</span> = <span class="id">rproject</span> <span class="id">l2</span> <span class="id">s</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof947')">Proof.</div>
<div class="proofscript" id="proof947">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">revert</span> <span class="id">l1</span> <span class="id">H</span> <span class="id">H1</span> <span class="id">H2</span>; <span class="tactic">induction</span> <span class="id">l2</span>; <span class="tactic">simpl</span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">apply</span> <span class="id">sublist_nil_r</span> <span class="kwd">in</span> <span class="id">H1</span>; <span class="tactic">subst</span>; <span class="tactic">simpl</span>; <span class="tactic">auto</span> 1.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">destruct</span> <span class="id">a</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">is_list_sorted</span> <span class="id">ODT_lt_dec</span> (<span class="id">domain</span> <span class="id">l2</span>) = <span class="id">true</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">by</span> (<span class="tactic">apply</span> (@<span class="id">rec_sorted_skip_first</span> <span class="id">string</span> <span class="id">ODT_string</span> <span class="id">_</span> <span class="id">l2</span> (<span class="id">s0</span>,<span class="id">a</span>)); <span class="tactic">assumption</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id">IHl2</span> <span class="id">H3</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">NoDup</span> (<span class="id">domain</span> ((<span class="id">s0</span>,<span class="id">a</span>)::<span class="id">l2</span>)))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">by</span> (<span class="tactic">apply</span> <span class="id">is_list_sorted_NoDup_strlt</span>; <span class="tactic">assumption</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">generalize</span> (<span class="id">sublist_cons_inv</span>' <span class="id">H1</span> <span class="id">H4</span>); <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">elim</span> <span class="id">H5</span>; <span class="tactic">clear</span> <span class="id">H5</span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">elim</span> <span class="id">H5</span>; <span class="tactic">clear</span> <span class="id">H5</span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">elim</span> <span class="id">H5</span>; <span class="tactic">clear</span> <span class="id">H5</span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H5</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">is_list_sorted</span> <span class="id">ODT_lt_dec</span> (<span class="id">domain</span> <span class="id">x</span>) = <span class="id">true</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">by</span> (<span class="tactic">apply</span> (@<span class="id">rec_sorted_skip_first</span> <span class="id">string</span> <span class="id">ODT_string</span> <span class="id">_</span>  <span class="id">x</span> (<span class="id">s0</span>,<span class="id">a</span>)); <span class="tactic">assumption</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id">IHl2</span> <span class="id">x</span> <span class="id">H7</span> <span class="id">H6</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">H2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">IHl2</span>; <span class="tactic">try</span> <span class="tactic">reflexivity</span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">H2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">case_eq</span> (<span class="id">string_dec</span> <span class="id">x0</span> <span class="id">s0</span>); <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">NoDup</span> (<span class="id">domain</span> ((<span class="id">s0</span>,<span class="id">a</span>)::<span class="id">x</span>))) <span class="tactic">by</span> (<span class="tactic">apply</span> <span class="id">is_list_sorted_NoDup_strlt</span>; <span class="tactic">assumption</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">assoc_lookupr</span> <span class="id">string_dec</span> <span class="id">x</span> <span class="id">s0</span> = <span class="id">None</span>) <span class="tactic">by</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="tactic">apply</span> <span class="id">assoc_lookupr_nin_none</span>; <span class="tactic">inversion</span> <span class="id">H5</span>; <span class="tactic">assumption</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">assoc_lookupr</span> <span class="id">string_dec</span> <span class="id">l2</span> <span class="id">s0</span> = <span class="id">None</span>) <span class="tactic">by</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="tactic">apply</span> <span class="id">assoc_lookupr_nin_none</span>; <span class="tactic">inversion</span> <span class="id">H4</span>; <span class="tactic">assumption</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H10</span>; <span class="tactic">rewrite</span> <span class="id">H11</span>; <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">specialize</span> (<span class="id">H2</span> <span class="id">x0</span> <span class="id">H8</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span>(<span class="id">string_dec</span> <span class="id">x0</span> <span class="id">s0</span>) ; <span class="tactic">try</span> <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">assoc_lookupr</span> <span class="id">string_dec</span> <span class="id">x</span> <span class="id">x0</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">assoc_lookupr</span> <span class="id">string_dec</span> <span class="id">l2</span> <span class="id">x0</span>); <span class="tactic">try</span> <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">elim</span> <span class="id">H5</span>; <span class="tactic">clear</span> <span class="id">H5</span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">case_eq</span> (<span class="id">in_dec</span> <span class="id">string_dec</span> <span class="id">s0</span> <span class="id">s</span>); <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id">H2</span> <span class="id">s0</span> <span class="id">i</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">string_dec</span> <span class="id">s0</span> <span class="id">s0</span>); <span class="tactic">try</span> <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">H5</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">assoc_lookupr</span> <span class="id">string_dec</span> <span class="id">l1</span> <span class="id">s0</span> = <span class="id">None</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">by</span> (<span class="tactic">apply</span> <span class="id">assoc_lookupr_nin_none</span>; <span class="tactic">assumption</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H8</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">assoc_lookupr</span> <span class="id">string_dec</span> <span class="id">l2</span> <span class="id">s0</span>); <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> (<span class="id">IHl2</span> <span class="id">l1</span> <span class="id">H</span> <span class="id">H6</span>); <span class="tactic">try</span> <span class="tactic">reflexivity</span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id">H2</span> <span class="id">x</span> <span class="id">H8</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">case_eq</span> (<span class="id">string_dec</span> <span class="id">x</span> <span class="id">s0</span>); <span class="tactic">intros</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H9</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">assoc_lookupr</span> <span class="id">string_dec</span> <span class="id">l1</span> <span class="id">x</span>); <span class="tactic">destruct</span> (<span class="id">assoc_lookupr</span> <span class="id">string_dec</span> <span class="id">l2</span> <span class="id">x</span>); <span class="tactic">try</span> <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">rproject_sublist</span> {<span class="id">A</span>} (<span class="id">l1</span> <span class="id">l2</span>:<span class="id">list</span> (<span class="id">string</span> * <span class="id">A</span>)) (<span class="id">s</span>:<span class="id">list</span> <span class="id">string</span>) :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">is_list_sorted</span> <span class="id">ODT_lt_dec</span> (<span class="id">domain</span> <span class="id">l1</span>) = <span class="id">true</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">is_list_sorted</span> <span class="id">ODT_lt_dec</span> (<span class="id">domain</span> <span class="id">l2</span>) = <span class="id">true</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">sublist</span> <span class="id">s</span> (<span class="id">domain</span> <span class="id">l1</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">sublist</span> <span class="id">l1</span> <span class="id">l2</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rproject</span> <span class="id">l1</span> <span class="id">s</span> = <span class="id">rproject</span> <span class="id">l2</span> <span class="id">s</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof948')">Proof.</div>
<div class="proofscript" id="proof948">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">sublist</span> <span class="id">s</span> (<span class="id">domain</span> <span class="id">l2</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">by</span> (<span class="tactic">apply</span> (<span class="id">sublist_trans</span> <span class="id">s</span> (<span class="id">domain</span> <span class="id">l1</span>) (<span class="id">domain</span> <span class="id">l2</span>)); <span class="tactic">try</span> <span class="tactic">assumption</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">sublist_domain</span>; <span class="tactic">assumption</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">rproject_with_lookup</span>; <span class="tactic">try</span> <span class="tactic">assumption</span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">In</span> <span class="id">x</span> (<span class="id">domain</span> <span class="id">l1</span>)) <span class="tactic">by</span> (<span class="tactic">apply</span> (<span class="id">sublist_In</span> <span class="id">H1</span>); <span class="tactic">assumption</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">In</span> <span class="id">x</span> (<span class="id">domain</span> <span class="id">l2</span>)) <span class="tactic">by</span> (<span class="tactic">apply</span> (<span class="id">sublist_In</span> <span class="id">H3</span>); <span class="tactic">assumption</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">generalize</span> (<span class="id">in_dom_lookupr</span> <span class="id">l1</span> <span class="id">x</span> <span class="id">string_dec</span>); <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">elim</span> (<span class="id">H7</span> <span class="id">H5</span>); <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">assoc_lookupr</span> <span class="id">string_dec</span> <span class="id">l2</span> <span class="id">x</span> = <span class="id">Some</span> <span class="id">x0</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">NoDup</span> (<span class="id">domain</span> <span class="id">l2</span>)) <span class="tactic">by</span> (<span class="tactic">apply</span> <span class="id">is_list_sorted_NoDup_strlt</span>; <span class="tactic">assumption</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> (<span class="id">assoc_lookupr_nodup_sublist</span> <span class="id">H9</span> <span class="id">H2</span>); <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H8</span>; <span class="tactic">rewrite</span> <span class="id">H9</span>; <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;Qed.</div>
&nbsp;&nbsp;<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">rproject_equivlist</span> {<span class="id">B</span>} (<span class="id">l</span>:<span class="id">list</span> (<span class="id">string</span>*<span class="id">B</span>)) <span class="id">sl1</span> <span class="id">sl2</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">equivlist</span> <span class="id">sl1</span> <span class="id">sl2</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rproject</span> <span class="id">l</span> <span class="id">sl1</span> = <span class="id">rproject</span> <span class="id">l</span> <span class="id">sl2</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof949')">Proof.</div>
<div class="proofscript" id="proof949">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">l</span>; <span class="tactic">simpl</span>; <span class="tactic">trivial</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">eqq</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> (<span class="id">IHl</span> <span class="id">eqq</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">in_dec</span> <span class="id">string_dec</span> (<span class="id">fst</span> <span class="id">a</span>) <span class="id">sl1</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">in_dec</span> <span class="id">string_dec</span> (<span class="id">fst</span> <span class="id">a</span>) <span class="id">sl2</span>); <span class="tactic">trivial</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">apply</span> <span class="id">eqq</span> <span class="kwd">in</span> <span class="id">i</span>; <span class="tactic">intuition</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">apply</span> <span class="id">eqq</span> <span class="kwd">in</span> <span class="id">i</span>; <span class="tactic">intuition</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">rproject_sortfilter</span> {<span class="id">B</span>} (<span class="id">l</span>:<span class="id">list</span> (<span class="id">string</span>*<span class="id">B</span>)) <span class="id">sl1</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rproject</span> <span class="id">l</span> (<span class="id">insertion_sort</span> <span class="id">ODT_lt_dec</span> <span class="id">sl1</span>) = <span class="id">rproject</span> <span class="id">l</span> <span class="id">sl1</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof950')">Proof.</div>
<div class="proofscript" id="proof950">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">rproject_equivlist</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">insertion_sort_trich_equiv</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">StringOrder.trichotemy</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">rproject_concat_dist</span> {<span class="id">A</span>} (<span class="id">l1</span> <span class="id">l2</span>:<span class="id">list</span> (<span class="id">string</span> * <span class="id">A</span>)) (<span class="id">s</span>:<span class="id">list</span> <span class="id">string</span>) :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rproject</span> (<span class="id">rec_concat_sort</span> <span class="id">l1</span> <span class="id">l2</span>) <span class="id">s</span> = <span class="id">rec_concat_sort</span> (<span class="id">rproject</span> <span class="id">l1</span> <span class="id">s</span>) (<span class="id">rproject</span> <span class="id">l2</span> <span class="id">s</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof951')">Proof.</div>
<div class="proofscript" id="proof951">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">rec_concat_sort</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">rproject_rec_sort_commute</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">rproject_app</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
<span class="kwd">End</span> <span class="id">RProject</span>.<br/>
<br/>
<span class="kwd">Section</span> <span class="id">SRProject</span>.<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id">sorted_vector</span> (<span class="id">s</span>:<span class="id">list</span> <span class="id">string</span>) : <span class="id">list</span> <span class="id">string</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">insertion_sort</span> <span class="id">ODT_lt_dec</span> <span class="id">s</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">sorted_vector_sorted</span> (<span class="id">s</span>:<span class="id">list</span> <span class="id">string</span>) :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">is_list_sorted</span> <span class="id">ODT_lt_dec</span> (<span class="id">sorted_vector</span> <span class="id">s</span>) = <span class="id">true</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof952')">Proof.</div>
<div class="proofscript" id="proof952">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">is_list_sorted_Sorted_iff</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">insertion_sort_Sorted</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id">projected_subset</span> (<span class="id">s1</span> <span class="id">s2</span>:<span class="id">list</span> <span class="id">string</span>) : <span class="id">list</span> <span class="id">string</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">filter</span> (<span class="kwd">fun</span> <span class="id">x</span> =&gt; <span class="kwd">if</span> <span class="id">in_dec</span> <span class="id">string_dec</span> <span class="id">x</span> <span class="id">s2</span> <span class="kwd">then</span> <span class="id">true</span> <span class="kwd">else</span> <span class="id">false</span>) <span class="id">s1</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">projected_subst_sorted</span> (<span class="id">s1</span> <span class="id">s2</span>:<span class="id">list</span> <span class="id">string</span>) :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">is_list_sorted</span> <span class="id">ODT_lt_dec</span> <span class="id">s1</span> = <span class="id">true</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">is_list_sorted</span> <span class="id">ODT_lt_dec</span> (<span class="id">projected_subset</span> <span class="id">s1</span> <span class="id">s2</span>) = <span class="id">true</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof953')">Proof.</div>
<div class="proofscript" id="proof953">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">sorted_StronglySorted</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">StronglySorted_filter</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">sorted_StronglySorted</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">StrictOrder_Transitive</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">StrictOrder_Transitive</span>.<br/>
&nbsp;&nbsp;Qed.</div>
&nbsp;&nbsp;<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">sorted_projected_subset_is_sublist</span> (<span class="id">s1</span> <span class="id">s2</span>:<span class="id">list</span> <span class="id">string</span>):<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">is_list_sorted</span> <span class="id">ODT_lt_dec</span> <span class="id">s1</span> = <span class="id">true</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">is_list_sorted</span> <span class="id">ODT_lt_dec</span> <span class="id">s2</span> = <span class="id">true</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">sublist</span> (<span class="id">projected_subset</span> <span class="id">s1</span> <span class="id">s2</span>) <span class="id">s2</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof954')">Proof.</div>
<div class="proofscript" id="proof954">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">StronglySorted_incl_sublist</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">sorted_StronglySorted</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">projected_subst_sorted</span>; <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">StrictOrder_Transitive</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">sorted_StronglySorted</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">StrictOrder_Transitive</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">projected_subset</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">s1</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">H1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">contradiction</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">is_list_sorted</span> <span class="id">ODT_lt_dec</span> <span class="id">s1</span> = <span class="id">true</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> (@<span class="id">is_list_sorted_cons_inv</span> <span class="id">string</span> <span class="id">_</span> <span class="id">_</span> <span class="id">a</span> <span class="id">s1</span>); <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id">IHs1</span> <span class="id">H2</span>); <span class="tactic">clear</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">in_dec</span> <span class="id">string_dec</span> <span class="id">a</span> <span class="id">s2</span>); <span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">elim</span> <span class="id">H1</span>; <span class="tactic">clear</span> <span class="id">H1</span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> (<span class="id">IHs1</span> <span class="id">H</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">apply</span> (<span class="id">IHs1</span> <span class="id">H1</span>).<br/>
&nbsp;&nbsp;Qed.</div>
&nbsp;&nbsp;&nbsp;&nbsp;<br/>
&nbsp;&nbsp;<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id">srproject</span> {<span class="id">A</span>} (<span class="id">l</span>:<span class="id">list</span> (<span class="id">string</span>*<span class="id">A</span>)) (<span class="id">s</span>:<span class="id">list</span> <span class="id">string</span>) : <span class="id">list</span> (<span class="id">string</span>*<span class="id">A</span>) :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">ps</span> := (<span class="id">projected_subset</span> (<span class="id">sorted_vector</span> <span class="id">s</span>) (<span class="id">domain</span> <span class="id">l</span>)) <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rproject</span> <span class="id">l</span> <span class="id">ps</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">insertion_sort_insert_equiv_vec</span> (<span class="id">x</span> <span class="id">a</span>:<span class="id">string</span>) (<span class="id">l</span>:<span class="id">list</span> <span class="id">string</span>) :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">In</span> <span class="id">x</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">RSort.insertion_sort_insert</span> <span class="id">ODT_lt_dec</span> <span class="id">a</span> <span class="id">l</span>) &lt;-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">a</span> = <span class="id">x</span> \/ <span class="id">In</span> <span class="id">x</span> <span class="id">l</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof955')">Proof.</div>
<div class="proofscript" id="proof955">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">l</span>; <span class="tactic">simpl</span>; [<span class="tactic">intuition</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">a</span>; <span class="tactic">destruct</span> <span class="id">a0</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intuition</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intuition</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intuition</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intuition</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intuition</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intuition</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">StringOrder.lt_dec</span> (<span class="id">String</span> <span class="id">a</span> <span class="id">a1</span>) (<span class="id">String</span> <span class="id">a0</span> <span class="id">a2</span>)); <span class="tactic">simpl</span>; [<span class="tactic">intuition</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">StringOrder.lt_dec</span> (<span class="id">String</span> <span class="id">a0</span> <span class="id">a2</span>) (<span class="id">String</span> <span class="id">a</span> <span class="id">a1</span>)); <span class="tactic">simpl</span>; [<span class="tactic">intuition</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intuition</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intuition</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>; <span class="tactic">clear</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">revert</span> <span class="id">n</span> <span class="id">n0</span> <span class="id">H1</span> <span class="id">H3</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">generalize</span> (<span class="id">String</span> <span class="id">a</span> <span class="id">a1</span>), (<span class="id">String</span> <span class="id">a0</span> <span class="id">a2</span>); <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">left</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">trichotemy</span> <span class="id">s</span> <span class="id">s0</span>); <span class="tactic">intuition</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">sorted_vector_equivlist</span> <span class="id">l</span> : <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">equivlist</span> (<span class="id">sorted_vector</span> <span class="id">l</span>) <span class="id">l</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof956')">Proof.</div>
<div class="proofscript" id="proof956">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">equivlist</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">l</span>; <span class="tactic">simpl</span>; [<span class="tactic">intuition</span>|]; <span class="tactic">intros</span> <span class="id">x</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">IHl</span>. <span class="tactic">apply</span> <span class="id">insertion_sort_insert_equiv_vec</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">equivlist_in_dec</span> (<span class="id">x</span>:<span class="id">string</span>) (<span class="id">s1</span> <span class="id">s2</span>:<span class="id">list</span> <span class="id">string</span>) :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">equivlist</span> <span class="id">s1</span> <span class="id">s2</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">if</span> (<span class="id">in_dec</span> <span class="id">string_dec</span> <span class="id">x</span> <span class="id">s1</span>) <span class="kwd">then</span> <span class="id">true</span> <span class="kwd">else</span> <span class="id">false</span>) =<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">if</span> (<span class="id">in_dec</span> <span class="id">string_dec</span> <span class="id">x</span> <span class="id">s2</span>) <span class="kwd">then</span> <span class="id">true</span> <span class="kwd">else</span> <span class="id">false</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof957')">Proof.</div>
<div class="proofscript" id="proof957">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">in_dec</span> <span class="id">string_dec</span> <span class="id">x</span> <span class="id">s1</span>); <span class="tactic">destruct</span> (<span class="id">in_dec</span> <span class="id">string_dec</span> <span class="id">x</span> <span class="id">s2</span>); <span class="tactic">try</span> <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">In</span> <span class="id">x</span> <span class="id">s2</span>). <span class="tactic">rewrite</span> &lt;- <span class="id">H</span>; <span class="tactic">assumption</span>. <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">In</span> <span class="id">x</span> <span class="id">s1</span>). <span class="tactic">rewrite</span> <span class="id">H</span>; <span class="tactic">assumption</span>. <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">sorted_vector_in_dec</span> (<span class="id">x</span>:<span class="id">string</span>) (<span class="id">s1</span>:<span class="id">list</span> <span class="id">string</span>):<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">if</span> (<span class="id">in_dec</span> <span class="id">string_dec</span> <span class="id">x</span> <span class="id">s1</span>) <span class="kwd">then</span> <span class="id">true</span> <span class="kwd">else</span> <span class="id">false</span>) =<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">if</span> (<span class="id">in_dec</span> <span class="id">string_dec</span> <span class="id">x</span> (<span class="id">sorted_vector</span> <span class="id">s1</span>)) <span class="kwd">then</span> <span class="id">true</span> <span class="kwd">else</span> <span class="id">false</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof958')">Proof.</div>
<div class="proofscript" id="proof958">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> (<span class="id">equivlist_in_dec</span> <span class="id">x</span> <span class="id">s1</span> (<span class="id">sorted_vector</span> <span class="id">s1</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">sorted_vector_equivlist</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">in_intersection_projected</span> (<span class="id">x</span>:<span class="id">string</span>) (<span class="id">s1</span> <span class="id">s2</span>:<span class="id">list</span> <span class="id">string</span>) :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">In</span> <span class="id">x</span> <span class="id">s1</span> /\ <span class="id">In</span> <span class="id">x</span> <span class="id">s2</span> -&gt; <span class="id">In</span> <span class="id">x</span> (<span class="id">projected_subset</span> <span class="id">s1</span> <span class="id">s2</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof959')">Proof.</div>
<div class="proofscript" id="proof959">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">elim</span> <span class="id">H</span>; <span class="tactic">clear</span> <span class="id">H</span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">s1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> *. <span class="id">contradiction</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">elim</span> <span class="id">H</span>; <span class="tactic">clear</span> <span class="id">H</span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">in_dec</span> <span class="id">string_dec</span> <span class="id">x</span> <span class="id">s2</span>); <span class="tactic">try</span> <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>; <span class="id">left</span>; <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id">IHs1</span> <span class="id">H</span>); <span class="tactic">clear</span> <span class="id">H0</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">in_dec</span> <span class="id">string_dec</span> <span class="id">a</span> <span class="id">s2</span>); <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>; <span class="id">right</span>; <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">in_projected</span> (<span class="id">x</span>:<span class="id">string</span>) (<span class="id">s1</span> <span class="id">s2</span>:<span class="id">list</span> <span class="id">string</span>) :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">In</span> <span class="id">x</span> (<span class="id">projected_subset</span> <span class="id">s1</span> <span class="id">s2</span>) -&gt; <span class="id">In</span> <span class="id">x</span> <span class="id">s1</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof960')">Proof.</div>
<div class="proofscript" id="proof960">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">s1</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> *; [<span class="id">contradiction</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">in_dec</span> <span class="id">string_dec</span> <span class="id">a</span> <span class="id">s2</span>); <span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">elim</span> <span class="id">H</span>; <span class="tactic">clear</span> <span class="id">H</span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">left</span>; <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">right</span>; <span class="tactic">apply</span> (<span class="id">IHs1</span> <span class="id">H</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">right</span>; <span class="tactic">apply</span> (<span class="id">IHs1</span> <span class="id">H</span>).<br/>
&nbsp;&nbsp;Qed.</div>
&nbsp;<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">sproject_in_dec</span> {<span class="id">A</span>} (<span class="id">x</span>:<span class="id">string</span>) (<span class="id">s1</span>:<span class="id">list</span> <span class="id">string</span>) (<span class="id">l</span>:<span class="id">list</span> (<span class="id">string</span>*<span class="id">A</span>)) :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">In</span> <span class="id">x</span> (<span class="id">domain</span> <span class="id">l</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">if</span> (<span class="id">in_dec</span> <span class="id">string_dec</span> <span class="id">x</span> <span class="id">s1</span>) <span class="kwd">then</span> <span class="id">true</span> <span class="kwd">else</span> <span class="id">false</span>) =<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">if</span> (<span class="id">in_dec</span> <span class="id">string_dec</span> <span class="id">x</span> (<span class="id">projected_subset</span> <span class="id">s1</span> (<span class="id">domain</span> <span class="id">l</span>))) <span class="kwd">then</span> <span class="id">true</span> <span class="kwd">else</span> <span class="id">false</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof961')">Proof.</div>
<div class="proofscript" id="proof961">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">in_dec</span> <span class="id">string_dec</span> <span class="id">x</span> <span class="id">s1</span>); <span class="tactic">destruct</span> (<span class="id">in_dec</span> <span class="id">string_dec</span> <span class="id">x</span> (<span class="id">projected_subset</span> <span class="id">s1</span> (<span class="id">domain</span> <span class="id">l</span>))); <span class="tactic">try</span> <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">assert</span> (<span class="id">In</span> <span class="id">x</span> (<span class="id">projected_subset</span> <span class="id">s1</span> (<span class="id">domain</span> <span class="id">l</span>))) <span class="tactic">by</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="tactic">apply</span> <span class="id">in_intersection_projected</span>; <span class="tactic">auto</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">assert</span> (<span class="id">In</span> <span class="id">x</span> <span class="id">s1</span>) <span class="tactic">by</span> (<span class="tactic">apply</span> (<span class="id">in_projected</span> <span class="id">x</span> <span class="id">s1</span> (<span class="id">domain</span> <span class="id">l</span>)); <span class="tactic">assumption</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;Qed.</div>
&nbsp;&nbsp;&nbsp;&nbsp;<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">rproject_sproject</span> {<span class="id">A</span>} (<span class="id">l</span>:<span class="id">list</span> (<span class="id">string</span>*<span class="id">A</span>)) (<span class="id">s</span>:<span class="id">list</span> <span class="id">string</span>) :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">is_list_sorted</span> <span class="id">ODT_lt_dec</span> (<span class="id">domain</span> <span class="id">l</span>) = <span class="id">true</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rproject</span> <span class="id">l</span> <span class="id">s</span> = <span class="id">srproject</span> <span class="id">l</span> <span class="id">s</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof962')">Proof.</div>
<div class="proofscript" id="proof962">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">srproject</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">rproject</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">filter</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">fun</span> <span class="id">x</span> : <span class="id">string</span> * <span class="id">A</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">if</span> <span class="id">in_dec</span> <span class="id">string_dec</span> (<span class="id">fst</span> <span class="id">x</span>) <span class="id">s</span> <span class="kwd">then</span> <span class="id">true</span> <span class="kwd">else</span> <span class="id">false</span>) <span class="id">l</span> =<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">filter</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">fun</span> <span class="id">x</span> : <span class="id">string</span> * <span class="id">A</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">if</span> <span class="id">in_dec</span> <span class="id">string_dec</span> (<span class="id">fst</span> <span class="id">x</span>) (<span class="id">sorted_vector</span> <span class="id">s</span>) <span class="kwd">then</span> <span class="id">true</span> <span class="kwd">else</span> <span class="id">false</span>) <span class="id">l</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">filter_eq</span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">sorted_vector_in_dec</span>; <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H0</span>; <span class="tactic">clear</span> <span class="id">H0</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">generalize</span> (<span class="id">sorted_vector</span> <span class="id">s</span>) <span class="kwd">as</span> <span class="id">ss</span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">filter_ext</span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">sproject_in_dec</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">x</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">l</span>; <span class="tactic">try</span> <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">is_list_sorted</span> <span class="id">StringOrder.lt_dec</span> (<span class="id">domain</span> <span class="id">l</span>) = <span class="id">true</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> (@<span class="id">is_list_sorted_cons_inv</span> <span class="id">string</span> <span class="id">_</span> <span class="id">_</span> (<span class="id">fst</span> <span class="id">a0</span>) (<span class="id">domain</span> <span class="id">l</span>)); <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id">IHl</span> <span class="id">H1</span>); <span class="tactic">clear</span> <span class="id">H1</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">elim</span> <span class="id">H0</span>; <span class="tactic">clear</span> <span class="id">H0</span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>; <span class="tactic">simpl</span>; <span class="id">left</span>; <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">right</span>; <span class="tactic">apply</span> (<span class="id">IHl</span> <span class="id">H</span>).<br/>
&nbsp;&nbsp;Qed.</div>
&nbsp;&nbsp;<br/>
&nbsp;&nbsp;<span class="kwd">Context</span> {<span class="id">fdata</span>:<span class="id">foreign_data</span>}.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">rmap_with_rproject</span> <span class="id">sl</span> <span class="id">l</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">rmap</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">fun</span> <span class="id">d1</span> : <span class="id">data</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">d1</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">dunit</span> =&gt; <span class="id">None</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">dnat</span> <span class="id">_</span> =&gt; <span class="id">None</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">dbool</span> <span class="id">_</span> =&gt; <span class="id">None</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">dstring</span> <span class="id">_</span> =&gt; <span class="id">None</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">dcoll</span> <span class="id">_</span> =&gt; <span class="id">None</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">drec</span> <span class="id">r</span> =&gt; <span class="id">Some</span> (<span class="id">drec</span> (<span class="id">rproject</span> <span class="id">r</span> <span class="id">sl</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">dleft</span> <span class="id">_</span> =&gt; <span class="id">None</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">dright</span> <span class="id">_</span> =&gt; <span class="id">None</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">dbrand</span> <span class="id">_</span> <span class="id">_</span> =&gt; <span class="id">None</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">dforeign</span> <span class="id">_</span> =&gt; <span class="id">None</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>) <span class="id">l</span>) =<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">rmap</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">fun</span> <span class="id">d1</span> : <span class="id">data</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">olift</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">fun</span> <span class="id">d0</span> : <span class="id">data</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">d0</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">dunit</span> =&gt; <span class="id">None</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">dnat</span> <span class="id">_</span> =&gt; <span class="id">None</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">dbool</span> <span class="id">_</span> =&gt; <span class="id">None</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">dstring</span> <span class="id">_</span> =&gt; <span class="id">None</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">dcoll</span> <span class="id">_</span> =&gt; <span class="id">None</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">drec</span> <span class="id">r</span> =&gt; <span class="id">Some</span> (<span class="id">drec</span> (<span class="id">rproject</span> <span class="id">r</span> <span class="id">sl</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">dleft</span> <span class="id">_</span> =&gt; <span class="id">None</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">dright</span> <span class="id">_</span> =&gt; <span class="id">None</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">dbrand</span> <span class="id">_</span> <span class="id">_</span> =&gt; <span class="id">None</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">dforeign</span> <span class="id">_</span> =&gt; <span class="id">None</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>) (<span class="id">Some</span> <span class="id">d1</span>)) <span class="id">l</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof963')">Proof.</div>
<div class="proofscript" id="proof963">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">rmap_ext</span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;Qed.</div>
&nbsp;&nbsp;&nbsp;&nbsp;<br/>
<span class="kwd">End</span> <span class="id">SRProject</span>.<br/>
<br/>
<span class="kwd">Hint</span> <span class="kwd">Resolve</span> @<span class="id">merge_bindings_sorted</span>.<br/>
<span class="kwd">Hint</span> <span class="id">Rewrite</span> @<span class="id">rondcoll2_dcoll</span> : <span class="id">alg</span>.<br/>
<span class="kwd">Hint</span> <span class="id">Rewrite</span> @<span class="id">rondcoll_dcoll</span> : <span class="id">alg</span>.<br/>
<span class="kwd">Hint</span> <span class="id">Rewrite</span> @<span class="id">ondcoll_dcoll</span> : <span class="id">alg</span>.<br/>
<span class="kwd">Hint</span> <span class="id">Rewrite</span> @<span class="id">lift_oncoll_dcoll</span> : <span class="id">alg</span>.<br/>
<span class="kwd">Hint</span> <span class="id">Rewrite</span> @<span class="id">olift_on_lift_dcoll</span> : <span class="id">alg</span>.<br/>
<span class="kwd">Hint</span> <span class="id">Rewrite</span> @<span class="id">olift_lift_dcoll</span> : <span class="id">alg</span>.<br/>
<span class="kwd">Hint</span> <span class="id">Rewrite</span> @<span class="id">rmap_id</span> : <span class="id">alg</span>.<br/>
<span class="kwd">Hint</span> <span class="id">Rewrite</span> @<span class="id">rmap_map</span> : <span class="id">alg</span>.<br/>
<span class="kwd">Hint</span> <span class="id">Rewrite</span> @<span class="id">lift_dcoll_cons_rmap</span> : <span class="id">alg</span>.<br/>
<span class="kwd">Hint</span> <span class="id">Rewrite</span> @<span class="id">rflatten_map_dcoll_id</span> : <span class="id">alg</span>.<br/>
<br/>
<span class="kwd">Notation</span> "<span class="id">X</span> ≅ <span class="id">Y</span>" := (<span class="id">ldeq</span> <span class="id">X</span> <span class="id">Y</span>) (<span class="tactic">at</span> <span class="id">level</span> 70) : <span class="id">rbag_scope</span>.                             <br/>
<span class="kwd">Notation</span> "<span class="id">b1</span> ⊎ <span class="id">b2</span>" := (<span class="id">bunion</span> <span class="id">b2</span> <span class="id">b1</span>) (<span class="id">right</span> <span class="id">associativity</span>, <span class="tactic">at</span> <span class="id">level</span> 70) : <span class="id">rbag_scope</span>.    <br/>
<span class="kwd">Notation</span> "<span class="id">b1</span> ⊖ <span class="id">b2</span>" := (<span class="id">bminus</span> <span class="id">b2</span> <span class="id">b1</span>) (<span class="id">right</span> <span class="id">associativity</span>, <span class="tactic">at</span> <span class="id">level</span> 70) : <span class="id">rbag_scope</span>.    <br/>
<span class="kwd">Notation</span> "<span class="id">b1</span> × <span class="id">b2</span>" := (<span class="id">rproduct</span> <span class="id">b1</span> <span class="id">b2</span>) (<span class="id">right</span> <span class="id">associativity</span>, <span class="tactic">at</span> <span class="id">level</span> 70) : <span class="id">rbag_scope</span>.   <br/>
<span class="kwd">Notation</span> "<span class="id">b1</span> <span class="id">min</span>-<span class="id">b</span> <span class="id">b2</span>" := (<span class="id">bmin</span> <span class="id">b1</span> <span class="id">b2</span>) (<span class="id">right</span> <span class="id">associativity</span>, <span class="tactic">at</span> <span class="id">level</span> 70) : <span class="id">rbag_scope</span>.<br/>
<span class="kwd">Notation</span> "<span class="id">b1</span> <span class="id">max</span>-<span class="id">b</span> <span class="id">b2</span>" := (<span class="id">bmax</span> <span class="id">b1</span> <span class="id">b2</span>) (<span class="id">right</span> <span class="id">associativity</span>, <span class="tactic">at</span> <span class="id">level</span> 70) : <span class="id">rbag_scope</span>.<br/>
<span class="kwd">Notation</span> "<span class="id">distinct</span>-<span class="id">b</span> <span class="id">b1</span>" := (<span class="id">bdistinct</span> <span class="id">b1</span>) (<span class="id">right</span> <span class="id">associativity</span>, <span class="tactic">at</span> <span class="id">level</span> 70) : <span class="id">rbag_scope</span>.<br/>
<br/>

</div>
<div class="footer"><hr/>Generated by <a href="https://github.com/xavierleroy/coq2html/">coq2html</div>
</body>
</html>
