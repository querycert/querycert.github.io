
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Module Qcert.Basic.Data.RBag</title>
<meta name="description" content="Documentation of Coq module Qcert.Basic.Data.RBag" />
<link href="coq2html.css" rel="stylesheet" type="text/css" />
<script type="text/javascript" src="coq2html.js"> </script>
</head>

<body onload="hideAll('proofscript')">
<h1 class="title">Module Qcert.Basic.Data.RBag</h1>
<div class="coq">
<br/>
<span class="kwd">Section</span> <span class="id">RBag</span>.<br/>
&nbsp;&nbsp;<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id">List</span>.<br/>
&nbsp;&nbsp;<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id">Arith</span> <span class="id">Min</span> <span class="id">Max</span> <span class="id">Omega</span>.<br/>
&nbsp;&nbsp;<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id">Permutation</span>.<br/>
&nbsp;&nbsp;<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id">Equivalence</span>.<br/>
&nbsp;&nbsp;<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id">Morphisms</span>.<br/>
&nbsp;&nbsp;<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id">Setoid</span>.<br/>
&nbsp;&nbsp;<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id">EquivDec</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id">Utils</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Context</span> {<span class="id">A</span>:<span class="kwd">Type</span>}.<br/>
&nbsp;&nbsp;<span class="kwd">Context</span> {<span class="id">eqdec</span>:<span class="id">EqDec</span> <span class="id">A</span> <span class="id">eq</span>}.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id">rbag</span> := <span class="id">list</span> <span class="id">A</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id">bunion</span> := (@<span class="id">app</span> <span class="id">A</span>).<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Delimit</span> <span class="kwd">Scope</span> <span class="id">rbag_scope</span> <span class="kwd">with</span> <span class="id">rbag</span>.<br/>
&nbsp;&nbsp;<span class="kwd">Bind</span> <span class="kwd">Scope</span> <span class="id">rbag_scope</span> <span class="kwd">with</span> <span class="id">rbag</span>.<br/>
&nbsp;&nbsp;<span class="kwd">Open</span> <span class="kwd">Scope</span> <span class="id">rbag_scope</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Notation</span> "<span class="id">X</span> ≅ <span class="id">Y</span>" := (<span class="id">ldeqA</span> <span class="id">X</span> <span class="id">Y</span>) (<span class="tactic">at</span> <span class="id">level</span> 70) : <span class="id">rbag_scope</span>.                              <br/>
&nbsp;&nbsp;<span class="kwd">Notation</span> "<span class="id">b1</span> ⊎ <span class="id">b2</span>" := (<span class="id">bunion</span> <span class="id">b1</span> <span class="id">b2</span>) (<span class="id">right</span> <span class="id">associativity</span>, <span class="tactic">at</span> <span class="id">level</span> 70) : <span class="id">rbag_scope</span>.    <br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Global</span> <span class="kwd">Instance</span> <span class="id">bunion_proper</span> : <span class="id">Proper</span> (<span class="id">ldeqA</span> ==&gt; <span class="id">ldeqA</span> ==&gt; <span class="id">ldeqA</span>) <span class="id">bunion</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof646')">Proof.</div>
<div class="proofscript" id="proof646">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">Proper</span>, <span class="id">respectful</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">unfold</span> <span class="id">bunion</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">Permutation_app</span>; <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">bunion_nil_r</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">l</span>:<span class="id">list</span> <span class="id">A</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">l</span> ⊎ <span class="id">nil</span>) = <span class="id">l</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof647')">Proof.</div>
<div class="proofscript" id="proof647">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>; <span class="tactic">unfold</span> <span class="id">bunion</span>; <span class="tactic">rewrite</span> <span class="id">app_nil_r</span>; <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">bunion_nil_l</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">l</span>:<span class="id">list</span> <span class="id">A</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">nil</span> ⊎ <span class="id">l</span>) = <span class="id">l</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof648')">Proof.</div>
<div class="proofscript" id="proof648">
 <span class="tactic">reflexivity</span>. Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">bunion_assoc</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">l1</span> <span class="id">l2</span> <span class="id">l3</span>:<span class="id">list</span> <span class="id">A</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;((<span class="id">l1</span> ⊎ <span class="id">l2</span>) ⊎ <span class="id">l3</span>) = (<span class="id">l1</span> ⊎ (<span class="id">l2</span> ⊎ <span class="id">l3</span>)).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof649')">Proof.</div>
<div class="proofscript" id="proof649">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>; <span class="tactic">unfold</span> <span class="id">bunion</span>; <span class="tactic">rewrite</span> <span class="id">app_assoc</span>; <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">bunion_comm</span> (<span class="id">l1</span> <span class="id">l2</span>: <span class="id">list</span> <span class="id">A</span>) :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">l1</span> ⊎ <span class="id">l2</span>) ≅ (<span class="id">l2</span> ⊎ <span class="id">l1</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof650')">Proof.</div>
<div class="proofscript" id="proof650">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">bunion</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">Permutation_app_comm</span>; <span class="tactic">try</span> <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">bunion_Forall</span> <span class="id">P</span> (<span class="id">l1</span> <span class="id">l2</span> : <span class="id">list</span> <span class="id">A</span>) :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Forall</span> <span class="id">P</span> <span class="id">l1</span> -&gt; <span class="id">Forall</span> <span class="id">P</span> <span class="id">l2</span> -&gt; <span class="id">Forall</span> <span class="id">P</span> (<span class="id">bunion</span> <span class="id">l1</span> <span class="id">l2</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof651')">Proof.</div>
<div class="proofscript" id="proof651">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">bunion</span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">Forall_app</span>; <span class="tactic">trivial</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Fixpoint</span> <span class="id">remove_one</span> (<span class="id">x</span> : <span class="id">A</span>) (<span class="id">l</span> : <span class="id">list</span> <span class="id">A</span>) : <span class="id">list</span> <span class="id">A</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">l</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">nil</span> =&gt; <span class="id">nil</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">y</span>::<span class="id">tl</span> =&gt; <span class="kwd">if</span> (<span class="id">x</span> == <span class="id">y</span>) <span class="kwd">then</span> <span class="id">tl</span> <span class="kwd">else</span> <span class="id">y</span>::(<span class="id">remove_one</span> <span class="id">x</span> <span class="id">tl</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Hint</span> <span class="kwd">Unfold</span> <span class="id">ldeqA</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Ltac</span> <span class="id">tac</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;:= <span class="tactic">repeat</span> <span class="tactic">progress</span> (<span class="tactic">intros</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> *; <span class="tactic">try</span> <span class="id">autorewrite</span> <span class="kwd">with</span> <span class="id">bag</span> <span class="kwd">in</span> *; <span class="tactic">try</span> <span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| [<span class="id">H</span>: ?<span class="id">a</span> = ?<span class="id">a</span> |- <span class="id">_</span> ] =&gt; <span class="tactic">clear</span> <span class="id">H</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| [<span class="id">H</span>: ?<span class="id">a</span> = ?<span class="id">a</span> -&gt; <span class="id">False</span> |- <span class="id">_</span> ] =&gt; <span class="tactic">elim</span> <span class="id">H</span>; <span class="tactic">reflexivity</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| [<span class="id">H</span>: ?<span class="id">a</span> &lt;&gt; ?<span class="id">a</span> |- <span class="id">_</span> ] =&gt; <span class="tactic">elim</span> <span class="id">H</span>; <span class="tactic">reflexivity</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| [<span class="id">H</span>: {<span class="id">_</span> | <span class="id">_</span> } |- <span class="id">_</span> ] =&gt; <span class="tactic">destruct</span> <span class="id">H</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| [<span class="id">H</span>: ?<span class="id">a</span> ≅ ?<span class="id">b</span> |- <span class="id">_</span> ] =&gt; <span class="tactic">rewrite</span> <span class="id">H</span> <span class="kwd">in</span> *<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| [<span class="id">H</span>: <span class="id">context</span> [@<span class="id">equiv_dec</span> ?<span class="id">A</span> ?<span class="id">eqA</span> ?<span class="id">eqvA</span> ?<span class="id">eqdecA</span> ?<span class="id">x</span> ?<span class="id">x</span> ] |- <span class="id">_</span>] =&gt; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">HH</span>:=(<span class="tactic">fresh</span> "<span class="id">eqH</span>") <span class="kwd">in</span> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (@<span class="id">equiv_dec</span> <span class="id">A</span> <span class="id">eqA</span> <span class="id">eqvA</span> <span class="id">eqdecA</span> <span class="id">x</span> <span class="id">x</span>) <span class="kwd">as</span> [<span class="id">eqH</span>|<span class="id">eqH</span>];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[|<span class="tactic">elim</span> <span class="id">eqH</span>; <span class="tactic">reflexivity</span>]<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| [|- <span class="id">context</span> [@<span class="id">equiv_dec</span> ?<span class="id">A</span> ?<span class="id">eqA</span> ?<span class="id">eqvA</span> ?<span class="id">eqdecA</span> ?<span class="id">x</span> ?<span class="id">x</span> ]] =&gt; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">HH</span>:=(<span class="tactic">fresh</span> "<span class="id">eqH</span>") <span class="kwd">in</span> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (@<span class="id">equiv_dec</span> <span class="id">A</span> <span class="id">eqA</span> <span class="id">eqvA</span> <span class="id">eqdecA</span> <span class="id">x</span> <span class="id">x</span>) <span class="kwd">as</span> [<span class="id">eqH</span>|<span class="id">eqH</span>];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[|<span class="tactic">elim</span> <span class="id">eqH</span>; <span class="tactic">reflexivity</span>]<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| [|- ?<span class="id">x</span> :: ?<span class="id">l</span> ≅ ?<span class="id">x</span> :: ?<span class="id">l</span>' ] =&gt; <span class="tactic">apply</span> <span class="id">perm_skip</span>; <span class="id">fold</span> <span class="id">ldeqA</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| [|- ?<span class="id">x</span> :: ?<span class="id">y</span> :: ?<span class="id">l</span> ≅ ?<span class="id">y</span> :: ?<span class="id">x</span> :: ?<span class="id">l</span>' ] =&gt; <span class="tactic">apply</span> <span class="id">perm_swap</span>; <span class="id">fold</span> <span class="id">ldeqA</span><br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| [<span class="id">H</span>: ?<span class="id">a</span> + {?<span class="id">b</span>} |- <span class="id">_</span> ] =&gt; <span class="tactic">destruct</span> <span class="id">H</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| [<span class="id">H</span>: {?<span class="id">a</span>} + {?<span class="id">b</span>} |- <span class="id">_</span> ] =&gt; <span class="tactic">destruct</span> <span class="id">H</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| [<span class="id">H</span>: <span class="id">context</span> [@<span class="id">equiv_dec</span> ?<span class="id">A</span> ?<span class="id">eqA</span> ?<span class="id">eqvA</span> ?<span class="id">eqdecA</span> ?<span class="id">x</span> ?<span class="id">y</span> ] |- <span class="id">_</span>] =&gt; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (@<span class="id">equiv_dec</span> <span class="id">A</span> <span class="id">eqA</span> <span class="id">eqvA</span> <span class="id">eqdecA</span> <span class="id">x</span> <span class="id">y</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| [|- <span class="id">context</span> [@<span class="id">equiv_dec</span> ?<span class="id">A</span> ?<span class="id">eqA</span> ?<span class="id">eqvA</span> ?<span class="id">eqdecA</span> ?<span class="id">x</span> ?<span class="id">y</span> ]] =&gt; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (@<span class="id">equiv_dec</span> <span class="id">A</span> <span class="id">eqA</span> <span class="id">eqvA</span> <span class="id">eqdecA</span> <span class="id">x</span> <span class="id">y</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">complement</span>, <span class="id">Equivalence.equiv</span> <span class="kwd">in</span> *;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">try</span> <span class="tactic">subst</span>; <span class="tactic">try</span> <span class="tactic">reflexivity</span>; <span class="tactic">eauto</span>).<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Global</span> <span class="kwd">Instance</span> <span class="id">remove_one_proper</span> : <span class="id">Proper</span> (<span class="id">eq</span> ==&gt; <span class="id">ldeqA</span> ==&gt; <span class="id">ldeqA</span>) <span class="id">remove_one</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof652')">Proof.</div>
<div class="proofscript" id="proof652">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">Proper</span>, <span class="id">respectful</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">elim</span> <span class="id">H0</span>; <span class="id">tac</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
<div class="doc">Bag minus
   * Remove elements of d from x.
   * Note the order of arguments: (bminus d x) is "x ⊖ d" </div>
&nbsp;&nbsp;<span class="kwd">Fixpoint</span> <span class="id">bminus</span> (<span class="id">d</span> <span class="id">x</span>:<span class="id">list</span> <span class="id">A</span>) {<span class="kwd">struct</span> <span class="id">d</span>} : <span class="id">list</span> <span class="id">A</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">d</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">nil</span> =&gt; <span class="id">x</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">d1</span> :: <span class="id">d</span>' =&gt; <span class="id">bminus</span> <span class="id">d</span>' (<span class="id">remove_one</span> <span class="id">d1</span> <span class="id">x</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Notation</span> "<span class="id">b1</span> ⊖ <span class="id">b2</span>" := (<span class="id">bminus</span> <span class="id">b2</span> <span class="id">b1</span>) (<span class="id">right</span> <span class="id">associativity</span>, <span class="tactic">at</span> <span class="id">level</span> 70) : <span class="id">rbag_scope</span>.    <br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">bminus_over_app_delta</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">d1</span> <span class="id">d2</span>:<span class="id">list</span> <span class="id">A</span>), <span class="kwd">forall</span> (<span class="id">s</span>:<span class="id">list</span> <span class="id">A</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;((<span class="id">s</span> ⊖ <span class="id">d1</span>) ⊖ <span class="id">d2</span>) = (<span class="id">s</span> ⊖ (<span class="id">d1</span> ++ <span class="id">d2</span>)).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof653')">Proof.</div>
<div class="proofscript" id="proof653">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">d1</span>; <span class="id">tac</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">bminus_to_nil</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">d</span>:<span class="id">list</span> <span class="id">A</span>), (<span class="id">nil</span> ⊖ <span class="id">d</span>) = <span class="id">nil</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof654')">Proof.</div>
<div class="proofscript" id="proof654">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">d</span>; <span class="id">tac</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">bminus_nil_to_self</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">x</span>:<span class="id">list</span> <span class="id">A</span>), (<span class="id">x</span> ⊖ <span class="id">nil</span>) = <span class="id">x</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof655')">Proof.</div>
<div class="proofscript" id="proof655">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">x</span>; <span class="id">tac</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Global</span> <span class="kwd">Instance</span> <span class="id">bminus_proper_lem</span> : <span class="id">Proper</span> (<span class="id">eq</span> ==&gt; <span class="id">ldeqA</span> ==&gt; <span class="id">ldeqA</span>) <span class="id">bminus</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof656')">Proof.</div>
<div class="proofscript" id="proof656">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">Proper</span>, <span class="id">respectful</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">x</span> <span class="id">y</span> <span class="id">H</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">y</span>; <span class="id">tac</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">IHy</span>; <span class="tactic">rewrite</span> <span class="id">H</span>; <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">remove_one_comm</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">x1</span> <span class="id">x2</span>:<span class="id">A</span>), <span class="kwd">forall</span> <span class="id">x</span>:<span class="id">list</span> <span class="id">A</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">remove_one</span> <span class="id">x1</span> (<span class="id">remove_one</span> <span class="id">x2</span> <span class="id">x</span>)) = (<span class="id">remove_one</span> <span class="id">x2</span> (<span class="id">remove_one</span> <span class="id">x1</span> <span class="id">x</span>)).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof657')">Proof.</div>
<div class="proofscript" id="proof657">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">x</span>; <span class="id">tac</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">remove_one_not_first</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">x1</span> <span class="id">x2</span>:<span class="id">A</span>), <span class="kwd">forall</span> <span class="id">s</span>:<span class="id">list</span> <span class="id">A</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">x1</span> &lt;&gt; <span class="id">x2</span> -&gt; (<span class="id">remove_one</span> <span class="id">x1</span> (<span class="id">x2</span> :: <span class="id">s</span>)) = <span class="id">x2</span> :: (<span class="id">remove_one</span> <span class="id">x1</span> <span class="id">s</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof658')">Proof.</div>
<div class="proofscript" id="proof658">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">elim</span> (<span class="id">equiv_dec</span> <span class="id">x1</span> <span class="id">x2</span>); <span class="tactic">intros</span>; [<span class="id">contradiction</span>|<span class="tactic">reflexivity</span>].<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Global</span> <span class="kwd">Instance</span> <span class="id">bminus_proper</span> : <span class="id">Proper</span> (<span class="id">ldeqA</span> ==&gt; <span class="id">ldeqA</span> ==&gt; <span class="id">ldeqA</span>) <span class="id">bminus</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof659')">Proof.</div>
<div class="proofscript" id="proof659">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">Proper</span>, <span class="id">respectful</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">x</span> <span class="id">y</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">elim</span> <span class="id">H</span>; <span class="id">tac</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">rewrite</span> <span class="id">remove_one_comm</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">rewrite</span> <span class="id">H1</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">symmetry</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">bminus_self</span> : <span class="kwd">forall</span> (<span class="id">x</span>:<span class="id">list</span> <span class="id">A</span>), (<span class="id">x</span> ⊖ <span class="id">x</span>) = <span class="id">nil</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof660')">Proof.</div>
<div class="proofscript" id="proof660">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>; <span class="tactic">induction</span> <span class="id">x</span>; <span class="id">tac</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">bminus_naught</span> : <span class="kwd">forall</span> (<span class="id">x</span>:<span class="id">list</span> <span class="id">A</span>), (<span class="id">x</span> ⊖ <span class="id">nil</span>) = <span class="id">x</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof661')">Proof.</div>
<div class="proofscript" id="proof661">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Hint</span> <span class="id">Rewrite</span> <span class="id">bminus_nil_to_self</span> <span class="id">bminus_to_nil</span> <span class="id">bminus_self</span> <span class="id">bminus_naught</span> : <span class="id">bag</span>.<br/>
&nbsp;&nbsp;<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">bminus_cons</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">a</span>:<span class="id">A</span>) (<span class="id">x</span> <span class="id">y</span>:<span class="id">list</span> <span class="id">A</span>), ((<span class="id">a</span> :: <span class="id">x</span>) ⊖ (<span class="id">a</span> :: <span class="id">y</span>)) = (<span class="id">x</span> ⊖ <span class="id">y</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof662')">Proof.</div>
<div class="proofscript" id="proof662">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">tac</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Hint</span> <span class="id">Rewrite</span> <span class="id">bminus_cons</span> : <span class="id">bag</span>.<br/>
&nbsp;&nbsp;<span class="kwd">Hint</span> <span class="id">Rewrite</span> <span class="id">app_nil_r</span> : <span class="id">bag</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">bunion_bminus</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">x</span> <span class="id">y</span>: <span class="id">list</span> <span class="id">A</span>), ((<span class="id">y</span> ⊎ <span class="id">x</span>) ⊖ <span class="id">y</span>) = <span class="id">x</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof663')">Proof.</div>
<div class="proofscript" id="proof663">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">x</span>; <span class="tactic">unfold</span> <span class="id">bunion</span> <span class="kwd">in</span> *; <span class="id">tac</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">y</span>; <span class="id">tac</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">remove_one_consed</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">x</span>:<span class="id">list</span> <span class="id">A</span>), <span class="kwd">forall</span> (<span class="id">a</span>:<span class="id">A</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">remove_one</span> <span class="id">a</span> (<span class="id">a</span> :: <span class="id">x</span>)) = <span class="id">x</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof664')">Proof.</div>
<div class="proofscript" id="proof664">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">tac</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">remove_one_In</span> (<span class="id">a</span> <span class="id">x</span>:<span class="id">A</span>) (<span class="id">l1</span> <span class="id">l2</span>:<span class="id">list</span> <span class="id">A</span>) :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">In</span> <span class="id">x</span> (<span class="id">bminus</span> <span class="id">l1</span> (<span class="id">remove_one</span> <span class="id">a</span> <span class="id">l2</span>)) -&gt; <span class="id">In</span> <span class="id">x</span> (<span class="id">bminus</span> <span class="id">l1</span> <span class="id">l2</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof665')">Proof.</div>
<div class="proofscript" id="proof665">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">revert</span> <span class="id">l2</span> <span class="id">a</span> <span class="id">x</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">l1</span>; <span class="tactic">intros</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">induction</span> <span class="id">l2</span>; <span class="tactic">intros</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">equiv_dec</span> <span class="id">a</span> <span class="id">a0</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">e</span> <span class="kwd">in</span> *; <span class="tactic">clear</span> <span class="id">e</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">right</span>; <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">elim</span> <span class="id">H</span>; <span class="tactic">clear</span> <span class="id">H</span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">left</span>; <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">right</span>; <span class="tactic">apply</span> (<span class="id">IHl2</span> <span class="id">H</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">apply</span> (<span class="id">IHl1</span> (<span class="id">remove_one</span> <span class="id">a</span> <span class="id">l2</span>) <span class="id">a0</span> <span class="id">x</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">remove_one_comm</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">remove_one_sublist</span> <span class="id">l</span> <span class="id">a</span> : <span class="id">sublist</span> (<span class="id">remove_one</span> <span class="id">a</span> <span class="id">l</span>) <span class="id">l</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof666')">Proof.</div>
<div class="proofscript" id="proof666">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">l</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">constructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">match_destr</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">constructor</span>; <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">constructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">trivial</span>.<br/>
&nbsp;&nbsp;Qed.</div>
&nbsp;&nbsp;<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">bminus_sublist</span> (<span class="id">l1</span> <span class="id">l2</span>:<span class="id">list</span> <span class="id">A</span>) :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">sublist</span> (<span class="id">bminus</span> <span class="id">l1</span> <span class="id">l2</span>) <span class="id">l2</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof667')">Proof.</div>
<div class="proofscript" id="proof667">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">revert</span> <span class="id">l2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">l1</span>; <span class="tactic">simpl</span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">rewrite</span> <span class="id">IHl1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">remove_one_sublist</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">bminus_Forall</span> (<span class="id">l1</span> <span class="id">l2</span>:<span class="id">list</span> <span class="id">A</span>) <span class="id">p</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Forall</span> <span class="id">p</span> <span class="id">l2</span> -&gt; <span class="id">Forall</span> <span class="id">p</span> (<span class="id">bminus</span> <span class="id">l1</span> <span class="id">l2</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof668')">Proof.</div>
<div class="proofscript" id="proof668">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">bminus_sublist</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">trivial</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">bminus_NoDup</span>  (<span class="id">l1</span> <span class="id">l2</span>:<span class="id">list</span> <span class="id">A</span>) : <span class="id">NoDup</span> <span class="id">l2</span> -&gt; <span class="id">NoDup</span> (<span class="id">bminus</span> <span class="id">l1</span> <span class="id">l2</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof669')">Proof.</div>
<div class="proofscript" id="proof669">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">bminus_sublist</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">trivial</span>.<br/>
&nbsp;&nbsp;Qed.</div>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br/>
&nbsp;&nbsp;<span class="kwd">Hint</span> <span class="id">Rewrite</span> <span class="id">bunion_bminus</span> <span class="id">remove_one_consed</span> : <span class="id">bag</span>.<br/>
&nbsp;&nbsp;<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">pick_an_a</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">l</span>:<span class="id">list</span> <span class="id">A</span>) (<span class="id">a</span>:<span class="id">A</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;({<span class="id">l</span>':<span class="id">list</span> <span class="id">A</span> | <span class="id">a</span>::<span class="id">l</span>' ≅ <span class="id">l</span>}) + {<span class="id">remove_one</span> <span class="id">a</span> <span class="id">l</span> ≅ <span class="id">l</span>}.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof670')">Proof.</div>
<div class="proofscript" id="proof670">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>; <span class="tactic">induction</span> <span class="id">l</span>; <span class="id">tac</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">left</span>; <span class="id">exists</span> (<span class="id">a0</span>::<span class="id">x</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">perm_swap</span>, <span class="id">l0</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Global</span> <span class="kwd">Instance</span> <span class="id">filter_proper</span> : <span class="kwd">forall</span> (<span class="id">p</span>:<span class="id">A</span> -&gt; <span class="id">bool</span>), <span class="id">Proper</span> (<span class="id">ldeqA</span> ==&gt; <span class="id">ldeqA</span>) (<span class="id">filter</span> <span class="id">p</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof671')">Proof.</div>
<div class="proofscript" id="proof671">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">Proper</span>, <span class="id">respectful</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">elim</span> <span class="id">H</span>; <span class="id">tac</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[|- <span class="id">context</span> [<span class="kwd">if</span> ?<span class="id">a</span> <span class="kwd">then</span> <span class="id">_</span> <span class="kwd">else</span> <span class="id">_</span> ] ] =&gt; <span class="id">case_eq</span> <span class="id">a</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>; <span class="id">tac</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Section</span> <span class="id">MBag</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Fixpoint</span> <span class="id">mult</span> (<span class="id">l</span>:<span class="id">list</span> <span class="id">A</span>) (<span class="id">a</span>:<span class="id">A</span>) : <span class="id">nat</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">l</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">nil</span> =&gt; <span class="id">O</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">b</span> :: <span class="id">l</span>' =&gt; <span class="kwd">if</span> (<span class="id">equiv_dec</span> <span class="id">a</span> <span class="id">b</span>) <span class="kwd">then</span> <span class="id">S</span> (<span class="id">mult</span> <span class="id">l</span>' <span class="id">a</span>) <span class="kwd">else</span> (<span class="id">mult</span> <span class="id">l</span>' <span class="id">a</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id">mult_equiv</span> <span class="id">l</span> <span class="id">l</span>' := (<span class="kwd">forall</span> <span class="id">a</span>, <span class="id">mult</span> <span class="id">l</span> <span class="id">a</span> = <span class="id">mult</span> <span class="id">l</span>' <span class="id">a</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Notation</span> "<span class="id">X</span> ≅# <span class="id">Y</span>" := (<span class="id">mult_equiv</span> <span class="id">X</span> <span class="id">Y</span>) (<span class="tactic">at</span> <span class="id">level</span> 70) : <span class="id">rbag_scope</span>.                              <br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Hint</span> <span class="kwd">Unfold</span> <span class="id">mult_equiv</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Global</span> <span class="kwd">Instance</span> <span class="id">mult_proper</span> : <span class="id">Proper</span> (<span class="id">ldeqA</span> ==&gt; <span class="id">eq</span> ==&gt; <span class="id">eq</span>) <span class="id">mult</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof672')">Proof.</div>
<div class="proofscript" id="proof672">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">Proper</span>, <span class="id">respectful</span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">elim</span> <span class="id">H</span>; <span class="tactic">intros</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">rewrite</span> <span class="id">H0</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">equiv_dec</span> <span class="id">y0</span> <span class="id">x1</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H2</span>; <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">rewrite</span> <span class="id">H0</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">equiv_dec</span> <span class="id">y0</span> <span class="id">y1</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">e</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">equiv_dec</span> <span class="id">y1</span> <span class="id">x1</span>); <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">equiv_dec</span> <span class="id">y0</span> <span class="id">x1</span>); <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">rewrite</span> <span class="id">H0</span> <span class="kwd">in</span> *; <span class="tactic">rewrite</span> <span class="id">H2</span>; <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">bags_equal_same_mult1</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">l1</span> <span class="id">l2</span>:<span class="id">list</span> <span class="id">A</span>), <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">l1</span> ≅ <span class="id">l2</span> -&gt; <span class="id">l1</span> ≅# <span class="id">l2</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof673')">Proof.</div>
<div class="proofscript" id="proof673">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">mult_equiv</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">H</span>; <span class="id">tac</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Fixpoint</span> <span class="id">groupby</span> (<span class="id">l</span>:<span class="id">list</span> <span class="id">A</span>) : <span class="id">list</span> (<span class="id">A</span>*<span class="id">nat</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:= <span class="kwd">match</span> <span class="id">l</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">nil</span> =&gt; <span class="id">nil</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| (<span class="id">a</span>::<span class="id">ls</span>) =&gt; <span class="kwd">let</span> <span class="id">rest</span> := <span class="id">groupby</span> <span class="id">ls</span> <span class="kwd">in</span> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">lookup</span> <span class="id">equiv_dec</span> <span class="id">rest</span> <span class="id">a</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">None</span> =&gt; (<span class="id">a</span>,1)::<span class="id">rest</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">Some</span> <span class="id">x</span> =&gt; <span class="id">update_first</span> <span class="id">equiv_dec</span> <span class="id">rest</span> <span class="id">a</span> (<span class="id">S</span> <span class="id">x</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">groupby_noDup</span> <span class="id">l</span> : <span class="id">NoDup</span> (<span class="id">domain</span> (<span class="id">groupby</span> <span class="id">l</span>)).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof674')">Proof.</div>
<div class="proofscript" id="proof674">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Hint</span> <span class="id">Constructors</span> <span class="id">NoDup</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">l</span>; <span class="tactic">simpl</span>; <span class="tactic">trivial</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">case_eq</span> (<span class="id">lookup</span> <span class="id">equiv_dec</span> (<span class="id">groupby</span> <span class="id">l</span>) <span class="id">a</span>); [<span class="tactic">intros</span> ? ?| <span class="tactic">intros</span> <span class="id">neq</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">rewrite</span> <span class="id">domain_update_first</span>; <span class="tactic">trivial</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">simpl</span>; <span class="id">constructor</span>; <span class="tactic">auto</span>. <span class="tactic">apply</span> <span class="id">lookup_none_nin</span> <span class="kwd">in</span> <span class="id">neq</span>; <span class="tactic">trivial</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Fixpoint</span> <span class="id">rep</span> (<span class="id">a</span>:<span class="id">A</span>) <span class="id">n</span> : <span class="id">list</span> <span class="id">A</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">n</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| 0 =&gt; <span class="id">nil</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">S</span> <span class="id">m</span> =&gt; <span class="id">a</span>::(<span class="id">rep</span> <span class="id">a</span> <span class="id">m</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Fixpoint</span> <span class="id">smush</span> (<span class="id">l</span>:<span class="id">list</span> (<span class="id">A</span>*<span class="id">nat</span>)) : <span class="id">list</span> <span class="id">A</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:= <span class="kwd">match</span> <span class="id">l</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">nil</span> =&gt; <span class="id">nil</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| ((<span class="id">d</span>,<span class="id">n</span>)::<span class="id">ls</span>) =&gt; <span class="id">rep</span> <span class="id">d</span> <span class="id">n</span> ++ <span class="id">smush</span> <span class="id">ls</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Global</span> <span class="kwd">Instance</span> <span class="id">smush_perm_proper</span> : <span class="id">Proper</span> ((@<span class="id">Permutation</span> (<span class="id">A</span>*<span class="id">nat</span>)) ==&gt; <span class="id">ldeqA</span>) <span class="id">smush</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof675')">Proof.</div>
<div class="proofscript" id="proof675">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">respectful</span>, <span class="id">Proper</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">Permutation_ind_bis</span>; <span class="tactic">intros</span>; <span class="tactic">try</span> <span class="tactic">reflexivity</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">destruct</span> <span class="id">x</span>. <span class="tactic">rewrite</span> <span class="id">H0</span>. <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">destruct</span> <span class="id">x</span>; <span class="tactic">destruct</span> <span class="id">y</span>. <span class="tactic">rewrite</span> <span class="id">H0</span>. <span class="tactic">repeat</span> <span class="tactic">rewrite</span> <span class="id">app_assoc</span>. <span class="tactic">apply</span> <span class="id">Permutation_app_tail</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">Permutation_app_comm</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">transitivity</span> (<span class="id">smush</span> <span class="id">l</span>'); <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
&nbsp;&nbsp;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">smush1</span> <span class="id">a</span> <span class="id">n</span> <span class="id">x</span> : <span class="id">smush</span> ((<span class="id">a</span>,<span class="id">S</span> <span class="id">n</span>)::<span class="id">x</span>) = <span class="id">a</span>::(<span class="id">smush</span> ((<span class="id">a</span>,<span class="id">n</span>)::<span class="id">x</span>)).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof676')">Proof.</div>
<div class="proofscript" id="proof676">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">trivial</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
&nbsp;&nbsp;&nbsp;&nbsp;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">smush_groupby</span> <span class="id">l</span> : <span class="id">Permutation</span> (<span class="id">smush</span> (<span class="id">groupby</span> <span class="id">l</span>)) <span class="id">l</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof677')">Proof.</div>
<div class="proofscript" id="proof677">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Hint</span> <span class="kwd">Resolve</span> <span class="id">groupby_noDup</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">l</span>; <span class="tactic">simpl</span>; <span class="tactic">trivial</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">case_eq</span> (<span class="id">lookup</span> <span class="id">equiv_dec</span> (<span class="id">groupby</span> <span class="id">l</span>) <span class="id">a</span>); [<span class="tactic">intros</span> <span class="id">n</span> <span class="id">eqn</span> | <span class="tactic">intros</span> <span class="id">neq</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">destruct</span> (<span class="id">lookup_to_front</span> <span class="id">equiv_dec</span> <span class="id">eqn</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">perm1</span>:<span class="id">Permutation</span> (<span class="id">update_first</span> <span class="id">equiv_dec</span> (<span class="id">groupby</span> <span class="id">l</span>) <span class="id">a</span> (<span class="id">S</span> <span class="id">n</span>)) (<span class="id">update_first</span> <span class="id">equiv_dec</span> ((<span class="id">a</span>, <span class="id">n</span>) :: <span class="id">x</span>) <span class="id">a</span> (<span class="id">S</span> <span class="id">n</span>))) <span class="tactic">by</span> (<span class="tactic">apply</span> <span class="id">update_first_NoDup_perm_proper</span>; <span class="tactic">auto</span>). <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">perm1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>. <span class="tactic">destruct</span> (<span class="id">equiv_dec</span> <span class="id">a</span> <span class="id">a</span>); <span class="tactic">try</span> <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">smush1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">perm_skip</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">H</span>, <span class="id">IHl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">trivial</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">simpl</span>. <span class="tactic">apply</span> <span class="id">perm_skip</span>; <span class="tactic">trivial</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">pick_an_a_or_absent</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">l</span>:<span class="id">list</span> <span class="id">A</span>) (<span class="id">a</span>:<span class="id">A</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">mult</span> <span class="id">l</span> <span class="id">a</span> = 0) \/ (<span class="id">exists</span> <span class="id">l</span>':<span class="id">list</span> <span class="id">A</span>, <span class="id">a</span>::<span class="id">l</span>' ≅ <span class="id">l</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof678')">Proof.</div>
<div class="proofscript" id="proof678">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">l</span>; <span class="tactic">intros</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">left</span>; <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">elim</span> (<span class="id">equiv_dec</span> <span class="id">a</span> <span class="id">a0</span>); <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">a1</span> <span class="kwd">in</span> *; <span class="tactic">clear</span> <span class="id">a1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">elim</span> (<span class="id">equiv_dec</span> <span class="id">a0</span> <span class="id">a0</span>); <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">right</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">generalize</span> (<span class="id">IHl</span> <span class="id">a0</span>); <span class="tactic">intros</span>; <span class="tactic">clear</span> <span class="id">IHl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">elim</span> <span class="id">H</span>; <span class="tactic">intros</span>; <span class="tactic">clear</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">l</span>; <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">l</span>; <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">generalize</span> (<span class="id">IHl</span> <span class="id">a0</span>); <span class="tactic">intros</span>; <span class="tactic">clear</span> <span class="id">IHl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">elim</span> <span class="id">H</span>; <span class="tactic">intros</span>; <span class="tactic">clear</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">left</span>; <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">right</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">l</span>; <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">elim</span> (<span class="id">equiv_dec</span> <span class="id">a0</span> <span class="id">a</span>); <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">a1</span> <span class="kwd">in</span> *; <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">generalize</span> (<span class="id">IHl</span> <span class="id">a0</span>); <span class="tactic">intros</span>; <span class="tactic">clear</span> <span class="id">IHl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">elim</span> <span class="id">H</span>; <span class="tactic">intros</span>; <span class="tactic">clear</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">left</span>; <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">right</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">elim</span> <span class="id">H0</span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> (<span class="id">a</span>::<span class="id">x</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">perm_swap</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
&nbsp;&nbsp;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">lookup_none_mult0</span> <span class="id">l</span> <span class="id">d</span> : <span class="id">lookup</span> <span class="id">equiv_dec</span> (<span class="id">groupby</span> <span class="id">l</span>) <span class="id">d</span> = <span class="id">None</span> -&gt; <span class="id">mult</span> <span class="id">l</span> <span class="id">d</span> = 0.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof679')">Proof.</div>
<div class="proofscript" id="proof679">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">revert</span> <span class="id">d</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">l</span>; <span class="tactic">simpl</span>; <span class="tactic">trivial</span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">case_eq</span> (<span class="id">lookup</span> <span class="id">equiv_dec</span> (<span class="id">groupby</span> <span class="id">l</span>) <span class="id">a</span>); <span class="tactic">intros</span>; <span class="tactic">rewrite</span> <span class="id">H0</span> <span class="kwd">in</span> <span class="id">H</span>; <span class="tactic">destruct</span> (<span class="id">equiv_dec</span> <span class="id">d</span> <span class="id">a</span>); <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">apply</span> <span class="id">lookup_none_nin</span> <span class="kwd">in</span> <span class="id">H</span>. <span class="tactic">elim</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">domain_update_first</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">e</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">in_dom</span>; <span class="tactic">eapply</span> <span class="id">lookup_in</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">apply</span> <span class="id">IHl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">lookup_none_nin</span> <span class="kwd">in</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">domain_update_first</span> <span class="kwd">in</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">case_eq</span> (<span class="id">lookup</span> <span class="id">equiv_dec</span> (<span class="id">groupby</span> <span class="id">l</span>) <span class="id">d</span>); <span class="tactic">try</span> <span class="tactic">congruence</span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">lookup_in</span> <span class="kwd">in</span> <span class="id">H1</span>. <span class="tactic">apply</span> <span class="id">in_dom</span> <span class="kwd">in</span> <span class="id">H1</span>. <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">H</span>. <span class="tactic">rewrite</span> <span class="id">e</span> <span class="kwd">in</span> *; <span class="tactic">destruct</span> (<span class="id">equiv_dec</span> <span class="id">a</span> <span class="id">a</span>); <span class="tactic">try</span> <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">H</span>. <span class="tactic">destruct</span> (<span class="id">equiv_dec</span> <span class="id">d</span> <span class="id">a</span>); <span class="tactic">try</span> <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">lookup_update_eq</span> {<span class="id">B</span>:<span class="kwd">Type</span> }{<span class="id">l</span> <span class="id">a</span>} {<span class="id">n</span> <span class="id">n</span>':<span class="id">B</span>} : <span class="id">lookup</span> <span class="id">equiv_dec</span> (<span class="id">update_first</span> <span class="id">equiv_dec</span> <span class="id">l</span> <span class="id">a</span> <span class="id">n</span>') <span class="id">a</span> = <span class="id">Some</span> <span class="id">n</span> -&gt; <span class="id">n</span> = <span class="id">n</span>'.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof680')">Proof.</div>
<div class="proofscript" id="proof680">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">revert</span> <span class="id">a</span> <span class="id">n</span> <span class="id">n</span>'.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">l</span>; <span class="tactic">simpl</span>; <span class="tactic">try</span> <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">destruct</span> <span class="id">a</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">equiv_dec</span> <span class="id">a0</span> <span class="id">a</span>); <span class="tactic">simpl</span> <span class="kwd">in</span> *; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">rewrite</span> <span class="id">e</span> <span class="kwd">in</span>*; <span class="tactic">destruct</span> (<span class="id">equiv_dec</span> <span class="id">a</span> <span class="id">a</span>); <span class="tactic">try</span> <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">destruct</span> (<span class="id">equiv_dec</span> <span class="id">a0</span> <span class="id">a</span>); <span class="tactic">try</span> <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">groupby_domain</span> {<span class="id">l</span> <span class="id">a</span>} : <span class="id">In</span> <span class="id">a</span> (<span class="id">domain</span> (<span class="id">groupby</span> <span class="id">l</span>)) &lt;-&gt; <span class="id">In</span> <span class="id">a</span> <span class="id">l</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof681')">Proof.</div>
<div class="proofscript" id="proof681">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">revert</span> <span class="id">a</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">l</span>; <span class="tactic">simpl</span>; <span class="tactic">intuition</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">case_eq</span> (<span class="id">lookup</span> <span class="id">equiv_dec</span> (<span class="id">groupby</span> <span class="id">l</span>) <span class="id">a</span>); <span class="tactic">intros</span>; <span class="tactic">rewrite</span> <span class="id">H0</span> <span class="kwd">in</span> <span class="id">H</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">rewrite</span> <span class="id">domain_update_first</span> <span class="kwd">in</span> <span class="id">H</span>. <span class="id">right</span>; <span class="tactic">apply</span> <span class="id">IHl</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">intuition</span>. <span class="id">right</span>; <span class="tactic">apply</span> <span class="id">IHl</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">case_eq</span> (<span class="id">lookup</span> <span class="id">equiv_dec</span> (<span class="id">groupby</span> <span class="id">l</span>) <span class="id">a0</span>); <span class="tactic">intros</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">rewrite</span> <span class="id">domain_update_first</span>. <span class="tactic">eapply</span> <span class="id">in_dom</span>; <span class="tactic">eapply</span> <span class="id">lookup_in</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">intuition</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">case_eq</span> (<span class="id">lookup</span> <span class="id">equiv_dec</span> (<span class="id">groupby</span> <span class="id">l</span>) <span class="id">a</span>); <span class="tactic">intros</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">rewrite</span> <span class="id">domain_update_first</span>. <span class="tactic">apply</span> <span class="id">IHl</span>; <span class="tactic">eauto</span>. <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">right</span>; <span class="tactic">eapply</span> <span class="id">IHl</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
&nbsp;&nbsp;&nbsp;&nbsp;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">lookup_update_eq_in</span> {<span class="id">B</span>:<span class="kwd">Type</span>}{<span class="id">l</span>:<span class="id">list</span> (<span class="id">A</span>*<span class="id">B</span>)} {<span class="id">a</span>} {<span class="id">n</span>:<span class="id">B</span>} :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">In</span> <span class="id">a</span> (<span class="id">domain</span> <span class="id">l</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">lookup</span> <span class="id">equiv_dec</span> (<span class="id">update_first</span> <span class="id">equiv_dec</span> <span class="id">l</span> <span class="id">a</span> <span class="id">n</span>) <span class="id">a</span> = <span class="id">Some</span> <span class="id">n</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof682')">Proof.</div>
<div class="proofscript" id="proof682">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">revert</span> <span class="id">a</span> <span class="id">n</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">l</span>; <span class="tactic">simpl</span>; <span class="tactic">intuition</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> *; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">destruct</span> (<span class="id">equiv_dec</span> <span class="id">a</span> <span class="id">a</span>); <span class="tactic">simpl</span>; <span class="tactic">intuition</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">equiv_dec</span> <span class="id">a</span> <span class="id">a</span>); <span class="tactic">simpl</span>; <span class="tactic">intuition</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">case_eq</span> (<span class="id">equiv_dec</span> <span class="id">a</span> <span class="id">a0</span>); <span class="tactic">simpl</span>; <span class="tactic">intros</span>; <span class="tactic">try</span> <span class="tactic">rewrite</span> <span class="id">e</span> <span class="kwd">in</span> *; <span class="tactic">subst</span>; <span class="tactic">rewrite</span> <span class="id">H</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
&nbsp;&nbsp;&nbsp;&nbsp;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">lookup_update_neq</span> {<span class="id">B</span>:<span class="kwd">Type</span> }{<span class="id">l</span> <span class="id">a</span> <span class="id">a</span>'} {<span class="id">n</span>:<span class="id">B</span>} : <span class="id">a</span>&lt;&gt;<span class="id">a</span>' -&gt; <span class="id">lookup</span> <span class="id">equiv_dec</span> (<span class="id">update_first</span> <span class="id">equiv_dec</span> <span class="id">l</span> <span class="id">a</span> <span class="id">n</span>) <span class="id">a</span>' = <span class="id">lookup</span> <span class="id">equiv_dec</span> <span class="id">l</span> <span class="id">a</span>'.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof683')">Proof.</div>
<div class="proofscript" id="proof683">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">revert</span> <span class="id">a</span> <span class="id">a</span>' <span class="id">n</span>. <span class="tactic">induction</span> <span class="id">l</span>; <span class="tactic">simpl</span>; <span class="tactic">intuition</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">equiv_dec</span> <span class="id">a</span> <span class="id">a0</span>); <span class="tactic">subst</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">e</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">destruct</span> (<span class="id">equiv_dec</span> <span class="id">a</span>' <span class="id">a0</span>); <span class="tactic">try</span> <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">destruct</span> (<span class="id">equiv_dec</span> <span class="id">a</span>' <span class="id">a0</span>); <span class="tactic">simpl</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
&nbsp;&nbsp;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">groupby_mult_in</span> {<span class="id">l</span> <span class="id">d</span> <span class="id">n</span>} : <span class="id">In</span> (<span class="id">d</span>, <span class="id">n</span>) (<span class="id">groupby</span> <span class="id">l</span>) -&gt; <span class="id">mult</span> <span class="id">l</span> <span class="id">d</span> = <span class="id">n</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof684')">Proof.</div>
<div class="proofscript" id="proof684">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">revert</span> <span class="id">n</span>. <span class="tactic">induction</span> <span class="id">l</span>; <span class="tactic">simpl</span>; <span class="tactic">intuition</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">case_eq</span> (<span class="id">lookup</span> <span class="id">equiv_dec</span> (<span class="id">groupby</span> <span class="id">l</span>) <span class="id">a</span>); <span class="tactic">intros</span>; <span class="tactic">rewrite</span> <span class="id">H0</span> <span class="kwd">in</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">apply</span> (<span class="id">in_lookup_nodup</span> <span class="id">equiv_dec</span>) <span class="kwd">in</span> <span class="id">H</span>; [|<span class="tactic">rewrite</span> <span class="id">domain_update_first</span>; <span class="tactic">apply</span> <span class="id">groupby_noDup</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">case_eq</span> (<span class="id">equiv_dec</span> <span class="id">d</span> <span class="id">a</span>); <span class="tactic">trivial</span>; <span class="tactic">intros</span>; <span class="tactic">try</span> <span class="tactic">rewrite</span> <span class="id">e</span> <span class="kwd">in</span> * ; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">apply</span> <span class="id">lookup_update_eq</span> <span class="kwd">in</span> <span class="id">H</span>. <span class="tactic">rewrite</span> (<span class="id">IHl</span> <span class="id">n0</span>); <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">lookup_in</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">apply</span> <span class="id">IHl</span>. <span class="tactic">rewrite</span> <span class="id">lookup_update_neq</span> <span class="kwd">in</span> <span class="id">H</span>; <span class="tactic">try</span> <span class="tactic">congruence</span>. <span class="tactic">eapply</span> <span class="id">lookup_in</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">destruct</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">inversion</span> <span class="id">H</span>; <span class="tactic">subst</span>. <span class="id">case_eq</span> (<span class="id">equiv_dec</span> <span class="id">d</span> <span class="id">d</span>); <span class="tactic">try</span> <span class="tactic">congruence</span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">lookup_none_mult0</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">rewrite</span> (<span class="id">IHl</span> <span class="id">_</span> <span class="id">H</span>). <span class="id">case_eq</span> (<span class="id">equiv_dec</span> <span class="id">d</span> <span class="id">a</span>); <span class="tactic">trivial</span>; <span class="tactic">intros</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">lookup_none_nin</span> <span class="kwd">in</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">in_dom</span> <span class="kwd">in</span> <span class="id">H</span>. <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
&nbsp;&nbsp;&nbsp;&nbsp;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">groupby_mult_in_pos</span> {<span class="id">l</span> <span class="id">d</span> <span class="id">n</span>} : <span class="id">In</span> (<span class="id">d</span>, <span class="id">n</span>) (<span class="id">groupby</span> <span class="id">l</span>) -&gt; <span class="id">n</span> &lt;&gt; 0.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof685')">Proof.</div>
<div class="proofscript" id="proof685">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">revert</span> <span class="id">n</span>. <span class="tactic">induction</span> <span class="id">l</span>; <span class="tactic">simpl</span>; <span class="tactic">intuition</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">case_eq</span> (<span class="id">lookup</span> <span class="id">equiv_dec</span> (<span class="id">groupby</span> <span class="id">l</span>) <span class="id">a</span>); <span class="tactic">intros</span>; <span class="tactic">rewrite</span> <span class="id">H0</span> <span class="kwd">in</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">apply</span> (<span class="id">in_lookup_nodup</span> <span class="id">equiv_dec</span>) <span class="kwd">in</span> <span class="id">H</span>; [|<span class="tactic">rewrite</span> <span class="id">domain_update_first</span>; <span class="tactic">apply</span> <span class="id">groupby_noDup</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">case_eq</span> (<span class="id">equiv_dec</span> <span class="id">d</span> <span class="id">a</span>); <span class="tactic">trivial</span>; <span class="tactic">intros</span>; <span class="tactic">subst</span>; <span class="tactic">try</span> <span class="tactic">rewrite</span> <span class="id">e</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">apply</span> <span class="id">lookup_update_eq</span> <span class="kwd">in</span> <span class="id">H</span>; <span class="tactic">discriminate</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">rewrite</span> <span class="id">lookup_update_neq</span> <span class="kwd">in</span> <span class="id">H</span>; <span class="tactic">auto</span>. <span class="tactic">apply</span> (<span class="id">IHl</span> 0); <span class="tactic">trivial</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">lookup_in</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">destruct</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">inversion</span> <span class="id">H</span>; <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">mult_in_groupby</span> {<span class="id">l</span> <span class="id">d</span> <span class="id">n</span>} : <span class="id">mult</span> <span class="id">l</span> <span class="id">d</span> = <span class="id">S</span> <span class="id">n</span> -&gt; <span class="id">In</span> (<span class="id">d</span>, <span class="id">S</span> <span class="id">n</span>) (<span class="id">groupby</span> <span class="id">l</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof686')">Proof.</div>
<div class="proofscript" id="proof686">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">revert</span> <span class="id">d</span> <span class="id">n</span>. <span class="tactic">induction</span> <span class="id">l</span>; <span class="tactic">simpl</span>; <span class="tactic">try</span> <span class="tactic">congruence</span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">case_eq</span> (<span class="id">lookup</span> <span class="id">equiv_dec</span> (<span class="id">groupby</span> <span class="id">l</span>) <span class="id">a</span>); <span class="tactic">intros</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">case_eq</span> (<span class="id">equiv_dec</span> <span class="id">d</span> <span class="id">a</span>); <span class="tactic">intros</span>; <span class="tactic">rewrite</span> <span class="id">H1</span> <span class="kwd">in</span> <span class="id">H</span>; <span class="tactic">subst</span>; <span class="tactic">simpl</span>; <span class="tactic">try</span> <span class="tactic">rewrite</span> <span class="id">e</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">inversion</span> <span class="id">H</span>. <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H3</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">mn0</span>:<span class="id">mult</span> <span class="id">l</span> <span class="id">a</span> = <span class="id">n0</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">apply</span> <span class="id">groupby_mult_in</span>. <span class="tactic">apply</span> (<span class="id">lookup_in</span> <span class="id">equiv_dec</span>); <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">rewrite</span> <span class="id">H3</span> <span class="kwd">in</span> <span class="id">mn0</span>. <span class="tactic">subst</span> <span class="id">n0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> (<span class="id">lookup_in</span> <span class="id">equiv_dec</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">lookup_update_eq_in</span>. <span class="tactic">apply</span> <span class="id">lookup_in</span>, <span class="id">in_dom</span> <span class="kwd">in</span> <span class="id">H0</span>. <span class="tactic">trivial</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">apply</span> (<span class="id">lookup_in</span> <span class="id">equiv_dec</span>). <span class="tactic">rewrite</span> <span class="id">lookup_update_neq</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">in_lookup_nodup</span>; <span class="tactic">try</span> <span class="tactic">apply</span> <span class="id">groupby_noDup</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">destruct</span> <span class="id">n</span>; <span class="tactic">intuition</span>. <span class="tactic">apply</span> <span class="id">lookup_none_nin</span> <span class="kwd">in</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H</span>. <span class="id">specialize</span> (<span class="id">IHl</span> <span class="id">_</span> <span class="id">_</span> <span class="id">H3</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">in_dom</span> <span class="kwd">in</span> <span class="id">IHl</span>. <span class="tactic">intuition</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">mult_nin_groupby</span> {<span class="id">l</span> <span class="id">d</span>} : <span class="id">mult</span> <span class="id">l</span> <span class="id">d</span> = 0 -&gt; ~ <span class="id">In</span> <span class="id">d</span> (<span class="id">domain</span> (<span class="id">groupby</span> <span class="id">l</span>)).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof687')">Proof.</div>
<div class="proofscript" id="proof687">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">mu</span> <span class="id">ind</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">in_domain_in</span> <span class="id">ind</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> (<span class="id">groupby_mult_in</span> <span class="id">H</span>) <span class="kwd">in</span> <span class="id">mu</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">generalize</span> (<span class="id">groupby_mult_in_pos</span> <span class="id">H</span>); <span class="tactic">intuition</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
&nbsp;&nbsp;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">bags_same_mult_has_equal</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">l1</span> <span class="id">l2</span>:<span class="id">list</span> <span class="id">A</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">forall</span> (<span class="id">a</span>:<span class="id">A</span>), (<span class="id">mult</span> <span class="id">l1</span> <span class="id">a</span>) = (<span class="id">mult</span> <span class="id">l2</span> <span class="id">a</span>)) -&gt;  (<span class="id">l1</span> ≅ <span class="id">l2</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof688')">Proof.</div>
<div class="proofscript" id="proof688">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">red</span>. <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- (<span class="id">smush_groupby</span> <span class="id">l1</span>), &lt;- (<span class="id">smush_groupby</span> <span class="id">l2</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">smush_perm_proper</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">NoDup_Permutation</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">apply</span> <span class="id">NoDup_domain_NoDup</span>; <span class="tactic">apply</span> <span class="id">groupby_noDup</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">apply</span> <span class="id">NoDup_domain_NoDup</span>; <span class="tactic">apply</span> <span class="id">groupby_noDup</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">intros</span>. <span class="tactic">destruct</span> <span class="id">x</span>. <span class="tactic">destruct</span> <span class="id">n</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">split</span>; <span class="tactic">intros</span> <span class="id">HH</span>; <span class="tactic">elim</span> (<span class="id">groupby_mult_in_pos</span> <span class="id">HH</span>); <span class="tactic">trivial</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">split</span>; <span class="tactic">intros</span> <span class="id">HH</span>; <span class="tactic">apply</span> <span class="id">groupby_mult_in</span> <span class="kwd">in</span> <span class="id">HH</span>; <span class="tactic">apply</span> <span class="id">mult_in_groupby</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">congruence</span>. <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">End</span> <span class="id">MBag</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id">bmin</span> (<span class="id">l1</span> <span class="id">l2</span>:<span class="id">list</span> <span class="id">A</span>) :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">l1</span> ⊖ (<span class="id">l1</span> ⊖ <span class="id">l2</span>).<br/>
&nbsp;&nbsp;<span class="kwd">Notation</span> "<span class="id">b1</span> <span class="id">min</span>-<span class="id">b</span> <span class="id">b2</span>" := (<span class="id">bmin</span> <span class="id">b1</span> <span class="id">b2</span>) (<span class="id">right</span> <span class="id">associativity</span>, <span class="tactic">at</span> <span class="id">level</span> 70) : <span class="id">rbag_scope</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id">bmax</span> (<span class="id">l1</span> <span class="id">l2</span>:<span class="id">list</span> <span class="id">A</span>) :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">l1</span> ⊎ (<span class="id">l2</span> ⊖ <span class="id">l1</span>).<br/>
&nbsp;&nbsp;<span class="kwd">Notation</span> "<span class="id">b1</span> <span class="id">max</span>-<span class="id">b</span> <span class="id">b2</span>" := (<span class="id">bmax</span> <span class="id">b1</span> <span class="id">b2</span>) (<span class="id">right</span> <span class="id">associativity</span>, <span class="tactic">at</span> <span class="id">level</span> 70) : <span class="id">rbag_scope</span>.<br/>
<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id">bcount</span> (<span class="id">l</span>:<span class="id">list</span> <span class="id">A</span>) := <span class="id">length</span> <span class="id">l</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Fixpoint</span> <span class="id">bdistinct</span> (<span class="id">l</span>:<span class="id">list</span> <span class="id">A</span>) :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">l</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">nil</span> =&gt; <span class="id">nil</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">x</span> :: <span class="id">l</span>' =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">dl</span>' := <span class="id">bdistinct</span> <span class="id">l</span>' <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">mult</span> <span class="id">dl</span>' <span class="id">x</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">O</span> =&gt; <span class="id">x</span> :: <span class="id">dl</span>'<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">_</span> =&gt; <span class="id">dl</span>'<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">bdistinct_sublist</span> <span class="id">l</span> : <span class="id">sublist</span> (<span class="id">bdistinct</span> <span class="id">l</span>) <span class="id">l</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof689')">Proof.</div>
<div class="proofscript" id="proof689">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">l</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">match_destr</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">apply</span> <span class="id">sublist_cons</span>; <span class="tactic">trivial</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">apply</span> <span class="id">sublist_skip</span>; <span class="tactic">trivial</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">bdistinct_Forall</span> {<span class="id">P</span>} {<span class="id">l</span>} :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Forall</span> <span class="id">P</span> <span class="id">l</span> -&gt; <span class="id">Forall</span> <span class="id">P</span> (<span class="id">bdistinct</span> <span class="id">l</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof690')">Proof.</div>
<div class="proofscript" id="proof690">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> (<span class="id">Forall_sublist</span> <span class="id">_</span> <span class="id">_</span> (<span class="id">bdistinct_sublist</span> <span class="id">l</span>)) <span class="kwd">in</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">trivial</span>.<br/>
&nbsp;&nbsp;Qed.</div>
&nbsp;&nbsp;<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">bdistinct_at_most_one</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">l</span>:<span class="id">list</span> <span class="id">A</span>), <span class="kwd">forall</span> (<span class="id">x</span>:<span class="id">A</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">mult</span> (<span class="id">bdistinct</span> <span class="id">l</span>) <span class="id">x</span>) = 0 \/ (<span class="id">mult</span> (<span class="id">bdistinct</span> <span class="id">l</span>) <span class="id">x</span>) = 1.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof691')">Proof.</div>
<div class="proofscript" id="proof691">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">l</span>; <span class="tactic">simpl</span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">left</span>; <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">generalize</span> (<span class="id">IHl</span> <span class="id">x</span>); <span class="tactic">generalize</span> (<span class="id">IHl</span> <span class="id">a</span>); <span class="tactic">intros</span>; <span class="tactic">clear</span> <span class="id">IHl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">elim</span> <span class="id">H0</span>; <span class="tactic">intro</span>; <span class="tactic">clear</span> <span class="id">H0</span>; <span class="tactic">elim</span> <span class="id">H</span>; <span class="tactic">intro</span>; <span class="tactic">clear</span> <span class="id">H</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">try</span> <span class="tactic">rewrite</span> <span class="id">H0</span>; <span class="tactic">simpl</span>; <span class="tactic">elim</span> (<span class="id">equiv_dec</span> <span class="id">x</span> <span class="id">a</span>); <span class="tactic">intro</span> <span class="id">aH</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">right</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">left</span>; <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">rewrite</span> <span class="id">aH</span> <span class="kwd">in</span> *; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">left</span>; <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">rewrite</span> <span class="id">aH</span> <span class="kwd">in</span> *; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">right</span>; <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">right</span>; <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">right</span>; <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Global</span> <span class="kwd">Instance</span> <span class="id">bdistinct_proper</span> : <span class="id">Proper</span> (<span class="id">ldeqA</span> ==&gt; <span class="id">ldeqA</span>) <span class="id">bdistinct</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof692')">Proof.</div>
<div class="proofscript" id="proof692">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">Proper</span>, <span class="id">respectful</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">generalize</span> <span class="id">bags_equal_same_mult1</span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">elim</span> <span class="id">H</span>; <span class="tactic">simpl</span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">apply</span> <span class="id">bags_same_mult_has_equal</span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> ((<span class="id">mult</span> (<span class="id">bdistinct</span> <span class="id">l</span>) <span class="id">x0</span>) = (<span class="id">mult</span> (<span class="id">bdistinct</span> <span class="id">l</span>') <span class="id">x0</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">H0</span>; <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">H0</span>; <span class="tactic">rewrite</span> <span class="id">H3</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">generalize</span> <span class="id">bdistinct_at_most_one</span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">elim</span> (<span class="id">H4</span> <span class="id">l</span>' <span class="id">x0</span>); <span class="tactic">intros</span>; <span class="tactic">clear</span> <span class="id">H4</span>; <span class="tactic">rewrite</span> <span class="id">H5</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H2</span>; <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">apply</span> <span class="id">bags_same_mult_has_equal</span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (((<span class="id">mult</span> (<span class="id">bdistinct</span> <span class="id">l</span>) <span class="id">x0</span>) = 0) \/ ((<span class="id">mult</span> (<span class="id">bdistinct</span> <span class="id">l</span>) <span class="id">x0</span>) = 1)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">bdistinct_at_most_one</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (((<span class="id">mult</span> (<span class="id">bdistinct</span> <span class="id">l</span>) <span class="id">y0</span>) = 0) \/ ((<span class="id">mult</span> (<span class="id">bdistinct</span> <span class="id">l</span>) <span class="id">y0</span>) = 1)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">bdistinct_at_most_one</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">elim</span> <span class="id">H1</span>; <span class="tactic">intros</span>; <span class="tactic">clear</span> <span class="id">H1</span>; <span class="tactic">elim</span> <span class="id">H2</span>; <span class="tactic">intros</span>; <span class="tactic">clear</span> <span class="id">H2</span>; <span class="tactic">rewrite</span> <span class="id">H3</span>; <span class="tactic">rewrite</span> <span class="id">H1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">elim</span> (<span class="id">equiv_dec</span> <span class="id">y0</span> <span class="id">x0</span>); <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">a0</span> <span class="kwd">in</span> *; <span class="tactic">clear</span> <span class="id">a0</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">elim</span> (<span class="id">equiv_dec</span> <span class="id">a</span> <span class="id">x0</span>); <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">elim</span> (<span class="id">equiv_dec</span> <span class="id">x0</span> <span class="id">x0</span>); <span class="tactic">intros</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">elim</span> (<span class="id">equiv_dec</span> <span class="id">a</span> <span class="id">x0</span>); <span class="tactic">intros</span>; <span class="tactic">try</span> <span class="tactic">reflexivity</span>; <span class="tactic">try</span> <span class="id">contradiction</span>; <span class="tactic">try</span> <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">elim</span> (<span class="id">equiv_dec</span> <span class="id">x0</span> <span class="id">x0</span>); <span class="tactic">intros</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">elim</span> (<span class="id">equiv_dec</span> <span class="id">a</span> <span class="id">x0</span>); <span class="tactic">intros</span>; <span class="tactic">try</span> <span class="tactic">reflexivity</span>; <span class="tactic">try</span> <span class="id">contradiction</span>; <span class="tactic">try</span> <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H3</span>; <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">elim</span> (<span class="id">equiv_dec</span> <span class="id">x0</span> <span class="id">x0</span>); <span class="tactic">intros</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">elim</span> (<span class="id">equiv_dec</span> <span class="id">a</span> <span class="id">x0</span>); <span class="tactic">intros</span>; <span class="tactic">try</span> <span class="tactic">reflexivity</span>; <span class="tactic">try</span> <span class="id">contradiction</span>; <span class="tactic">try</span> <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H3</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">elim</span> (<span class="id">equiv_dec</span> <span class="id">x0</span> <span class="id">y0</span>); <span class="tactic">intros</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H3</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">elim</span> (<span class="id">equiv_dec</span> <span class="id">a</span> <span class="id">y0</span>); <span class="tactic">intros</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">elim</span> (<span class="id">equiv_dec</span> <span class="id">a</span> <span class="id">x0</span>); <span class="tactic">intros</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">elim</span> (<span class="id">equiv_dec</span> <span class="id">a</span> <span class="id">y0</span>); <span class="tactic">intros</span>; <span class="tactic">try</span> <span class="tactic">reflexivity</span>; <span class="tactic">try</span> <span class="id">contradiction</span>; <span class="tactic">try</span> <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">elim</span> (<span class="id">equiv_dec</span> <span class="id">a</span> <span class="id">y0</span>); <span class="tactic">intros</span>; <span class="tactic">try</span> <span class="tactic">reflexivity</span>; <span class="tactic">try</span> <span class="id">contradiction</span>; <span class="tactic">try</span> <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">elim</span> (<span class="id">equiv_dec</span> <span class="id">a</span> <span class="id">x0</span>); <span class="tactic">intros</span>; <span class="tactic">try</span> <span class="tactic">reflexivity</span>; <span class="tactic">try</span> <span class="id">contradiction</span>; <span class="tactic">try</span> <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">elim</span> (<span class="id">equiv_dec</span> <span class="id">a</span> <span class="id">y0</span>); <span class="tactic">intros</span>; <span class="tactic">try</span> <span class="tactic">reflexivity</span>; <span class="tactic">try</span> <span class="id">contradiction</span>; <span class="tactic">try</span> <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">elim</span> (<span class="id">equiv_dec</span> <span class="id">a</span> <span class="id">y0</span>); <span class="tactic">intros</span>; <span class="tactic">try</span> <span class="tactic">reflexivity</span>; <span class="tactic">try</span> <span class="id">contradiction</span>; <span class="tactic">try</span> <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">simpl</span>; <span class="tactic">rewrite</span> <span class="id">H3</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">elim</span> (<span class="id">equiv_dec</span> <span class="id">y0</span> <span class="id">x0</span>); <span class="tactic">intros</span>; <span class="tactic">simpl</span>; <span class="tactic">try</span> <span class="tactic">reflexivity</span>; <span class="tactic">try</span> <span class="id">contradiction</span>; <span class="tactic">try</span> <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">elim</span> (<span class="id">equiv_dec</span> <span class="id">a</span> <span class="id">y0</span>); <span class="tactic">intros</span>; <span class="tactic">try</span> <span class="tactic">reflexivity</span>; <span class="tactic">try</span> <span class="id">contradiction</span>; <span class="tactic">try</span> <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">elim</span> (<span class="id">equiv_dec</span> <span class="id">a</span> <span class="id">y0</span>); <span class="tactic">intros</span>; <span class="tactic">try</span> <span class="tactic">reflexivity</span>; <span class="tactic">try</span> <span class="id">contradiction</span>; <span class="tactic">try</span> <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">elim</span> (<span class="id">equiv_dec</span> <span class="id">x0</span> <span class="id">y0</span>); <span class="tactic">intros</span>; <span class="tactic">simpl</span>; <span class="tactic">try</span> <span class="tactic">reflexivity</span>; <span class="tactic">try</span> <span class="id">contradiction</span>; <span class="tactic">try</span> <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H3</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">elim</span> (<span class="id">equiv_dec</span> <span class="id">a</span> <span class="id">y0</span>); <span class="tactic">intros</span>; <span class="tactic">try</span> <span class="tactic">reflexivity</span>; <span class="tactic">try</span> <span class="id">contradiction</span>; <span class="tactic">try</span> <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">elim</span> (<span class="id">equiv_dec</span> <span class="id">x0</span> <span class="id">y0</span>); <span class="tactic">intros</span>; <span class="tactic">simpl</span>; <span class="tactic">try</span> <span class="tactic">reflexivity</span>; <span class="tactic">try</span> <span class="id">contradiction</span>; <span class="tactic">try</span> <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H3</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">elim</span> (<span class="id">equiv_dec</span> <span class="id">a</span> <span class="id">y0</span>); <span class="tactic">intros</span>; <span class="tactic">try</span> <span class="tactic">reflexivity</span>; <span class="tactic">try</span> <span class="id">contradiction</span>; <span class="tactic">try</span> <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">rewrite</span> <span class="id">H3</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">apply</span> <span class="id">perm_trans</span> <span class="kwd">with</span> (<span class="id">l</span>' := <span class="id">bdistinct</span> <span class="id">l</span>'); <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;Qed.</div>
&nbsp;&nbsp;<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">bdistinct_exactly_zero</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">l</span>:<span class="id">list</span> <span class="id">A</span>), <span class="kwd">forall</span> (<span class="id">x</span>:<span class="id">A</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">mult</span> <span class="id">l</span> <span class="id">x</span>) = 0 -&gt; (<span class="id">mult</span> (<span class="id">bdistinct</span> <span class="id">l</span>) <span class="id">x</span>) = 0.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof693')">Proof.</div>
<div class="proofscript" id="proof693">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">l</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>; <span class="tactic">simpl</span>; <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intro</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">elim</span> (<span class="id">equiv_dec</span> <span class="id">x</span> <span class="id">a</span>); <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">assert</span> (((<span class="id">mult</span> (<span class="id">bdistinct</span> <span class="id">l</span>) <span class="id">a</span>) = 0) \/ ((<span class="id">mult</span> (<span class="id">bdistinct</span> <span class="id">l</span>) <span class="id">a</span>) = 1)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">bdistinct_at_most_one</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">elim</span> <span class="id">H0</span>; <span class="tactic">intros</span>; <span class="tactic">rewrite</span> <span class="id">H1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">elim</span> (<span class="id">equiv_dec</span> <span class="id">x</span> <span class="id">a</span>); <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">contradiction</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">apply</span> <span class="id">IHl</span>; <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">apply</span> <span class="id">IHl</span>; <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">bdistinct_exactly_zero_back</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">l</span>:<span class="id">list</span> <span class="id">A</span>), <span class="kwd">forall</span> (<span class="id">x</span>:<span class="id">A</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">mult</span> (<span class="id">bdistinct</span> <span class="id">l</span>) <span class="id">x</span>) = 0 -&gt; (<span class="id">mult</span> <span class="id">l</span> <span class="id">x</span>) = 0.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof694')">Proof.</div>
<div class="proofscript" id="proof694">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">generalize</span> (<span class="id">pick_an_a_or_absent</span> <span class="id">l</span> <span class="id">x</span>); <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">elim</span> <span class="id">H0</span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">elim</span> <span class="id">H1</span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> ((<span class="id">mult</span> (<span class="id">bdistinct</span> (<span class="id">x</span> :: <span class="id">x0</span>)) <span class="id">x</span>) = 0).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">bags_equal_same_mult1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H2</span>; <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">H3</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (((<span class="id">mult</span> (<span class="id">bdistinct</span> <span class="id">x0</span>) <span class="id">x</span>) = 0) \/ ((<span class="id">mult</span> (<span class="id">bdistinct</span> <span class="id">x0</span>) <span class="id">x</span>) = 1)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">bdistinct_at_most_one</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">elim</span> <span class="id">H4</span>; <span class="tactic">intros</span>; <span class="tactic">clear</span> <span class="id">H4</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H5</span> <span class="kwd">in</span> <span class="id">H3</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">H3</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">revert</span> <span class="id">H3</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">elim</span> (<span class="id">equiv_dec</span> <span class="id">x</span> <span class="id">x</span>); <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H5</span> <span class="kwd">in</span> <span class="id">H3</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">bdistinct_exactly_one</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">l</span>:<span class="id">list</span> <span class="id">A</span>), <span class="kwd">forall</span> (<span class="id">x</span>:<span class="id">A</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">mult</span> <span class="id">l</span> <span class="id">x</span>) &lt;&gt; 0 -&gt; (<span class="id">mult</span> (<span class="id">bdistinct</span> <span class="id">l</span>) <span class="id">x</span>) = 1.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof695')">Proof.</div>
<div class="proofscript" id="proof695">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">generalize</span> (<span class="id">bdistinct_at_most_one</span> <span class="id">l</span> <span class="id">x</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">elim</span> <span class="id">H0</span>; <span class="tactic">intro</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> <span class="id">False</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">bdistinct_exactly_zero_back</span>; <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">contradiction</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">bdistinct_exactly_one_back</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">l</span>:<span class="id">list</span> <span class="id">A</span>), <span class="kwd">forall</span> (<span class="id">x</span>:<span class="id">A</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">mult</span> (<span class="id">bdistinct</span> <span class="id">l</span>) <span class="id">x</span>) = 1 -&gt; (<span class="id">mult</span> <span class="id">l</span> <span class="id">x</span>) &lt;&gt; 0.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof696')">Proof.</div>
<div class="proofscript" id="proof696">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">l</span>; <span class="tactic">simpl</span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (((<span class="id">mult</span> (<span class="id">bdistinct</span> <span class="id">l</span>) <span class="id">a</span>) = 0) \/ ((<span class="id">mult</span> (<span class="id">bdistinct</span> <span class="id">l</span>) <span class="id">a</span>) = 1)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">bdistinct_at_most_one</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">revert</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">elim</span> <span class="id">H0</span>; <span class="tactic">intro</span>; <span class="tactic">clear</span> <span class="id">H0</span>; <span class="tactic">rewrite</span> <span class="id">H</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">elim</span> (<span class="id">equiv_dec</span> <span class="id">x</span> <span class="id">a</span>); <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">a0</span> <span class="kwd">in</span> *; <span class="tactic">clear</span> <span class="id">a0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">IHl</span>; <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">elim</span> (<span class="id">equiv_dec</span> <span class="id">x</span> <span class="id">a</span>); <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">a0</span> <span class="kwd">in</span> *; <span class="tactic">clear</span> <span class="id">a0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">IHl</span>; <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">bdistinct_exactly_one_back_diff</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">l</span>:<span class="id">list</span> <span class="id">A</span>), <span class="kwd">forall</span> (<span class="id">x</span>:<span class="id">A</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">mult</span> (<span class="id">bdistinct</span> <span class="id">l</span>) <span class="id">x</span>) = 1 -&gt; (<span class="id">mult</span> <span class="id">l</span> <span class="id">x</span>) &gt;= 1.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof697')">Proof.</div>
<div class="proofscript" id="proof697">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> ((<span class="id">mult</span> <span class="id">l</span> <span class="id">x</span>) &lt;&gt; 0). <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">bdistinct_exactly_one_back</span>; <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">omega</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">exist_or_zero</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">s</span>:<span class="id">list</span> <span class="id">A</span>), <span class="kwd">forall</span> (<span class="id">x</span>:<span class="id">A</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">exists</span> (<span class="id">rs</span>:<span class="id">list</span> <span class="id">A</span>), (<span class="id">x</span>::<span class="id">rs</span>) ≅ <span class="id">s</span>) \/ (<span class="id">mult</span> <span class="id">s</span> <span class="id">x</span>) = 0.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof698')">Proof.</div>
<div class="proofscript" id="proof698">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">s</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">right</span>; <span class="tactic">simpl</span>; <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">intros</span>. <span class="tactic">destruct</span> (<span class="id">equiv_dec</span> <span class="id">x</span> <span class="id">a</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">left</span>; <span class="tactic">elim</span> (<span class="id">IHs</span> <span class="id">a</span>); <span class="tactic">intro</span>; <span class="tactic">elim</span> <span class="id">H</span>; <span class="tactic">intros</span>; <span class="tactic">rewrite</span> <span class="id">e</span> <span class="kwd">in</span> *; <span class="id">exists</span> <span class="id">s</span>; <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">elim</span> (<span class="id">IHs</span> <span class="id">x</span>); <span class="tactic">intro</span>; <span class="tactic">elim</span> <span class="id">H</span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">left</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> (<span class="id">a</span>::<span class="id">x0</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">perm_swap</span>; <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">right</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">equiv_dec</span> <span class="id">x</span> <span class="id">a</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">contradiction</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">bdistinct_mult</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">l</span>:<span class="id">list</span> <span class="id">A</span>), <span class="kwd">forall</span> (<span class="id">x</span>:<span class="id">A</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">mult</span> (<span class="id">bdistinct</span> <span class="id">l</span>) <span class="id">x</span> = <span class="id">min</span> (<span class="id">mult</span> <span class="id">l</span> <span class="id">x</span>) 1.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof699')">Proof.</div>
<div class="proofscript" id="proof699">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">l</span>; <span class="tactic">simpl</span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">elim</span> (<span class="id">equiv_dec</span> <span class="id">x</span> <span class="id">a</span>); <span class="tactic">intro</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">a0</span> <span class="kwd">in</span> *; <span class="tactic">clear</span> <span class="id">a0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">generalize</span> (<span class="id">IHl</span> <span class="id">a</span>); <span class="tactic">intro</span>; <span class="tactic">rewrite</span> <span class="id">H</span>; <span class="tactic">clear</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">generalize</span> (<span class="id">exist_or_zero</span> <span class="id">l</span> <span class="id">a</span>); <span class="tactic">intro</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">elim</span> <span class="id">H</span>; <span class="tactic">intro</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">elim</span> <span class="id">H0</span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">min</span> (<span class="id">mult</span> <span class="id">l</span> <span class="id">a</span>) 1 = 1).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">H1</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">elim</span> (<span class="id">equiv_dec</span> <span class="id">a</span> <span class="id">a</span>); <span class="tactic">intro</span>; <span class="tactic">try</span> <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">generalize</span> (<span class="id">mult</span> <span class="id">x0</span> <span class="id">a</span>); <span class="tactic">intro</span>; <span class="tactic">auto</span> <span class="kwd">with</span> <span class="id">arith</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">IHl</span>; <span class="tactic">rewrite</span> <span class="id">H2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">generalize</span> (<span class="id">mult</span> <span class="id">l</span> <span class="id">a</span>); <span class="tactic">intro</span>; <span class="tactic">rewrite</span> &lt;- <span class="id">succ_min_distr</span>; <span class="tactic">auto</span> <span class="kwd">with</span> <span class="id">arith</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H0</span>; <span class="tactic">rewrite</span> <span class="id">min_0_l</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">elim</span> (<span class="id">equiv_dec</span> <span class="id">a</span> <span class="id">a</span>); <span class="tactic">intro</span>; <span class="tactic">try</span> <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">IHl</span>; <span class="tactic">rewrite</span> <span class="id">H0</span>; <span class="tactic">auto</span> <span class="kwd">with</span> <span class="id">arith</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">IHl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">generalize</span> (<span class="id">min_against_one</span> (<span class="id">mult</span> <span class="id">l</span> <span class="id">a</span>)); <span class="tactic">intro</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">elim</span> <span class="id">H</span>; <span class="tactic">intro</span>; <span class="tactic">clear</span> <span class="id">H</span>; <span class="tactic">rewrite</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>; <span class="tactic">elim</span> (<span class="id">equiv_dec</span> <span class="id">x</span> <span class="id">a</span>); <span class="tactic">intro</span>; <span class="tactic">try</span> <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">IHl</span>; <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">mult_pos_equiv_in</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">l</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">x</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">mult</span> <span class="id">l</span> <span class="id">x</span> &gt; 0 &lt;-&gt; <span class="id">In</span> <span class="id">x</span> <span class="id">l</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof700')">Proof.</div>
<div class="proofscript" id="proof700">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="comment">(*&nbsp;Case&nbsp;"-&gt;"&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">l</span>; <span class="tactic">simpl</span>; <span class="tactic">try</span> <span class="tactic">omega</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">case</span> (<span class="id">equiv_dec</span> <span class="id">x</span> <span class="id">a</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">intros</span> <span class="id">Hx</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Hx</span> <span class="kwd">in</span> *; <span class="tactic">clear</span> <span class="id">Hx</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">left</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">intros</span> <span class="id">Hx</span> <span class="id">Hl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">right</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">IHl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="comment">(*&nbsp;Case&nbsp;"&lt;-"&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">l</span>; <span class="tactic">simpl</span>; <span class="tactic">try</span> <span class="id">contradiction</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">Hx</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Hx</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">rewrite</span> <span class="id">H</span> <span class="kwd">in</span> *; <span class="tactic">clear</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">case</span> (<span class="id">equiv_dec</span> <span class="id">x</span> <span class="id">x</span>); <span class="tactic">try</span> <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">gt_Sn_O</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">case</span> (<span class="id">equiv_dec</span> <span class="id">x</span> <span class="id">a</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">gt_Sn_O</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">IHl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">bdistinct_same_elemts</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">l</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">x</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">In</span> <span class="id">x</span> <span class="id">l</span> -&gt; <span class="id">In</span> <span class="id">x</span> (<span class="id">bdistinct</span> <span class="id">l</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof701')">Proof.</div>
<div class="proofscript" id="proof701">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">l</span> <span class="id">x</span> <span class="id">Hx</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">mult_pos_equiv_in</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">mult_pos_equiv_in</span> <span class="kwd">in</span> <span class="id">Hx</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">bdistinct_mult</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">min_case</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">bdistinct_nil</span> {<span class="id">l</span>:<span class="id">list</span> <span class="id">A</span>} :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">bdistinct</span> <span class="id">l</span> = <span class="id">nil</span> -&gt; <span class="id">l</span> = <span class="id">nil</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof702')">Proof.</div>
<div class="proofscript" id="proof702">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">l</span>; <span class="tactic">simpl</span>; <span class="tactic">trivial</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">bdistinct</span> <span class="id">l</span>); <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">discriminate</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">match_destr</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">bdistinct_NoDup</span> (<span class="id">l</span> : <span class="id">list</span> <span class="id">A</span>) :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">NoDup</span> (<span class="id">bdistinct</span> <span class="id">l</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof703')">Proof.</div>
<div class="proofscript" id="proof703">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">l</span>; <span class="tactic">simpl</span>; [<span class="id">constructor</span> | ].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">match_case</span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">constructor</span>; <span class="tactic">trivial</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">mult_pos_equiv_in</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">omega</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">NoDup_bdistinct</span> {<span class="id">l</span>:<span class="id">list</span> <span class="id">A</span>} :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">NoDup</span> <span class="id">l</span> -&gt; <span class="id">bdistinct</span> <span class="id">l</span> = <span class="id">l</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof704')">Proof.</div>
<div class="proofscript" id="proof704">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">l</span>; <span class="tactic">simpl</span>; <span class="tactic">trivial</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> 1; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">IHl</span> <span class="tactic">by</span> <span class="tactic">trivial</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">mult_pos_equiv_in</span> <span class="kwd">in</span> <span class="id">H2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">match_case</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>; <span class="tactic">omega</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">bdistinct_idem</span> {<span class="id">l</span>:<span class="id">list</span> <span class="id">A</span>} :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">bdistinct</span> (<span class="id">bdistinct</span> <span class="id">l</span>) = <span class="id">bdistinct</span> <span class="id">l</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof705')">Proof.</div>
<div class="proofscript" id="proof705">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> (@<span class="id">NoDup_bdistinct</span> (<span class="id">bdistinct</span> <span class="id">l</span>)); <span class="tactic">trivial</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">bdistinct_NoDup</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">bdistinct_equivlist</span>  (<span class="id">l</span> : <span class="id">list</span> <span class="id">A</span>) :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">equivlist</span> <span class="id">l</span> (<span class="id">bdistinct</span> <span class="id">l</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof706')">Proof.</div>
<div class="proofscript" id="proof706">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">equivlist_incls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">intros</span> ? <span class="id">inn</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">bdistinct_same_elemts</span>; <span class="tactic">trivial</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">rewrite</span> <span class="id">bdistinct_sublist</span>; <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">fold_right_bdistinct</span> (<span class="id">f</span> : <span class="id">A</span> -&gt; <span class="id">A</span> -&gt; <span class="id">A</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">assoc</span>:<span class="kwd">forall</span> <span class="id">x</span> <span class="id">y</span> <span class="id">z</span> : <span class="id">A</span>, <span class="id">f</span> <span class="id">x</span> (<span class="id">f</span> <span class="id">y</span> <span class="id">z</span>) = <span class="id">f</span> (<span class="id">f</span> <span class="id">x</span> <span class="id">y</span>) <span class="id">z</span>) <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">comm</span>:<span class="kwd">forall</span> <span class="id">x</span> <span class="id">y</span> : <span class="id">A</span>, <span class="id">f</span> <span class="id">x</span> <span class="id">y</span> = <span class="id">f</span> <span class="id">y</span> <span class="id">x</span>) <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">idem</span>:<span class="kwd">forall</span> <span class="id">x</span>  : <span class="id">A</span>, <span class="id">f</span> <span class="id">x</span> <span class="id">x</span> = <span class="id">x</span>) (<span class="id">l</span>:<span class="id">list</span> <span class="id">A</span>) (<span class="id">unit</span>:<span class="id">A</span>) :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">fold_right</span> <span class="id">f</span> <span class="id">unit</span> <span class="id">l</span> = <span class="id">fold_right</span> <span class="id">f</span> <span class="id">unit</span> (<span class="id">bdistinct</span> <span class="id">l</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof707')">Proof.</div>
<div class="proofscript" id="proof707">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">l</span>; <span class="tactic">simpl</span>; <span class="tactic">trivial</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">match_case</span>; <span class="tactic">simpl</span>; <span class="tactic">rewrite</span> <span class="id">IHl</span>; <span class="tactic">trivial</span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">inn</span>:<span class="id">In</span> <span class="id">a</span> (<span class="id">bdistinct</span> <span class="id">l</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">by</span> (<span class="tactic">apply</span> <span class="id">mult_pos_equiv_in</span>; <span class="tactic">omega</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">in_split</span> <span class="id">_</span> <span class="id">_</span> <span class="id">inn</span>) <span class="kwd">as</span> [<span class="id">t1</span> [<span class="id">t2</span> <span class="id">teq</span>]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">teq</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">perm</span>:<span class="id">Permutation</span> (<span class="id">t1</span> ++ <span class="id">a</span> :: <span class="id">t2</span>) (<span class="id">a</span>::<span class="id">t1</span>++ <span class="id">t2</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">by</span> (<span class="tactic">rewrite</span> <span class="id">Permutation_middle</span>; <span class="tactic">reflexivity</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> (<span class="id">fold_right_perm</span> <span class="id">_</span> <span class="id">assoc</span> <span class="id">comm</span> (<span class="id">t1</span> ++ <span class="id">a</span> :: <span class="id">t2</span>) (<span class="id">a</span> :: <span class="id">t1</span> ++ <span class="id">t2</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">by</span> <span class="tactic">trivial</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">assoc</span>, <span class="id">idem</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">trivial</span>.<br/>
&nbsp;&nbsp;Qed.</div>
&nbsp;&nbsp;<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">fold_right_equivlist</span> (<span class="id">f</span> : <span class="id">A</span> -&gt; <span class="id">A</span> -&gt; <span class="id">A</span>)<br/>
&nbsp;&nbsp;(<span class="id">assoc</span>:<span class="kwd">forall</span> <span class="id">x</span> <span class="id">y</span> <span class="id">z</span> : <span class="id">A</span>, <span class="id">f</span> <span class="id">x</span> (<span class="id">f</span> <span class="id">y</span> <span class="id">z</span>) = <span class="id">f</span> (<span class="id">f</span> <span class="id">x</span> <span class="id">y</span>) <span class="id">z</span>) <br/>
&nbsp;&nbsp;(<span class="id">comm</span>:<span class="kwd">forall</span> <span class="id">x</span> <span class="id">y</span> : <span class="id">A</span>, <span class="id">f</span> <span class="id">x</span> <span class="id">y</span> = <span class="id">f</span> <span class="id">y</span> <span class="id">x</span>) <br/>
&nbsp;&nbsp;(<span class="id">idem</span>:<span class="kwd">forall</span> <span class="id">x</span>  : <span class="id">A</span>, <span class="id">f</span> <span class="id">x</span> <span class="id">x</span> = <span class="id">x</span>) (<span class="id">l1</span> <span class="id">l2</span>:<span class="id">list</span> <span class="id">A</span>) (<span class="id">unit</span>:<span class="id">A</span>) :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">equivlist</span> <span class="id">l1</span> <span class="id">l2</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">fold_right</span> <span class="id">f</span> <span class="id">unit</span> <span class="id">l1</span> = <span class="id">fold_right</span> <span class="id">f</span> <span class="id">unit</span> <span class="id">l2</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof708')">Proof.</div>
<div class="proofscript" id="proof708">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> (<span class="id">fold_right_bdistinct</span> <span class="id">_</span> <span class="id">assoc</span> <span class="id">comm</span> <span class="id">idem</span> <span class="id">l1</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> (<span class="id">fold_right_bdistinct</span> <span class="id">_</span> <span class="id">assoc</span> <span class="id">comm</span> <span class="id">idem</span> <span class="id">l2</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">fold_right_perm</span>; <span class="tactic">trivial</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">NoDup_Permutation</span>'; <span class="tactic">trivial</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">apply</span> <span class="id">bdistinct_NoDup</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">apply</span> <span class="id">bdistinct_NoDup</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">repeat</span> <span class="tactic">rewrite</span> &lt;- <span class="id">bdistinct_equivlist</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">trivial</span>.<br/>
&nbsp;&nbsp;Qed.</div>
&nbsp;&nbsp;<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">bunion_mult</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">s</span> <span class="id">t</span>:<span class="id">list</span> <span class="id">A</span>), <span class="kwd">forall</span> (<span class="id">x</span>:<span class="id">A</span>), <span class="id">mult</span> (<span class="id">s</span> ⊎ <span class="id">t</span>) <span class="id">x</span> = (<span class="id">mult</span> <span class="id">s</span> <span class="id">x</span>) + (<span class="id">mult</span> <span class="id">t</span> <span class="id">x</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof709')">Proof.</div>
<div class="proofscript" id="proof709">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">s</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">unfold</span> <span class="id">bunion</span>; <span class="tactic">rewrite</span> <span class="id">app_nil_l</span>; <span class="tactic">simpl</span>; <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">unfold</span> <span class="id">bunion</span> <span class="kwd">in</span> *; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">equiv_dec</span> <span class="id">x</span> <span class="id">a</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">rewrite</span> <span class="id">IHs</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">remove_one_mult</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">s</span>:<span class="id">list</span> <span class="id">A</span>), <span class="kwd">forall</span> (<span class="id">x</span>:<span class="id">A</span>), <span class="id">mult</span> (<span class="id">remove_one</span> <span class="id">x</span> <span class="id">s</span>) <span class="id">x</span> = <span class="id">pred</span> (<span class="id">mult</span> <span class="id">s</span> <span class="id">x</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof710')">Proof.</div>
<div class="proofscript" id="proof710">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">s</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">destruct</span> (<span class="id">equiv_dec</span> <span class="id">x</span> <span class="id">a</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">equiv_dec</span> <span class="id">x</span> <span class="id">a</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">contradiction</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">mult_on_remove</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">s</span>:<span class="id">list</span> <span class="id">A</span>), <span class="kwd">forall</span> (<span class="id">a</span> <span class="id">x</span>:<span class="id">A</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">x</span> &lt;&gt; <span class="id">a</span> -&gt; <span class="id">mult</span> (<span class="id">remove_one</span> <span class="id">a</span> <span class="id">s</span>) <span class="id">x</span> = <span class="id">mult</span> <span class="id">s</span> <span class="id">x</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof711')">Proof.</div>
<div class="proofscript" id="proof711">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>; <span class="tactic">induction</span> <span class="id">s</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>; <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">elim</span> (<span class="id">equiv_dec</span> <span class="id">a</span> <span class="id">a0</span>); <span class="tactic">intro</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">rewrite</span> <span class="id">a1</span> <span class="kwd">in</span> *; <span class="tactic">clear</span> <span class="id">a1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">elim</span> (<span class="id">equiv_dec</span> <span class="id">x</span> <span class="id">a0</span>); <span class="tactic">intro</span>. <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">a1</span> <span class="kwd">in</span> *; <span class="tactic">clear</span> <span class="id">a1</span>; <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">elim</span> (<span class="id">equiv_dec</span> <span class="id">a</span> <span class="id">a</span>); <span class="tactic">intro</span>; [<span class="tactic">reflexivity</span>|<span class="tactic">congruence</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">elim</span> (<span class="id">equiv_dec</span> <span class="id">x</span> <span class="id">a0</span>); <span class="tactic">intro</span>; <span class="tactic">auto</span>; <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">bminus_mult</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">s</span> <span class="id">t</span>:<span class="id">list</span> <span class="id">A</span>), <span class="kwd">forall</span> (<span class="id">x</span>:<span class="id">A</span>), <span class="id">mult</span> (<span class="id">s</span> ⊖ <span class="id">t</span>) <span class="id">x</span> = (<span class="id">mult</span> <span class="id">s</span> <span class="id">x</span>) - (<span class="id">mult</span> <span class="id">t</span> <span class="id">x</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof712')">Proof.</div>
<div class="proofscript" id="proof712">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>; <span class="id">revert</span> <span class="id">s</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">t</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intro</span>. <span class="tactic">rewrite</span> &lt;- <span class="id">minus_n_O</span>; <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>; <span class="tactic">rewrite</span> <span class="id">IHt</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">equiv_dec</span> <span class="id">x</span> <span class="id">a</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">e</span> <span class="kwd">in</span> *; <span class="tactic">clear</span> <span class="id">e</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">remove_one_mult</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">generalize</span> (<span class="id">exist_or_zero</span> <span class="id">s</span> <span class="id">a</span>); <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">elim</span> <span class="id">H</span>; <span class="tactic">intros</span>; <span class="tactic">clear</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">elim</span> <span class="id">H0</span>; <span class="tactic">intros</span>; <span class="tactic">clear</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">H</span> <span class="kwd">in</span> *; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">elim</span> (<span class="id">equiv_dec</span> <span class="id">a</span> <span class="id">a</span>); <span class="tactic">intro</span>; <span class="tactic">try</span> <span class="tactic">congruence</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H0</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">generalize</span> (<span class="id">mult_on_remove</span> <span class="id">s</span> <span class="id">a</span> <span class="id">x</span>); <span class="tactic">intro</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">complement</span>,<span class="id">equiv</span> <span class="kwd">in</span> <span class="id">c</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;Qed.</div>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">bmin_on_nil_r</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">s</span>:<span class="id">list</span> <span class="id">A</span>), (<span class="id">s</span> <span class="id">min</span>-<span class="id">b</span> <span class="id">nil</span>) = <span class="id">nil</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof713')">Proof.</div>
<div class="proofscript" id="proof713">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">s</span>; <span class="tactic">unfold</span> <span class="id">bmin</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">bminus_naught</span>; <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>; <span class="tactic">destruct</span> (<span class="id">equiv_dec</span> <span class="id">a</span> <span class="id">a</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">bminus_self</span>; <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">bmin_on_nil_l</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">s</span>:<span class="id">list</span> <span class="id">A</span>), (<span class="id">nil</span> <span class="id">min</span>-<span class="id">b</span> <span class="id">s</span>) = <span class="id">nil</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof714')">Proof.</div>
<div class="proofscript" id="proof714">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">s</span>; <span class="tactic">unfold</span> <span class="id">bmin</span>; <span class="tactic">rewrite</span> <span class="id">bminus_to_nil</span>; <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">bmax_on_nil_r</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">s</span>:<span class="id">list</span> <span class="id">A</span>), (<span class="id">s</span> <span class="id">max</span>-<span class="id">b</span> <span class="id">nil</span>) = <span class="id">s</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof715')">Proof.</div>
<div class="proofscript" id="proof715">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">s</span>; <span class="tactic">unfold</span> <span class="id">bmax</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">bminus_naught</span>; <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>; <span class="tactic">destruct</span> (<span class="id">equiv_dec</span> <span class="id">a</span> <span class="id">a</span>); <span class="tactic">rewrite</span> <span class="id">bminus_to_nil</span>; <span class="tactic">rewrite</span> <span class="id">bunion_nil_r</span>; <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">bmax_on_nil_l</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">s</span>:<span class="id">list</span> <span class="id">A</span>), (<span class="id">nil</span> <span class="id">max</span>-<span class="id">b</span> <span class="id">s</span>) = <span class="id">s</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof716')">Proof.</div>
<div class="proofscript" id="proof716">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>; <span class="tactic">unfold</span> <span class="id">bmax</span>; <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">bmin_Forall</span> <span class="id">P</span> (<span class="id">l1</span> <span class="id">l2</span> : <span class="id">list</span> <span class="id">A</span>) :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Forall</span> <span class="id">P</span> <span class="id">l1</span> -&gt; <span class="id">Forall</span> <span class="id">P</span> <span class="id">l2</span> -&gt; <span class="id">Forall</span> <span class="id">P</span> (<span class="id">bmin</span> <span class="id">l1</span> <span class="id">l2</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof717')">Proof.</div>
<div class="proofscript" id="proof717">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">bmin</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="tactic">apply</span> <span class="id">bminus_Forall</span>; <span class="tactic">trivial</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">bmax_Forall</span> <span class="id">P</span> (<span class="id">l1</span> <span class="id">l2</span> : <span class="id">list</span> <span class="id">A</span>) :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Forall</span> <span class="id">P</span> <span class="id">l1</span> -&gt; <span class="id">Forall</span> <span class="id">P</span> <span class="id">l2</span> -&gt; <span class="id">Forall</span> <span class="id">P</span> (<span class="id">bmax</span> <span class="id">l1</span> <span class="id">l2</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof718')">Proof.</div>
<div class="proofscript" id="proof718">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">bmax</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">bunion_Forall</span>; <span class="tactic">trivial</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">bminus_Forall</span>; <span class="tactic">trivial</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">minus_min</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">n</span> <span class="id">n0</span>:<span class="id">nat</span>), <span class="id">n0</span> - (<span class="id">n0</span> - <span class="id">n</span>) = <span class="id">min</span> <span class="id">n0</span> <span class="id">n</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof719')">Proof.</div>
<div class="proofscript" id="proof719">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">n</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>; <span class="tactic">rewrite</span> <span class="id">min_0_r</span>; <span class="tactic">rewrite</span> &lt;- <span class="id">minus_n_O</span>; <span class="tactic">rewrite</span> <span class="id">minus_diag</span>; <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">generalize</span> <span class="id">eq_nat_dec</span>; <span class="tactic">intro</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">elim</span> (<span class="id">H</span> <span class="id">n</span> <span class="id">n0</span>); <span class="tactic">intro</span>; <span class="tactic">clear</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">a</span> <span class="kwd">in</span> *; <span class="tactic">clear</span> <span class="id">a</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">n0</span> &lt;= (<span class="id">S</span> <span class="id">n0</span>)); <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> (<span class="id">min_l</span> <span class="id">n0</span> (<span class="id">S</span> <span class="id">n0</span>) <span class="id">H</span>); <span class="tactic">omega</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">generalize</span> (<span class="id">compare_either</span> <span class="id">n0</span> (<span class="id">S</span> <span class="id">n</span>)); <span class="tactic">intro</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">elim</span> <span class="id">H</span>; <span class="tactic">intro</span>; <span class="tactic">clear</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">rewrite</span> <span class="id">min_l</span>; <span class="tactic">try</span> <span class="tactic">assumption</span>; <span class="tactic">omega</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">rewrite</span> <span class="id">min_r</span>; <span class="tactic">try</span> <span class="tactic">assumption</span>; <span class="tactic">omega</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">minus_max</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">n</span> <span class="id">n0</span>:<span class="id">nat</span>), <span class="id">n0</span> + (<span class="id">n</span> - <span class="id">n0</span>) = <span class="id">max</span> <span class="id">n0</span> <span class="id">n</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof720')">Proof.</div>
<div class="proofscript" id="proof720">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">n</span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">max_0_r</span>; <span class="tactic">auto</span> <span class="kwd">with</span> <span class="id">arith</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">generalize</span> <span class="id">eq_nat_dec</span>; <span class="tactic">intro</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">elim</span> (<span class="id">H</span> <span class="id">n</span> <span class="id">n0</span>); <span class="tactic">intro</span>; <span class="tactic">clear</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">a</span> <span class="kwd">in</span> *; <span class="tactic">clear</span> <span class="id">a</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">n0</span> &lt;= (<span class="id">S</span> <span class="id">n0</span>)); <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> (<span class="id">max_r</span> <span class="id">n0</span> (<span class="id">S</span> <span class="id">n0</span>) <span class="id">H</span>); <span class="tactic">omega</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">generalize</span> (<span class="id">compare_either</span> <span class="id">n0</span> (<span class="id">S</span> <span class="id">n</span>)); <span class="tactic">intro</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">elim</span> <span class="id">H</span>; <span class="tactic">intro</span>; <span class="tactic">clear</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">rewrite</span> <span class="id">max_r</span>; <span class="tactic">try</span> <span class="tactic">assumption</span>; <span class="tactic">omega</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">rewrite</span> <span class="id">max_l</span>; <span class="tactic">try</span> <span class="tactic">assumption</span>; <span class="tactic">omega</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">bmin_mult</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">s</span> <span class="id">t</span>:<span class="id">list</span> <span class="id">A</span>), <span class="kwd">forall</span> (<span class="id">x</span>:<span class="id">A</span>), (<span class="id">mult</span> (<span class="id">s</span> <span class="id">min</span>-<span class="id">b</span> <span class="id">t</span>) <span class="id">x</span>) = <span class="id">min</span> (<span class="id">mult</span> <span class="id">s</span> <span class="id">x</span>) (<span class="id">mult</span> <span class="id">t</span> <span class="id">x</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof721')">Proof.</div>
<div class="proofscript" id="proof721">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">bmin</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="tactic">rewrite</span> <span class="id">bminus_mult</span>; <span class="tactic">induction</span> <span class="id">s</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">elim</span> (<span class="id">equiv_dec</span> <span class="id">x</span> <span class="id">a</span>); <span class="tactic">intro</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">rewrite</span> <span class="id">a0</span> <span class="kwd">in</span> *; <span class="tactic">clear</span> <span class="id">a0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">revert</span> <span class="id">IHs</span>; <span class="tactic">generalize</span> (<span class="id">mult</span> <span class="id">s</span> <span class="id">a</span>); <span class="tactic">generalize</span> (<span class="id">mult</span> <span class="id">t</span> <span class="id">a</span>); <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">minus_min</span>; <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">generalize</span> (<span class="id">mult</span> <span class="id">s</span> <span class="id">x</span>); <span class="tactic">generalize</span> (<span class="id">mult</span> <span class="id">t</span> <span class="id">x</span>); <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">minus_min</span>; <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">bmax_mult</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">s</span> <span class="id">t</span>:<span class="id">list</span> <span class="id">A</span>), <span class="kwd">forall</span> (<span class="id">x</span>:<span class="id">A</span>), (<span class="id">mult</span> (<span class="id">s</span> <span class="id">max</span>-<span class="id">b</span> <span class="id">t</span>) <span class="id">x</span>) = <span class="id">max</span> (<span class="id">mult</span> <span class="id">s</span> <span class="id">x</span>) (<span class="id">mult</span> <span class="id">t</span> <span class="id">x</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof722')">Proof.</div>
<div class="proofscript" id="proof722">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">bmax</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">bunion_mult</span>; <span class="tactic">rewrite</span> <span class="id">bminus_mult</span>; <span class="tactic">induction</span> <span class="id">s</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">auto</span> <span class="kwd">with</span> <span class="id">arith</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">elim</span> (<span class="id">equiv_dec</span> <span class="id">x</span> <span class="id">a</span>); <span class="tactic">intro</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">rewrite</span> <span class="id">a0</span> <span class="kwd">in</span> *; <span class="tactic">clear</span> <span class="id">a0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">revert</span> <span class="id">IHs</span>; <span class="tactic">generalize</span> (<span class="id">mult</span> <span class="id">s</span> <span class="id">a</span>); <span class="tactic">generalize</span> (<span class="id">mult</span> <span class="id">t</span> <span class="id">a</span>); <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">minus_max</span>; <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">generalize</span> (<span class="id">mult</span> <span class="id">s</span> <span class="id">x</span>); <span class="tactic">generalize</span> (<span class="id">mult</span> <span class="id">t</span> <span class="id">x</span>); <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">minus_max</span>; <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">bmin_comm</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">s</span> <span class="id">t</span>:<span class="id">list</span> <span class="id">A</span>), (<span class="id">s</span> <span class="id">min</span>-<span class="id">b</span> <span class="id">t</span>) ≅ (<span class="id">t</span> <span class="id">min</span>-<span class="id">b</span> <span class="id">s</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof723')">Proof.</div>
<div class="proofscript" id="proof723">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">bags_same_mult_has_equal</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intro</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> (<span class="id">bmin_mult</span> <span class="id">s</span> <span class="id">t</span> <span class="id">a</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> (<span class="id">bmin_mult</span> <span class="id">t</span> <span class="id">s</span> <span class="id">a</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">min_comm</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">bmax_comm</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">s</span> <span class="id">t</span>:<span class="id">list</span> <span class="id">A</span>), (<span class="id">s</span> <span class="id">max</span>-<span class="id">b</span> <span class="id">t</span>) ≅ (<span class="id">t</span> <span class="id">max</span>-<span class="id">b</span> <span class="id">s</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof724')">Proof.</div>
<div class="proofscript" id="proof724">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">bags_same_mult_has_equal</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intro</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> (<span class="id">bmax_mult</span> <span class="id">s</span> <span class="id">t</span> <span class="id">a</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> (<span class="id">bmax_mult</span> <span class="id">t</span> <span class="id">s</span> <span class="id">a</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">max_comm</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">select_not_select</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">p</span>:<span class="id">A</span> -&gt; <span class="id">bool</span>), <span class="kwd">forall</span> (<span class="id">s</span>:<span class="id">list</span> <span class="id">A</span>), <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;((<span class="id">filter</span> <span class="id">p</span> <span class="id">s</span>) ⊎ (<span class="id">filter</span> (<span class="kwd">fun</span> <span class="id">x</span> =&gt; <span class="id">negb</span> (<span class="id">p</span> <span class="id">x</span>)) <span class="id">s</span>)) ≅ <span class="id">s</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof725')">Proof.</div>
<div class="proofscript" id="proof725">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">s</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>; <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">generalize</span> (<span class="id">two_cases</span> <span class="id">p</span> <span class="id">a</span>); <span class="tactic">intro</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">elim</span> <span class="id">H</span>; <span class="tactic">intro</span>; <span class="tactic">rewrite</span> <span class="id">H0</span>; <span class="tactic">simpl</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">bunion_comm</span> <span class="kwd">in</span> *; <span class="tactic">unfold</span> <span class="id">bunion</span> <span class="kwd">in</span> *;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">try</span> <span class="tactic">rewrite</span> &lt;- <span class="id">app_comm_cons</span>; <span class="tactic">rewrite</span> <span class="id">IHs</span>; <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">bdistinct_over_bunion_empty_r</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">l1</span> <span class="id">l2</span>:<span class="id">list</span> <span class="id">A</span>), <span class="kwd">forall</span> (<span class="id">x</span>:<span class="id">A</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">mult</span> (<span class="id">bdistinct</span> (<span class="id">l1</span> ⊎ <span class="id">l2</span>)) <span class="id">x</span> = 0) -&gt; (<span class="id">mult</span> (<span class="id">bdistinct</span> <span class="id">l2</span>) <span class="id">x</span> = 0).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof726')">Proof.</div>
<div class="proofscript" id="proof726">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">bunion</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">l1</span>; <span class="tactic">intros</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> *; <span class="tactic">try</span> <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">elim</span> (<span class="id">equiv_dec</span> <span class="id">x</span> <span class="id">a</span>); <span class="tactic">intro</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">a0</span> <span class="kwd">in</span> *; <span class="tactic">clear</span> <span class="id">a0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (((<span class="id">mult</span> (<span class="id">bdistinct</span> (<span class="id">l1</span>++<span class="id">l2</span>)) <span class="id">a</span>) = 0) \/ ((<span class="id">mult</span> (<span class="id">bdistinct</span> (<span class="id">l1</span>++<span class="id">l2</span>)) <span class="id">a</span>) = 1)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">bdistinct_at_most_one</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">elim</span> <span class="id">H0</span>; <span class="tactic">intros</span>; <span class="tactic">clear</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> (<span class="id">IHl1</span> <span class="id">l2</span> <span class="id">a</span>); <span class="tactic">try</span> <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H1</span> <span class="kwd">in</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> (<span class="id">IHl1</span> <span class="id">l2</span> <span class="id">x</span>); <span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (((<span class="id">mult</span> (<span class="id">bdistinct</span> (<span class="id">l1</span>++<span class="id">l2</span>)) <span class="id">a</span>) = 0) \/ ((<span class="id">mult</span> (<span class="id">bdistinct</span> (<span class="id">l1</span>++<span class="id">l2</span>)) <span class="id">a</span>) = 1)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">bdistinct_at_most_one</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">elim</span> <span class="id">H0</span>; <span class="tactic">intros</span>; <span class="tactic">clear</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H1</span> <span class="kwd">in</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">revert</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">elim</span> (<span class="id">equiv_dec</span> <span class="id">x</span> <span class="id">a</span>); <span class="tactic">intro</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">a0</span> <span class="kwd">in</span> *; <span class="tactic">clear</span> <span class="id">a0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intro</span>; <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H1</span> <span class="kwd">in</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">bdistinct_over_bunion_empty_l</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">l1</span> <span class="id">l2</span>:<span class="id">list</span> <span class="id">A</span>), <span class="kwd">forall</span> (<span class="id">x</span>:<span class="id">A</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">mult</span> (<span class="id">bdistinct</span> (<span class="id">l1</span> ⊎ <span class="id">l2</span>)) <span class="id">x</span> = 0) -&gt; (<span class="id">mult</span> (<span class="id">bdistinct</span> <span class="id">l1</span>) <span class="id">x</span> = 0).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof727')">Proof.</div>
<div class="proofscript" id="proof727">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>; <span class="tactic">rewrite</span> <span class="id">bdistinct_mult</span> <span class="kwd">in</span> *; <span class="tactic">rewrite</span> <span class="id">bunion_mult</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">l1</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> *; <span class="tactic">try</span> <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">revert</span> <span class="id">H</span>; <span class="tactic">elim</span> (<span class="id">equiv_dec</span> <span class="id">x</span> <span class="id">a</span>); <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">a0</span> <span class="kwd">in</span> *; <span class="tactic">clear</span> <span class="id">a0</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">apply</span> <span class="id">IHl1</span>; <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">bdistinct_over_bunion_singleton2</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">l1</span> <span class="id">l2</span>:<span class="id">list</span> <span class="id">A</span>), <span class="kwd">forall</span> (<span class="id">x</span>:<span class="id">A</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">mult</span> (<span class="id">bdistinct</span> <span class="id">l2</span>) <span class="id">x</span> = 0) -&gt; (<span class="id">mult</span> (<span class="id">bdistinct</span> <span class="id">l1</span>) <span class="id">x</span> = 1) -&gt; (<span class="id">mult</span> (<span class="id">bdistinct</span> (<span class="id">l1</span> ⊎ <span class="id">l2</span>)) <span class="id">x</span> = 1).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof728')">Proof.</div>
<div class="proofscript" id="proof728">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>; <span class="tactic">rewrite</span> <span class="id">bdistinct_mult</span> <span class="kwd">in</span> *; <span class="tactic">rewrite</span> <span class="id">bunion_mult</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">l1</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> *; <span class="tactic">try</span> <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">revert</span> <span class="id">H0</span>; <span class="tactic">elim</span> (<span class="id">equiv_dec</span> <span class="id">x</span> <span class="id">a</span>); <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">rewrite</span> <span class="id">a0</span> <span class="kwd">in</span> *; <span class="tactic">clear</span> <span class="id">a0</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">revert</span> <span class="id">H</span> <span class="id">IHl1</span> <span class="id">H0</span>; <span class="tactic">generalize</span> (<span class="id">mult</span> <span class="id">l1</span> <span class="id">a</span>); <span class="tactic">generalize</span> (<span class="id">mult</span> <span class="id">l2</span> <span class="id">a</span>); <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">n</span> = 0).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">apply</span> <span class="id">min_zero</span> <span class="kwd">with</span> (<span class="id">n2</span> := 0); <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">clear</span> <span class="id">H</span>; <span class="tactic">rewrite</span> <span class="id">H1</span> <span class="kwd">in</span> *; <span class="tactic">rewrite</span> <span class="id">plus_0_r</span> <span class="kwd">in</span> *; <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">apply</span> <span class="id">IHl1</span>; <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;Qed.</div>
&nbsp;&nbsp;<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">bdistinct_over_bunion</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">l1</span> <span class="id">l2</span>:<span class="id">list</span> <span class="id">A</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">bdistinct</span> (<span class="id">l1</span> ⊎ <span class="id">l2</span>)) ≅ ((<span class="id">bdistinct</span> <span class="id">l1</span>) <span class="id">max</span>-<span class="id">b</span> (<span class="id">bdistinct</span> <span class="id">l2</span>)).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof729')">Proof.</div>
<div class="proofscript" id="proof729">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">bags_same_mult_has_equal</span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">bmax_mult</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="tactic">rewrite</span> <span class="id">bdistinct_mult</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">bunion_mult</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">generalize</span> (<span class="id">mult</span> <span class="id">l1</span> <span class="id">a</span>); <span class="tactic">generalize</span> (<span class="id">mult</span> <span class="id">l2</span> <span class="id">a</span>); <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">generalize</span> (<span class="id">min_against_one</span> <span class="id">n</span>); <span class="tactic">generalize</span> (<span class="id">min_against_one</span> <span class="id">n0</span>); <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">elim</span> <span class="id">H</span>; <span class="tactic">elim</span> <span class="id">H0</span>; <span class="tactic">intros</span>; <span class="tactic">clear</span> <span class="id">H</span> <span class="id">H0</span>; <span class="tactic">rewrite</span> <span class="id">H1</span>; <span class="tactic">rewrite</span> <span class="id">H2</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">assert</span> (<span class="id">n</span> = 0).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">min_zero</span> <span class="kwd">with</span> (<span class="id">n2</span> := 0); <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">n0</span> = 0).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">min_zero</span> <span class="kwd">with</span> (<span class="id">n2</span> := 0); <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H</span>; <span class="tactic">rewrite</span> <span class="id">H0</span>; <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">assert</span> (<span class="id">n0</span> = 0).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">min_zero</span> <span class="kwd">with</span> (<span class="id">n2</span> := 0); <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H</span>; <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">assert</span> (<span class="id">n</span> = 0).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">min_zero</span> <span class="kwd">with</span> (<span class="id">n2</span> := 0); <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H</span>; <span class="tactic">rewrite</span> <span class="id">plus_0_r</span>; <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">assert</span> (1 &lt;= <span class="id">n</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">min_one_yields_one</span>; <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (1 &lt;= <span class="id">n0</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">min_one_yields_one</span>; <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">generalize</span> (<span class="id">compare_either</span> (<span class="id">n</span>+<span class="id">n0</span>) 1); <span class="tactic">intro</span>; <span class="tactic">elim</span> <span class="id">H</span>; <span class="tactic">intros</span>; <span class="tactic">clear</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">min_r</span>; <span class="tactic">try</span> <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">omega</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">plus_n_Sm</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">min_r</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">auto</span> <span class="kwd">with</span> <span class="id">arith</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">bmin_zero</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">l1</span> <span class="id">l2</span>:<span class="id">list</span> <span class="id">A</span>), <span class="kwd">forall</span> (<span class="id">x</span>:<span class="id">A</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">mult</span> (<span class="id">l1</span> <span class="id">min</span>-<span class="id">b</span> <span class="id">l2</span>) <span class="id">x</span> = 0 -&gt; (<span class="id">mult</span> <span class="id">l1</span> <span class="id">x</span> = 0) \/ (<span class="id">mult</span> <span class="id">l2</span> <span class="id">x</span> = 0).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof730')">Proof.</div>
<div class="proofscript" id="proof730">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">l2</span>; <span class="tactic">simpl</span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">right</span>; <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">bmin_mult</span> <span class="kwd">in</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">revert</span> <span class="id">H</span>; <span class="tactic">elim</span> (<span class="id">equiv_dec</span> <span class="id">x</span> <span class="id">a</span>); <span class="tactic">intro</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">a0</span> <span class="kwd">in</span> *; <span class="tactic">clear</span> <span class="id">a0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intro</span>; <span class="id">left</span>; <span class="tactic">apply</span> (<span class="id">min_zero</span> (<span class="id">mult</span> <span class="id">l1</span> <span class="id">a</span>) (<span class="id">mult</span> <span class="id">l2</span> <span class="id">a</span>)); <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intro</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">bmin_mult</span> <span class="kwd">in</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> (<span class="id">IHl2</span> <span class="id">x</span>); <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">bmin_zero_back</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">l1</span> <span class="id">l2</span>:<span class="id">list</span> <span class="id">A</span>), <span class="kwd">forall</span> (<span class="id">x</span>:<span class="id">A</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">mult</span> <span class="id">l1</span> <span class="id">x</span> = 0) \/ (<span class="id">mult</span> <span class="id">l2</span> <span class="id">x</span> = 0) -&gt; <span class="id">mult</span> (<span class="id">l1</span> <span class="id">min</span>-<span class="id">b</span> <span class="id">l2</span>) <span class="id">x</span> = 0.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof731')">Proof.</div>
<div class="proofscript" id="proof731">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">l2</span>; <span class="tactic">simpl</span>; <span class="tactic">intros</span>; <span class="tactic">rewrite</span> <span class="id">bmin_mult</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">min_0_r</span>; <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">revert</span> <span class="id">H</span>; <span class="tactic">elim</span> (<span class="id">equiv_dec</span> <span class="id">x</span> <span class="id">a</span>); <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">a0</span> <span class="kwd">in</span> *; <span class="tactic">clear</span> <span class="id">a0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">elim</span> <span class="id">H</span>; <span class="tactic">intro</span>; <span class="tactic">clear</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H0</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">generalize</span> (<span class="id">mult</span> <span class="id">l2</span> <span class="id">a</span>); <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H0</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">generalize</span> (<span class="id">mult</span> <span class="id">l1</span> <span class="id">a</span>); <span class="tactic">intro</span>; <span class="tactic">rewrite</span> <span class="id">min_0_r</span>; <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">elim</span> <span class="id">H</span>; <span class="tactic">intro</span>; <span class="tactic">clear</span> <span class="id">H</span>; <span class="tactic">rewrite</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">generalize</span> (<span class="id">mult</span> <span class="id">l1</span> <span class="id">a</span>); <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">generalize</span> (<span class="id">mult</span> <span class="id">l1</span> <span class="id">a</span>); <span class="tactic">intro</span>; <span class="tactic">rewrite</span> <span class="id">min_0_r</span>; <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">bdistinct_over_bmin</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">l2</span> <span class="id">l1</span>:<span class="id">list</span> <span class="id">A</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">bdistinct</span> (<span class="id">l1</span> <span class="id">min</span>-<span class="id">b</span> <span class="id">l2</span>)) ≅ ((<span class="id">bdistinct</span> <span class="id">l1</span>) <span class="id">min</span>-<span class="id">b</span> (<span class="id">bdistinct</span> <span class="id">l2</span>)).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof732')">Proof.</div>
<div class="proofscript" id="proof732">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">bags_same_mult_has_equal</span>; <span class="tactic">intro</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">bdistinct_mult</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="tactic">rewrite</span> <span class="id">bmin_mult</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="tactic">rewrite</span> <span class="id">bdistinct_mult</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">generalize</span> (<span class="id">mult</span> <span class="id">l1</span> <span class="id">a</span>); <span class="tactic">intro</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">generalize</span> (<span class="id">mult</span> <span class="id">l2</span> <span class="id">a</span>); <span class="tactic">intro</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">generalize</span> (<span class="id">min_against_one</span> <span class="id">n</span>); <span class="tactic">intro</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">generalize</span> (<span class="id">min_against_one</span> <span class="id">n0</span>); <span class="tactic">intro</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">elim</span> <span class="id">H</span>; <span class="tactic">intro</span>; <span class="tactic">clear</span> <span class="id">H</span>; <span class="tactic">elim</span> <span class="id">H0</span>; <span class="tactic">intro</span>; <span class="tactic">clear</span> <span class="id">H0</span>; <span class="tactic">rewrite</span> <span class="id">H</span>; <span class="tactic">rewrite</span> <span class="id">H1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">n</span> = 0); <span class="tactic">try</span> (<span class="tactic">apply</span> (<span class="id">min_zero</span> <span class="id">n</span> 0); <span class="tactic">assumption</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">n0</span> = 0); <span class="tactic">try</span> (<span class="tactic">apply</span> (<span class="id">min_zero</span> <span class="id">n0</span> 0); <span class="tactic">assumption</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H0</span>; <span class="tactic">rewrite</span> <span class="id">H2</span>; <span class="tactic">auto</span> <span class="kwd">with</span> <span class="id">arith</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">n</span> = 0); <span class="tactic">try</span> (<span class="tactic">apply</span> (<span class="id">min_zero</span> <span class="id">n</span> 0); <span class="tactic">assumption</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H0</span>; <span class="tactic">auto</span> <span class="kwd">with</span> <span class="id">arith</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">n0</span> = 0); <span class="tactic">try</span> (<span class="tactic">apply</span> (<span class="id">min_zero</span> <span class="id">n0</span> 0); <span class="tactic">assumption</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H0</span>; <span class="tactic">rewrite</span> <span class="id">min_0_r</span>; <span class="tactic">auto</span> <span class="kwd">with</span> <span class="id">arith</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>; <span class="tactic">generalize</span> (<span class="id">compare_either</span> <span class="id">n</span> <span class="id">n0</span>); <span class="tactic">intro</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">elim</span> <span class="id">H0</span>; <span class="tactic">intro</span>; <span class="tactic">clear</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">min</span> <span class="id">n</span> <span class="id">n0</span> = <span class="id">n</span>). <span class="tactic">try</span> (<span class="tactic">rewrite</span> <span class="id">min_l</span>; [<span class="tactic">reflexivity</span>|<span class="tactic">assumption</span>]).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H0</span>; <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">min</span> <span class="id">n</span> <span class="id">n0</span> = <span class="id">n0</span>). <span class="tactic">try</span> (<span class="tactic">rewrite</span> <span class="id">min_r</span>; [<span class="tactic">reflexivity</span>|<span class="tactic">assumption</span>]).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H0</span>; <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">split_select</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">p</span>:<span class="id">A</span> -&gt; <span class="id">bool</span>), <span class="kwd">forall</span> (<span class="id">s</span>:<span class="id">list</span> <span class="id">A</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> (<span class="id">sp</span> <span class="id">nsp</span>:<span class="id">list</span> <span class="id">A</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">sp</span> ⊎ <span class="id">nsp</span>) ≅ <span class="id">s</span> /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">filter</span> <span class="id">p</span> <span class="id">sp</span>) = <span class="id">sp</span> /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">filter</span> <span class="id">p</span> <span class="id">nsp</span>) = <span class="id">nil</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof733')">Proof.</div>
<div class="proofscript" id="proof733">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">s</span> ≅ ((<span class="id">filter</span> <span class="id">p</span> <span class="id">s</span>) ⊎ (<span class="id">filter</span> (<span class="kwd">fun</span> <span class="id">x</span> =&gt; <span class="id">negb</span> (<span class="id">p</span> <span class="id">x</span>)) <span class="id">s</span>))).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> (<span class="id">select_not_select</span> <span class="id">p</span>) <span class="kwd">with</span> (<span class="id">s</span> := <span class="id">s</span>); <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> (<span class="id">filter</span> <span class="id">p</span> <span class="id">s</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> (<span class="id">filter</span> (<span class="kwd">fun</span> <span class="id">x</span> : <span class="id">A</span> =&gt; <span class="id">negb</span> (<span class="id">p</span> <span class="id">x</span>)) <span class="id">s</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>;[<span class="tactic">rewrite</span> &lt;- <span class="id">H</span>; <span class="tactic">reflexivity</span>|<span class="tactic">split</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">rewrite</span> <span class="id">filter_filter</span>; <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">rewrite</span> <span class="id">filter_not_filter</span>; <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">mult_filter_true</span> <span class="id">l</span> {<span class="id">p</span> <span class="id">a</span>} : <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">p</span> <span class="id">a</span> = <span class="id">true</span> -&gt; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">mult</span> (<span class="id">filter</span> <span class="id">p</span> <span class="id">l</span>) <span class="id">a</span> = <span class="id">mult</span> <span class="id">l</span> <span class="id">a</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof734')">Proof.</div>
<div class="proofscript" id="proof734">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">eqf</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">l</span>; <span class="tactic">simpl</span>; <span class="tactic">trivial</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">case_eq</span> (<span class="id">equiv_dec</span> <span class="id">a</span> <span class="id">a0</span>); <span class="tactic">intros</span>; <span class="tactic">try</span> <span class="tactic">rewrite</span> <span class="id">e</span> <span class="kwd">in</span> *; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">rewrite</span> <span class="id">eqf</span>; <span class="tactic">simpl</span>. <span class="tactic">rewrite</span> <span class="id">H</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">destruct</span> (<span class="id">p</span> <span class="id">a0</span>); <span class="tactic">auto</span>; <span class="tactic">simpl</span>. <span class="tactic">rewrite</span> <span class="id">H</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">mult_filter_false</span> <span class="id">l</span> {<span class="id">p</span> <span class="id">a</span>} : <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">p</span> <span class="id">a</span> = <span class="id">false</span> -&gt; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">mult</span> (<span class="id">filter</span> <span class="id">p</span> <span class="id">l</span>) <span class="id">a</span> = 0.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof735')">Proof.</div>
<div class="proofscript" id="proof735">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">eqf</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">l</span>; <span class="tactic">simpl</span>; <span class="tactic">trivial</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">case_eq</span> (<span class="id">p</span> <span class="id">a0</span>); <span class="tactic">auto</span>; <span class="tactic">simpl</span>; <span class="tactic">intros</span>. <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">case_eq</span> (<span class="id">equiv_dec</span> <span class="id">a</span> <span class="id">a0</span>); <span class="tactic">intros</span>; <span class="tactic">subst</span>; <span class="tactic">intuition</span>; <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id">bminus_delta2</span> (<span class="id">Q</span> <span class="id">dQm</span> <span class="id">dQp</span>:<span class="id">list</span> <span class="id">A</span>) :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Q</span> <span class="id">min</span>-<span class="id">b</span> <span class="id">dQm</span>) ⊖ <span class="id">dQp</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id">bplus_delta2</span> (<span class="id">Q</span> <span class="id">dQm</span> <span class="id">dQp</span>:<span class="id">list</span> <span class="id">A</span>) :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">dQp</span> ⊖ (<span class="id">Q</span> <span class="id">min</span>-<span class="id">b</span> <span class="id">dQm</span>).<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id">apply_deltas</span> (<span class="id">Q</span> <span class="id">dQm</span> <span class="id">dQp</span>: <span class="id">list</span> <span class="id">A</span>) :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Q</span> ⊖ <span class="id">dQm</span>) ⊎ <span class="id">dQp</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">theorem2_a</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">Q</span> <span class="id">dQm</span> <span class="id">dQp</span>: <span class="id">list</span> <span class="id">A</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">apply_deltas</span> <span class="id">Q</span> <span class="id">dQm</span> <span class="id">dQp</span>) ≅<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">apply_deltas</span> <span class="id">Q</span> (<span class="id">bminus_delta2</span> <span class="id">Q</span> <span class="id">dQm</span> <span class="id">dQp</span>) (<span class="id">bplus_delta2</span> <span class="id">Q</span> <span class="id">dQm</span> <span class="id">dQp</span>)).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof736')">Proof.</div>
<div class="proofscript" id="proof736">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">bags_same_mult_has_equal</span>; <span class="tactic">intro</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">apply_deltas</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">bminus_delta2</span>; <span class="tactic">unfold</span> <span class="id">bplus_delta2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="tactic">rewrite</span> <span class="id">bunion_mult</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="tactic">rewrite</span> <span class="id">bminus_mult</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="tactic">rewrite</span> <span class="id">bmin_mult</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">generalize</span> (<span class="id">mult</span> <span class="id">Q</span> <span class="id">a</span>) <span class="kwd">as</span> <span class="id">nQ</span>; <span class="tactic">intro</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">generalize</span> (<span class="id">mult</span> <span class="id">dQm</span> <span class="id">a</span>) <span class="kwd">as</span> <span class="id">ndQm</span>; <span class="tactic">intro</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">generalize</span> (<span class="id">mult</span> <span class="id">dQp</span> <span class="id">a</span>) <span class="kwd">as</span> <span class="id">ndQp</span>; <span class="tactic">intro</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">generalize</span> (<span class="id">compare_either</span> <span class="id">nQ</span> <span class="id">ndQm</span>); <span class="tactic">intro</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">elim</span> <span class="id">H</span>; <span class="tactic">intro</span>; <span class="tactic">clear</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">rewrite</span> <span class="id">min_l</span>; <span class="tactic">try</span> <span class="tactic">assumption</span>; <span class="tactic">omega</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">rewrite</span> <span class="id">min_r</span>; <span class="tactic">try</span> <span class="tactic">assumption</span>; <span class="tactic">omega</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">theorem2_b</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">Q</span> <span class="id">dQm</span> <span class="id">dQp</span>: <span class="id">list</span> <span class="id">A</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;((<span class="id">bminus_delta2</span> <span class="id">Q</span> <span class="id">dQm</span> <span class="id">dQp</span>) ⊖ <span class="id">Q</span>) ≅ <span class="id">nil</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof737')">Proof.</div>
<div class="proofscript" id="proof737">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">bags_same_mult_has_equal</span>; <span class="tactic">intro</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">bminus_delta2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="tactic">rewrite</span> <span class="id">bminus_mult</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">bmin_mult</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">generalize</span> (<span class="id">mult</span> <span class="id">Q</span> <span class="id">a</span>) <span class="kwd">as</span> <span class="id">nQ</span>; <span class="tactic">intro</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">generalize</span> (<span class="id">mult</span> <span class="id">dQm</span> <span class="id">a</span>) <span class="kwd">as</span> <span class="id">ndQm</span>; <span class="tactic">intro</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">generalize</span> (<span class="id">mult</span> <span class="id">dQp</span> <span class="id">a</span>) <span class="kwd">as</span> <span class="id">ndQp</span>; <span class="tactic">intro</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">generalize</span> (<span class="id">compare_either</span> <span class="id">nQ</span> <span class="id">ndQm</span>); <span class="tactic">intro</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">elim</span> <span class="id">H</span>; <span class="tactic">intro</span>; <span class="tactic">clear</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">rewrite</span> <span class="id">min_l</span>; <span class="tactic">try</span> <span class="tactic">assumption</span>; <span class="tactic">omega</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">rewrite</span> <span class="id">min_r</span>; <span class="tactic">try</span> <span class="tactic">assumption</span>; <span class="tactic">omega</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">theorem2_c</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">Q</span> <span class="id">dQm</span> <span class="id">dQp</span>: <span class="id">list</span> <span class="id">A</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;((<span class="id">bminus_delta2</span> <span class="id">Q</span> <span class="id">dQm</span> <span class="id">dQp</span>) <span class="id">min</span>-<span class="id">b</span> (<span class="id">bplus_delta2</span> <span class="id">Q</span> <span class="id">dQm</span> <span class="id">dQp</span>)) ≅ <span class="id">nil</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof738')">Proof.</div>
<div class="proofscript" id="proof738">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">bags_same_mult_has_equal</span>; <span class="tactic">intro</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">bminus_delta2</span>; <span class="tactic">unfold</span> <span class="id">bplus_delta2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">bmin_mult</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="tactic">rewrite</span> <span class="id">bminus_mult</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="tactic">rewrite</span> <span class="id">bmin_mult</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">generalize</span> (<span class="id">mult</span> <span class="id">Q</span> <span class="id">a</span>) <span class="kwd">as</span> <span class="id">nQ</span>; <span class="tactic">intro</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">generalize</span> (<span class="id">mult</span> <span class="id">dQm</span> <span class="id">a</span>) <span class="kwd">as</span> <span class="id">ndQm</span>; <span class="tactic">intro</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">generalize</span> (<span class="id">mult</span> <span class="id">dQp</span> <span class="id">a</span>) <span class="kwd">as</span> <span class="id">ndQp</span>; <span class="tactic">intro</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">generalize</span> (<span class="id">compare_either</span> <span class="id">nQ</span> <span class="id">ndQm</span>); <span class="tactic">intro</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">elim</span> <span class="id">H</span>; <span class="tactic">intros</span>; <span class="tactic">clear</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">assert</span> (<span class="id">min</span> <span class="id">nQ</span> <span class="id">ndQm</span> = <span class="id">nQ</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">min_l</span>; [<span class="tactic">reflexivity</span>|<span class="tactic">assumption</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">generalize</span> (<span class="id">compare_either</span> <span class="id">nQ</span> <span class="id">ndQp</span>); <span class="tactic">intro</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">elim</span> <span class="id">H1</span>; <span class="tactic">intros</span>; <span class="tactic">clear</span> <span class="id">H1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">rewrite</span> <span class="id">min_l</span>; <span class="tactic">omega</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">rewrite</span> <span class="id">min_r</span>; <span class="tactic">omega</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">assert</span> (<span class="id">min</span> <span class="id">nQ</span> <span class="id">ndQm</span> = <span class="id">ndQm</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">min_r</span>; [<span class="tactic">reflexivity</span>|<span class="tactic">assumption</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">generalize</span> (<span class="id">compare_either</span> <span class="id">ndQm</span> <span class="id">ndQp</span>); <span class="tactic">intro</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">elim</span> <span class="id">H1</span>; <span class="tactic">intros</span>; <span class="tactic">clear</span> <span class="id">H1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">rewrite</span> <span class="id">min_l</span>; <span class="tactic">omega</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">rewrite</span> <span class="id">min_r</span>; <span class="tactic">omega</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">remove_one_bminus</span> <span class="id">r</span> <span class="id">s</span> <span class="id">a</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;((<span class="id">remove_one</span> <span class="id">a</span> <span class="id">s</span>) ⊖ <span class="id">r</span>) = (<span class="id">s</span> ⊖ (<span class="id">a</span> :: <span class="id">r</span>)).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof739')">Proof.</div>
<div class="proofscript" id="proof739">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">revert</span> <span class="id">s</span> <span class="id">r</span>. <span class="tactic">induction</span> <span class="id">r</span>; <span class="tactic">intros</span>; <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">remove_bminus_comm</span> <span class="id">r</span> <span class="id">s</span> <span class="id">a</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;((<span class="id">remove_one</span> <span class="id">a</span> <span class="id">s</span>) ⊖ <span class="id">r</span>) = (<span class="id">remove_one</span> <span class="id">a</span> (<span class="id">s</span> ⊖ <span class="id">r</span>)).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof740')">Proof.</div>
<div class="proofscript" id="proof740">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">revert</span> <span class="id">r</span> <span class="id">s</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">r</span>; <span class="tactic">intros</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">rewrite</span> <span class="id">remove_one_comm</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> (<span class="id">IHr</span> (<span class="id">remove_one</span> <span class="id">a0</span> <span class="id">s</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">filter_remove_one_false</span> <span class="id">s</span> {<span class="id">p</span> <span class="id">a</span>} : <span class="id">p</span> <span class="id">a</span> = <span class="id">false</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">filter</span> <span class="id">p</span> (<span class="id">remove_one</span> <span class="id">a</span> <span class="id">s</span>)) = <span class="id">filter</span> <span class="id">p</span> <span class="id">s</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof741')">Proof.</div>
<div class="proofscript" id="proof741">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">eqf</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">s</span>; <span class="tactic">simpl</span>; <span class="tactic">trivial</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">case_eq</span> (<span class="id">equiv_dec</span> <span class="id">a</span> <span class="id">a0</span>); <span class="tactic">intros</span>; <span class="tactic">subst</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">e</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">rewrite</span> <span class="id">eqf</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">case_eq</span> (<span class="id">p</span> <span class="id">a0</span>); <span class="tactic">intros</span> <span class="id">eqf0</span>; <span class="tactic">rewrite</span> <span class="id">IHs</span>; <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">filter_remove_one</span> <span class="id">s</span> {<span class="id">p</span> <span class="id">a</span>} :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">filter</span> <span class="id">p</span> (<span class="id">remove_one</span> <span class="id">a</span> <span class="id">s</span>)) = <span class="id">remove_one</span> <span class="id">a</span> (<span class="id">filter</span> <span class="id">p</span> <span class="id">s</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof742')">Proof.</div>
<div class="proofscript" id="proof742">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">s</span>; <span class="tactic">simpl</span>; <span class="tactic">trivial</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">case_eq</span> (<span class="id">equiv_dec</span> <span class="id">a</span> <span class="id">a0</span>); <span class="tactic">intros</span>; <span class="tactic">subst</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">red</span> <span class="kwd">in</span> <span class="id">e</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">case_eq</span> (<span class="id">p</span> <span class="id">a0</span>); <span class="tactic">intros</span> <span class="id">eqf0</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">elim</span> (<span class="id">equiv_dec</span> <span class="id">a0</span> <span class="id">a0</span>); <span class="tactic">intro</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">filter_remove_one_false</span> <span class="kwd">in</span> <span class="id">IHs</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">case_eq</span> (<span class="id">p</span> <span class="id">a0</span>); <span class="tactic">intros</span> <span class="id">eqf0</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">elim</span> (<span class="id">EquivDec.equiv_dec</span> <span class="id">a</span> <span class="id">a0</span>); <span class="tactic">intro</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">IHs</span>; <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">bunion_filter</span> (<span class="id">s</span>:<span class="id">list</span> <span class="id">A</span>) (<span class="id">ds</span>:<span class="id">list</span> <span class="id">A</span>) (<span class="id">p</span>:<span class="id">A</span> -&gt; <span class="id">bool</span>):<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">filter</span> <span class="id">p</span> (<span class="id">s</span> ⊎ <span class="id">ds</span>)) = ((<span class="id">filter</span> <span class="id">p</span> <span class="id">s</span>) ⊎ (<span class="id">filter</span> <span class="id">p</span> <span class="id">ds</span>)).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof743')">Proof.</div>
<div class="proofscript" id="proof743">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>; <span class="tactic">unfold</span> <span class="id">bunion</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">s</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">generalize</span> (<span class="id">two_cases</span> <span class="id">p</span> <span class="id">a</span>); <span class="tactic">intro</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">elim</span> <span class="id">H</span>; <span class="tactic">intro</span>; <span class="tactic">rewrite</span> <span class="id">H0</span>; <span class="tactic">try</span> <span class="tactic">rewrite</span> &lt;- <span class="id">app_comm_cons</span>; <span class="tactic">rewrite</span> <span class="id">IHs</span>; <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">bminus_filter</span> (<span class="id">p</span>:<span class="id">A</span> -&gt; <span class="id">bool</span>) (<span class="id">s</span> <span class="id">ds</span>:<span class="id">list</span> <span class="id">A</span>) : (<span class="id">filter</span> <span class="id">p</span> (<span class="id">s</span> ⊖ <span class="id">ds</span>)) = ((<span class="id">filter</span> <span class="id">p</span> <span class="id">s</span>) ⊖ (<span class="id">filter</span> <span class="id">p</span> <span class="id">ds</span>)).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof744')">Proof.</div>
<div class="proofscript" id="proof744">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">revert</span> <span class="id">s</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">ds</span>; <span class="tactic">simpl</span>; <span class="tactic">auto</span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">IHds</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">case_eq</span> (<span class="id">p</span> <span class="id">a</span>); <span class="tactic">intros</span> <span class="id">eqf</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">rewrite</span> <span class="id">filter_remove_one</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">rewrite</span> <span class="id">filter_remove_one_false</span>; <span class="tactic">trivial</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
<span class="kwd">End</span> <span class="id">RBag</span>.<br/>
<br/>
<span class="kwd">Section</span> <span class="id">NumMinMax</span>.<br/>
&nbsp;&nbsp;<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id">ZArith</span>.<br/>
&nbsp;&nbsp;<span class="kwd">Open</span> <span class="kwd">Scope</span> <span class="id">Z_scope</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id">bnummin</span> (<span class="id">l</span>:<span class="id">list</span> <span class="id">Z</span>) :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">l</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">nil</span> =&gt; 0<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">x0</span> :: <span class="id">l</span>' =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">fold_right</span> (<span class="kwd">fun</span> <span class="id">x</span> <span class="id">y</span> =&gt; <span class="id">Zmin</span> <span class="id">x</span> <span class="id">y</span>) <span class="id">x0</span> <span class="id">l</span>'<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id">bnummax</span> (<span class="id">l</span>:<span class="id">list</span> <span class="id">Z</span>) :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">l</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">nil</span> =&gt; 0<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">x0</span> :: <span class="id">l</span>' =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">fold_right</span> (<span class="kwd">fun</span> <span class="id">x</span> <span class="id">y</span> =&gt; <span class="id">Zmax</span> <span class="id">x</span> <span class="id">y</span>) <span class="id">x0</span> <span class="id">l</span>'<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
&nbsp;&nbsp;<br/>
<span class="kwd">End</span> <span class="id">NumMinMax</span>.<br/>
<br/>
<span class="kwd">Hint</span> <span class="id">Rewrite</span> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">bminus_nil_to_self</span> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">bminus_to_nil</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">bminus_self</span> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">bminus_naught</span> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">bminus_cons</span> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">app_nil_r</span> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">bunion_bminus</span> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">remove_one_consed</span> : <span class="id">bag</span>.<br/>
<br/>
<span class="kwd">Hint</span> <span class="kwd">Unfold</span> <span class="id">ldeqA</span>.<br/>
<span class="kwd">Hint</span> <span class="kwd">Unfold</span> <span class="id">mult_equiv</span>.<br/>
<br/>

</div>
<div class="footer"><hr/>Generated by <a href="https://github.com/xavierleroy/coq2html/">coq2html</div>
</body>
</html>
