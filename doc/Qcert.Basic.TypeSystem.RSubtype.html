
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Module Qcert.Basic.TypeSystem.RSubtype</title>
<meta name="description" content="Documentation of Coq module Qcert.Basic.TypeSystem.RSubtype" />
<link href="coq2html.css" rel="stylesheet" type="text/css" />
<script type="text/javascript" src="coq2html.js"> </script>
</head>

<body onload="hideAll('proofscript')">
<h1 class="title">Module Qcert.Basic.TypeSystem.RSubtype</h1>
<div class="coq">
<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id">String</span>.<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id">List</span>.<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id">RelationClasses</span>.<br/>
<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id">Utils</span>.<br/>
<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id">ForeignType</span>.<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id">RType</span>.<br/>
<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id">BrandRelation</span>.<br/>
<br/>
<span class="kwd">Section</span> <span class="id">subtype</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Context</span> {<span class="id">ftype</span>:<span class="id">foreign_type</span>}.<br/>
&nbsp;&nbsp;<span class="kwd">Context</span> {<span class="id">br</span>:<span class="id">brand_relation</span>}.<br/>
&nbsp;&nbsp;<br/>
<span class="kwd">Inductive</span> <span class="id">subtype</span> : <span class="id">rtype</span> -&gt; <span class="id">rtype</span> -&gt; <span class="kwd">Prop</span> :=<br/>
&nbsp;&nbsp;| <span class="id">STop</span> <span class="id">r</span> : <span class="id">subtype</span> <span class="id">r</span> ⊤<br/>
&nbsp;&nbsp;| <span class="id">SBottom</span> <span class="id">r</span> : <span class="id">subtype</span> ⊥ <span class="id">r</span><br/>
&nbsp;&nbsp;| <span class="id">SRefl</span> <span class="id">r</span> : <span class="id">subtype</span> <span class="id">r</span> <span class="id">r</span><br/>
&nbsp;&nbsp;| <span class="id">SColl</span> <span class="id">r1</span> <span class="id">r2</span> : <span class="id">subtype</span> <span class="id">r1</span> <span class="id">r2</span> -&gt; <span class="id">subtype</span> (<span class="id">Coll</span> <span class="id">r1</span>) (<span class="id">Coll</span> <span class="id">r2</span>)<br/>
<div class="doc">Allow width subtyping of open records and depth subtyping of both types of records. Also, a closed record can be a subtype of an open record (but not vice versa) </div>
&nbsp;&nbsp;| <span class="id">SRec</span> <span class="id">k1</span> <span class="id">k2</span> <span class="id">rl1</span> <span class="id">rl2</span> <span class="id">pf1</span> <span class="id">pf2</span> : (<span class="kwd">forall</span> <span class="id">s</span> <span class="id">r</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">lookup</span> <span class="id">string_dec</span> <span class="id">rl2</span> <span class="id">s</span> = <span class="id">Some</span> <span class="id">r</span>' -&gt; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">r</span>, <span class="id">lookup</span> <span class="id">string_dec</span> <span class="id">rl1</span> <span class="id">s</span> = <span class="id">Some</span> <span class="id">r</span> /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">subtype</span> <span class="id">r</span> <span class="id">r</span>') -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">k2</span> = <span class="id">Closed</span> -&gt; <span class="id">k1</span> = <span class="id">Closed</span> /\ <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">s</span>, <span class="id">In</span> <span class="id">s</span> (<span class="id">domain</span> <span class="id">rl1</span>) -&gt; <span class="id">In</span> <span class="id">s</span> (<span class="id">domain</span> <span class="id">rl2</span>))) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">subtype</span> (<span class="id">Rec</span> <span class="id">k1</span> <span class="id">rl1</span> <span class="id">pf1</span>) (<span class="id">Rec</span> <span class="id">k2</span> <span class="id">rl2</span> <span class="id">pf2</span>)<br/>
&nbsp;&nbsp;| <span class="id">SEither</span> <span class="id">l1</span> <span class="id">l2</span> <span class="id">r1</span> <span class="id">r2</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">subtype</span> <span class="id">l1</span> <span class="id">l2</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">subtype</span> <span class="id">r1</span> <span class="id">r2</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">subtype</span> (<span class="id">Either</span> <span class="id">l1</span> <span class="id">r1</span>) (<span class="id">Either</span> <span class="id">l2</span> <span class="id">r2</span>)<br/>
&nbsp;&nbsp;| <span class="id">SArrow</span> <span class="id">in1</span> <span class="id">in2</span> <span class="id">out1</span> <span class="id">out2</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">subtype</span> <span class="id">in2</span> <span class="id">in1</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">subtype</span> <span class="id">out1</span> <span class="id">out2</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">subtype</span> (<span class="id">Arrow</span> <span class="id">in1</span> <span class="id">out1</span>) (<span class="id">Arrow</span> <span class="id">in2</span> <span class="id">out2</span>)<br/>
&nbsp;&nbsp;| <span class="id">SBrand</span> <span class="id">b1</span> <span class="id">b2</span> : <span class="id">sub_brands</span> <span class="id">brand_relation_brands</span> <span class="id">b1</span> <span class="id">b2</span> -&gt; <span class="id">subtype</span> (<span class="id">Brand</span> <span class="id">b1</span>) (<span class="id">Brand</span> <span class="id">b2</span>)<br/>
&nbsp;&nbsp;| <span class="id">SForeign</span> <span class="id">ft1</span> <span class="id">ft2</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">foreign_type_sub</span> <span class="id">ft1</span> <span class="id">ft2</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">subtype</span> (<span class="id">Foreign</span> <span class="id">ft1</span>) (<span class="id">Foreign</span> <span class="id">ft2</span>)<br/>
.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">SRec_open</span> <span class="id">k1</span> <span class="id">rl1</span> <span class="id">rl2</span> <span class="id">pf1</span> <span class="id">pf2</span> :<br/>
&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">s</span> <span class="id">r</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">lookup</span> <span class="id">string_dec</span> <span class="id">rl2</span> <span class="id">s</span> = <span class="id">Some</span> <span class="id">r</span>' -&gt; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">r</span>, <span class="id">lookup</span> <span class="id">string_dec</span> <span class="id">rl1</span> <span class="id">s</span> = <span class="id">Some</span> <span class="id">r</span> /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">subtype</span> <span class="id">r</span> <span class="id">r</span>') -&gt;<br/>
&nbsp;&nbsp;<span class="id">subtype</span> (<span class="id">Rec</span> <span class="id">k1</span> <span class="id">rl1</span> <span class="id">pf1</span>) (<span class="id">Rec</span> <span class="kwd">Open</span> <span class="id">rl2</span> <span class="id">pf2</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof1109')">Proof.</div>
<div class="proofscript" id="proof1109">
&nbsp;&nbsp;<span class="tactic">intros</span>; <span class="id">constructor</span>; <span class="tactic">intuition</span>; <span class="tactic">discriminate</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">SRec_closed_in_domain</span> {<span class="id">k1</span> <span class="id">k2</span> <span class="id">rl1</span> <span class="id">rl2</span> <span class="id">pf1</span> <span class="id">pf2</span>} :<br/>
&nbsp;&nbsp;<span class="id">subtype</span> (<span class="id">Rec</span> <span class="id">k1</span> <span class="id">rl1</span> <span class="id">pf1</span>) (<span class="id">Rec</span> <span class="id">k2</span> <span class="id">rl2</span> <span class="id">pf2</span>) -&gt;<br/>
&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">x</span>, <span class="id">In</span> <span class="id">x</span> (<span class="id">domain</span> <span class="id">rl2</span>) -&gt; <span class="id">In</span> <span class="id">x</span> (<span class="id">domain</span> <span class="id">rl1</span>)).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof1110')">Proof.</div>
<div class="proofscript" id="proof1110">
&nbsp;&nbsp;<span class="tactic">inversion</span> 1; <span class="id">rtype_equalizer</span>; <span class="tactic">subst</span>; <span class="tactic">intuition</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">in_dom_lookup</span> <span class="id">string_dec</span> <span class="id">H0</span>).<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">H3</span> <span class="id">_</span> <span class="id">_</span> <span class="id">H1</span>) <span class="kwd">as</span> [? [<span class="id">inn</span> ?]].<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">lookup_in</span> <span class="kwd">in</span> <span class="id">inn</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">in_dom</span> <span class="kwd">in</span> <span class="id">inn</span>.<br/>
&nbsp;&nbsp;<span class="tactic">trivial</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">SRec_closed_equiv_domain</span> {<span class="id">k1</span> <span class="id">rl1</span> <span class="id">rl2</span> <span class="id">pf1</span> <span class="id">pf2</span>} :<br/>
&nbsp;&nbsp;<span class="id">subtype</span> (<span class="id">Rec</span> <span class="id">k1</span> <span class="id">rl1</span> <span class="id">pf1</span>) (<span class="id">Rec</span> <span class="id">Closed</span> <span class="id">rl2</span> <span class="id">pf2</span>) -&gt;<br/>
&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">x</span>, <span class="id">In</span> <span class="id">x</span> (<span class="id">domain</span> <span class="id">rl1</span>) &lt;-&gt; <span class="id">In</span> <span class="id">x</span> (<span class="id">domain</span> <span class="id">rl2</span>)).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof1111')">Proof.</div>
<div class="proofscript" id="proof1111">
&nbsp;&nbsp;<span class="tactic">inversion</span> 1; <span class="id">rtype_equalizer</span>; <span class="tactic">subst</span>; <span class="tactic">intuition</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">SRec_closed_in_domain</span>; <span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id">Eqdep_dec</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">UIP_refl_dec</span> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<span class="id">A</span>:<span class="kwd">Type</span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">dec</span>:<span class="kwd">forall</span> <span class="id">x</span> <span class="id">y</span>:<span class="id">A</span>, {<span class="id">x</span> = <span class="id">y</span>} + {<span class="id">x</span> &lt;&gt; <span class="id">y</span>}) <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<span class="id">x</span>:<span class="id">A</span>} <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">p1</span>:<span class="id">x</span> = <span class="id">x</span>) : <span class="id">p1</span> = <span class="id">eq_refl</span> <span class="id">x</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof1112')">Proof.</div>
<div class="proofscript" id="proof1112">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">apply</span> (<span class="id">UIP_dec</span>); <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;Qed.</div>
&nbsp;&nbsp;<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id">Bool</span>.<br/>
<br/>
<div class="doc">This follows trivially from the consistency of join and subtype.
      However, this version should have better computational properties.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id">subtype_both_dec</span> <span class="id">x</span> <span class="id">y</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">prod</span> ({<span class="id">subtype</span> <span class="id">x</span> <span class="id">y</span>} + {~ <span class="id">subtype</span> <span class="id">x</span> <span class="id">y</span>}) ({<span class="id">subtype</span> <span class="id">y</span> <span class="id">x</span>} + {~ <span class="id">subtype</span> <span class="id">y</span> <span class="id">x</span>})).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof1113')">Proof.</div>
<div class="proofscript" id="proof1113">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Ltac</span> <span class="id">simp</span> := <span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| [<span class="id">H</span>:(@<span class="id">eq</span> <span class="id">bool</span> ?<span class="id">x</span> ?<span class="id">x</span>) |- <span class="id">_</span> ] =&gt; <span class="tactic">generalize</span> (<span class="id">UIP_refl_dec</span> <span class="id">bool_dec</span> <span class="id">H</span>); <span class="tactic">intro</span>; <span class="tactic">subst</span> <span class="id">H</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">x</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Hint</span> <span class="id">Constructors</span> <span class="id">subtype</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">revert</span> <span class="id">y</span>; <span class="tactic">induction</span> <span class="id">x</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;; <span class="tactic">intros</span> <span class="id">y</span>; <span class="tactic">destruct</span> <span class="id">y</span> <span class="kwd">as</span> [<span class="id">y</span> <span class="id">pfy</span>]; <span class="tactic">destruct</span> <span class="id">y</span>; <span class="id">constructor</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">try</span> <span class="id">solve</span>[<span class="id">right</span>; <span class="tactic">inversion</span> 1 | <span class="id">left</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> *; <span class="tactic">repeat</span> <span class="id">simp</span>; <span class="tactic">eauto</span> ].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">destruct</span> (<span class="id">IHx</span> <span class="id">e</span> (<span class="id">exist</span> <span class="id">_</span> <span class="id">y</span> <span class="id">pfy</span>)) <span class="kwd">as</span> [[?|?]<span class="id">_</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">left</span>. <span class="tactic">repeat</span> <span class="tactic">rewrite</span> (<span class="id">Coll_canon</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">right</span>. <span class="tactic">intro</span> <span class="id">ss</span>; <span class="tactic">apply</span> <span class="id">n</span>. <span class="tactic">inversion</span> <span class="id">ss</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">erewrite</span> (<span class="id">rtype_ext</span>); <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">destruct</span> <span class="id">r1</span>; <span class="tactic">destruct</span> <span class="id">r2</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">erewrite</span> (<span class="id">rtype_ext</span> <span class="id">e</span>); <span class="id">erewrite</span> (<span class="id">rtype_ext</span> <span class="id">pfy</span>); <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">destruct</span> (<span class="id">IHx</span> <span class="id">e</span> (<span class="id">exist</span> <span class="id">_</span> <span class="id">y</span> <span class="id">pfy</span>)) <span class="kwd">as</span> [<span class="id">_</span>[?|?]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">left</span>. <span class="tactic">repeat</span> <span class="tactic">rewrite</span> (<span class="id">Coll_canon</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">right</span>. <span class="tactic">intro</span> <span class="id">ss</span>; <span class="tactic">apply</span> <span class="id">n</span>. <span class="tactic">inversion</span> <span class="id">ss</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">erewrite</span> (<span class="id">rtype_ext</span>); <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">destruct</span> <span class="id">r1</span>; <span class="tactic">destruct</span> <span class="id">r2</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">erewrite</span> (<span class="id">rtype_ext</span> <span class="id">e</span>); <span class="id">erewrite</span> (<span class="id">rtype_ext</span> <span class="id">pfy</span>); <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">rename</span> <span class="id">srl</span> <span class="id">into</span> <span class="id">srl0</span>; <span class="tactic">rename</span> <span class="id">r</span> <span class="id">into</span> <span class="id">srl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">sub</span>:{<span class="kwd">forall</span> <span class="id">s</span> <span class="id">r</span>' <span class="id">pf</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">lookup</span> <span class="id">string_dec</span> <span class="id">srl0</span> <span class="id">s</span> = <span class="id">Some</span> <span class="id">r</span>' -&gt; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">r</span> <span class="id">pf</span>, <span class="id">lookup</span> <span class="id">string_dec</span> <span class="id">srl</span> <span class="id">s</span> = <span class="id">Some</span> <span class="id">r</span> /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">subtype</span> (<span class="id">exist</span> <span class="id">_</span> <span class="id">r</span> <span class="id">pf</span>) (<span class="id">exist</span> <span class="id">_</span> <span class="id">r</span>' <span class="id">pf</span>')} + {~ (<span class="kwd">forall</span> <span class="id">s</span> <span class="id">r</span>' <span class="id">pf</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">lookup</span> <span class="id">string_dec</span> <span class="id">srl0</span> <span class="id">s</span> = <span class="id">Some</span> <span class="id">r</span>' -&gt; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">r</span> <span class="id">pf</span>, <span class="id">lookup</span> <span class="id">string_dec</span> <span class="id">srl</span> <span class="id">s</span> = <span class="id">Some</span> <span class="id">r</span> /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">subtype</span> (<span class="id">exist</span> <span class="id">_</span> <span class="id">r</span> <span class="id">pf</span>) (<span class="id">exist</span> <span class="id">_</span> <span class="id">r</span>' <span class="id">pf</span>'))}).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">induction</span> <span class="id">srl0</span>; <span class="tactic">simpl</span>; [<span class="id">left</span>; <span class="tactic">intros</span>; <span class="tactic">discriminate</span> | ].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">a</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">case_eq</span> (<span class="id">lookup</span> <span class="id">string_dec</span> <span class="id">srl</span> <span class="id">s</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">intros</span> ? <span class="id">inn</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">wfr</span>:<span class="id">wf_rtype</span>₀ <span class="id">r</span> = <span class="id">true</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">by</span> (<span class="tactic">eapply</span> (<span class="id">wf_rtype</span>₀<span class="id">_Rec_In</span> <span class="id">pfy</span>); <span class="tactic">simpl</span>; <span class="id">left</span>; <span class="tactic">reflexivity</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">Forallt_In</span> <span class="id">H</span> <span class="id">_</span> (<span class="id">lookup_in</span> <span class="id">string_dec</span> <span class="id">_</span> <span class="id">inn</span>) (<span class="id">wf_rtype</span>₀<span class="id">_Rec_In</span> <span class="id">e</span> <span class="id">_</span> <span class="id">_</span> ((<span class="id">lookup_in</span> <span class="id">string_dec</span> <span class="id">_</span> <span class="id">inn</span>))) (<span class="id">exist</span> <span class="id">_</span> <span class="id">r</span> <span class="id">wfr</span>)) <span class="kwd">as</span> [[?|?]<span class="id">_</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">IHsrl0</span> (<span class="id">wf_rtype</span>₀<span class="id">_cons_tail</span> <span class="id">pfy</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">left</span>. <span class="tactic">intros</span> ? ? ? <span class="id">eqq</span>. <span class="id">match_destr_in</span> <span class="id">eqq</span>; <span class="tactic">subst</span>; <span class="tactic">eauto</span> 2.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">eqq</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> (<span class="id">rtype_ext</span> <span class="id">pf</span>' <span class="id">wfr</span>); <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">right</span>; <span class="tactic">intro</span> <span class="id">nin</span>. <span class="tactic">apply</span> <span class="id">n</span>; <span class="tactic">intros</span> <span class="id">ss</span> <span class="id">rr</span> <span class="id">rrpf</span> <span class="id">sin</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id">nin</span> <span class="id">ss</span> <span class="id">rr</span>). <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">match_destr_in</span> <span class="id">nin</span>; [| <span class="tactic">intuition</span> ].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">wf_rtype</span>₀<span class="id">_cons_nin</span> <span class="kwd">in</span> <span class="id">pfy</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">right</span>; <span class="tactic">intro</span> <span class="id">nin</span>. <span class="id">specialize</span> (<span class="id">nin</span> <span class="id">s</span> <span class="id">r</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">match_destr_in</span> <span class="id">nin</span>; [| <span class="tactic">intuition</span> ].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">nin</span> <span class="id">wfr</span> (<span class="id">eq_refl</span> <span class="id">_</span>)) <span class="kwd">as</span> [? [?[??]]]; <span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">inn</span> <span class="kwd">in</span> <span class="id">H0</span>. <span class="tactic">inversion</span> <span class="id">H0</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">n</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> (<span class="id">rtype_ext</span> <span class="id">_</span> <span class="id">x0</span>). <span class="tactic">trivial</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">right</span>; <span class="tactic">intro</span> <span class="id">nin</span>. <span class="id">specialize</span> (<span class="id">nin</span> <span class="id">s</span> <span class="id">r</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">match_destr_in</span> <span class="id">nin</span>; [| <span class="tactic">intuition</span> ].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">wfr</span>:<span class="id">wf_rtype</span>₀ <span class="id">r</span> = <span class="id">true</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">by</span> (<span class="tactic">eapply</span> (<span class="id">wf_rtype</span>₀<span class="id">_Rec_In</span> <span class="id">pfy</span>); <span class="tactic">simpl</span>; <span class="id">left</span>; <span class="tactic">reflexivity</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">nin</span> <span class="id">wfr</span> (<span class="id">eq_refl</span> <span class="id">_</span>)) <span class="kwd">as</span> [? [?[??]]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">destruct</span> <span class="id">sub</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">destruct</span> <span class="id">k0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">left</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">from_Rec</span>₀ <span class="id">srl</span> <span class="id">e</span>) <span class="kwd">as</span> [? [?[??]]]; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">H1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">from_Rec</span>₀ <span class="id">_</span> <span class="id">pfy</span>) <span class="kwd">as</span> [? [?[??]]]; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">H2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">econstructor</span>; <span class="tactic">try</span> <span class="tactic">discriminate</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> ? ? <span class="id">lo</span>. <span class="tactic">destruct</span> <span class="id">r</span>'.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">lookup_map_some</span>' <span class="kwd">in</span> <span class="id">lo</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">e0</span> <span class="id">_</span> <span class="id">_</span> <span class="id">e1</span> <span class="id">lo</span>) <span class="kwd">as</span> [?[?[??]]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- (<span class="id">lookup_map_some</span>' <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">x5</span>) <span class="kwd">in</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> (<span class="id">exist</span> <span class="id">_</span> <span class="id">x4</span> <span class="id">x5</span>). <span class="tactic">intuition</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">k</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">right</span>; <span class="tactic">inversion</span> 1; <span class="tactic">intuition</span>; <span class="tactic">discriminate</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">incl_list_dec</span> <span class="id">string_dec</span> (<span class="id">domain</span> <span class="id">srl</span>) (<span class="id">domain</span> <span class="id">srl0</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">left</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">from_Rec</span>₀ <span class="id">srl</span> <span class="id">e</span>) <span class="kwd">as</span> [? [?[??]]]; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">H1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">from_Rec</span>₀ <span class="id">_</span> <span class="id">pfy</span>) <span class="kwd">as</span> [? [?[??]]]; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">H2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">constructor</span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">r</span>'.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> (<span class="id">lookup_map_some</span>' <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">e1</span>) <span class="kwd">in</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">e0</span> <span class="id">_</span> <span class="id">_</span> <span class="id">e1</span> <span class="id">H0</span>) <span class="kwd">as</span> [?[?[??]]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- (<span class="id">lookup_map_some</span>' <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">x5</span>) <span class="kwd">in</span> <span class="id">H3</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> (<span class="id">exist</span> <span class="id">_</span> <span class="id">x4</span> <span class="id">x5</span>). <span class="tactic">intuition</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intuition</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id">i</span> <span class="id">s</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">domain</span> <span class="kwd">in</span> <span class="id">i</span>; <span class="tactic">repeat</span> <span class="tactic">rewrite</span> <span class="id">map_map</span> <span class="kwd">in</span> <span class="id">i</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">i</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">right</span>; <span class="tactic">inversion</span> 1; <span class="id">rtype_equalizer</span>; <span class="tactic">subst</span>; <span class="tactic">eauto</span> 2.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intuition</span>.  <span class="tactic">apply</span> <span class="id">n</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> ? .<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">domain</span>; <span class="tactic">repeat</span> <span class="tactic">rewrite</span> <span class="id">map_map</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">right</span>; <span class="tactic">inversion</span> 1; <span class="tactic">apply</span> <span class="id">n</span>; <span class="id">rtype_equalizer</span>; <span class="tactic">subst</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- (<span class="id">lookup_map_some</span>' <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">pf</span>') <span class="kwd">in</span> <span class="id">H1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">H4</span> <span class="id">_</span> <span class="id">_</span> <span class="id">H1</span>) <span class="kwd">as</span> [? [??]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">x</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">x</span>; <span class="id">exists</span> <span class="id">e0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- (<span class="id">lookup_map_some</span>' <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">e0</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intuition</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">rename</span> <span class="id">srl</span> <span class="id">into</span> <span class="id">srl0</span>; <span class="tactic">rename</span> <span class="id">r</span> <span class="id">into</span> <span class="id">srl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">sub</span>:{<span class="kwd">forall</span> <span class="id">s</span> <span class="id">r</span>' <span class="id">pf</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">lookup</span> <span class="id">string_dec</span> <span class="id">srl</span> <span class="id">s</span> = <span class="id">Some</span> <span class="id">r</span>' -&gt; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">r</span> <span class="id">pf</span>, <span class="id">lookup</span> <span class="id">string_dec</span> <span class="id">srl0</span> <span class="id">s</span> = <span class="id">Some</span> <span class="id">r</span> /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">subtype</span> (<span class="id">exist</span> <span class="id">_</span> <span class="id">r</span> <span class="id">pf</span>) (<span class="id">exist</span> <span class="id">_</span> <span class="id">r</span>' <span class="id">pf</span>')} + {~ (<span class="kwd">forall</span> <span class="id">s</span> <span class="id">r</span>' <span class="id">pf</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">lookup</span> <span class="id">string_dec</span> <span class="id">srl</span> <span class="id">s</span> = <span class="id">Some</span> <span class="id">r</span>' -&gt; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">r</span> <span class="id">pf</span>, <span class="id">lookup</span> <span class="id">string_dec</span> <span class="id">srl0</span> <span class="id">s</span> = <span class="id">Some</span> <span class="id">r</span> /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">subtype</span> (<span class="id">exist</span> <span class="id">_</span> <span class="id">r</span> <span class="id">pf</span>) (<span class="id">exist</span> <span class="id">_</span> <span class="id">r</span>' <span class="id">pf</span>'))}).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">induction</span> <span class="id">srl</span>; <span class="tactic">simpl</span>; [<span class="id">left</span>; <span class="tactic">intros</span>; <span class="tactic">discriminate</span> | ].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">a</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">case_eq</span> (<span class="id">lookup</span> <span class="id">string_dec</span> <span class="id">srl0</span> <span class="id">s</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">intros</span> ? <span class="id">inn</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">wfr0</span>:<span class="id">wf_rtype</span>₀ <span class="id">r0</span> = <span class="id">true</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">by</span> (<span class="tactic">eapply</span> (<span class="id">wf_rtype</span>₀<span class="id">_Rec_In</span> <span class="id">pfy</span>); <span class="tactic">eapply</span> <span class="id">lookup_in</span>; <span class="tactic">eauto</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">wfr</span>:<span class="id">wf_rtype</span>₀ <span class="id">r</span> = <span class="id">true</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">by</span> (<span class="tactic">eapply</span> (<span class="id">wf_rtype</span>₀<span class="id">_Rec_In</span> <span class="id">e</span>); <span class="tactic">simpl</span>; <span class="id">left</span>; <span class="tactic">reflexivity</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">invcs</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">H2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">H2</span> <span class="id">wfr</span> (<span class="id">exist</span> <span class="id">_</span> <span class="id">r0</span> <span class="id">wfr0</span>)) <span class="kwd">as</span> [<span class="id">_</span> <span class="id">issub</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">destruct</span> <span class="id">issub</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">destruct</span> (<span class="id">IHsrl</span> <span class="id">H3</span> (<span class="id">wf_rtype</span>₀<span class="id">_cons_tail</span> <span class="id">e</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">left</span>; <span class="tactic">intros</span> ? ? ? <span class="id">eqq</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">match_destr_in</span> <span class="id">eqq</span>; <span class="tactic">subst</span>; <span class="tactic">eauto</span> 2.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">eqq</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> (<span class="id">rtype_ext</span> <span class="id">pf</span>' <span class="id">wfr</span>); <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">right</span>; <span class="tactic">intro</span> <span class="id">nin</span>. <span class="tactic">apply</span> <span class="id">n</span>; <span class="tactic">intros</span> <span class="id">ss</span> <span class="id">rr</span> <span class="id">rrpf</span> <span class="id">sin</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id">nin</span> <span class="id">ss</span> <span class="id">rr</span>). <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">match_destr_in</span> <span class="id">nin</span>; [| <span class="tactic">intuition</span> ].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">wf_rtype</span>₀<span class="id">_cons_nin</span> <span class="kwd">in</span> <span class="id">e</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">right</span>; <span class="tactic">intro</span> <span class="id">nin</span>. <span class="id">specialize</span> (<span class="id">nin</span> <span class="id">s</span> <span class="id">r</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">match_destr_in</span> <span class="id">nin</span>; [| <span class="tactic">intuition</span> ].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">nin</span> <span class="id">wfr</span> (<span class="id">eq_refl</span> <span class="id">_</span>)) <span class="kwd">as</span> [? [?[??]]]; <span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">inn</span> <span class="kwd">in</span> <span class="id">H</span>. <span class="tactic">inversion</span> <span class="id">H</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">n</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> (<span class="id">rtype_ext</span> <span class="id">_</span> <span class="id">x0</span>). <span class="tactic">trivial</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">right</span>; <span class="tactic">intro</span> <span class="id">nin</span>. <span class="id">specialize</span> (<span class="id">nin</span> <span class="id">s</span> <span class="id">r</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">match_destr_in</span> <span class="id">nin</span>; [| <span class="tactic">intuition</span> ].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">wfr</span>:<span class="id">wf_rtype</span>₀ <span class="id">r</span> = <span class="id">true</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">by</span> (<span class="tactic">eapply</span> (<span class="id">wf_rtype</span>₀<span class="id">_Rec_In</span> <span class="id">e</span>); <span class="tactic">simpl</span>; <span class="id">left</span>; <span class="tactic">reflexivity</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">nin</span> <span class="id">wfr</span> (<span class="id">eq_refl</span> <span class="id">_</span>)) <span class="kwd">as</span> [? [?[??]]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">destruct</span> <span class="id">sub</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* {<span class="tactic">destruct</span> <span class="id">k</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">left</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">from_Rec</span>₀ <span class="id">srl</span> <span class="id">e</span>) <span class="kwd">as</span> [? [?[??]]]; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">H1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">from_Rec</span>₀ <span class="id">_</span> <span class="id">pfy</span>) <span class="kwd">as</span> [? [?[??]]]; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">H2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">econstructor</span>; <span class="tactic">try</span> <span class="tactic">discriminate</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> ? ? <span class="id">lo</span>. <span class="tactic">destruct</span> <span class="id">r</span>'.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">lookup_map_some</span>' <span class="kwd">in</span> <span class="id">lo</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">e0</span> <span class="id">_</span> <span class="id">_</span> <span class="id">e1</span> <span class="id">lo</span>) <span class="kwd">as</span> [?[?[??]]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- (<span class="id">lookup_map_some</span>' <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">x5</span>) <span class="kwd">in</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> (<span class="id">exist</span> <span class="id">_</span> <span class="id">x4</span> <span class="id">x5</span>). <span class="tactic">intuition</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">destruct</span> <span class="id">k0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">right</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> 1; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intuition</span>; <span class="tactic">discriminate</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">destruct</span> (<span class="id">incl_list_dec</span> <span class="id">string_dec</span> (<span class="id">domain</span> <span class="id">srl0</span>) (<span class="id">domain</span> <span class="id">srl</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">left</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">from_Rec</span>₀ <span class="id">srl</span> <span class="id">e</span>) <span class="kwd">as</span> [? [?[??]]]; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">H1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">from_Rec</span>₀ <span class="id">_</span> <span class="id">pfy</span>) <span class="kwd">as</span> [? [?[??]]]; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">H2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">constructor</span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">destruct</span> <span class="id">r</span>'.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> (<span class="id">lookup_map_some</span>' <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">e1</span>) <span class="kwd">in</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">e0</span> <span class="id">_</span> <span class="id">_</span> <span class="id">e1</span> <span class="id">H0</span>) <span class="kwd">as</span> [?[?[??]]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- (<span class="id">lookup_map_some</span>' <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">x5</span>) <span class="kwd">in</span> <span class="id">H3</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> (<span class="id">exist</span> <span class="id">_</span> <span class="id">x4</span> <span class="id">x5</span>). <span class="tactic">intuition</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">intuition</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id">i</span> <span class="id">s</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">domain</span> <span class="kwd">in</span> <span class="id">i</span>; <span class="tactic">repeat</span> <span class="tactic">rewrite</span> <span class="id">map_map</span> <span class="kwd">in</span> <span class="id">i</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">i</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">right</span>; <span class="tactic">inversion</span> 1; <span class="id">rtype_equalizer</span>; <span class="tactic">subst</span>; <span class="tactic">eauto</span> 2.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intuition</span>.  <span class="tactic">apply</span> <span class="id">n</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> ? .<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">domain</span>; <span class="tactic">repeat</span> <span class="tactic">rewrite</span> <span class="id">map_map</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">right</span>; <span class="tactic">inversion</span> 1; <span class="tactic">apply</span> <span class="id">n</span>; <span class="id">rtype_equalizer</span>; <span class="tactic">subst</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- (<span class="id">lookup_map_some</span>' <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">pf</span>') <span class="kwd">in</span> <span class="id">H1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">H4</span> <span class="id">_</span> <span class="id">_</span> <span class="id">H1</span>) <span class="kwd">as</span> [? [??]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">x</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">x</span>; <span class="id">exists</span> <span class="id">e0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- (<span class="id">lookup_map_some</span>' <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">e0</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intuition</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">destruct</span> (<span class="id">Either</span>₀<span class="id">_wf_inv</span> <span class="id">e</span>) <span class="kwd">as</span> [<span class="id">pfl1</span> <span class="id">pfr1</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">Either</span>₀<span class="id">_wf_inv</span> <span class="id">pfy</span>) <span class="kwd">as</span> [<span class="id">pfl2</span> <span class="id">pfr2</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">IHx1</span> <span class="id">pfl1</span> (<span class="id">exist</span> <span class="id">_</span> <span class="id">_</span> <span class="id">pfl2</span>)) <span class="kwd">as</span> [[?|?]<span class="id">_</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">destruct</span> (<span class="id">IHx2</span> <span class="id">pfr1</span> (<span class="id">exist</span> <span class="id">_</span> <span class="id">_</span> <span class="id">pfr2</span>)) <span class="kwd">as</span> [[?|?]<span class="id">_</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">left</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> (<span class="id">Either_canon</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">pfl1</span> <span class="id">pfr1</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> (<span class="id">Either_canon</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">pfl2</span> <span class="id">pfr2</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">right</span>; <span class="tactic">inversion</span> 1; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">n</span>. <span class="tactic">rewrite</span> (<span class="id">rtype_ext</span> <span class="id">pfr1</span> <span class="id">pfr2</span>). <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> (<span class="id">Either_canon</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">pfl1</span> <span class="id">pfr1</span>) <span class="kwd">in</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> (<span class="id">Either_canon</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">pfl2</span> <span class="id">pfr2</span>) <span class="kwd">in</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">n</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H</span>; <span class="id">rtype_equalizer</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> (<span class="id">rtype_ext</span> <span class="id">pfr1</span> <span class="id">pfr2</span>). <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> (<span class="id">rtype_ext</span> <span class="id">pfr1</span> (<span class="id">proj2_sig</span> <span class="id">r1</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> (<span class="id">rtype_ext</span> <span class="id">pfr2</span> (<span class="id">proj2_sig</span> <span class="id">r2</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">r1</span>; <span class="tactic">destruct</span> <span class="id">r2</span>. <span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">trivial</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">right</span>; <span class="tactic">inversion</span> 1; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">n</span>. <span class="tactic">rewrite</span> (<span class="id">rtype_ext</span> <span class="id">pfl1</span> <span class="id">pfl2</span>). <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> (<span class="id">Either_canon</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">pfl1</span> <span class="id">pfr1</span>) <span class="kwd">in</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> (<span class="id">Either_canon</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">pfl2</span> <span class="id">pfr2</span>) <span class="kwd">in</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">n</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H</span>. <span class="id">rtype_equalizer</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>. <span class="tactic">rewrite</span> (<span class="id">rtype_ext</span> <span class="id">pfl1</span> <span class="id">pfl2</span>). <span class="tactic">eauto</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> (<span class="id">rtype_ext</span> <span class="id">pfl1</span> (<span class="id">proj2_sig</span> <span class="id">l1</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> (<span class="id">rtype_ext</span> <span class="id">pfl2</span> (<span class="id">proj2_sig</span> <span class="id">l2</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">l1</span>; <span class="tactic">destruct</span> <span class="id">l2</span>. <span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">trivial</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">destruct</span> (<span class="id">Either</span>₀<span class="id">_wf_inv</span> <span class="id">e</span>) <span class="kwd">as</span> [<span class="id">pfl1</span> <span class="id">pfr1</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">Either</span>₀<span class="id">_wf_inv</span> <span class="id">pfy</span>) <span class="kwd">as</span> [<span class="id">pfl2</span> <span class="id">pfr2</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">IHx1</span> <span class="id">pfl1</span> (<span class="id">exist</span> <span class="id">_</span> <span class="id">_</span> <span class="id">pfl2</span>)) <span class="kwd">as</span> [<span class="id">_</span>[?|?]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">destruct</span> (<span class="id">IHx2</span> <span class="id">pfr1</span> (<span class="id">exist</span> <span class="id">_</span> <span class="id">_</span> <span class="id">pfr2</span>)) <span class="kwd">as</span> [<span class="id">_</span>[?|?]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">left</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> (<span class="id">Either_canon</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">pfl1</span> <span class="id">pfr1</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> (<span class="id">Either_canon</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">pfl2</span> <span class="id">pfr2</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">right</span>; <span class="tactic">inversion</span> 1; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">n</span>. <span class="tactic">rewrite</span> (<span class="id">rtype_ext</span> <span class="id">pfr1</span> <span class="id">pfr2</span>). <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> (<span class="id">Either_canon</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">pfl1</span> <span class="id">pfr1</span>) <span class="kwd">in</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> (<span class="id">Either_canon</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">pfl2</span> <span class="id">pfr2</span>) <span class="kwd">in</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">n</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">inversion</span> <span class="id">H</span>; <span class="id">rtype_equalizer</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">rewrite</span> (<span class="id">rtype_ext</span> <span class="id">pfr1</span> <span class="id">pfr2</span>). <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> (<span class="id">rtype_ext</span> <span class="id">pfr2</span> (<span class="id">proj2_sig</span> <span class="id">r1</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> (<span class="id">rtype_ext</span> <span class="id">pfr1</span> (<span class="id">proj2_sig</span> <span class="id">r2</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">r1</span>; <span class="tactic">destruct</span> <span class="id">r2</span>. <span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">trivial</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">right</span>; <span class="tactic">inversion</span> 1; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">n</span>. <span class="tactic">rewrite</span> (<span class="id">rtype_ext</span> <span class="id">pfl1</span> <span class="id">pfl2</span>). <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> (<span class="id">Either_canon</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">pfl1</span> <span class="id">pfr1</span>) <span class="kwd">in</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> (<span class="id">Either_canon</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">pfl2</span> <span class="id">pfr2</span>) <span class="kwd">in</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">n</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H</span>. <span class="id">rtype_equalizer</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>. <span class="tactic">rewrite</span> (<span class="id">rtype_ext</span> <span class="id">pfl1</span> <span class="id">pfl2</span>). <span class="tactic">eauto</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> (<span class="id">rtype_ext</span> <span class="id">pfl2</span> (<span class="id">proj2_sig</span> <span class="id">l1</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> (<span class="id">rtype_ext</span> <span class="id">pfl1</span> (<span class="id">proj2_sig</span> <span class="id">l2</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">l1</span>; <span class="tactic">destruct</span> <span class="id">l2</span>. <span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">trivial</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">destruct</span> (<span class="id">Arrow</span>₀<span class="id">_wf_inv</span> <span class="id">e</span>) <span class="kwd">as</span> [<span class="id">pfl1</span> <span class="id">pfr1</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">Arrow</span>₀<span class="id">_wf_inv</span> <span class="id">pfy</span>) <span class="kwd">as</span> [<span class="id">pfl2</span> <span class="id">pfr2</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">IHx1</span> <span class="id">pfl1</span> (<span class="id">exist</span> <span class="id">_</span> <span class="id">_</span> <span class="id">pfl2</span>)) <span class="kwd">as</span> [?[?|?]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">destruct</span> (<span class="id">IHx2</span> <span class="id">pfr1</span> (<span class="id">exist</span> <span class="id">_</span> <span class="id">_</span> <span class="id">pfr2</span>)) <span class="kwd">as</span> [[?|?]?].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">left</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> (<span class="id">Arrow_canon</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">pfl1</span> <span class="id">pfr1</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> (<span class="id">Arrow_canon</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">pfl2</span> <span class="id">pfr2</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">econstructor</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">right</span>; <span class="tactic">inversion</span> 1; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">n</span>. <span class="tactic">rewrite</span> (<span class="id">rtype_ext</span> <span class="id">pfr1</span> <span class="id">pfr2</span>). <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> (<span class="id">Arrow_canon</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">pfl1</span> <span class="id">pfr1</span>) <span class="kwd">in</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> (<span class="id">Arrow_canon</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">pfl2</span> <span class="id">pfr2</span>) <span class="kwd">in</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">n</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H</span>; <span class="id">rtype_equalizer</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> (<span class="id">rtype_ext</span> <span class="id">pfr1</span> <span class="id">pfr2</span>). <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> (<span class="id">rtype_ext</span> <span class="id">pfr1</span> (<span class="id">proj2_sig</span> <span class="id">out1</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> (<span class="id">rtype_ext</span> <span class="id">pfr2</span> (<span class="id">proj2_sig</span> <span class="id">out2</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">out1</span>; <span class="tactic">destruct</span> <span class="id">out2</span>. <span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">trivial</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">right</span>; <span class="tactic">inversion</span> 1; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">n</span>. <span class="tactic">rewrite</span> (<span class="id">rtype_ext</span> <span class="id">pfl1</span> <span class="id">pfl2</span>). <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> (<span class="id">Arrow_canon</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">pfl1</span> <span class="id">pfr1</span>) <span class="kwd">in</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> (<span class="id">Arrow_canon</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">pfl2</span> <span class="id">pfr2</span>) <span class="kwd">in</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">n</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H</span>. <span class="id">rtype_equalizer</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>. <span class="tactic">rewrite</span> (<span class="id">rtype_ext</span> <span class="id">pfl1</span> <span class="id">pfl2</span>). <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rtype_equalizer</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> (<span class="id">rtype_ext</span> <span class="id">pfl1</span> (<span class="id">proj2_sig</span> <span class="id">in1</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> (<span class="id">rtype_ext</span> <span class="id">pfl2</span> (<span class="id">proj2_sig</span> <span class="id">in2</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">in1</span>; <span class="tactic">destruct</span> <span class="id">in2</span>. <span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">trivial</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">destruct</span> (<span class="id">Arrow</span>₀<span class="id">_wf_inv</span> <span class="id">e</span>) <span class="kwd">as</span> [<span class="id">pfl1</span> <span class="id">pfr1</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">Arrow</span>₀<span class="id">_wf_inv</span> <span class="id">pfy</span>) <span class="kwd">as</span> [<span class="id">pfl2</span> <span class="id">pfr2</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">IHx1</span> <span class="id">pfl1</span> (<span class="id">exist</span> <span class="id">_</span> <span class="id">_</span> <span class="id">pfl2</span>)) <span class="kwd">as</span> [[?|?]?].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">destruct</span> (<span class="id">IHx2</span> <span class="id">pfr1</span> (<span class="id">exist</span> <span class="id">_</span> <span class="id">_</span> <span class="id">pfr2</span>)) <span class="kwd">as</span> [?[?|?]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">left</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> (<span class="id">Arrow_canon</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">pfl1</span> <span class="id">pfr1</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> (<span class="id">Arrow_canon</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">pfl2</span> <span class="id">pfr2</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">econstructor</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">right</span>; <span class="tactic">inversion</span> 1; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">n</span>. <span class="tactic">rewrite</span> (<span class="id">rtype_ext</span> <span class="id">pfr1</span> <span class="id">pfr2</span>). <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> (<span class="id">Arrow_canon</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">pfl1</span> <span class="id">pfr1</span>) <span class="kwd">in</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> (<span class="id">Arrow_canon</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">pfl2</span> <span class="id">pfr2</span>) <span class="kwd">in</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">n</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H</span>; <span class="id">rtype_equalizer</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> (<span class="id">rtype_ext</span> <span class="id">pfr1</span> <span class="id">pfr2</span>). <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> (<span class="id">rtype_ext</span> <span class="id">pfr1</span> (<span class="id">proj2_sig</span> <span class="id">out2</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> (<span class="id">rtype_ext</span> <span class="id">pfr2</span> (<span class="id">proj2_sig</span> <span class="id">out1</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">out1</span>; <span class="tactic">destruct</span> <span class="id">out2</span>. <span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">trivial</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">right</span>; <span class="tactic">inversion</span> 1; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">n</span>. <span class="tactic">rewrite</span> (<span class="id">rtype_ext</span> <span class="id">pfl1</span> <span class="id">pfl2</span>). <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> (<span class="id">Arrow_canon</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">pfl1</span> <span class="id">pfr1</span>) <span class="kwd">in</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> (<span class="id">Arrow_canon</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">pfl2</span> <span class="id">pfr2</span>) <span class="kwd">in</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">n</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H</span>. <span class="id">rtype_equalizer</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>. <span class="tactic">rewrite</span> (<span class="id">rtype_ext</span> <span class="id">pfl1</span> <span class="id">pfl2</span>). <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rtype_equalizer</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> (<span class="id">rtype_ext</span> <span class="id">pfl1</span> (<span class="id">proj2_sig</span> <span class="id">in2</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> (<span class="id">rtype_ext</span> <span class="id">pfl2</span> (<span class="id">proj2_sig</span> <span class="id">in1</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">in1</span>; <span class="tactic">destruct</span> <span class="id">in2</span>. <span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">trivial</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">destruct</span> (<span class="id">sub_brands_dec</span> <span class="id">brand_relation_brands</span> <span class="id">b</span> <span class="id">b0</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">left</span>; <span class="tactic">repeat</span> <span class="tactic">rewrite</span> <span class="id">Brand_canon</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">right</span>. <span class="tactic">inversion</span> 1; <span class="tactic">subst</span>; <span class="tactic">eauto</span> 2.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">intuition</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">apply</span> <span class="id">n</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="tactic">rewrite</span> (<span class="id">canon_brands_equiv</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">trivial</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">destruct</span> (<span class="id">sub_brands_dec</span> <span class="id">brand_relation_brands</span> <span class="id">b0</span> <span class="id">b</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">left</span>; <span class="tactic">repeat</span> <span class="tactic">rewrite</span> <span class="id">Brand_canon</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">right</span>. <span class="tactic">inversion</span> 1; <span class="tactic">subst</span>; <span class="tactic">eauto</span> 2.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">intuition</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">apply</span> <span class="id">n</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="tactic">rewrite</span> (<span class="id">canon_brands_equiv</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">trivial</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">destruct</span> (<span class="id">foreign_type_sub_dec</span> <span class="id">ft</span> <span class="id">ft0</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">left</span>. <span class="tactic">repeat</span> <span class="tactic">rewrite</span> <span class="id">Foreign_canon</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">SForeign</span>; <span class="tactic">trivial</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">right</span>; <span class="tactic">intros</span> <span class="id">sub</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">invcs</span> <span class="id">sub</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">apply</span> <span class="id">n</span>; <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">intuition</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">destruct</span> (<span class="id">foreign_type_sub_dec</span> <span class="id">ft0</span> <span class="id">ft</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">left</span>. <span class="tactic">repeat</span> <span class="tactic">rewrite</span> <span class="id">Foreign_canon</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">SForeign</span>; <span class="tactic">trivial</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">right</span>; <span class="tactic">intros</span> <span class="id">sub</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">invcs</span> <span class="id">sub</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">apply</span> <span class="id">n</span>; <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">intuition</span>.<br/>
&nbsp;&nbsp;Defined.</div>
&nbsp;&nbsp;<br/>
&nbsp;&nbsp;<span class="kwd">Theorem</span> <span class="id">subtype_dec</span> <span class="id">x</span> <span class="id">y</span> : {<span class="id">subtype</span> <span class="id">x</span> <span class="id">y</span>} + {~ <span class="id">subtype</span> <span class="id">x</span> <span class="id">y</span>}.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof1114')">Proof.</div>
<div class="proofscript" id="proof1114">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">subtype_both_dec</span> <span class="id">x</span> <span class="id">y</span>) <span class="kwd">as</span> [? <span class="id">_</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">trivial</span>.<br/>
&nbsp;&nbsp;Defined.</div>
<br/>
<span class="kwd">End</span> <span class="id">subtype</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">subtype_ext</span> {<span class="id">ftype</span>:<span class="id">foreign_type</span>} {<span class="id">br</span>:<span class="id">brand_relation</span>} {<span class="id">a</span> <span class="id">b</span> <span class="id">pfa</span> <span class="id">pfb</span>} :<br/>
&nbsp;&nbsp;<span class="id">subtype</span> (<span class="id">exist</span> <span class="id">_</span> <span class="id">a</span> <span class="id">pfa</span>) (<span class="id">exist</span> <span class="id">_</span> <span class="id">b</span> <span class="id">pfb</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">pfa</span>' <span class="id">pfb</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">subtype</span> (<span class="id">exist</span> <span class="id">_</span> <span class="id">a</span> <span class="id">pfa</span>') (<span class="id">exist</span> <span class="id">_</span> <span class="id">b</span> <span class="id">pfb</span>').<br/>
<div class="toggleproof" onclick="toggleDisplay('proof1115')">Proof.</div>
<div class="proofscript" id="proof1115">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> (<span class="id">rtype_ext</span> <span class="id">pfa</span>' <span class="id">pfa</span>).<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> (<span class="id">rtype_ext</span> <span class="id">pfb</span>' <span class="id">pfb</span>).<br/>
&nbsp;&nbsp;<span class="tactic">trivial</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">subtype_Either_inv</span> {<span class="id">ftype</span>:<span class="id">foreign_type</span>} {<span class="id">br</span>:<span class="id">brand_relation</span>} {τ<span class="id">l</span> τ<span class="id">r</span> τ<span class="id">l</span>' τ<span class="id">r</span>'} :<br/>
&nbsp;&nbsp;<span class="id">subtype</span> (<span class="id">Either</span> τ<span class="id">l</span> τ<span class="id">r</span>) (<span class="id">Either</span> τ<span class="id">l</span>' τ<span class="id">r</span>') -&gt;<br/>
&nbsp;&nbsp;<span class="id">subtype</span> τ<span class="id">l</span> τ<span class="id">l</span>'  /\<br/>
&nbsp;&nbsp;<span class="id">subtype</span> τ<span class="id">r</span> τ<span class="id">r</span>'.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof1116')">Proof.</div>
<div class="proofscript" id="proof1116">
&nbsp;&nbsp;<span class="tactic">inversion</span> 1; <span class="id">rtype_equalizer</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">subst</span>; <span class="tactic">split</span>; <span class="id">econstructor</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">subst</span>. <span class="tactic">intuition</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">subtype_Arrow_inv</span> {<span class="id">ftype</span>:<span class="id">foreign_type</span>} {<span class="id">br</span>:<span class="id">brand_relation</span>} {τ<span class="id">l</span> τ<span class="id">r</span> τ<span class="id">l</span>' τ<span class="id">r</span>'} :<br/>
&nbsp;&nbsp;<span class="id">subtype</span> (<span class="id">Arrow</span> τ<span class="id">l</span> τ<span class="id">r</span>) (<span class="id">Arrow</span> τ<span class="id">l</span>' τ<span class="id">r</span>') -&gt;<br/>
&nbsp;&nbsp;<span class="id">subtype</span> τ<span class="id">l</span>' τ<span class="id">l</span>  /\<br/>
&nbsp;&nbsp;<span class="id">subtype</span> τ<span class="id">r</span> τ<span class="id">r</span>'.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof1117')">Proof.</div>
<div class="proofscript" id="proof1117">
&nbsp;&nbsp;<span class="tactic">inversion</span> 1; <span class="id">rtype_equalizer</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">subst</span>; <span class="tactic">split</span>; <span class="id">econstructor</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">subst</span>. <span class="tactic">intuition</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Notation</span> "<span class="id">r1</span> &lt;: <span class="id">r2</span>" := (<span class="id">subtype</span> <span class="id">r1</span> <span class="id">r2</span>) (<span class="tactic">at</span> <span class="id">level</span> 70).<br/>
<br/>

</div>
<div class="footer"><hr/>Generated by <a href="https://github.com/xavierleroy/coq2html/">coq2html</div>
</body>
</html>
