
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Module Qcert.NNRCMR.Optim.NNRCMRRewrite</title>
<meta name="description" content="Documentation of Coq module Qcert.NNRCMR.Optim.NNRCMRRewrite" />
<link href="coq2html.css" rel="stylesheet" type="text/css" />
<script type="text/javascript" src="coq2html.js"> </script>
</head>

<body onload="hideAll('proofscript')">
<h1 class="title">Module Qcert.NNRCMR.Optim.NNRCMRRewrite</h1>
<div class="coq">
<br/>
<span class="kwd">Section</span> <span class="id"><a name="NNRCMRRewrite">NNRCMRRewrite</a></span>.<br/>
&nbsp;&nbsp;<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Strings.String.html">String</a></span>.<br/>
&nbsp;&nbsp;<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html">List</a></span>.<br/>
&nbsp;&nbsp;<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Arith.Arith.html">Arith</a></span>.<br/>
&nbsp;&nbsp;<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Classes.EquivDec.html">EquivDec</a></span>.<br/>
&nbsp;&nbsp;<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="Qcert.Utils.Utils.html">Utils</a></span>.<br/>
&nbsp;&nbsp;<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="Qcert.Common.CommonRuntime.html">CommonRuntime</a></span>.<br/>
&nbsp;&nbsp;<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="Qcert.cNNRC.cNNRCRuntime.html">cNNRCRuntime</a></span>.<br/>
&nbsp;&nbsp;<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="Qcert.NNRC.NNRCRuntime.html">NNRCRuntime</a></span>.<br/>
&nbsp;&nbsp;<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html">NNRCMR</a></span>.<br/>
&nbsp;&nbsp;<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="Qcert.NNRCMR.Lang.ForeignReduceOps.html">ForeignReduceOps</a></span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Local</span> <span class="kwd">Open</span> <span class="kwd">Scope</span> <span class="id">list_scope</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Context</span> {<span class="id">fruntime</span>:<span class="id"><a href="Qcert.Common.ForeignRuntime.html#foreign_runtime">foreign_runtime</a></span>}.<br/>
&nbsp;&nbsp;<span class="kwd">Context</span> {<span class="id">fredop</span>:<span class="id"><a href="Qcert.NNRCMR.Lang.ForeignReduceOps.html#foreign_reduce_op">foreign_reduce_op</a></span>}.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Context</span> (<span class="id">h</span>:<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span>(<span class="id"><a href="http://coq.inria.fr/library/Coq.Strings.String.html#string">string</a></span>*<span class="id"><a href="http://coq.inria.fr/library/Coq.Strings.String.html#string">string</a></span>)).<br/>
<br/>
<br/>
<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="is_id_function">is_id_function</a></span> (<span class="id">f</span>: <span class="id"><a href="Qcert.Common.Env.RVar.html#var">var</a></span> * <span class="id"><a href="Qcert.NNRC.Lang.NNRC.html#nnrc">nnrc</a></span>) :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> (<span class="id">x</span>, <span class="id">n</span>) := <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#f">f</a></span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#n">n</a></span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="Qcert.cNNRC.Lang.cNNRC.html#NNRCVar">NNRCVar</a></span> <span class="id">y</span> =&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Classes.EquivDec.html#equiv_decb">equiv_decb</a></span> <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#x">x</a></span> <span class="id">y</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="Qcert.cNNRC.Lang.cNNRC.html#NNRCUnop">NNRCUnop</a></span> <span class="id"><a href="Qcert.Common.Operators.UnaryOperators.html#OpIdentity">OpIdentity</a></span> (<span class="id"><a href="Qcert.cNNRC.Lang.cNNRC.html#NNRCVar">NNRCVar</a></span> <span class="id">y</span>) =&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Classes.EquivDec.html#equiv_decb">equiv_decb</a></span> <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#x">x</a></span> <span class="id">y</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">_</span> =&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#false">false</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="is_coll_function">is_coll_function</a></span> (<span class="id">f</span>: <span class="id"><a href="Qcert.Common.Env.RVar.html#var">var</a></span> * <span class="id"><a href="Qcert.NNRC.Lang.NNRC.html#nnrc">nnrc</a></span>) :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> (<span class="id">x</span>, <span class="id">n</span>) := <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#f">f</a></span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#n">n</a></span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="Qcert.cNNRC.Lang.cNNRC.html#NNRCUnop">NNRCUnop</a></span> <span class="id"><a href="Qcert.Common.Operators.UnaryOperators.html#OpBag">OpBag</a></span> (<span class="id"><a href="Qcert.cNNRC.Lang.cNNRC.html#NNRCVar">NNRCVar</a></span> <span class="id">y</span>) =&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Classes.EquivDec.html#equiv_decb">equiv_decb</a></span> <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#x">x</a></span> <span class="id">y</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">_</span> =&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#false">false</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
&nbsp;&nbsp;<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="is_constant_function">is_constant_function</a></span> (<span class="id">f</span>: <span class="id"><a href="Qcert.Common.Env.RVar.html#var">var</a></span> * <span class="id"><a href="Qcert.NNRC.Lang.NNRC.html#nnrc">nnrc</a></span>) :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> (<span class="id">x</span>, <span class="id">n</span>) := <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#f">f</a></span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#n">n</a></span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="Qcert.cNNRC.Lang.cNNRC.html#NNRCConst">NNRCConst</a></span> <span class="id">_</span> =&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#true">true</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">_</span> =&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#false">false</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="is_flatten_function">is_flatten_function</a></span> (<span class="id">f</span>: <span class="id"><a href="Qcert.Common.Env.RVar.html#var">var</a></span> * <span class="id"><a href="Qcert.NNRC.Lang.NNRC.html#nnrc">nnrc</a></span>) :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> (<span class="id">x</span>, <span class="id">n</span>) := <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#f">f</a></span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#n">n</a></span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="Qcert.cNNRC.Lang.cNNRC.html#NNRCUnop">NNRCUnop</a></span> <span class="id"><a href="Qcert.Common.Operators.UnaryOperators.html#OpFlatten">OpFlatten</a></span> (<span class="id"><a href="Qcert.cNNRC.Lang.cNNRC.html#NNRCVar">NNRCVar</a></span> <span class="id">y</span>) =&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Classes.EquivDec.html#equiv_decb">equiv_decb</a></span> <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#x">x</a></span> <span class="id">y</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="Qcert.cNNRC.Lang.cNNRC.html#NNRCLet">NNRCLet</a></span> <span class="id">a</span> (<span class="id"><a href="Qcert.cNNRC.Lang.cNNRC.html#NNRCUnop">NNRCUnop</a></span> <span class="id"><a href="Qcert.Common.Operators.UnaryOperators.html#OpFlatten">OpFlatten</a></span> (<span class="id"><a href="Qcert.cNNRC.Lang.cNNRC.html#NNRCVar">NNRCVar</a></span> <span class="id">y</span>)) (<span class="id"><a href="Qcert.cNNRC.Lang.cNNRC.html#NNRCVar">NNRCVar</a></span> <span class="id">b</span>) =&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Classes.EquivDec.html#equiv_decb">equiv_decb</a></span> <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#x">x</a></span> <span class="id">y</span> &amp;&amp; <span class="id"><a href="http://coq.inria.fr/library/Coq.Classes.EquivDec.html#equiv_decb">equiv_decb</a></span> <span class="id">a</span> <span class="id">b</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">_</span> =&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#false">false</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="is_flatten_function_correct">is_flatten_function_correct</a></span> (<span class="id">x</span>:<span class="id"><a href="Qcert.Common.Env.RVar.html#var">var</a></span>) (<span class="id">n</span>:<span class="id"><a href="Qcert.NNRC.Lang.NNRC.html#nnrc">nnrc</a></span>) (<span class="id">env</span>:<span class="id"><a href="Qcert.Common.Data.RData.html#bindings">bindings</a></span>) :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#is_flatten_function">is_flatten_function</a></span> (<span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#x">x</a></span>,<span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#n">n</a></span>) = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#true">true</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">d</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Qcert.Utils.Assoc.html#lookup">lookup</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Classes.EquivDec.html#equiv_dec">equiv_dec</a></span> <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#env">env</a></span> <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#x">x</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#d">d</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="Qcert.cNNRC.Lang.cNNRC.html#nnrc_core_eval">nnrc_core_eval</a></span> <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#NNRCMRRewrite.h">h</a></span> <span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#empty_cenv">empty_cenv</a></span> <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#env">env</a></span> <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#n">n</a></span>) = <span class="id"><a href="Qcert.Common.Data.RRelation.html#lift_oncoll">lift_oncoll</a></span> (<span class="kwd">fun</span> <span class="id">l</span> =&gt; (<span class="id"><a href="Qcert.Utils.Lift.html#lift">lift</a></span> <span class="id"><a href="Qcert.Common.Data.RData.html#dcoll">dcoll</a></span> (<span class="id"><a href="Qcert.Common.Data.RRelation.html#rflatten">rflatten</a></span> <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#l">l</a></span>))) <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#d">d</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2634')">Proof.</div>
<div class="proofscript" id="proof2634">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">Hfun</span> <span class="id">d</span> <span class="id">Henv</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">n</span>; <span class="tactic">try</span> <span class="tactic">congruence</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">destruct</span> <span class="id">u</span>; <span class="tactic">try</span> <span class="tactic">congruence</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">n</span>; <span class="tactic">try</span> <span class="tactic">congruence</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Classes.EquivDec.html#equiv_decb">equiv_decb</a></span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">dest_eqdec</span>; <span class="tactic">try</span> <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Henv</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">destruct</span> <span class="id">n1</span>; <span class="tactic">try</span> <span class="tactic">congruence</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">u</span>; <span class="tactic">try</span> <span class="tactic">congruence</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">n1</span>; <span class="tactic">try</span> <span class="tactic">congruence</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">n2</span>; <span class="tactic">try</span> <span class="tactic">congruence</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Bool.Bool.html#andb_true_iff">Bool.andb_true_iff</a></span> <span class="kwd">in</span> <span class="id">Hfun</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Hfun</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Classes.EquivDec.html#equiv_decb">equiv_decb</a></span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="id">dest_eqdec</span>; <span class="tactic">try</span> <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Henv</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="Qcert.Common.Data.RRelation.html#lift_oncoll">lift_oncoll</a></span> (<span class="kwd">fun</span> <span class="id">l</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="Qcert.Common.Data.RData.html#data">data</a></span> =&gt; <span class="id"><a href="Qcert.Utils.Lift.html#lift">lift</a></span> <span class="id"><a href="Qcert.Common.Data.RData.html#dcoll">dcoll</a></span> (<span class="id"><a href="Qcert.Common.Data.RRelation.html#rflatten">rflatten</a></span> <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#l">l</a></span>)) <span class="id">d</span>); <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="is_uncoll_function_arg">is_uncoll_function_arg</a></span> (<span class="id">f</span>: <span class="id"><a href="Qcert.Common.Env.RVar.html#var">var</a></span> * <span class="id"><a href="Qcert.NNRC.Lang.NNRC.html#nnrc">nnrc</a></span>) :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> (<span class="id">x</span>, <span class="id">n</span>) := <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#f">f</a></span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#n">n</a></span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="Qcert.cNNRC.Lang.cNNRC.html#NNRCLet">NNRCLet</a></span> <span class="id">a</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="Qcert.cNNRC.Lang.cNNRC.html#NNRCEither">NNRCEither</a></span> (<span class="id"><a href="Qcert.cNNRC.Lang.cNNRC.html#NNRCUnop">NNRCUnop</a></span> <span class="id"><a href="Qcert.Common.Operators.UnaryOperators.html#OpSingleton">OpSingleton</a></span> (<span class="id"><a href="Qcert.cNNRC.Lang.cNNRC.html#NNRCVar">NNRCVar</a></span> <span class="id">y</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">b</span> (<span class="id"><a href="Qcert.cNNRC.Lang.cNNRC.html#NNRCVar">NNRCVar</a></span> <span class="id">b</span>')<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">c</span> (<span class="id"><a href="Qcert.cNNRC.Lang.cNNRC.html#NNRCConst">NNRCConst</a></span> <span class="id"><a href="Qcert.Common.Data.RData.html#dunit">dunit</a></span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">n</span>' =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Classes.EquivDec.html#equiv_decb">equiv_decb</a></span> <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#x">x</a></span> <span class="id">y</span> &amp;&amp; <span class="id"><a href="http://coq.inria.fr/library/Coq.Classes.EquivDec.html#equiv_decb">equiv_decb</a></span> <span class="id">b</span> <span class="id">b</span>' &amp;&amp; <span class="id"><a href="http://coq.inria.fr/library/Coq.Classes.EquivDec.html#equiv_decb">equiv_decb</a></span> <span class="id">a</span> <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#x">x</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">_</span> =&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#false">false</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<br/>
<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="is_id_scalar_map">is_id_scalar_map</a></span> <span class="id">map</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#map">map</a></span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#MapDist">MapDist</a></span> <span class="id">f</span> =&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#false">false</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#MapDistFlatten">MapDistFlatten</a></span> <span class="id">f</span> =&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#false">false</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#MapScalar">MapScalar</a></span> <span class="id">f</span> =&gt; <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#is_coll_function">is_coll_function</a></span> <span class="id">f</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="id_scalar_map_correct">id_scalar_map_correct</a></span> <span class="id">mr_map</span> <span class="id">d</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#is_id_scalar_map">is_id_scalar_map</a></span> <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#mr_map">mr_map</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#true">true</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#mr_map_eval">mr_map_eval</a></span> <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#NNRCMRRewrite.h">h</a></span> <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#mr_map">mr_map</a></span> (<span class="id"><a href="Qcert.Common.Data.DData.html#Dlocal">Dlocal</a></span> <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#d">d</a></span>) = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> (<span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#d">d</a></span>::<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2635')">Proof.</div>
<div class="proofscript" id="proof2635">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">H_is_id_map</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">mr_map</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> *; <span class="tactic">try</span> <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">p</span>; <span class="tactic">try</span> <span class="tactic">congruence</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">n</span>; <span class="tactic">try</span> <span class="tactic">congruence</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">u</span>; <span class="tactic">try</span> <span class="tactic">congruence</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">n</span>; <span class="tactic">try</span> <span class="tactic">congruence</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Classes.EquivDec.html#equiv_decb">equiv_decb</a></span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="id">dest_eqdec</span>; <span class="tactic">try</span> <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="is_id_dist_map">is_id_dist_map</a></span> <span class="id">map</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#map">map</a></span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#MapDist">MapDist</a></span> <span class="id">f</span> =&gt; <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#is_id_function">is_id_function</a></span> <span class="id">f</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#MapDistFlatten">MapDistFlatten</a></span> <span class="id">f</span> =&gt; <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#is_coll_function">is_coll_function</a></span> <span class="id">f</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#MapScalar">MapScalar</a></span> <span class="id">_</span> =&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#false">false</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="id_dist_map_correct">id_dist_map_correct</a></span> <span class="id">mr_map</span> <span class="id">coll</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#is_id_dist_map">is_id_dist_map</a></span> <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#mr_map">mr_map</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#true">true</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#mr_map_eval">mr_map_eval</a></span> <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#NNRCMRRewrite.h">h</a></span> <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#mr_map">mr_map</a></span> (<span class="id"><a href="Qcert.Common.Data.DData.html#Ddistr">Ddistr</a></span> <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#coll">coll</a></span>) = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#coll">coll</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2636')">Proof.</div>
<div class="proofscript" id="proof2636">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">H_is_id_dist_map</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">mr_map</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">Case</span> "<span class="id">MapDist</span>"%<span class="id">string</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">p</span>; <span class="tactic">try</span> <span class="tactic">congruence</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">n</span>; <span class="tactic">try</span> <span class="tactic">congruence</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">unfold</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Classes.EquivDec.html#equiv_decb">equiv_decb</a></span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="id">dest_eqdec</span>; <span class="tactic">try</span> <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="Qcert.Common.Data.RRelation.html#rmap_id">rmap_id</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">destruct</span> <span class="id">u</span>; <span class="tactic">try</span> <span class="tactic">congruence</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">n</span>; <span class="tactic">try</span> <span class="tactic">congruence</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Classes.EquivDec.html#equiv_decb">equiv_decb</a></span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="id">dest_eqdec</span>; <span class="tactic">try</span> <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="Qcert.Common.Data.RRelation.html#rmap_id">rmap_id</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">Case</span> "<span class="id">MapDistFlatten</span>"%<span class="id">string</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">p</span>; <span class="tactic">try</span> <span class="tactic">congruence</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">n</span>; <span class="tactic">try</span> <span class="tactic">congruence</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">u</span>; <span class="tactic">try</span> <span class="tactic">congruence</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">n</span>; <span class="tactic">try</span> <span class="tactic">congruence</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Classes.EquivDec.html#equiv_decb">equiv_decb</a></span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="id">dest_eqdec</span>; <span class="tactic">try</span> <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">autorewrite</span> <span class="kwd">with</span> <span class="id">alg</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">Case</span> "<span class="id">MapScalar</span>"%<span class="id">string</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H_is_id_dist_map</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="is_dispatch_map">is_dispatch_map</a></span> <span class="id">map</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#map">map</a></span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#MapScalar">MapScalar</a></span> <span class="id">f</span> =&gt; <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#is_id_function">is_id_function</a></span> <span class="id">f</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">_</span> =&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#false">false</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="dispatch_map_correct">dispatch_map_correct</a></span> <span class="id">mr_map</span> <span class="id">coll</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#is_dispatch_map">is_dispatch_map</a></span> <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#mr_map">mr_map</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#true">true</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#mr_map_eval">mr_map_eval</a></span> <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#NNRCMRRewrite.h">h</a></span> <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#mr_map">mr_map</a></span> (<span class="id"><a href="Qcert.Common.Data.DData.html#Dlocal">Dlocal</a></span> (<span class="id"><a href="Qcert.Common.Data.RData.html#dcoll">dcoll</a></span> <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#coll">coll</a></span>)) = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#coll">coll</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2637')">Proof.</div>
<div class="proofscript" id="proof2637">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#mr_map_eval">mr_map_eval</a></span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">mr_map</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> *; <span class="tactic">try</span> <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">p</span>; <span class="tactic">try</span> <span class="tactic">congruence</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">n</span>; <span class="tactic">try</span> <span class="tactic">congruence</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">unfold</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Classes.EquivDec.html#equiv_decb">equiv_decb</a></span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="id">dest_eqdec</span>; <span class="tactic">try</span> <span class="tactic">congruence</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">destruct</span> <span class="id">u</span>; <span class="tactic">try</span> <span class="tactic">congruence</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">n</span>; <span class="tactic">try</span> <span class="tactic">congruence</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Classes.EquivDec.html#equiv_decb">equiv_decb</a></span> <span class="kwd">in</span> *;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="id">dest_eqdec</span>; <span class="tactic">try</span> <span class="tactic">congruence</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="is_scalar_map">is_scalar_map</a></span> <span class="id">map</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#map">map</a></span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#MapScalar">MapScalar</a></span> <span class="id">_</span> =&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#true">true</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">_</span> =&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#false">false</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="is_flatten_dist_map">is_flatten_dist_map</a></span> <span class="id">map</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#map">map</a></span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#MapDistFlatten">MapDistFlatten</a></span> <span class="id">f</span> =&gt; <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#is_id_function">is_id_function</a></span> <span class="id">f</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">_</span> =&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#false">false</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="flatten_dist_map_correct">flatten_dist_map_correct</a></span> <span class="id">mr_map</span> <span class="id">coll</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#is_flatten_dist_map">is_flatten_dist_map</a></span> <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#mr_map">mr_map</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#true">true</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#mr_map_eval">mr_map_eval</a></span> <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#NNRCMRRewrite.h">h</a></span> <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#mr_map">mr_map</a></span> (<span class="id"><a href="Qcert.Common.Data.DData.html#Ddistr">Ddistr</a></span> <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#coll">coll</a></span>) = <span class="id"><a href="Qcert.Common.Data.RRelation.html#rflatten">rflatten</a></span> <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#coll">coll</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2638')">Proof.</div>
<div class="proofscript" id="proof2638">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#mr_map_eval">mr_map_eval</a></span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">mr_map</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> *; <span class="tactic">try</span> <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">p</span>; <span class="tactic">try</span> <span class="tactic">congruence</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">n</span>; <span class="tactic">try</span> <span class="tactic">congruence</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">unfold</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Classes.EquivDec.html#equiv_decb">equiv_decb</a></span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="id">dest_eqdec</span>; <span class="tactic">try</span> <span class="tactic">congruence</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="Qcert.Common.Data.RRelation.html#rmap_id">rmap_id</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">destruct</span> <span class="id">u</span>; <span class="tactic">try</span> <span class="tactic">congruence</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">n</span>; <span class="tactic">try</span> <span class="tactic">congruence</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Classes.EquivDec.html#equiv_decb">equiv_decb</a></span> <span class="kwd">in</span> *;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="id">dest_eqdec</span>; <span class="tactic">try</span> <span class="tactic">congruence</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="Qcert.Common.Data.RRelation.html#rmap_id">rmap_id</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
<br/>
<br/>
<br/>
&nbsp;&nbsp;<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="is_flatten_collect">is_flatten_collect</a></span> <span class="tactic">red</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="tactic">red</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#RedId">RedId</a></span> =&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#false">false</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#RedCollect">RedCollect</a></span> <span class="id">reduce</span> =&gt; <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#is_flatten_function">is_flatten_function</a></span> <span class="id">reduce</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#RedOp">RedOp</a></span> <span class="id">op</span> =&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#false">false</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#RedSingleton">RedSingleton</a></span> =&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#false">false</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="is_id_reduce">is_id_reduce</a></span> <span class="tactic">red</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="tactic">red</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#RedId">RedId</a></span> =&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#true">true</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#RedCollect">RedCollect</a></span> <span class="id">reduce</span> =&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#false">false</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#RedOp">RedOp</a></span> <span class="id">op</span> =&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#false">false</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#RedSingleton">RedSingleton</a></span> =&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#false">false</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="id_reduce_correct">id_reduce_correct</a></span> <span class="tactic">red</span> <span class="id">coll</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#is_id_reduce">is_id_reduce</a></span> <span class="tactic">red</span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#true">true</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#mr_reduce_eval">mr_reduce_eval</a></span> <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#NNRCMRRewrite.h">h</a></span> <span class="tactic">red</span> <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#coll">coll</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> (<span class="id"><a href="Qcert.Common.Data.DData.html#Ddistr">Ddistr</a></span> <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#coll">coll</a></span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2639')">Proof.</div>
<div class="proofscript" id="proof2639">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="tactic">red</span>; <span class="tactic">simpl</span>; <span class="tactic">try</span> <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="is_id_collect">is_id_collect</a></span> <span class="tactic">red</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="tactic">red</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#RedId">RedId</a></span> =&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#false">false</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#RedCollect">RedCollect</a></span> <span class="id">reduce</span> =&gt; <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#is_id_function">is_id_function</a></span> <span class="id">reduce</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#RedOp">RedOp</a></span> <span class="id">op</span> =&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#false">false</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#RedSingleton">RedSingleton</a></span> =&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#false">false</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="id_collect_correct">id_collect_correct</a></span> <span class="tactic">red</span> <span class="id">coll</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#is_id_collect">is_id_collect</a></span> <span class="tactic">red</span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#true">true</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#mr_reduce_eval">mr_reduce_eval</a></span> <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#NNRCMRRewrite.h">h</a></span> <span class="tactic">red</span> <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#coll">coll</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> (<span class="id"><a href="Qcert.Common.Data.DData.html#Dlocal">Dlocal</a></span> (<span class="id"><a href="Qcert.Common.Data.RData.html#dcoll">dcoll</a></span> <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#coll">coll</a></span>)).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2640')">Proof.</div>
<div class="proofscript" id="proof2640">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">Hred</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="tactic">red</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> *; <span class="tactic">try</span> <span class="tactic">congruence</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">try</span> <span class="id">solve</span> [<span class="tactic">destruct</span> <span class="id">r</span>; <span class="tactic">simpl</span>; <span class="tactic">congruence</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">p</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">n</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> *; <span class="tactic">try</span> <span class="tactic">congruence</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Classes.EquivDec.html#equiv_decb">equiv_decb</a></span> <span class="kwd">in</span> *;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="id">dest_eqdec</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> *; <span class="tactic">try</span> <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">u</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> *; <span class="tactic">try</span> <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">n</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> *; <span class="tactic">try</span> <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="id">dest_eqdec</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> *; <span class="tactic">try</span> <span class="tactic">congruence</span>.<br/>
&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="is_singleton_reduce">is_singleton_reduce</a></span> <span class="tactic">red</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="tactic">red</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#RedId">RedId</a></span> =&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#false">false</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#RedCollect">RedCollect</a></span> <span class="id">_</span> =&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#false">false</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#RedOp">RedOp</a></span> <span class="id">_</span> =&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#false">false</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#RedSingleton">RedSingleton</a></span> =&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#true">true</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="singleton_reduce_correct">singleton_reduce_correct</a></span> <span class="tactic">red</span> <span class="id">d</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#is_singleton_reduce">is_singleton_reduce</a></span> <span class="tactic">red</span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#true">true</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#mr_reduce_eval">mr_reduce_eval</a></span> <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#NNRCMRRewrite.h">h</a></span> <span class="tactic">red</span> (<span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#d">d</a></span>::<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span>) = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> (<span class="id"><a href="Qcert.Common.Data.DData.html#Dlocal">Dlocal</a></span> <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#d">d</a></span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2641')">Proof.</div>
<div class="proofscript" id="proof2641">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">Hred</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="tactic">red</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> *; <span class="tactic">try</span> <span class="tactic">congruence</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">try</span> <span class="id">solve</span> [<span class="tactic">destruct</span> <span class="id">r</span>; <span class="tactic">simpl</span>; <span class="tactic">congruence</span>].<br/>
&nbsp;Qed.</div>
<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="is_uncoll_collect">is_uncoll_collect</a></span> <span class="tactic">red</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="tactic">red</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#RedId">RedId</a></span> =&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#false">false</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#RedCollect">RedCollect</a></span> <span class="id">reduce</span> =&gt; <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#is_uncoll_function_arg">is_uncoll_function_arg</a></span> <span class="id">reduce</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#RedOp">RedOp</a></span> <span class="id">op</span> =&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#false">false</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#RedSingleton">RedSingleton</a></span> =&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#false">false</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="suppress_uncoll_in_collect_reduce">suppress_uncoll_in_collect_reduce</a></span> <span class="tactic">red</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="tactic">red</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#RedId">RedId</a></span> =&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#RedCollect">RedCollect</a></span> <span class="id">f</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">if</span> <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#is_uncoll_function_arg">is_uncoll_function_arg</a></span> <span class="id">f</span> <span class="kwd">then</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> (<span class="id">x</span>, <span class="id">n</span>) := <span class="id">f</span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#n">n</a></span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="Qcert.cNNRC.Lang.cNNRC.html#NNRCLet">NNRCLet</a></span> <span class="id">a</span> <span class="id">_</span> <span class="id">n</span>' =&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> (<span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#RedCollect">RedCollect</a></span> (<span class="id">a</span>, <span class="id">n</span>'))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">_</span> =&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">else</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#RedOp">RedOp</a></span> <span class="id">op</span> =&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#RedSingleton">RedSingleton</a></span> =&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="suppress_uncoll_in_collect_reduce_correct">suppress_uncoll_in_collect_reduce_correct</a></span> <span class="id">reduce</span> <span class="id">coll</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">reduce</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#reduce_well_formed">reduce_well_formed</a></span> <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#reduce">reduce</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#is_uncoll_collect">is_uncoll_collect</a></span> <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#reduce">reduce</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#true">true</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#suppress_uncoll_in_collect_reduce">suppress_uncoll_in_collect_reduce</a></span> <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#reduce">reduce</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">reduce</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#mr_reduce_eval">mr_reduce_eval</a></span> <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#NNRCMRRewrite.h">h</a></span> <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#reduce">reduce</a></span> (<span class="id"><a href="Qcert.Common.Data.RData.html#dcoll">dcoll</a></span> <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#coll">coll</a></span> :: <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span>) =<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#mr_reduce_eval">mr_reduce_eval</a></span> <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#NNRCMRRewrite.h">h</a></span> <span class="id">reduce</span>' <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#coll">coll</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2642')">Proof.</div>
<div class="proofscript" id="proof2642">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">reduce</span>' <span class="id">Hwf</span> <span class="id">Hred</span> <span class="id">Hred</span>'.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">reduce</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> *; <span class="tactic">try</span> <span class="tactic">congruence</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">try</span> <span class="id">solve</span> [<span class="tactic">destruct</span> <span class="id">r</span>; <span class="tactic">simpl</span>; <span class="tactic">congruence</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">p</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> *; <span class="tactic">try</span> <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">n</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> *; <span class="tactic">try</span> <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">n1</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> *; <span class="tactic">try</span> <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">n1_1</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> *; <span class="tactic">try</span> <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">u</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> *; <span class="tactic">try</span> <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">n1_2</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> *; <span class="tactic">try</span> <span class="tactic">congruence</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">n1_1</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> *; <span class="tactic">try</span> <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">n1_3</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> *; <span class="tactic">try</span> <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">d</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> *; <span class="tactic">try</span> <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Hred</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Hred</span>'.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Bool.Bool.html#andb_true_iff">Bool.andb_true_iff</a></span> <span class="kwd">in</span> <span class="id">Hred</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Hred</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Classes.EquivDec.html#equiv_decb">equiv_decb</a></span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="id">dest_eqdec</span>; <span class="tactic">try</span> <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> <span class="id">e0</span> <span class="id">e</span> <span class="id">H</span> <span class="id">H1</span> <span class="id">H2</span> <span class="id">Hred</span>'.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id"><a href="Qcert.cNNRC.Lang.cNNRC.html#nnrc_core_eval">nnrc_core_eval</a></span> <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#NNRCMRRewrite.h">h</a></span> <span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#empty_cenv">empty_cenv</a></span> ((<span class="id">v</span>, <span class="id"><a href="Qcert.Common.Data.RData.html#dcoll">dcoll</a></span> <span class="id">coll</span>) :: (<span class="id">v</span>, <span class="id"><a href="Qcert.Common.Data.RData.html#dcoll">dcoll</a></span> (<span class="id"><a href="Qcert.Common.Data.RData.html#dcoll">dcoll</a></span> <span class="id">coll</span> :: <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span>)) :: <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span>) <span class="id">n2</span> =<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Qcert.cNNRC.Lang.cNNRC.html#nnrc_core_eval">nnrc_core_eval</a></span> <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#NNRCMRRewrite.h">h</a></span> <span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#empty_cenv">empty_cenv</a></span> ((<span class="id">v</span>, <span class="id"><a href="Qcert.Common.Data.RData.html#dcoll">dcoll</a></span> <span class="id">coll</span>) :: <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span>) <span class="id">n2</span>) <span class="kwd">as</span> <span class="id">Heq</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[ | <span class="tactic">rewrite</span> &lt;- <span class="id">Heq</span>; <span class="tactic">reflexivity</span> ].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="Qcert.cNNRC.Lang.cNNRCShadow.html#nnrc_core_eval_equiv_free_in_env">nnrc_core_eval_equiv_free_in_env</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">x</span> <span class="id">Hx</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="Qcert.Utils.Assoc.html#lookup">lookup</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="id">dest_eqdec</span>; <span class="tactic">try</span> <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
<br/>
<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="is_id_dist_mr">is_id_dist_mr</a></span> <span class="id">mr</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#mr">mr</a></span>.(<span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#mr_reduce">mr_reduce</a></span>) <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#RedId">RedId</a></span> =&gt; <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#is_id_dist_map">is_id_dist_map</a></span> <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#mr">mr</a></span>.(<span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#mr_map">mr_map</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#RedCollect">RedCollect</a></span> <span class="id">reduce</span> =&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#false">false</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#RedOp">RedOp</a></span> <span class="id">op</span> =&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#false">false</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#RedSingleton">RedSingleton</a></span> =&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#false">false</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="is_id_dist_mr_correct">is_id_dist_mr_correct</a></span> (<span class="id">mr</span>:<span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#mr">mr</a></span>) :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#is_id_dist_mr">is_id_dist_mr</a></span> <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#mr">mr</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#true">true</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">loc_d</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#map_well_localized">map_well_localized</a></span> <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#mr">mr</a></span>.(<span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#mr_map">mr_map</a></span>) <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#loc_d">loc_d</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#loc_d">loc_d</a></span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="Qcert.Common.Data.DData.html#Ddistr">Ddistr</a></span> <span class="id">coll</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#mr_eval">mr_eval</a></span> <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#NNRCMRRewrite.h">h</a></span> <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#mr">mr</a></span> <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#loc_d">loc_d</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> (<span class="id"><a href="Qcert.Common.Data.DData.html#Ddistr">Ddistr</a></span> <span class="id">coll</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="Qcert.Common.Data.DData.html#Dlocal">Dlocal</a></span> <span class="id">d</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#mr_eval">mr_eval</a></span> <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#NNRCMRRewrite.h">h</a></span> <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#mr">mr</a></span> <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#loc_d">loc_d</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> (<span class="id"><a href="Qcert.Common.Data.DData.html#Ddistr">Ddistr</a></span> (<span class="id">d</span>::<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2643')">Proof.</div>
<div class="proofscript" id="proof2643">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">H_is_id_mr</span> <span class="id">loc_d</span> <span class="id">H_well_localized</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#is_id_dist_mr">is_id_dist_mr</a></span> <span class="kwd">in</span> <span class="id">H_is_id_mr</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">mr</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">mr_reduce</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> *; <span class="tactic">try</span> <span class="tactic">congruence</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">try</span> <span class="id">solve</span> [ <span class="tactic">destruct</span> <span class="id">r</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> *; <span class="tactic">congruence</span> ].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#mr_eval">mr_eval</a></span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">loc_d</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">Case</span> "<span class="id">loc_d</span> <span class="id">is</span> <span class="id">scalar</span>"%<span class="id">string</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">mr_map</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> *;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">try</span> <span class="id">contradiction</span>; <span class="tactic">try</span> <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">Case</span> "<span class="id">loc_d</span> <span class="id">is</span> <span class="id">distributed</span>"%<span class="id">string</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> (<span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#id_dist_map_correct">id_dist_map_correct</a></span> <span class="id">_</span> <span class="id">_</span> <span class="id">H_is_id_mr</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="is_id_scalar_mr">is_id_scalar_mr</a></span> <span class="id">mr</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#mr">mr</a></span>.(<span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#mr_reduce">mr_reduce</a></span>) <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#RedId">RedId</a></span> =&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#false">false</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#RedCollect">RedCollect</a></span> <span class="id">reduce</span> =&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#false">false</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#RedOp">RedOp</a></span> <span class="id">op</span> =&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#false">false</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#RedSingleton">RedSingleton</a></span> =&gt; <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#is_id_scalar_map">is_id_scalar_map</a></span> <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#mr">mr</a></span>.(<span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#mr_map">mr_map</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="is_id_scalar_mr_correct">is_id_scalar_mr_correct</a></span> (<span class="id">mr</span>:<span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#mr">mr</a></span>) :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#is_id_scalar_mr">is_id_scalar_mr</a></span> <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#mr">mr</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#true">true</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">loc_d</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#map_well_localized">map_well_localized</a></span> <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#mr">mr</a></span>.(<span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#mr_map">mr_map</a></span>) <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#loc_d">loc_d</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#loc_d">loc_d</a></span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="Qcert.Common.Data.DData.html#Ddistr">Ddistr</a></span> <span class="id">coll</span> =&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Logic.html#False">False</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="Qcert.Common.Data.DData.html#Dlocal">Dlocal</a></span> <span class="id">d</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#mr_eval">mr_eval</a></span> <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#NNRCMRRewrite.h">h</a></span> <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#mr">mr</a></span> <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#loc_d">loc_d</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> (<span class="id"><a href="Qcert.Common.Data.DData.html#Dlocal">Dlocal</a></span> <span class="id">d</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2644')">Proof.</div>
<div class="proofscript" id="proof2644">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">H_is_id_mr</span> <span class="id">loc_d</span> <span class="id">H_well_localized</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#is_id_scalar_mr">is_id_scalar_mr</a></span> <span class="kwd">in</span> <span class="id">H_is_id_mr</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">mr</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">mr_reduce</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> *; <span class="tactic">try</span> <span class="tactic">congruence</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">try</span> <span class="id">solve</span> [ <span class="tactic">destruct</span> <span class="id">r</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> *; <span class="tactic">congruence</span> ].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#mr_eval">mr_eval</a></span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">loc_d</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">Case</span> "<span class="id">loc_d</span> <span class="id">is</span> <span class="id">scalar</span>"%<span class="id">string</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> (<span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#id_scalar_map_correct">id_scalar_map_correct</a></span> <span class="id">_</span> <span class="id">_</span> <span class="id">H_is_id_mr</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">Case</span> "<span class="id">loc_d</span> <span class="id">is</span> <span class="id">distributed</span>"%<span class="id">string</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">mr_map</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> *;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">try</span> <span class="id">contradiction</span>; <span class="tactic">try</span> <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="is_kindofflatten_mr">is_kindofflatten_mr</a></span> <span class="id">mr</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#is_id_dist_map">is_id_dist_map</a></span> <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#mr">mr</a></span>.(<span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#mr_map">mr_map</a></span>) &amp;&amp; <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#is_flatten_collect">is_flatten_collect</a></span> <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#mr">mr</a></span>.(<span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#mr_reduce">mr_reduce</a></span>).<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="is_kindofflatten_mr_correct">is_kindofflatten_mr_correct</a></span> (<span class="id">mr</span>:<span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#mr">mr</a></span>) (<span class="id">loc_d</span>: <span class="id"><a href="Qcert.Common.Data.DData.html#ddata">ddata</a></span>) :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#is_kindofflatten_mr">is_kindofflatten_mr</a></span> <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#mr">mr</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#true">true</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#map_well_localized">map_well_localized</a></span> <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#mr">mr</a></span>.(<span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#mr_map">mr_map</a></span>) <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#loc_d">loc_d</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#loc_d">loc_d</a></span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="Qcert.Common.Data.DData.html#Ddistr">Ddistr</a></span> <span class="id">coll</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#mr_eval">mr_eval</a></span> <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#NNRCMRRewrite.h">h</a></span> <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#mr">mr</a></span> <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#loc_d">loc_d</a></span> = <span class="id"><a href="Qcert.Utils.Lift.html#lift">lift</a></span> (<span class="kwd">fun</span> <span class="id">l</span> =&gt; <span class="id"><a href="Qcert.Common.Data.DData.html#Dlocal">Dlocal</a></span> (<span class="id"><a href="Qcert.Common.Data.RData.html#dcoll">dcoll</a></span> <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#l">l</a></span>)) (<span class="id"><a href="Qcert.Common.Data.RRelation.html#rflatten">rflatten</a></span> <span class="id">coll</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="Qcert.Common.Data.DData.html#Dlocal">Dlocal</a></span> <span class="id">d</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#mr_eval">mr_eval</a></span> <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#NNRCMRRewrite.h">h</a></span> <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#mr">mr</a></span> <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#loc_d">loc_d</a></span> = <span class="id"><a href="Qcert.Utils.Lift.html#lift">lift</a></span> (<span class="kwd">fun</span> <span class="id">l</span> =&gt; <span class="id"><a href="Qcert.Common.Data.DData.html#Dlocal">Dlocal</a></span> (<span class="id"><a href="Qcert.Common.Data.RData.html#dcoll">dcoll</a></span> <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#l">l</a></span>)) (<span class="id"><a href="Qcert.Common.Data.RRelation.html#rflatten">rflatten</a></span> (<span class="id">d</span>::<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2645')">Proof.</div>
<div class="proofscript" id="proof2645">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">Hmr</span> <span class="id">Hwell_localized</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#is_kindofflatten_mr">is_kindofflatten_mr</a></span> <span class="kwd">in</span> <span class="id">Hmr</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Bool.Bool.html#andb_true_iff">Bool.andb_true_iff</a></span> <span class="kwd">in</span> <span class="id">Hmr</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Hmr</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#is_flatten_collect">is_flatten_collect</a></span> <span class="kwd">in</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">mr</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">mr_reduce</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> *; <span class="tactic">try</span> <span class="tactic">congruence</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">try</span> <span class="id">solve</span> [ <span class="tactic">destruct</span> <span class="id">r</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> *; <span class="tactic">congruence</span> ].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#mr_eval">mr_eval</a></span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">loc_d</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">Case</span> "<span class="id">loc_d</span> <span class="id">is</span> <span class="id">scalar</span>"%<span class="id">string</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">mr_map</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> *;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">try</span> <span class="id">contradiction</span>; <span class="tactic">try</span> <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">Case</span> "<span class="id">loc_d</span> <span class="id">is</span> <span class="id">distributed</span>"%<span class="id">string</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> (<span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#id_dist_map_correct">id_dist_map_correct</a></span> <span class="id">_</span> <span class="id">_</span> <span class="id">H</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">p</span>; <span class="tactic">try</span> <span class="tactic">congruence</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">n</span>; <span class="tactic">try</span> <span class="tactic">congruence</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">destruct</span> <span class="id">u</span>; <span class="tactic">try</span> <span class="tactic">congruence</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">n</span>; <span class="tactic">try</span> <span class="tactic">congruence</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Classes.EquivDec.html#equiv_decb">equiv_decb</a></span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="id">dest_eqdec</span>; <span class="tactic">try</span> <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="Qcert.Common.Data.RRelation.html#rflatten">rflatten</a></span> <span class="id">l</span>); <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">destruct</span> <span class="id">n1</span>; <span class="tactic">try</span> <span class="tactic">congruence</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">u</span>; <span class="tactic">try</span> <span class="tactic">congruence</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">n1</span>; <span class="tactic">try</span> <span class="tactic">congruence</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">n2</span>; <span class="tactic">try</span> <span class="tactic">congruence</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Bool.Bool.html#andb_true_iff">Bool.andb_true_iff</a></span> <span class="kwd">in</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Classes.EquivDec.html#equiv_decb">equiv_decb</a></span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="id">dest_eqdec</span>; <span class="tactic">try</span> <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="Qcert.Common.Data.RRelation.html#rflatten">rflatten</a></span> <span class="id">l</span>); <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="is_collect_mr">is_collect_mr</a></span> <span class="id">mr</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#is_id_dist_map">is_id_dist_map</a></span> <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#mr">mr</a></span>.(<span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#mr_map">mr_map</a></span>) &amp;&amp; <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#is_id_collect">is_id_collect</a></span> <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#mr">mr</a></span>.(<span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#mr_reduce">mr_reduce</a></span>).<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="mr_collect_collects">mr_collect_collects</a></span> (<span class="id">mr</span>:<span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#mr">mr</a></span>) (<span class="id">loc_d</span>:<span class="id"><a href="Qcert.Common.Data.DData.html#ddata">ddata</a></span>) :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#is_collect_mr">is_collect_mr</a></span> <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#mr">mr</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#true">true</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#map_well_localized">map_well_localized</a></span> <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#mr">mr</a></span>.(<span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#mr_map">mr_map</a></span>) <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#loc_d">loc_d</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#loc_d">loc_d</a></span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="Qcert.Common.Data.DData.html#Ddistr">Ddistr</a></span> <span class="id">coll</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#mr_eval">mr_eval</a></span> <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#NNRCMRRewrite.h">h</a></span> <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#mr">mr</a></span> <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#loc_d">loc_d</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> (<span class="id"><a href="Qcert.Common.Data.DData.html#Dlocal">Dlocal</a></span> (<span class="id"><a href="Qcert.Common.Data.RData.html#dcoll">dcoll</a></span> <span class="id">coll</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="Qcert.Common.Data.DData.html#Dlocal">Dlocal</a></span> <span class="id">d</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#mr_eval">mr_eval</a></span> <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#NNRCMRRewrite.h">h</a></span> <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#mr">mr</a></span> <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#loc_d">loc_d</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> (<span class="id"><a href="Qcert.Common.Data.DData.html#Dlocal">Dlocal</a></span> (<span class="id"><a href="Qcert.Common.Data.RData.html#dcoll">dcoll</a></span> (<span class="id">d</span>::<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span>)))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2646')">Proof.</div>
<div class="proofscript" id="proof2646">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">Hmr</span> <span class="id">Hwell_localized</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#is_collect_mr">is_collect_mr</a></span> <span class="kwd">in</span> <span class="id">Hmr</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Bool.Bool.html#andb_true_iff">Bool.andb_true_iff</a></span> <span class="kwd">in</span> <span class="id">Hmr</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Hmr</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">mr</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">mr_reduce</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> *; <span class="tactic">try</span> <span class="tactic">congruence</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">try</span> <span class="id">solve</span> [ <span class="tactic">destruct</span> <span class="id">r</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> *; <span class="tactic">congruence</span> ].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#mr_eval">mr_eval</a></span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">loc_d</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;-&nbsp;Case&nbsp;"loc_d&nbsp;is&nbsp;scalar"%string.&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;&nbsp;&nbsp;rewrite&nbsp;Hmap;&nbsp;simpl.&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;&nbsp;&nbsp;destruct&nbsp;p;&nbsp;simpl&nbsp;in&nbsp;*.&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;&nbsp;&nbsp;destruct&nbsp;n;&nbsp;simpl&nbsp;in&nbsp;*;&nbsp;try&nbsp;congruence.&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;&nbsp;&nbsp;*&nbsp;unfold&nbsp;equiv_decb&nbsp;in&nbsp;*.&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;repeat&nbsp;dest_eqdec;&nbsp;try&nbsp;congruence.&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;reflexivity.&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;&nbsp;&nbsp;*&nbsp;destruct&nbsp;u;&nbsp;simpl&nbsp;in&nbsp;*;&nbsp;try&nbsp;congruence.&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;destruct&nbsp;n;&nbsp;simpl&nbsp;in&nbsp;*;&nbsp;try&nbsp;congruence.&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;unfold&nbsp;equiv_decb&nbsp;in&nbsp;*.&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;repeat&nbsp;dest_eqdec;&nbsp;try&nbsp;congruence.&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;reflexivity.&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">Case</span> "<span class="id">loc_d</span> <span class="id">is</span> <span class="id">scalar</span>"%<span class="id">string</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">mr_map</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> *;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">try</span> <span class="id">contradiction</span>; <span class="tactic">try</span> <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">Case</span> "<span class="id">loc_d</span> <span class="id">is</span> <span class="id">distributed</span>"%<span class="id">string</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> (<span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#id_dist_map_correct">id_dist_map_correct</a></span> <span class="id">_</span> <span class="id">_</span> <span class="id">H</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">p</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> *; <span class="tactic">try</span> <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">n</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> *; <span class="tactic">try</span> <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">unfold</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Classes.EquivDec.html#equiv_decb">equiv_decb</a></span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="id">dest_eqdec</span>; <span class="tactic">try</span> <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">destruct</span> <span class="id">u</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> *; <span class="tactic">try</span> <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">n</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> *; <span class="tactic">try</span> <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Classes.EquivDec.html#equiv_decb">equiv_decb</a></span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="id">dest_eqdec</span>; <span class="tactic">try</span> <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="is_dispatch_mr">is_dispatch_mr</a></span> <span class="id">mr</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#mr">mr</a></span>.(<span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#mr_reduce">mr_reduce</a></span>) <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#RedId">RedId</a></span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#is_dispatch_map">is_dispatch_map</a></span> <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#mr">mr</a></span>.(<span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#mr_map">mr_map</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#RedCollect">RedCollect</a></span> <span class="id">reduce</span> =&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#false">false</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#RedOp">RedOp</a></span> <span class="id">_</span> =&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#false">false</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#RedSingleton">RedSingleton</a></span> =&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#false">false</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="mr_dispatch_correct">mr_dispatch_correct</a></span> (<span class="id">mr</span>:<span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#mr">mr</a></span>) (<span class="id">coll</span>:<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="Qcert.Common.Data.RData.html#data">data</a></span>) :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#is_dispatch_mr">is_dispatch_mr</a></span> <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#mr">mr</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#true">true</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#mr_eval">mr_eval</a></span> <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#NNRCMRRewrite.h">h</a></span> <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#mr">mr</a></span> (<span class="id"><a href="Qcert.Common.Data.DData.html#Dlocal">Dlocal</a></span> (<span class="id"><a href="Qcert.Common.Data.RData.html#dcoll">dcoll</a></span> <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#coll">coll</a></span>)) = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> (<span class="id"><a href="Qcert.Common.Data.DData.html#Ddistr">Ddistr</a></span> <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#coll">coll</a></span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2647')">Proof.</div>
<div class="proofscript" id="proof2647">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#is_dispatch_mr">is_dispatch_mr</a></span> <span class="kwd">in</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">mr</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">mr_reduce</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> *; <span class="tactic">try</span> <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#is_dispatch_map">is_dispatch_map</a></span> <span class="kwd">in</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#mr_eval">mr_eval</a></span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#dispatch_map_correct">dispatch_map_correct</a></span>; [|<span class="tactic">assumption</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#mr_reduce_eval">mr_reduce_eval</a></span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="Qcert.Common.Data.RRelation.html#rflatten">rflatten</a></span> <span class="id">coll</span>); <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="map_collect_flatten_to_map_flatten_collect">map_collect_flatten_to_map_flatten_collect</a></span> <span class="id">mr</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#mr">mr</a></span>.(<span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#mr_map">mr_map</a></span>) <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#MapDist">MapDist</a></span> <span class="id">f</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">if</span> <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#is_flatten_collect">is_flatten_collect</a></span> <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#mr">mr</a></span>.(<span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#mr_reduce">mr_reduce</a></span>) <span class="kwd">then</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">mr</span>' :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#mkMR">mkMR</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#mr">mr</a></span>.(<span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#mr_input">mr_input</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#mr">mr</a></span>.(<span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#mr_output">mr_output</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#MapDistFlatten">MapDistFlatten</a></span> <span class="id">f</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#RedCollect">RedCollect</a></span> <span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#id_function">id_function</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> (<span class="id">mr</span>'::<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">else</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">_</span> =&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="map_collect_flatten_to_map_flatten_collect_correct">map_collect_flatten_to_map_flatten_collect_correct</a></span> <span class="id">mr</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">mr_chain</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#map_collect_flatten_to_map_flatten_collect">map_collect_flatten_to_map_flatten_collect</a></span> <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#mr">mr</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#mr_chain">mr_chain</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">env</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#mr_chain_eval">mr_chain_eval</a></span> <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#NNRCMRRewrite.h">h</a></span> <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#env">env</a></span> (<span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#mr">mr</a></span>::<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span>) = <span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#mr_chain_eval">mr_chain_eval</a></span> <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#NNRCMRRewrite.h">h</a></span> <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#env">env</a></span> <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#mr_chain">mr_chain</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2648')">Proof.</div>
<div class="proofscript" id="proof2648">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">mr_chain</span> <span class="id">Hmr_chain</span> <span class="id">env</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#map_collect_flatten_to_map_flatten_collect">map_collect_flatten_to_map_flatten_collect</a></span> <span class="kwd">in</span> <span class="id">Hmr_chain</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">mr</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">mr_map</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> *; <span class="tactic">try</span> <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">mr_chain</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">case_eq</span> (<span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#is_flatten_collect">is_flatten_collect</a></span> <span class="id">mr_reduce</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">Heq</span>; <span class="tactic">rewrite</span> <span class="id">Heq</span> <span class="kwd">in</span> *;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">try</span> <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">mr_reduce</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> *; <span class="tactic">try</span> <span class="tactic">congruence</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">try</span> <span class="id">solve</span> [ <span class="tactic">destruct</span> <span class="id">r</span>; <span class="tactic">congruence</span> ].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Hmr_chain</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#mr_chain_eval">mr_chain_eval</a></span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="Qcert.Utils.Assoc.html#lookup">lookup</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Classes.EquivDec.html#equiv_dec">equiv_dec</a></span> <span class="id">env</span> <span class="id">mr_input</span>); <span class="tactic">simpl</span>; <span class="tactic">try</span> <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">p0</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> *; <span class="tactic">try</span> <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">n</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> *; <span class="tactic">try</span> <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">destruct</span> <span class="id">u</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> *; <span class="tactic">try</span> <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">n</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> *; <span class="tactic">try</span> <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">d</span>; <span class="tactic">try</span> <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#mr_eval">mr_eval</a></span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#mr_reduce_eval">mr_reduce_eval</a></span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Classes.EquivDec.html#equiv_decb">equiv_decb</a></span> <span class="kwd">in</span> *;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="id">dest_eqdec</span>; <span class="tactic">try</span> <span class="tactic">congruence</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="Qcert.Common.Data.RRelation.html#rmap">rmap</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">fun</span> <span class="id">d0</span> : <span class="id"><a href="Qcert.Common.Data.RData.html#data">data</a></span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> (<span class="id">doc</span>, <span class="id">body</span>) := <span class="id">p</span> <span class="kwd">in</span> <span class="id"><a href="Qcert.cNNRC.Lang.cNNRC.html#nnrc_core_eval">nnrc_core_eval</a></span> <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#NNRCMRRewrite.h">h</a></span> <span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#empty_cenv">empty_cenv</a></span> ((<span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#doc">doc</a></span>, <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#d0">d0</a></span>) :: <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span>) <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#body">body</a></span>) <span class="id">l</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>; <span class="tactic">try</span> <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="Qcert.Common.Data.RRelation.html#rflatten">rflatten</a></span> <span class="id">l0</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>; <span class="tactic">try</span> <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">destruct</span> <span class="id">n1</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> *; <span class="tactic">try</span> <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">u</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> *; <span class="tactic">try</span> <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">n1</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> *; <span class="tactic">try</span> <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">n2</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> *; <span class="tactic">try</span> <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#mr_eval">mr_eval</a></span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">d</span>; <span class="tactic">try</span> <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Bool.Bool.html#andb_true_iff">Bool.andb_true_iff</a></span> <span class="kwd">in</span> <span class="id">Heq</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Heq</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="Qcert.Common.Data.RRelation.html#rmap">rmap</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">fun</span> <span class="id">d</span> : <span class="id"><a href="Qcert.Common.Data.RData.html#data">data</a></span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> (<span class="id">doc</span>, <span class="id">body</span>) := <span class="id">p</span> <span class="kwd">in</span> <span class="id"><a href="Qcert.cNNRC.Lang.cNNRC.html#nnrc_core_eval">nnrc_core_eval</a></span> <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#NNRCMRRewrite.h">h</a></span> <span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#empty_cenv">empty_cenv</a></span> ((<span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#doc">doc</a></span>, <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#d">d</a></span>) :: <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span>) <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#body">body</a></span>) <span class="id">l</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>; <span class="tactic">try</span> <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (@<span class="id"><a href="http://coq.inria.fr/library/Coq.Classes.EquivDec.html#equiv_dec">equiv_dec</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Strings.String.html#string">string</a></span> (@<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Logic.html#eq">eq</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Strings.String.html#string">string</a></span>) (@<span class="id"><a href="http://coq.inria.fr/library/Coq.Classes.RelationClasses.html#eq_equivalence">eq_equivalence</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Strings.String.html#string">string</a></span>) <span class="id"><a href="Qcert.Utils.CoqLibAdd.html#string_eqdec">string_eqdec</a></span> <span class="id">v1</span> <span class="id">v</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[ | <span class="tactic">unfold</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Classes.EquivDec.html#equiv_decb">equiv_decb</a></span> <span class="kwd">in</span> *;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="id">dest_eqdec</span>; <span class="tactic">try</span> <span class="tactic">congruence</span> ].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (@<span class="id"><a href="http://coq.inria.fr/library/Coq.Classes.EquivDec.html#equiv_dec">equiv_dec</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Strings.String.html#string">string</a></span> (@<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Logic.html#eq">eq</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Strings.String.html#string">string</a></span>) (@<span class="id"><a href="http://coq.inria.fr/library/Coq.Classes.RelationClasses.html#eq_equivalence">eq_equivalence</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Strings.String.html#string">string</a></span>) <span class="id"><a href="Qcert.Utils.CoqLibAdd.html#string_eqdec">string_eqdec</a></span> <span class="id">v2</span> <span class="id">v0</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[ | <span class="tactic">unfold</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Classes.EquivDec.html#equiv_decb">equiv_decb</a></span> <span class="kwd">in</span> *;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="id">dest_eqdec</span>; <span class="tactic">try</span> <span class="tactic">congruence</span> ].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="Qcert.Common.Data.RRelation.html#rflatten">rflatten</a></span> <span class="id">l0</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>; <span class="tactic">try</span> <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="merge_correct">merge_correct</a></span> (<span class="id">mf</span>:<span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#mr">mr</a></span> -&gt; <span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#mr">mr</a></span> -&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#option">option</a></span> <span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#mr">mr</a></span>) (<span class="id">m1</span> <span class="id">m2</span>: <span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#mr">mr</a></span>) :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">m3</span>:<span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#mr">mr</a></span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#m1">m1</a></span>.(<span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#mr_output">mr_output</a></span>) &lt;&gt; <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#m1">m1</a></span>.(<span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#mr_input">mr_input</a></span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#m2">m2</a></span>.(<span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#mr_output">mr_output</a></span>) &lt;&gt; <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#m2">m2</a></span>.(<span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#mr_input">mr_input</a></span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#m2">m2</a></span>.(<span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#mr_output">mr_output</a></span>) &lt;&gt; <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#m1">m1</a></span>.(<span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#mr_input">mr_input</a></span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#mf">mf</a></span> <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#m1">m1</a></span> <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#m2">m2</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#m3">m3</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">loc_d</span>: <span class="id"><a href="Qcert.Common.Data.DData.html#ddata">ddata</a></span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#map_well_localized">map_well_localized</a></span> <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#m1">m1</a></span>.(<span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#mr_map">mr_map</a></span>) <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#loc_d">loc_d</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#get_mr_chain_result">get_mr_chain_result</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#mr_chain_eval">mr_chain_eval</a></span> <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#NNRCMRRewrite.h">h</a></span> ((<span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#m1">m1</a></span>.(<span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#mr_input">mr_input</a></span>),<span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#loc_d">loc_d</a></span>)::<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span>) (<span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#m1">m1</a></span>::<span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#m2">m2</a></span>::<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span>)) =<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#get_mr_chain_result">get_mr_chain_result</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#mr_chain_eval">mr_chain_eval</a></span> <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#NNRCMRRewrite.h">h</a></span> ((<span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#m1">m1</a></span>.(<span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#mr_input">mr_input</a></span>),<span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#loc_d">loc_d</a></span>)::<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span>) (<span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#m3">m3</a></span>::<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span>)).<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="merge_correct_weak">merge_correct_weak</a></span> (<span class="id">mf</span>:<span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#mr">mr</a></span> -&gt; <span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#mr">mr</a></span> -&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#option">option</a></span> <span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#mr">mr</a></span>) :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">m1</span> <span class="id">m2</span> <span class="id">m3</span>:<span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#mr">mr</a></span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#m1">m1</a></span>.(<span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#mr_output">mr_output</a></span>) &lt;&gt; <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#m1">m1</a></span>.(<span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#mr_input">mr_input</a></span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#m2">m2</a></span>.(<span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#mr_output">mr_output</a></span>) &lt;&gt; <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#m2">m2</a></span>.(<span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#mr_input">mr_input</a></span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#m2">m2</a></span>.(<span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#mr_output">mr_output</a></span>) &lt;&gt; <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#m1">m1</a></span>.(<span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#mr_input">mr_input</a></span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#mf">mf</a></span> <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#m1">m1</a></span> <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#m2">m2</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#m3">m3</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">loc_d</span>: <span class="id"><a href="Qcert.Common.Data.DData.html#ddata">ddata</a></span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">result</span>: <span class="id"><a href="Qcert.Common.Data.RData.html#data">data</a></span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#map_well_localized">map_well_localized</a></span> <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#m1">m1</a></span>.(<span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#mr_map">mr_map</a></span>) <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#loc_d">loc_d</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#get_mr_chain_result">get_mr_chain_result</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#mr_chain_eval">mr_chain_eval</a></span> <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#NNRCMRRewrite.h">h</a></span> ((<span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#m1">m1</a></span>.(<span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#mr_input">mr_input</a></span>),<span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#loc_d">loc_d</a></span>)::<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span>) (<span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#m1">m1</a></span>::<span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#m2">m2</a></span>::<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span>)) = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#result">result</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#get_mr_chain_result">get_mr_chain_result</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#mr_chain_eval">mr_chain_eval</a></span> <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#NNRCMRRewrite.h">h</a></span> ((<span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#m1">m1</a></span>.(<span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#mr_input">mr_input</a></span>),<span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#loc_d">loc_d</a></span>)::<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span>) (<span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#m3">m3</a></span>::<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span>)) = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#result">result</a></span>.<br/>
<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="merge_collect_dispatch">merge_collect_dispatch</a></span> <span class="id">mr1</span> <span class="id">mr2</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">if</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Classes.EquivDec.html#equiv_decb">equiv_decb</a></span> <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#mr1">mr1</a></span>.(<span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#mr_output">mr_output</a></span>) <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#mr2">mr2</a></span>.(<span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#mr_input">mr_input</a></span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;&amp; <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#is_id_collect">is_id_collect</a></span> <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#mr1">mr1</a></span>.(<span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#mr_reduce">mr_reduce</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;&amp; <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#is_dispatch_map">is_dispatch_map</a></span> <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#mr2">mr2</a></span>.(<span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#mr_map">mr_map</a></span>) <span class="kwd">then</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">mr</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#mkMR">mkMR</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#mr1">mr1</a></span>.(<span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#mr_input">mr_input</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#mr2">mr2</a></span>.(<span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#mr_output">mr_output</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#mr1">mr1</a></span>.(<span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#mr_map">mr_map</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#mr2">mr2</a></span>.(<span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#mr_reduce">mr_reduce</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#mr">mr</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">else</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="merge_collect_dispatch_correct">merge_collect_dispatch_correct</a></span> <span class="id">mr1</span> <span class="id">mr2</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#merge_correct">merge_correct</a></span> <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#merge_collect_dispatch">merge_collect_dispatch</a></span> <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#mr1">mr1</a></span> <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#mr2">mr2</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2649')">Proof.</div>
<div class="proofscript" id="proof2649">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#merge_correct">merge_correct</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">mr3</span> <span class="id">Hcycle1</span> <span class="id">Hcycle2</span> <span class="id">Hcycle3</span> <span class="id">Hmerge</span> <span class="id">loc_d</span> <span class="id">Hwell_localized</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#merge_collect_dispatch">merge_collect_dispatch</a></span> <span class="kwd">in</span> <span class="id">Hmerge</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">case_eq</span> ((<span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#mr_output">mr_output</a></span> <span class="id">mr1</span> ==<span class="id">b</span> <span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#mr_input">mr_input</a></span> <span class="id">mr2</span>) &amp;&amp;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#is_id_collect">is_id_collect</a></span> (<span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#mr_reduce">mr_reduce</a></span> <span class="id">mr1</span>) &amp;&amp; <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#is_dispatch_map">is_dispatch_map</a></span> (<span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#mr_map">mr_map</a></span> <span class="id">mr2</span>)); <span class="tactic">intros</span> <span class="id">Heq</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Heq</span> <span class="kwd">in</span> *; <span class="tactic">simpl</span> <span class="kwd">in</span> *; [|<span class="tactic">congruence</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Hmerge</span>; <span class="tactic">clear</span> <span class="id">Hmerge</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Bool.Bool.html#andb_true_iff">Bool.andb_true_iff</a></span> <span class="kwd">in</span> <span class="id">Heq</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Bool.Bool.html#andb_true_iff">Bool.andb_true_iff</a></span> <span class="kwd">in</span> <span class="id">Heq</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Heq</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#mr_chain_eval">mr_chain_eval</a></span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="Qcert.Utils.Lift.html#olift">olift</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Classes.EquivDec.html#equiv_decb">equiv_decb</a></span> <span class="kwd">in</span> *;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="id">dest_eqdec</span>; <span class="tactic">try</span> <span class="tactic">congruence</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#mr_eval">mr_eval</a></span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">case_eq</span> ((<span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#mr_map_eval">mr_map_eval</a></span> <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#NNRCMRRewrite.h">h</a></span> (<span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#mr_map">mr_map</a></span> <span class="id">mr1</span>) <span class="id">loc_d</span>)); <span class="tactic">simpl</span>; <span class="tactic">try</span> <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">coll</span> <span class="id">Hmap1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> (<span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#id_collect_correct">id_collect_correct</a></span> <span class="id">_</span> <span class="id">_</span> <span class="id">H1</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="id">dest_eqdec</span>; <span class="tactic">try</span> <span class="tactic">congruence</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">case_eq</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Classes.EquivDec.html#equiv_dec">equiv_dec</a></span> (<span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#mr_input">mr_input</a></span> <span class="id">mr2</span>) (<span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#mr_output">mr_output</a></span> <span class="id">mr1</span>)); <span class="tactic">try</span> <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> (<span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#dispatch_map_correct">dispatch_map_correct</a></span> <span class="id">_</span> <span class="id">_</span> <span class="id">H0</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#mr_reduce_eval">mr_reduce_eval</a></span> <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#NNRCMRRewrite.h">h</a></span> (<span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#mr_reduce">mr_reduce</a></span> <span class="id">mr2</span>) <span class="id">coll</span>); <span class="tactic">try</span> <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">e1</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#merge_env">merge_env</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">d</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Classes.EquivDec.html#equiv_decb">equiv_decb</a></span> <span class="kwd">in</span> *;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="id">dest_eqdec</span>; <span class="tactic">try</span> <span class="tactic">congruence</span>; <span class="tactic">simpl</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
<br/>
<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="merge_mr_id_dist_l">merge_mr_id_dist_l</a></span> <span class="id">mr1</span> <span class="id">mr2</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">if</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Classes.EquivDec.html#equiv_decb">equiv_decb</a></span> <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#mr1">mr1</a></span>.(<span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#mr_output">mr_output</a></span>) <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#mr2">mr2</a></span>.(<span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#mr_input">mr_input</a></span>) &amp;&amp; <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#is_id_dist_mr">is_id_dist_mr</a></span> <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#mr1">mr1</a></span> <span class="kwd">then</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">mr</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#mkMR">mkMR</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#mr1">mr1</a></span>.(<span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#mr_input">mr_input</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#mr2">mr2</a></span>.(<span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#mr_output">mr_output</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#mr2">mr2</a></span>.(<span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#mr_map">mr_map</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#mr2">mr2</a></span>.(<span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#mr_reduce">mr_reduce</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#mr">mr</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">else</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="merge_mr_id_dist_l_correct">merge_mr_id_dist_l_correct</a></span> <span class="id">mr1</span> <span class="id">mr2</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#merge_correct">merge_correct</a></span> <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#merge_mr_id_dist_l">merge_mr_id_dist_l</a></span> <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#mr1">mr1</a></span> <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#mr2">mr2</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2650')">Proof.</div>
<div class="proofscript" id="proof2650">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#merge_correct">merge_correct</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">mr3</span> <span class="id">Hcycle1</span> <span class="id">Hcycle2</span> <span class="id">Hcycle3</span> <span class="id">Hmerge_mr</span> <span class="id">loc_d</span> <span class="id">Hwell_localized</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#merge_mr_id_dist_l">merge_mr_id_dist_l</a></span> <span class="kwd">in</span> <span class="id">Hmerge_mr</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">case_eq</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Classes.EquivDec.html#equiv_decb">equiv_decb</a></span> (<span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#mr_output">mr_output</a></span> <span class="id">mr1</span>) (<span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#mr_input">mr_input</a></span> <span class="id">mr2</span>) &amp;&amp; <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#is_id_dist_mr">is_id_dist_mr</a></span> <span class="id">mr1</span>); <span class="tactic">intros</span> <span class="id">Heq</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Heq</span> <span class="kwd">in</span> *; <span class="tactic">simpl</span> <span class="kwd">in</span> *; [|<span class="tactic">congruence</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Bool.Bool.html#andb_true_iff">Bool.andb_true_iff</a></span> <span class="kwd">in</span> <span class="id">Heq</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Heq</span> <span class="kwd">as</span> (<span class="id">Hmr1_mr2</span>, <span class="id">Hmr1_is_id</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Hmerge_mr</span>; <span class="tactic">clear</span> <span class="id">Hmerge_mr</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#mr_chain_eval">mr_chain_eval</a></span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Classes.EquivDec.html#equiv_dec">equiv_dec</a></span> (<span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#mr_input">mr_input</a></span> <span class="id">mr1</span>) (<span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#mr_input">mr_input</a></span> <span class="id">mr1</span>)); <span class="tactic">try</span> <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">generalize</span> (<span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#is_id_dist_mr_correct">is_id_dist_mr_correct</a></span> <span class="id">mr1</span> <span class="id">Hmr1_is_id</span> <span class="id">loc_d</span> <span class="id">Hwell_localized</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">Hmr1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#is_id_dist_mr">is_id_dist_mr</a></span> <span class="kwd">in</span> <span class="id">Hmr1_is_id</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">mr1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">mr_reduce</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> *; <span class="tactic">try</span> <span class="tactic">congruence</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">try</span> <span class="id">solve</span> [ <span class="tactic">destruct</span> <span class="id">r</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> *; <span class="tactic">congruence</span> ].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">loc_d</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">Case</span> "<span class="id">loc_d</span> <span class="id">is</span> <span class="id">scalar</span>"%<span class="id">string</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">mr_map</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> *;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">try</span> <span class="id">contradiction</span>; <span class="tactic">try</span> <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">Case</span> "<span class="id">loc_d</span> <span class="id">is</span> <span class="id">distributed</span>"%<span class="id">string</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Hmr1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#merge_env">merge_env</a></span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Classes.EquivDec.html#equiv_decb">equiv_decb</a></span> <span class="kwd">in</span> *;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="id">dest_eqdec</span>; <span class="tactic">try</span> <span class="tactic">congruence</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="id">dest_eqdec</span>; <span class="tactic">try</span> <span class="tactic">congruence</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#mr_eval">mr_eval</a></span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">generalize</span> (<span class="id"><a href="Qcert.Utils.Lift.html#olift">olift</a></span> (<span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#mr_reduce_eval">mr_reduce_eval</a></span> <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#NNRCMRRewrite.h">h</a></span> (<span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#mr_reduce">mr_reduce</a></span> <span class="id">mr2</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#mr_map_eval">mr_map_eval</a></span> <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#NNRCMRRewrite.h">h</a></span> (<span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#mr_map">NNRCMR.mr_map</a></span> <span class="id">mr2</span>) (<span class="id"><a href="Qcert.Common.Data.DData.html#Ddistr">Ddistr</a></span> <span class="id">l</span>))).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">o</span>; <span class="tactic">try</span> <span class="tactic">reflexivity</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">d</span>; <span class="tactic">try</span> <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="merge_mr_id_scalar_l">merge_mr_id_scalar_l</a></span> <span class="id">mr1</span> <span class="id">mr2</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">if</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Classes.EquivDec.html#equiv_decb">equiv_decb</a></span> <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#mr1">mr1</a></span>.(<span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#mr_output">mr_output</a></span>) <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#mr2">mr2</a></span>.(<span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#mr_input">mr_input</a></span>) &amp;&amp; <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#is_id_scalar_mr">is_id_scalar_mr</a></span> <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#mr1">mr1</a></span> <span class="kwd">then</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">mr</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#mkMR">mkMR</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#mr1">mr1</a></span>.(<span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#mr_input">mr_input</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#mr2">mr2</a></span>.(<span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#mr_output">mr_output</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#mr2">mr2</a></span>.(<span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#mr_map">mr_map</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#mr2">mr2</a></span>.(<span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#mr_reduce">mr_reduce</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#mr">mr</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">else</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="merge_mr_id_scalar_l_correct">merge_mr_id_scalar_l_correct</a></span> <span class="id">mr1</span> <span class="id">mr2</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#merge_correct">merge_correct</a></span> <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#merge_mr_id_scalar_l">merge_mr_id_scalar_l</a></span> <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#mr1">mr1</a></span> <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#mr2">mr2</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2651')">Proof.</div>
<div class="proofscript" id="proof2651">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#merge_correct">merge_correct</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">mr3</span> <span class="id">Hcycle1</span> <span class="id">Hcycle2</span> <span class="id">Hcycle3</span> <span class="id">Hmerge_mr</span> <span class="id">loc_d</span> <span class="id">Hwell_localized</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#merge_mr_id_scalar_l">merge_mr_id_scalar_l</a></span> <span class="kwd">in</span> <span class="id">Hmerge_mr</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">case_eq</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Classes.EquivDec.html#equiv_decb">equiv_decb</a></span> (<span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#mr_output">mr_output</a></span> <span class="id">mr1</span>) (<span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#mr_input">mr_input</a></span> <span class="id">mr2</span>) &amp;&amp; <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#is_id_scalar_mr">is_id_scalar_mr</a></span> <span class="id">mr1</span>); <span class="tactic">intros</span> <span class="id">Heq</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Heq</span> <span class="kwd">in</span> *; <span class="tactic">simpl</span> <span class="kwd">in</span> *; [|<span class="tactic">congruence</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Bool.Bool.html#andb_true_iff">Bool.andb_true_iff</a></span> <span class="kwd">in</span> <span class="id">Heq</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Heq</span> <span class="kwd">as</span> (<span class="id">Hmr1_mr2</span>, <span class="id">Hmr1_is_id</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Hmerge_mr</span>; <span class="tactic">clear</span> <span class="id">Hmerge_mr</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#mr_chain_eval">mr_chain_eval</a></span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Classes.EquivDec.html#equiv_dec">equiv_dec</a></span> (<span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#mr_input">mr_input</a></span> <span class="id">mr1</span>) (<span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#mr_input">mr_input</a></span> <span class="id">mr1</span>)); <span class="tactic">try</span> <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">generalize</span> (<span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#is_id_scalar_mr_correct">is_id_scalar_mr_correct</a></span> <span class="id">mr1</span> <span class="id">Hmr1_is_id</span> <span class="id">loc_d</span> <span class="id">Hwell_localized</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">Hmr1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#is_id_scalar_mr">is_id_scalar_mr</a></span> <span class="kwd">in</span> <span class="id">Hmr1_is_id</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">mr1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">mr_reduce</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> *; <span class="tactic">try</span> <span class="tactic">congruence</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">try</span> <span class="id">solve</span> [ <span class="tactic">destruct</span> <span class="id">r</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> *; <span class="tactic">congruence</span> ].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">loc_d</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">Case</span> "<span class="id">loc_d</span> <span class="id">is</span> <span class="id">scalar</span>"%<span class="id">string</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Hmr1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#merge_env">merge_env</a></span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Classes.EquivDec.html#equiv_decb">equiv_decb</a></span> <span class="kwd">in</span> *;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="id">dest_eqdec</span>; <span class="tactic">try</span> <span class="tactic">congruence</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="id">dest_eqdec</span>; <span class="tactic">try</span> <span class="tactic">congruence</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#mr_eval">mr_eval</a></span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">generalize</span> (<span class="id"><a href="Qcert.Utils.Lift.html#olift">olift</a></span> (<span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#mr_reduce_eval">mr_reduce_eval</a></span> <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#NNRCMRRewrite.h">h</a></span> (<span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#mr_reduce">mr_reduce</a></span> <span class="id">mr2</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#mr_map_eval">mr_map_eval</a></span> <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#NNRCMRRewrite.h">h</a></span> (<span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#mr_map">NNRCMR.mr_map</a></span> <span class="id">mr2</span>) (<span class="id"><a href="Qcert.Common.Data.DData.html#Dlocal">Dlocal</a></span> <span class="id">d</span>))).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">o</span>; <span class="tactic">try</span> <span class="tactic">reflexivity</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">d0</span>; <span class="tactic">try</span> <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">Case</span> "<span class="id">loc_d</span> <span class="id">is</span> <span class="id">distributed</span>"%<span class="id">string</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">mr_map</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> *;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">try</span> <span class="id">contradiction</span>; <span class="tactic">try</span> <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="merge_id_reduce_id_dist_map">merge_id_reduce_id_dist_map</a></span> <span class="id">mr1</span> <span class="id">mr2</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">if</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Classes.EquivDec.html#equiv_decb">equiv_decb</a></span> <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#mr1">mr1</a></span>.(<span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#mr_output">mr_output</a></span>) <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#mr2">mr2</a></span>.(<span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#mr_input">mr_input</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;&amp; <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#is_id_reduce">is_id_reduce</a></span> <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#mr1">mr1</a></span>.(<span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#mr_reduce">mr_reduce</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;&amp; <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#is_id_dist_map">is_id_dist_map</a></span> <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#mr2">mr2</a></span>.(<span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#mr_map">mr_map</a></span>) <span class="kwd">then</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">mr</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#mkMR">mkMR</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#mr1">mr1</a></span>.(<span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#mr_input">mr_input</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#mr2">mr2</a></span>.(<span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#mr_output">mr_output</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#mr1">mr1</a></span>.(<span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#mr_map">mr_map</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#mr2">mr2</a></span>.(<span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#mr_reduce">mr_reduce</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#mr">mr</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">else</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="merge_id_reduce_id_dist_map_correct">merge_id_reduce_id_dist_map_correct</a></span> <span class="id">mr1</span> <span class="id">mr2</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#merge_correct">merge_correct</a></span> <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#merge_id_reduce_id_dist_map">merge_id_reduce_id_dist_map</a></span> <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#mr1">mr1</a></span> <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#mr2">mr2</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2652')">Proof.</div>
<div class="proofscript" id="proof2652">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#merge_correct">merge_correct</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">mr3</span> <span class="id">Hcycle1</span> <span class="id">Hcycle2</span> <span class="id">Hcycle3</span> <span class="id">Hmerge_mr</span> <span class="id">loc_d</span> <span class="id">Hwell_localized</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#merge_id_reduce_id_dist_map">merge_id_reduce_id_dist_map</a></span> <span class="kwd">in</span> <span class="id">Hmerge_mr</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">case_eq</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Classes.EquivDec.html#equiv_decb">equiv_decb</a></span> (<span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#mr_output">mr_output</a></span> <span class="id">mr1</span>) (<span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#mr_input">mr_input</a></span> <span class="id">mr2</span>) &amp;&amp;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#is_id_reduce">is_id_reduce</a></span> (<span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#mr_reduce">mr_reduce</a></span> <span class="id">mr1</span>) &amp;&amp; <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#is_id_dist_map">is_id_dist_map</a></span> (<span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#mr_map">mr_map</a></span> <span class="id">mr2</span>)); <span class="tactic">intros</span> <span class="id">Heq</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Heq</span> <span class="kwd">in</span> *; <span class="tactic">simpl</span> <span class="kwd">in</span> *; [|<span class="tactic">congruence</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Bool.Bool.html#andb_true_iff">Bool.andb_true_iff</a></span> <span class="kwd">in</span> <span class="id">Heq</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Heq</span> <span class="kwd">as</span> (<span class="id">Htmp</span>, <span class="id">Hmr2_map_is_id</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Htmp</span> <span class="kwd">as</span> (<span class="id">Hmr1_mr2</span>, <span class="id">Hmr1_red_is_id</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Hmerge_mr</span>; <span class="tactic">clear</span> <span class="id">Hmerge_mr</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#mr_chain_eval">mr_chain_eval</a></span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Classes.EquivDec.html#equiv_dec">equiv_dec</a></span> (<span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#mr_input">mr_input</a></span> <span class="id">mr1</span>) (<span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#mr_input">mr_input</a></span> <span class="id">mr1</span>)); <span class="tactic">simpl</span>; <span class="tactic">try</span> <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#mr_eval">mr_eval</a></span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> ((<span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#mr_map_eval">mr_map_eval</a></span> <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#NNRCMRRewrite.h">h</a></span> (<span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#mr_map">mr_map</a></span> <span class="id">mr1</span>) <span class="id">loc_d</span>)); <span class="tactic">simpl</span>; <span class="tactic">try</span> <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> (<span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#id_reduce_correct">id_reduce_correct</a></span> <span class="id">_</span> <span class="id">_</span> <span class="id">Hmr1_red_is_id</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Classes.EquivDec.html#equiv_decb">equiv_decb</a></span> <span class="kwd">in</span> *;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="id">dest_eqdec</span>; <span class="tactic">try</span> <span class="tactic">congruence</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="id">dest_eqdec</span>; <span class="tactic">try</span> <span class="tactic">congruence</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> (<span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#id_dist_map_correct">id_dist_map_correct</a></span> <span class="id">_</span> <span class="id">_</span> <span class="id">Hmr2_map_is_id</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#mr_reduce_eval">mr_reduce_eval</a></span> <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#NNRCMRRewrite.h">h</a></span> (<span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#mr_reduce">mr_reduce</a></span> <span class="id">mr2</span>) <span class="id">l</span>); <span class="tactic">simpl</span>; <span class="tactic">try</span> <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#merge_env">merge_env</a></span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="id">dest_eqdec</span>; <span class="tactic">try</span> <span class="tactic">congruence</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">d</span>; <span class="tactic">simpl</span>; <span class="tactic">try</span> <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="merge_singleton_reduce_id_scalar_map">merge_singleton_reduce_id_scalar_map</a></span> <span class="id">mr1</span> <span class="id">mr2</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">if</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Classes.EquivDec.html#equiv_decb">equiv_decb</a></span> <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#mr1">mr1</a></span>.(<span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#mr_output">mr_output</a></span>) <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#mr2">mr2</a></span>.(<span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#mr_input">mr_input</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;&amp; <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#is_singleton_reduce">is_singleton_reduce</a></span> <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#mr1">mr1</a></span>.(<span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#mr_reduce">mr_reduce</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;&amp; <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#is_id_scalar_map">is_id_scalar_map</a></span> <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#mr2">mr2</a></span>.(<span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#mr_map">mr_map</a></span>) <span class="kwd">then</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">mr</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#mkMR">mkMR</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#mr1">mr1</a></span>.(<span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#mr_input">mr_input</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#mr2">mr2</a></span>.(<span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#mr_output">mr_output</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#mr1">mr1</a></span>.(<span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#mr_map">mr_map</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#mr2">mr2</a></span>.(<span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#mr_reduce">mr_reduce</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#mr">mr</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">else</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="merge_singleton_reduce_id_scalar_map_correct">merge_singleton_reduce_id_scalar_map_correct</a></span> <span class="id">mr1</span> <span class="id">mr2</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">loc_d</span>, <span class="id">exists</span> <span class="id">d</span>, <span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#mr_map_eval">mr_map_eval</a></span> <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#NNRCMRRewrite.h">h</a></span> <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#mr1">mr1</a></span>.(<span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#mr_map">mr_map</a></span>) <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#loc_d">loc_d</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> (<span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#d">d</a></span>::<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span>)) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#merge_correct">merge_correct</a></span> <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#merge_singleton_reduce_id_scalar_map">merge_singleton_reduce_id_scalar_map</a></span> <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#mr1">mr1</a></span> <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#mr2">mr2</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2653')">Proof.</div>
<div class="proofscript" id="proof2653">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">Hmap1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#merge_correct">merge_correct</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">mr3</span> <span class="id">Hcycle1</span> <span class="id">Hcycle2</span> <span class="id">Hcycle3</span> <span class="id">Hmerge_mr</span> <span class="id">loc_d</span> <span class="id">Hwell_localized</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#merge_singleton_reduce_id_scalar_map">merge_singleton_reduce_id_scalar_map</a></span> <span class="kwd">in</span> <span class="id">Hmerge_mr</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">case_eq</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Classes.EquivDec.html#equiv_decb">equiv_decb</a></span> (<span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#mr_output">mr_output</a></span> <span class="id">mr1</span>) (<span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#mr_input">mr_input</a></span> <span class="id">mr2</span>) &amp;&amp;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#is_singleton_reduce">is_singleton_reduce</a></span> (<span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#mr_reduce">mr_reduce</a></span> <span class="id">mr1</span>) &amp;&amp;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#is_id_scalar_map">is_id_scalar_map</a></span> (<span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#mr_map">mr_map</a></span> <span class="id">mr2</span>)); <span class="tactic">intros</span> <span class="id">Heq</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Heq</span> <span class="kwd">in</span> *; <span class="tactic">simpl</span> <span class="kwd">in</span> *; [|<span class="tactic">congruence</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Bool.Bool.html#andb_true_iff">Bool.andb_true_iff</a></span> <span class="kwd">in</span> <span class="id">Heq</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Heq</span> <span class="kwd">as</span> (<span class="id">Htmp</span>, <span class="id">Hmr2_map_is_id</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Htmp</span> <span class="kwd">as</span> (<span class="id">Hm1_m2</span>, <span class="id">Hmr1_red_is_single</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Hmerge_mr</span>; <span class="tactic">clear</span> <span class="id">Hmerge_mr</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#mr_chain_eval">mr_chain_eval</a></span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Classes.EquivDec.html#equiv_dec">equiv_dec</a></span> (<span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#mr_input">mr_input</a></span> <span class="id">mr1</span>) (<span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#mr_input">mr_input</a></span> <span class="id">mr1</span>)); <span class="tactic">simpl</span>; <span class="tactic">try</span> <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#mr_eval">mr_eval</a></span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id">Hmap1</span> <span class="id">loc_d</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Hmap1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> (<span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#singleton_reduce_correct">singleton_reduce_correct</a></span> <span class="id">_</span> <span class="id">_</span> <span class="id">Hmr1_red_is_single</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Classes.EquivDec.html#equiv_decb">equiv_decb</a></span> <span class="kwd">in</span> *;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="id">dest_eqdec</span>; <span class="tactic">try</span> <span class="tactic">congruence</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="id">dest_eqdec</span>; <span class="tactic">try</span> <span class="tactic">congruence</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> (<span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#id_scalar_map_correct">id_scalar_map_correct</a></span> <span class="id">_</span> <span class="id">_</span> <span class="id">Hmr2_map_is_id</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#mr_reduce_eval">mr_reduce_eval</a></span> <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#NNRCMRRewrite.h">h</a></span> (<span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#mr_reduce">mr_reduce</a></span> <span class="id">mr2</span>) (<span class="id">x</span> :: <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span>)); <span class="tactic">simpl</span>; <span class="tactic">try</span> <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#merge_env">merge_env</a></span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="id">dest_eqdec</span>; <span class="tactic">try</span> <span class="tactic">congruence</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">d</span>; <span class="tactic">simpl</span>; <span class="tactic">try</span> <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="merge_reduce_id_flatten_map">merge_reduce_id_flatten_map</a></span> (<span class="id">mr1</span> <span class="id">mr2</span>:<span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#mr">mr</a></span>) :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#mr1">mr1</a></span>.(<span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#mr_map">mr_map</a></span>) <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#MapDist">MapDist</a></span> <span class="id">map1</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">if</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Classes.EquivDec.html#equiv_decb">equiv_decb</a></span> <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#mr1">mr1</a></span>.(<span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#mr_output">mr_output</a></span>) <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#mr2">mr2</a></span>.(<span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#mr_input">mr_input</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;&amp; <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#is_id_reduce">is_id_reduce</a></span> <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#mr1">mr1</a></span>.(<span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#mr_reduce">mr_reduce</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;&amp; <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#is_flatten_dist_map">is_flatten_dist_map</a></span> <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#mr2">mr2</a></span>.(<span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#mr_map">mr_map</a></span>) <span class="kwd">then</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">mr</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#mkMR">mkMR</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#mr1">mr1</a></span>.(<span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#mr_input">mr_input</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#mr2">mr2</a></span>.(<span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#mr_output">mr_output</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#MapDistFlatten">MapDistFlatten</a></span> <span class="id">map1</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#mr2">mr2</a></span>.(<span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#mr_reduce">mr_reduce</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#mr">mr</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">else</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">_</span> =&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="merge_reduce_id_flatten_map_correct">merge_reduce_id_flatten_map_correct</a></span> <span class="id">mr1</span> <span class="id">mr2</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#merge_correct">merge_correct</a></span> <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#merge_reduce_id_flatten_map">merge_reduce_id_flatten_map</a></span> <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#mr1">mr1</a></span> <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#mr2">mr2</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2654')">Proof.</div>
<div class="proofscript" id="proof2654">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#merge_correct">merge_correct</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">mr3</span> <span class="id">Hcycle1</span> <span class="id">Hcycle2</span> <span class="id">Hcycle3</span> <span class="id">Hmerge_mr</span> <span class="id">loc_d</span> <span class="id">Hwell_localized</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#merge_reduce_id_flatten_map">merge_reduce_id_flatten_map</a></span> <span class="kwd">in</span> <span class="id">Hmerge_mr</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#mr_chain_eval">mr_chain_eval</a></span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Classes.EquivDec.html#equiv_dec">equiv_dec</a></span> (<span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#mr_input">mr_input</a></span> <span class="id">mr1</span>) (<span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#mr_input">mr_input</a></span> <span class="id">mr1</span>)); <span class="tactic">simpl</span>; <span class="tactic">try</span> <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#mr_eval">mr_eval</a></span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#mr_map">mr_map</a></span> <span class="id">mr1</span>); <span class="tactic">try</span> <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">case_eq</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Classes.EquivDec.html#equiv_decb">equiv_decb</a></span> (<span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#mr_output">mr_output</a></span> <span class="id">mr1</span>) (<span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#mr_input">mr_input</a></span> <span class="id">mr2</span>) &amp;&amp;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#is_id_reduce">is_id_reduce</a></span> (<span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#mr_reduce">mr_reduce</a></span> <span class="id">mr1</span>) &amp;&amp;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#is_flatten_dist_map">is_flatten_dist_map</a></span> (<span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#mr_map">mr_map</a></span> <span class="id">mr2</span>)); <span class="tactic">intros</span> <span class="id">Heq</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Heq</span> <span class="kwd">in</span> *; <span class="tactic">simpl</span> <span class="kwd">in</span> *; [|<span class="tactic">congruence</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Bool.Bool.html#andb_true_iff">Bool.andb_true_iff</a></span> <span class="kwd">in</span> <span class="id">Heq</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Heq</span> <span class="kwd">as</span> (<span class="id">Htmp</span>, <span class="id">Hmr2_map_is_flatten</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Htmp</span> <span class="kwd">as</span> (<span class="id">Hmr1_mr2</span>, <span class="id">Hmr1_red_is_id</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Hmerge_mr</span>; <span class="tactic">clear</span> <span class="id">Hmerge_mr</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">loc_d</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> *; <span class="tactic">try</span> <span class="id">contradiction</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">dest_eqdec</span>; <span class="tactic">try</span> <span class="tactic">congruence</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="Qcert.Common.Data.RRelation.html#rmap">rmap</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">fun</span> <span class="id">d</span> : <span class="id"><a href="Qcert.Common.Data.RData.html#data">data</a></span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> (<span class="id">doc</span>, <span class="id">body</span>) := <span class="id">p</span> <span class="kwd">in</span> <span class="id"><a href="Qcert.cNNRC.Lang.cNNRC.html#nnrc_core_eval">nnrc_core_eval</a></span> <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#NNRCMRRewrite.h">h</a></span> <span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#empty_cenv">empty_cenv</a></span> ((<span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#doc">doc</a></span>, <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#d">d</a></span>) :: <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span>) <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#body">body</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">l</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> *; <span class="tactic">try</span> <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> (<span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#id_reduce_correct">id_reduce_correct</a></span> <span class="id">_</span> <span class="id">_</span> <span class="id">Hmr1_red_is_id</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Classes.EquivDec.html#equiv_decb">equiv_decb</a></span> <span class="kwd">in</span> *;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="id">dest_eqdec</span>; <span class="tactic">try</span> <span class="tactic">congruence</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="id">dest_eqdec</span>; <span class="tactic">try</span> <span class="tactic">congruence</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> (<span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#flatten_dist_map_correct">flatten_dist_map_correct</a></span> <span class="id">_</span> <span class="id">_</span> <span class="id">Hmr2_map_is_flatten</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="Qcert.Utils.Lift.html#olift">olift</a></span> (<span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#mr_reduce_eval">mr_reduce_eval</a></span> <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#NNRCMRRewrite.h">h</a></span> (<span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#mr_reduce">mr_reduce</a></span> <span class="id">mr2</span>)) (<span class="id"><a href="Qcert.Common.Data.RRelation.html#rflatten">rflatten</a></span> <span class="id">l0</span>));<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>; <span class="tactic">try</span> <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#merge_env">merge_env</a></span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="id">dest_eqdec</span>; <span class="tactic">try</span> <span class="tactic">congruence</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">d</span>; <span class="tactic">simpl</span>; <span class="tactic">try</span> <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="merge_scalar_singleton_scalar">merge_scalar_singleton_scalar</a></span> (<span class="id">mr1</span> <span class="id">mr2</span>: <span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#mr">mr</a></span>) :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">if</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Classes.EquivDec.html#equiv_decb">equiv_decb</a></span> <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#mr1">mr1</a></span>.(<span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#mr_output">mr_output</a></span>) <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#mr2">mr2</a></span>.(<span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#mr_input">mr_input</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;&amp; <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#is_singleton_reduce">is_singleton_reduce</a></span> <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#mr1">mr1</a></span>.(<span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#mr_reduce">mr_reduce</a></span>) <span class="kwd">then</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#mr1">mr1</a></span>.(<span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#mr_map">mr_map</a></span>), <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#mr2">mr2</a></span>.(<span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#mr_map">mr_map</a></span>) <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#MapScalar">MapScalar</a></span> (<span class="id">x1</span>, <span class="id"><a href="Qcert.cNNRC.Lang.cNNRC.html#NNRCUnop">NNRCUnop</a></span> <span class="id"><a href="Qcert.Common.Operators.UnaryOperators.html#OpBag">OpBag</a></span> <span class="id">n1</span>), <span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#MapScalar">MapScalar</a></span> (<span class="id">x2</span>, <span class="id">n2</span>) =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">map</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#MapScalar">MapScalar</a></span> (<span class="id">x1</span>, <span class="id"><a href="Qcert.cNNRC.Lang.cNNRC.html#NNRCLet">NNRCLet</a></span> <span class="id">x2</span> <span class="id">n1</span> <span class="id">n2</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">mr</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#mkMR">mkMR</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#mr1">mr1</a></span>.(<span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#mr_input">mr_input</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#mr2">mr2</a></span>.(<span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#mr_output">mr_output</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#map">map</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#mr2">mr2</a></span>.(<span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#mr_reduce">mr_reduce</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#mr">mr</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">_</span>, <span class="id">_</span> =&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">else</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="merge_scalar_singleton_scalar_correct">merge_scalar_singleton_scalar_correct</a></span> <span class="id">mr1</span> <span class="id">mr2</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#mr_well_formed">mr_well_formed</a></span> <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#mr2">mr2</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#merge_correct">merge_correct</a></span> <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#merge_scalar_singleton_scalar">merge_scalar_singleton_scalar</a></span> <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#mr1">mr1</a></span> <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#mr2">mr2</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2655')">Proof.</div>
<div class="proofscript" id="proof2655">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">Hmr2_wf</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#mr_well_formed">mr_well_formed</a></span> <span class="kwd">in</span> <span class="id">Hmr2_wf</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Hmr2_wf</span> <span class="kwd">as</span> [ <span class="id">Hmr2_map_wf</span> <span class="id">Hmr2_red_wf</span> ].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> <span class="id">Hmr2_red_wf</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#merge_correct">merge_correct</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">mr3</span> <span class="id">Hcycle1</span> <span class="id">Hcycle2</span> <span class="id">Hcycle3</span> <span class="id">Hmerge_mr</span> <span class="id">loc_d</span> <span class="id">Hwell_localized</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#merge_scalar_singleton_scalar">merge_scalar_singleton_scalar</a></span> <span class="kwd">in</span> <span class="id">Hmerge_mr</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#mr_chain_eval">mr_chain_eval</a></span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Classes.EquivDec.html#equiv_dec">equiv_dec</a></span> (<span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#mr_input">mr_input</a></span> <span class="id">mr1</span>) (<span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#mr_input">mr_input</a></span> <span class="id">mr1</span>)); <span class="tactic">simpl</span>; <span class="tactic">try</span> <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#mr_eval">mr_eval</a></span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">case_eq</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Classes.EquivDec.html#equiv_decb">equiv_decb</a></span> (<span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#mr_output">mr_output</a></span> <span class="id">mr1</span>) (<span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#mr_input">mr_input</a></span> <span class="id">mr2</span>) &amp;&amp;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#is_singleton_reduce">is_singleton_reduce</a></span> (<span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#mr_reduce">mr_reduce</a></span> <span class="id">mr1</span>)); <span class="tactic">intros</span> <span class="id">Heq</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Heq</span> <span class="kwd">in</span> *; <span class="tactic">simpl</span> <span class="kwd">in</span> *; [|<span class="tactic">congruence</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Bool.Bool.html#andb_true_iff">Bool.andb_true_iff</a></span> <span class="kwd">in</span> <span class="id">Heq</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Heq</span> <span class="kwd">as</span> (<span class="id">Hmr1_mr2</span>, <span class="id">Hmr1_red_is_singleton</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Hmerge_mr</span>; <span class="tactic">clear</span> <span class="id">Hmerge_mr</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#mr_map">mr_map</a></span> <span class="id">mr1</span>); <span class="tactic">try</span> <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">p</span>; <span class="tactic">try</span> <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">n</span>; <span class="tactic">try</span> <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">u</span>; <span class="tactic">try</span> <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#mr_map">mr_map</a></span> <span class="id">mr2</span>); <span class="tactic">try</span> <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">p</span>; <span class="tactic">try</span> <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H0</span>; <span class="tactic">clear</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">loc_d</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> *; <span class="tactic">try</span> <span class="id">contradiction</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">dest_eqdec</span>; <span class="tactic">try</span> <span class="tactic">congruence</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="Qcert.cNNRC.Lang.cNNRC.html#nnrc_core_eval">nnrc_core_eval</a></span> <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#NNRCMRRewrite.h">h</a></span> <span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#empty_cenv">empty_cenv</a></span> ((<span class="id">v</span>, <span class="id">d</span>) :: <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span>) <span class="id">n</span>); <span class="tactic">simpl</span>; <span class="tactic">try</span> <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> (<span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#singleton_reduce_correct">singleton_reduce_correct</a></span> <span class="id">_</span> <span class="id">_</span> <span class="id">Hmr1_red_is_singleton</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="id">dest_eqdec</span>; <span class="tactic">try</span> <span class="tactic">congruence</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Classes.EquivDec.html#equiv_decb">equiv_decb</a></span> <span class="kwd">in</span> *;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="id">dest_eqdec</span>; <span class="tactic">try</span> <span class="tactic">congruence</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id"><a href="Qcert.cNNRC.Lang.cNNRC.html#nnrc_core_eval">nnrc_core_eval</a></span> <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#NNRCMRRewrite.h">h</a></span> <span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#empty_cenv">empty_cenv</a></span> ((<span class="id">v0</span>, <span class="id">d0</span>) :: <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span>) <span class="id">n0</span> =<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Qcert.cNNRC.Lang.cNNRC.html#nnrc_core_eval">nnrc_core_eval</a></span> <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#NNRCMRRewrite.h">h</a></span> <span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#empty_cenv">empty_cenv</a></span> ((<span class="id">v0</span>, <span class="id">d0</span>) :: (<span class="id">v</span>, <span class="id">d</span>) :: <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span>) <span class="id">n0</span>) <span class="kwd">as</span> <span class="id">Heq</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[ | <span class="tactic">rewrite</span> <span class="id">Heq</span>; <span class="tactic">clear</span> <span class="id">Heq</span> ].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">apply</span> <span class="id"><a href="Qcert.cNNRC.Lang.cNNRCShadow.html#nnrc_core_eval_equiv_free_in_env">nnrc_core_eval_equiv_free_in_env</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">x</span> <span class="id">Hx</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">x</span> = <span class="id">v0</span>) <span class="kwd">as</span> <span class="id">Heq</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[ | <span class="tactic">rewrite</span> <span class="id">Heq</span>; <span class="tactic">clear</span> <span class="id">Heq</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="id">dest_eqdec</span>; <span class="tactic">try</span> <span class="tactic">congruence</span> ].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#function_with_no_free_vars">function_with_no_free_vars</a></span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">Hmr2_map_wf</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">destruct</span> (<span class="id"><a href="Qcert.cNNRC.Lang.cNNRC.html#nnrc_core_eval">nnrc_core_eval</a></span> <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#NNRCMRRewrite.h">h</a></span> <span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#empty_cenv">empty_cenv</a></span> ((<span class="id">v0</span>, <span class="id">d0</span>) :: (<span class="id">v</span>, <span class="id">d</span>) :: <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span>) <span class="id">n0</span>); <span class="tactic">simpl</span>; <span class="tactic">try</span> <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="Qcert.Utils.Lift.html#olift">olift</a></span> (<span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#mr_reduce_eval">mr_reduce_eval</a></span> <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#NNRCMRRewrite.h">h</a></span> (<span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#mr_reduce">mr_reduce</a></span> <span class="id">mr2</span>))); <span class="tactic">simpl</span>; <span class="tactic">try</span> <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#merge_env">merge_env</a></span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="id">dest_eqdec</span>; <span class="tactic">try</span> <span class="tactic">congruence</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">d2</span>; <span class="tactic">simpl</span>; <span class="tactic">try</span> <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
&nbsp;&nbsp;<br/>
<br/>
&nbsp;&nbsp;<br/>
<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="merge_mr_last">merge_mr_last</a></span> <span class="id">mr</span> (<span class="id">last</span>: ((<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="Qcert.Common.Env.RVar.html#var">var</a></span> * <span class="id"><a href="Qcert.NNRC.Lang.NNRC.html#nnrc">nnrc</a></span>) * <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> (<span class="id"><a href="Qcert.Common.Env.RVar.html#var">var</a></span> * <span class="id"><a href="Qcert.Common.Data.DData.html#dlocalization">dlocalization</a></span>)) ) :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> '((<span class="id">params</span>, <span class="id">n</span>), <span class="id">args</span>) := <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#last">last</a></span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> (<span class="id">params</span>, <span class="id">args</span>) <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| (<span class="id">x</span>::<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span>, (<span class="id">output</span>, <span class="id">Vscalar</span>)::<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span>) =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">if</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Classes.EquivDec.html#equiv_decb">equiv_decb</a></span> <span class="id">output</span> <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#mr">mr</a></span>.(<span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#mr_output">mr_output</a></span>) &amp;&amp; <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#is_singleton_reduce">is_singleton_reduce</a></span> <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#mr">mr</a></span>.(<span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#mr_reduce">mr_reduce</a></span>) <span class="kwd">then</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#mr">mr</a></span>.(<span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#mr_map">mr_map</a></span>) <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#MapScalar">MapScalar</a></span> (<span class="id">x1</span>, <span class="id"><a href="Qcert.cNNRC.Lang.cNNRC.html#NNRCUnop">NNRCUnop</a></span> <span class="id"><a href="Qcert.Common.Operators.UnaryOperators.html#OpBag">OpBag</a></span> <span class="id">n1</span>) =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> ((<span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#mr">mr</a></span>.(<span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#mr_input">mr_input</a></span>)::<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span>, <span class="id"><a href="Qcert.cNNRC.Lang.cNNRC.html#NNRCLet">NNRCLet</a></span> <span class="id">x</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="Qcert.cNNRC.Lang.cNNRC.html#NNRCLet">NNRCLet</a></span> <span class="id">x1</span> (<span class="id"><a href="Qcert.cNNRC.Lang.cNNRC.html#NNRCVar">NNRCVar</a></span> <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#mr">mr</a></span>.(<span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#mr_input">mr_input</a></span>)) <span class="id">n1</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">n</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#mr">mr</a></span>.(<span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#mr_input">mr_input</a></span>), <span class="id">Vscalar</span>)::<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">_</span> =&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">else</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| (<span class="id">_</span>, <span class="id">_</span>) =&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="merge_last">merge_last</a></span> <span class="id">mrl</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> '(<span class="id">chain</span>, <span class="id">output</span>, <span class="id">last</span>) :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#fold_right">List.fold_right</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">fun</span> <span class="id">mr</span> <span class="id">chain_output_last</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#chain_output_last">chain_output_last</a></span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span>, <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span>, <span class="id">last</span>) =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#merge_mr_last">merge_mr_last</a></span> <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#mr">mr</a></span> <span class="id">last</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">last</span>' =&gt; (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span>, <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span>, <span class="id">last</span>')<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span> =&gt; (<span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#mr">mr</a></span>::<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span>, <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> (<span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#mr_output">mr_output</a></span> <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#mr">mr</a></span>), <span class="id">last</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| (<span class="id">acc</span>, <span class="id">output</span>, <span class="id">last</span>) =&gt; (<span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#mr">mr</a></span>::<span class="id">acc</span>, <span class="id">output</span>, <span class="id">last</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span>, <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span>, <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#mrl">mrl</a></span>.(<span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#mr_last">mr_last</a></span>)) <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#mrl">mrl</a></span>.(<span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#mr_chain">mr_chain</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">output</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span> =&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">output</span> =&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> (<span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#mkMRChain">mkMRChain</a></span> <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#mrl">mrl</a></span>.(<span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#mr_inputs_loc">mr_inputs_loc</a></span>) <span class="id">chain</span> <span class="id">last</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="mr_chain_apply_rewrite">mr_chain_apply_rewrite</a></span> (<span class="id">rew</span>: <span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#mr">mr</a></span> -&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#option">option</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#mr">mr</a></span>)) <span class="id">l</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#flat_map">List.flat_map</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">fun</span> <span class="id">mr</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#rew">rew</a></span> <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#mr">mr</a></span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span> =&gt; <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#mr">mr</a></span>::<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">mr_chain</span> =&gt; <span class="id">mr_chain</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#l">l</a></span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="apply_rewrite">apply_rewrite</a></span> (<span class="id">rew</span>: <span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#mr">mr</a></span> -&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#option">option</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#mr">mr</a></span>)) <span class="id">mrl</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#mkMRChain">mkMRChain</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#mrl">mrl</a></span>.(<span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#mr_inputs_loc">mr_inputs_loc</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#mr_chain_apply_rewrite">mr_chain_apply_rewrite</a></span> <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#rew">rew</a></span> <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#mrl">mrl</a></span>.(<span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#mr_chain">mr_chain</a></span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#mrl">mrl</a></span>.(<span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#mr_last">mr_last</a></span>).<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="mr_chain_apply_merge">mr_chain_apply_merge</a></span> (<span class="id">merge</span>: <span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#mr">mr</a></span> -&gt; <span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#mr">mr</a></span> -&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#option">option</a></span> <span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#mr">mr</a></span>) <span class="id">l</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">output_vars</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="Qcert.Common.Env.RVar.html#var">var</a></span> := <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#fold_left">List.fold_left</a></span> (<span class="kwd">fun</span> <span class="id">acc</span> <span class="id">mr</span> =&gt; <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#mr">mr</a></span>.(<span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#mr_output">mr_output</a></span>) :: <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#acc">acc</a></span>) <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#l">l</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#fold_right">List.fold_right</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">fun</span> <span class="id">mr1</span> <span class="id">acc</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">if</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Arith.Compare_dec.html#leb">leb</a></span> (<span class="id"><a href="Qcert.Utils.Bag.html#mult">mult</a></span> <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#output_vars">output_vars</a></span> <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#mr1">mr1</a></span>.(<span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#mr_output">mr_output</a></span>)) 1 <span class="kwd">then</span>  <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">l_optimized</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#fold_right">List.fold_right</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">fun</span> <span class="id">mr2</span> <span class="id">acc</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#merge">merge</a></span> <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#mr1">mr1</a></span> <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#mr2">mr2</a></span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span> =&gt; <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#mr2">mr2</a></span> :: <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#acc">acc</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">mr12</span> =&gt; <span class="id">mr12</span> :: <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#acc">acc</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span> <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#acc">acc</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#mr1">mr1</a></span> :: <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#l_optimized">l_optimized</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">else</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#mr1">mr1</a></span> :: <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#acc">acc</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span> <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#l">l</a></span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="apply_merge">apply_merge</a></span> (<span class="id">merge</span>: <span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#mr">mr</a></span> -&gt; <span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#mr">mr</a></span> -&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#option">option</a></span> <span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#mr">mr</a></span>) <span class="id">mrl</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#mkMRChain">mkMRChain</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#mrl">mrl</a></span>.(<span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#mr_inputs_loc">mr_inputs_loc</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#mr_chain_apply_merge">mr_chain_apply_merge</a></span> <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#merge">merge</a></span> <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#mrl">mrl</a></span>.(<span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#mr_chain">mr_chain</a></span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#mrl">mrl</a></span>.(<span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#mr_last">mr_last</a></span>).<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Fixpoint</span> <span class="id"><a name="mr_chain_cleanup">mr_chain_cleanup</a></span> <span class="id">l</span> (<span class="id">to_keep</span>: <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="Qcert.Common.Env.RVar.html#var">var</a></span>) :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> (<span class="id">to_keep</span>', <span class="id">res</span>) :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#fold_right">List.fold_right</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">fun</span> <span class="id">r</span> (<span class="id">acc</span>: <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="Qcert.Common.Env.RVar.html#var">var</a></span> * <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#mr">mr</a></span>) =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> (<span class="id">to_keep</span>, <span class="id">res</span>) := <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#acc">acc</a></span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">if</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#in_dec">in_dec</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Classes.EquivDec.html#equiv_dec">equiv_dec</a></span> <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#r">r</a></span>.(<span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#mr_output">mr_output</a></span>) <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#to_keep">to_keep</a></span> <span class="kwd">then</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#r">r</a></span>.(<span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#mr_input">mr_input</a></span>)::<span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#to_keep">to_keep</a></span>, <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#r">r</a></span>::<span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#res">res</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">else</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#to_keep">to_keep</a></span>, <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#res">res</a></span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#to_keep">to_keep</a></span>, <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span>) <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#l">l</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#res">res</a></span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="mr_cleanup">mr_cleanup</a></span> <span class="id">mrl</span> <span class="id">to_keep</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#mkMRChain">mkMRChain</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#mrl">mrl</a></span>.(<span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#mr_inputs_loc">mr_inputs_loc</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#mr_chain_cleanup">mr_chain_cleanup</a></span> <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#mrl">mrl</a></span>.(<span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#mr_chain">mr_chain</a></span>) <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#to_keep">to_keep</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#mrl">mrl</a></span>.(<span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#mr_last">mr_last</a></span>).<br/>
<br/>
&nbsp;<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="mr_optimize_step">mr_optimize_step</a></span> (<span class="id">l</span>: <span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#nnrcmr">nnrcmr</a></span>): <span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#nnrcmr">nnrcmr</a></span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">to_keep</span> := <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map">List.map</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#snd">snd</a></span> <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#l">l</a></span>.(<span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#mr_last">mr_last</a></span>)) <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">l</span> := <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#apply_rewrite">apply_rewrite</a></span> <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#map_collect_flatten_to_map_flatten_collect">map_collect_flatten_to_map_flatten_collect</a></span> <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#l">l</a></span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">l</span> := <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#apply_merge">apply_merge</a></span> <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#merge_id_reduce_id_dist_map">merge_id_reduce_id_dist_map</a></span> <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#l">l</a></span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">l</span> := <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#mr_cleanup">mr_cleanup</a></span> <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#l">l</a></span> <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#to_keep">to_keep</a></span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">l</span> := <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#apply_merge">apply_merge</a></span> <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#merge_singleton_reduce_id_scalar_map">merge_singleton_reduce_id_scalar_map</a></span> <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#l">l</a></span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">l</span> := <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#mr_cleanup">mr_cleanup</a></span> <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#l">l</a></span> <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#to_keep">to_keep</a></span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">l</span> := <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#apply_merge">apply_merge</a></span> <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#merge_reduce_id_flatten_map">merge_reduce_id_flatten_map</a></span> <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#l">l</a></span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">l</span> := <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#mr_cleanup">mr_cleanup</a></span> <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#l">l</a></span> <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#to_keep">to_keep</a></span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">l</span> := <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#apply_merge">apply_merge</a></span> <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#merge_collect_dispatch">merge_collect_dispatch</a></span> <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#l">l</a></span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">l</span> := <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#mr_cleanup">mr_cleanup</a></span> <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#l">l</a></span> <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#to_keep">to_keep</a></span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">l</span> := <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#apply_merge">apply_merge</a></span> <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#merge_mr_id_dist_l">merge_mr_id_dist_l</a></span> <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#l">l</a></span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">l</span> := <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#mr_cleanup">mr_cleanup</a></span> <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#l">l</a></span> <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#to_keep">to_keep</a></span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">l</span> := <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#apply_merge">apply_merge</a></span> <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#merge_mr_id_scalar_l">merge_mr_id_scalar_l</a></span> <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#l">l</a></span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">l</span> := <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#mr_cleanup">mr_cleanup</a></span> <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#l">l</a></span> <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#to_keep">to_keep</a></span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">l</span> := <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#apply_merge">apply_merge</a></span> <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#merge_scalar_singleton_scalar">merge_scalar_singleton_scalar</a></span> <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#l">l</a></span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">l</span> := <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#mr_cleanup">mr_cleanup</a></span> <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#l">l</a></span> <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#to_keep">to_keep</a></span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">l</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#merge_last">merge_last</a></span> <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#l">l</a></span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span> =&gt; <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#l">l</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">l</span> =&gt; <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#l">l</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#l">l</a></span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Fixpoint</span> <span class="id"><a name="mr_optimize_loop">mr_optimize_loop</a></span> <span class="id">n</span> (<span class="id">l</span>: <span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#nnrcmr">nnrcmr</a></span>) :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#n">n</a></span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| 0 =&gt; <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#l">l</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#S">S</a></span> <span class="id">n</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">l</span> := <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#mr_optimize_step">mr_optimize_step</a></span> <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#l">l</a></span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#mr_optimize_loop">mr_optimize_loop</a></span> <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#n">n</a></span> <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#l">l</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="mr_optimize">mr_optimize</a></span> (<span class="id">l</span>: <span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#nnrcmr">nnrcmr</a></span>) :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#mr_optimize_loop">mr_optimize_loop</a></span> 10 <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#l">l</a></span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="fresh_mr_var">fresh_mr_var</a></span> (<span class="id">prefix</span>: <span class="id"><a href="http://coq.inria.fr/library/Coq.Strings.String.html#string">string</a></span>) (<span class="id">vars</span>: <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="Qcert.Common.Env.RVar.html#var">var</a></span>) :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">x</span> := <span class="id"><a href="Qcert.Utils.Fresh.html#fresh_var">fresh_var</a></span> <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#prefix">prefix</a></span> <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#vars">vars</a></span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#x">x</a></span>, <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#x">x</a></span>::<span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#vars">vars</a></span>).<br/>
<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="get_mr_chain_vars">get_mr_chain_vars</a></span> <span class="id">mr_chain</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#fold_left">List.fold_left</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">fun</span> <span class="id">acc</span> <span class="id">mr</span> =&gt; <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#mr">mr</a></span>.(<span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#mr_input">mr_input</a></span>) :: <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#mr">mr</a></span>.(<span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#mr_output">mr_output</a></span>) :: <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#acc">acc</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#mr_chain">mr_chain</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="get_nnrcmr_vars">get_nnrcmr_vars</a></span> <span class="id">mrl</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#get_mr_chain_vars">get_mr_chain_vars</a></span> <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#mrl">mrl</a></span>.(<span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#mr_chain">mr_chain</a></span>).<br/>
<br/>
<span class="kwd">End</span> <span class="id"><a href="Qcert.NNRCMR.Optim.NNRCMRRewrite.html#NNRCMRRewrite">NNRCMRRewrite</a></span>.<br/>
<br/>
<br/>

</div>
<div class="footer"><hr/>Generated by <a href="https://github.com/xavierleroy/coq2html/">coq2html</div>
</body>
</html>
