
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Module Qcert.CldMR.Lang.CldMR</title>
<meta name="description" content="Documentation of Coq module Qcert.CldMR.Lang.CldMR" />
<link href="coq2html.css" rel="stylesheet" type="text/css" />
<script type="text/javascript" src="coq2html.js"> </script>
</head>

<body onload="hideAll('proofscript')">
<h1 class="title">Module Qcert.CldMR.Lang.CldMR</h1>
<div class="coq">
<br/>
<div class="doc">CldMR is a language to describe chains of Map/Reduce views in the
Cloudant Database, followed by some local computation over the result
of the views. </div>
<br/>
<div class="doc">Cloudant's notion of 'views' provides some of the capabilities
    that are available in more common Map/Reduce framework such as Hadoop,
    but has a number of different properties. </div>
<br/>
<div class="doc">Cloudant notion of views is less expressive than general purpose
    Map/Reduce but offers the following additional capabilities:
<ul>
<li>
 Cloudant views can be chained through a special directive called
  dbcopy which creates a new database that can be the input to a
  subsequent Cloudant view.
</li>
<li>
 Cloudant views are computed in an incremental fashion, i.e., changes
  on the input are propagated with limited recomputation and
  exploiting results from previous executions which are cached. </li>
</ul>
</div>
<br/>
<div class="doc">To achieve that, Cloudant views relies on a number of invariants,
    which we expose and try to enforce. The most important invariants
    are:
<ul>
<li>
 A <span class="bracket"><span class="id">dbcopy</span></span> can only be present if a reduce is present as well.
</li>
<li>
 the result of a <span class="bracket"><span class="id">dbcopy</span></span> directive is implicitely coerced into a a
  database in the form of key/value pairs, which are used to populate
  the newly created database/view.
</li>
<li>
 A subsequent map over that dbcopy must access data accordingly (in
  such key/values JSON structure).
</li>
<li>
 The "reduce" part of Cloudant views is heavily constrained and must
  provide two distinct functions: one called <span class="bracket"><span class="id">reduce</span></span>, the other
  called <span class="bracket"><span class="id">rereduce</span></span>. The <span class="bracket"><span class="id">rereduce</span></span> function must be associative and
  commutative.  </li>
</ul>
</div>
<br/>
<div class="doc">Finally, Cloudant views support special purposes reducers for the
most common aggregate functions (count, sum, and average). We provide
a representation to take advantage of those. </div>
<br/>
<div class="doc">Summary:
<ul>
<li>
 Language: CldMR (Cloudant Map/Reduce)
</li>
<li>
 Based on: Cloudant DB documentation.
</li>
<li>
 URL: https://console.ng.bluemix.net/docs/services/Cloudant/api/creating_views.html#views-mapreduce-
</li>
<li>
 Languages translating to CldMR: NNRCMR
</li>
<li>
 Languages translating from CldMR: Cloudant
</li>
</ul>
</div>
<br/>
<span class="kwd">Section</span> <span class="id"><a name="CldMR">CldMR</a></span>.<br/>
&nbsp;&nbsp;<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Strings.String.html">String</a></span>.<br/>
&nbsp;&nbsp;<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html">List</a></span>.<br/>
&nbsp;&nbsp;<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Sorting.Mergesort.html">Sorting.Mergesort</a></span>.<br/>
&nbsp;&nbsp;<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Classes.EquivDec.html">EquivDec</a></span>.<br/>
&nbsp;&nbsp;<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="Qcert.Utils.Utils.html">Utils</a></span>.<br/>
&nbsp;&nbsp;<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="Qcert.Common.CommonRuntime.html">CommonRuntime</a></span>.<br/>
&nbsp;&nbsp;<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="Qcert.cNNRC.cNNRCRuntime.html">cNNRCRuntime</a></span>.<br/>
&nbsp;&nbsp;<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="Qcert.NNRCMR.NNRCMRRuntime.html">NNRCMRRuntime</a></span>.<br/>
&nbsp;&nbsp;<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="Qcert.CldMR.Lang.CldMRUtil.html">CldMRUtil</a></span>.<br/>
&nbsp;&nbsp;<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="Qcert.CldMR.Lang.ForeignCloudant.html">ForeignCloudant</a></span>.<br/>
&nbsp;&nbsp;<br/>
&nbsp;&nbsp;<span class="kwd">Local</span> <span class="kwd">Open</span> <span class="kwd">Scope</span> <span class="id">list_scope</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Context</span> {<span class="id">fruntime</span>:<span class="id"><a href="Qcert.Common.ForeignRuntime.html#foreign_runtime">foreign_runtime</a></span>}.<br/>
&nbsp;&nbsp;<span class="kwd">Context</span> {<span class="id">fredop</span>:<span class="id"><a href="Qcert.NNRCMR.Lang.ForeignReduceOps.html#foreign_reduce_op">foreign_reduce_op</a></span>}.<br/>
&nbsp;&nbsp;<span class="kwd">Context</span> {<span class="id">fcloudant</span>:<span class="id"><a href="Qcert.CldMR.Lang.ForeignCloudant.html#foreign_cloudant">foreign_cloudant</a></span>}.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Context</span> (<span class="id">h</span>:<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span>(<span class="id"><a href="http://coq.inria.fr/library/Coq.Strings.String.html#string">string</a></span>*<span class="id"><a href="http://coq.inria.fr/library/Coq.Strings.String.html#string">string</a></span>)).<br/>
<br/>
<h1> Abstract Syntax </h1>
<br/>
<div class="doc">As in NNRCMR, all local computation inside the map or the reduce
  in CldMR is described using NNRC expressions. </div>
&nbsp;&nbsp;<br/>
<h2> Map </h2>
&nbsp;&nbsp;<br/>
<div class="doc">The <span class="bracket"><span class="id">map</span></span> part of a Cloudant view is described using two
  components:
<ul>
<li>
 a map function which can be either a map or a flat_map, which is
  applied to every document in the input database.
</li>
<li>
 an emit function which controls the generation of keys passed to the
  reduce. The emit function is either: (i) <span class="bracket"><span class="id">dist</span></span> which creates unique
  id's for the result of the map and results in a distributed
  collection, (ii) <span class="bracket"><span class="id">collect</span></span> which is enforcing accumulation to a
  single output document with a single key. </li>
</ul>
</div>
<br/>
<div class="doc">Note that as opposed to NNRCMR, the collect is specified in the
  map rather than the reduce, since it has to be controlled through an
  emit. </div>
&nbsp;&nbsp;<br/>
<div class="doc">Also note that this model does not cover a group-by semantics
  but only simpler forms of reduce. </div>
&nbsp;&nbsp;<br/>
&nbsp;&nbsp;<span class="kwd">Inductive</span> <span class="id"><a name="cld_map_fun">cld_map_fun</a></span> :=<br/>
&nbsp;&nbsp;| <span class="id"><a name="CldMapId">CldMapId</a></span> : <span class="id"><a href="Qcert.Common.Env.RVar.html#var">var</a></span> * <span class="id"><a href="Qcert.cNNRC.Lang.cNNRC.html#nnrc">nnrc</a></span> -&gt; <span class="id"><a href="Qcert.CldMR.Lang.CldMR.html#cld_map_fun">cld_map_fun</a></span>           <span class="docright">(* <span class="bracket"><span class="id">A</span> -&gt; <span class="id">B</span></span>  *)</span><br/>
&nbsp;&nbsp;| <span class="id"><a name="CldMapFlatten">CldMapFlatten</a></span> : <span class="id"><a href="Qcert.Common.Env.RVar.html#var">var</a></span> * <span class="id"><a href="Qcert.cNNRC.Lang.cNNRC.html#nnrc">nnrc</a></span> -&gt; <span class="id"><a href="Qcert.CldMR.Lang.CldMR.html#cld_map_fun">cld_map_fun</a></span>.     <span class="docright">(* <span class="bracket"><span class="id">A</span> -&gt; <span class="id">coll</span> <span class="id">B</span></span>  *)</span><br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Inductive</span> <span class="id"><a name="cld_map_emit">cld_map_emit</a></span> :=<br/>
&nbsp;&nbsp;| <span class="id"><a name="CldEmitDist">CldEmitDist</a></span> : <span class="id"><a href="Qcert.CldMR.Lang.CldMR.html#cld_map_emit">cld_map_emit</a></span>                     <span class="docright">(* Emit one key per input document  *)</span><br/>
&nbsp;&nbsp;| <span class="id"><a name="CldEmitCollect">CldEmitCollect</a></span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nat">nat</a></span> -&gt; <span class="id"><a href="Qcert.CldMR.Lang.CldMR.html#cld_map_emit">cld_map_emit</a></span>.          <span class="docright">(* Emit a single key for all documents  *)</span><br/>
&nbsp;&nbsp;<br/>
&nbsp;&nbsp;<span class="kwd">Record</span> <span class="id"><a name="cld_map">cld_map</a></span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a name="mkMapCld">mkMapCld</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id"><a name="map_fun">map_fun</a></span>: <span class="id"><a href="Qcert.CldMR.Lang.CldMR.html#cld_map_fun">cld_map_fun</a></span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a name="map_emit">map_emit</a></span>: <span class="id"><a href="Qcert.CldMR.Lang.CldMR.html#cld_map_emit">cld_map_emit</a></span> }.<br/>
<br/>
<h2> Reduce </h2>
&nbsp;&nbsp;<br/>
&nbsp;&nbsp;<span class="kwd">Inductive</span> <span class="id"><a name="cld_numeric_type">cld_numeric_type</a></span> :=<br/>
&nbsp;&nbsp;| <span class="id"><a name="Cld_int">Cld_int</a></span><br/>
&nbsp;&nbsp;| <span class="id"><a name="Cld_float">Cld_float</a></span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Global</span> <span class="kwd">Instance</span> <span class="id"><a name="cld_numeric_type_eqdec">cld_numeric_type_eqdec</a></span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Classes.EquivDec.html#EqDec">EqDec</a></span> <span class="id"><a href="Qcert.CldMR.Lang.CldMR.html#cld_numeric_type">cld_numeric_type</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Logic.html#eq">eq</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2713')">Proof.</div>
<div class="proofscript" id="proof2713">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">red</span>. <span class="tactic">unfold</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Classes.Equivalence.html#equiv">equiv</a></span>, <span class="id"><a href="http://coq.inria.fr/library/Coq.Classes.RelationClasses.html#complement">complement</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">change</span> (<span class="kwd">forall</span> <span class="id">x</span> <span class="id">y</span> : <span class="id"><a href="Qcert.CldMR.Lang.CldMR.html#cld_numeric_type">cld_numeric_type</a></span>, {<span class="id"><a href="Qcert.CldMR.Lang.CldMR.html#x">x</a></span> = <span class="id"><a href="Qcert.CldMR.Lang.CldMR.html#y">y</a></span>} + {<span class="id"><a href="Qcert.CldMR.Lang.CldMR.html#x">x</a></span> &lt;&gt; <span class="id"><a href="Qcert.CldMR.Lang.CldMR.html#y">y</a></span>}).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">decide</span> <span class="id">equality</span>.<br/>
&nbsp;&nbsp;Defined.</div>
&nbsp;&nbsp;<br/>
&nbsp;&nbsp;<span class="kwd">Inductive</span> <span class="id"><a name="cld_reduce_op">cld_reduce_op</a></span> :=<br/>
&nbsp;&nbsp;| <span class="id"><a name="CldRedOpCount">CldRedOpCount</a></span> : <span class="id"><a href="Qcert.CldMR.Lang.CldMR.html#cld_reduce_op">cld_reduce_op</a></span>                          <span class="docright">(* Special reducer: <span class="bracket"><span class="id">_count</span></span>  *)</span><br/>
&nbsp;&nbsp;| <span class="id"><a name="CldRedOpSum">CldRedOpSum</a></span> (<span class="id">typ</span>:<span class="id"><a href="Qcert.CldMR.Lang.CldMR.html#cld_numeric_type">cld_numeric_type</a></span>): <span class="id"><a href="Qcert.CldMR.Lang.CldMR.html#cld_reduce_op">cld_reduce_op</a></span>      <span class="docright">(* Special reducer: <span class="bracket"><span class="id">_sum</span></span>  *)</span><br/>
&nbsp;&nbsp;| <span class="id"><a name="CldRedOpStats">CldRedOpStats</a></span> (<span class="id">typ</span>:<span class="id"><a href="Qcert.CldMR.Lang.CldMR.html#cld_numeric_type">cld_numeric_type</a></span>): <span class="id"><a href="Qcert.CldMR.Lang.CldMR.html#cld_reduce_op">cld_reduce_op</a></span>.   <span class="docright">(* Special reducer: <span class="bracket"><span class="id">_stat</span></span>  *)</span><br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Inductive</span> <span class="id"><a name="cld_reduce_fun">cld_reduce_fun</a></span> :=<br/>
&nbsp;&nbsp;| <span class="id"><a name="CldRedId">CldRedId</a></span> : <span class="id"><a href="Qcert.CldMR.Lang.CldMR.html#cld_reduce_fun">cld_reduce_fun</a></span>                                 <span class="docright">(* Reduce is identity  *)</span><br/>
&nbsp;&nbsp;| <span class="id"><a name="CldRedAggregate">CldRedAggregate</a></span> :                                         <span class="docright">(* Arbitrary reduce + rereduce  *)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;((<span class="id"><a href="Qcert.Common.Env.RVar.html#var">var</a></span> * <span class="id"><a href="Qcert.Common.Env.RVar.html#var">var</a></span>) * <span class="id"><a href="Qcert.cNNRC.Lang.cNNRC.html#nnrc">nnrc</a></span>) -&gt; (<span class="id"><a href="Qcert.Common.Env.RVar.html#var">var</a></span> * <span class="id"><a href="Qcert.cNNRC.Lang.cNNRC.html#nnrc">nnrc</a></span>) -&gt; <span class="id"><a href="Qcert.CldMR.Lang.CldMR.html#cld_reduce_fun">cld_reduce_fun</a></span><br/>
&nbsp;&nbsp;| <span class="id"><a name="CldRedOp">CldRedOp</a></span> : <span class="id"><a href="Qcert.CldMR.Lang.CldMR.html#cld_reduce_op">cld_reduce_op</a></span> -&gt; <span class="id"><a href="Qcert.CldMR.Lang.CldMR.html#cld_reduce_fun">cld_reduce_fun</a></span>.               <span class="docright">(* Special reducer  *)</span><br/>
<br/>
<div class="doc">In the case of the arbirary reduce operation: the first function
      is the <span class="bracket"><span class="id">reduce</span></span> and applied once on each key/value pair
      resulting from the map <span class="bracket">(<span class="id">K</span> * <span class="id">list</span> <span class="id">B</span>) -&gt; <span class="id">C</span></span>; the second function
      is the <span class="bracket"><span class="id">rereduce</span></span> and applied on the result of the first
      function <span class="bracket">(<span class="id">list</span> <span class="id">C</span>) -&gt; <span class="id">C</span></span>. </div>
<br/>
&nbsp;&nbsp;<span class="kwd">Record</span> <span class="id"><a name="cld_reduce">cld_reduce</a></span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a name="mkReduceCld">mkReduceCld</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id"><a name="reduce_fun">reduce_fun</a></span>: <span class="id"><a href="Qcert.CldMR.Lang.CldMR.html#cld_reduce_fun">cld_reduce_fun</a></span>;   <span class="docright">(* reduce function  *)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a name="reduce_output">reduce_output</a></span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#option">option</a></span> <span class="id"><a href="Qcert.Common.Env.RVar.html#var">var</a></span> }. <span class="docright">(* Output database <span class="bracket"><span class="id">dbcopy</span></span>  *)</span><br/>
<br/>
<h2> Map/Reduce View </h2>
&nbsp;&nbsp;<br/>
&nbsp;&nbsp;<span class="kwd">Record</span> <span class="id"><a name="cldmr_step">cldmr_step</a></span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a name="mkMRCld">mkMRCld</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id"><a name="cldmr_step_input">cldmr_step_input</a></span>: <span class="id"><a href="Qcert.Common.Env.RVar.html#var">var</a></span>;                    <span class="docright">(* Input database  *)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a name="cldmr_step_map">cldmr_step_map</a></span>: <span class="id"><a href="Qcert.CldMR.Lang.CldMR.html#cld_map">cld_map</a></span>;                  <span class="docright">(* Map  *)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a name="cldmr_step_reduce">cldmr_step_reduce</a></span>: <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#option">option</a></span> <span class="id"><a href="Qcert.CldMR.Lang.CldMR.html#cld_reduce">cld_reduce</a></span>;     <span class="docright">(* Reduce  *)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a name="cldmr_step_reduce_default">cldmr_step_reduce_default</a></span>: <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#option">option</a></span> <span class="id"><a href="Qcert.cNNRC.Lang.cNNRC.html#nnrc">nnrc</a></span> }. <span class="docright">(* Default when database is empty  *)</span><br/>
<br/>
<h2> Map/Reduce Chains </h2>
<br/>
<div class="doc">The top-level data structure includes a list of Map/Reduce
  views, followed by an additional expressions which is used to gather
  all the results from the views and compute the final results. This
  is meant to be evaluated locally. </div>
&nbsp;&nbsp;<br/>
&nbsp;&nbsp;<span class="kwd">Record</span> <span class="id"><a name="cldmr">cldmr</a></span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a name="mkMRCldChain">mkMRCldChain</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id"><a name="cldmr_chain">cldmr_chain</a></span>: <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="Qcert.CldMR.Lang.CldMR.html#cldmr_step">cldmr_step</a></span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a name="cldmr_last">cldmr_last</a></span>: ((<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="Qcert.Common.Env.RVar.html#var">var</a></span>) * <span class="id"><a href="Qcert.cNNRC.Lang.cNNRC.html#nnrc">nnrc</a></span>) * (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="Qcert.Common.Env.RVar.html#var">var</a></span>) }.<br/>
<br/>
<br/>
<br/>
<h1> Well-formed properties </h1>
&nbsp;&nbsp;<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="cldmr_step_causally_consistent">cldmr_step_causally_consistent</a></span> (<span class="id">mr1</span> <span class="id">mr2</span>:<span class="id"><a href="Qcert.CldMR.Lang.CldMR.html#cldmr_step">cldmr_step</a></span>) : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#bool">bool</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;:= <span class="kwd">match</span> <span class="id"><a href="Qcert.CldMR.Lang.CldMR.html#mr2">mr2</a></span>.(<span class="id"><a href="Qcert.CldMR.Lang.CldMR.html#cldmr_step_reduce">cldmr_step_reduce</a></span>) <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">r</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">r</span>.(<span class="id"><a href="Qcert.CldMR.Lang.CldMR.html#reduce_output">reduce_output</a></span>) <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">o</span> =&gt; <span class="id"><a href="Qcert.CldMR.Lang.CldMR.html#mr1">mr1</a></span>.(<span class="id"><a href="Qcert.CldMR.Lang.CldMR.html#cldmr_step_input">cldmr_step_input</a></span>) &lt;&gt;<span class="id">b</span> <span class="id">o</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span> =&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#true">true</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span> =&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#true">true</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="cldmr_chain_causally_consistent">cldmr_chain_causally_consistent</a></span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="Qcert.CldMR.Lang.CldMR.html#cldmr_step">cldmr_step</a></span> -&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#bool">bool</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;:= <span class="id"><a href="Qcert.Utils.ListAdd.html#forallb_ordpairs_refl">forallb_ordpairs_refl</a></span> <span class="id"><a href="Qcert.CldMR.Lang.CldMR.html#cldmr_step_causally_consistent">cldmr_step_causally_consistent</a></span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="cldmr_causally_consistent">cldmr_causally_consistent</a></span> (<span class="id">cldmr</span>: <span class="id"><a href="Qcert.CldMR.Lang.CldMR.html#cldmr">cldmr</a></span>) : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#bool">bool</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;:= <span class="id"><a href="Qcert.CldMR.Lang.CldMR.html#cldmr_chain_causally_consistent">cldmr_chain_causally_consistent</a></span> <span class="id"><a href="Qcert.CldMR.Lang.CldMR.html#cldmr">cldmr</a></span>.(<span class="id"><a href="Qcert.CldMR.Lang.CldMR.html#cldmr_chain">cldmr_chain</a></span>).<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="cldmr_step_io_vars">cldmr_step_io_vars</a></span> <span class="id">mr0</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="Qcert.Common.Env.RVar.html#var">var</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;:= <span class="id"><a href="Qcert.CldMR.Lang.CldMR.html#mr0">mr0</a></span>.(<span class="id"><a href="Qcert.CldMR.Lang.CldMR.html#cldmr_step_input">cldmr_step_input</a></span>)::<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id"><a href="Qcert.CldMR.Lang.CldMR.html#mr0">mr0</a></span>.(<span class="id"><a href="Qcert.CldMR.Lang.CldMR.html#cldmr_step_reduce">cldmr_step_reduce</a></span>) <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">r</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">r</span>.(<span class="id"><a href="Qcert.CldMR.Lang.CldMR.html#reduce_output">reduce_output</a></span>) <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">o</span> =&gt; <span class="id">o</span>::<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span> =&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span> =&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="mr_chain_io_vars">mr_chain_io_vars</a></span> (<span class="id">l</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#mr">mr</a></span>) : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="Qcert.Common.Env.RVar.html#var">var</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;:= <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> <span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#mr_input">mr_input</a></span> <span class="id"><a href="Qcert.CldMR.Lang.CldMR.html#l">l</a></span> ++ <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> <span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#mr_output">mr_output</a></span> <span class="id"><a href="Qcert.CldMR.Lang.CldMR.html#l">l</a></span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="nnrcmr_io_vars">nnrcmr_io_vars</a></span> (<span class="id">mrl</span> : <span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#nnrcmr">nnrcmr</a></span>) : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="Qcert.Common.Env.RVar.html#var">var</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;:= <span class="id"><a href="Qcert.CldMR.Lang.CldMR.html#mr_chain_io_vars">mr_chain_io_vars</a></span> <span class="id"><a href="Qcert.CldMR.Lang.CldMR.html#mrl">mrl</a></span>.(<span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#mr_chain">mr_chain</a></span>).<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="cldmr_chain_io_vars">cldmr_chain_io_vars</a></span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="Qcert.CldMR.Lang.CldMR.html#cldmr_step">cldmr_step</a></span> -&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="Qcert.Common.Env.RVar.html#var">var</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;:= <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#flat_map">flat_map</a></span> <span class="id"><a href="Qcert.CldMR.Lang.CldMR.html#cldmr_step_io_vars">cldmr_step_io_vars</a></span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="cldmr_io_vars">cldmr_io_vars</a></span> (<span class="id">cldmr</span>:<span class="id"><a href="Qcert.CldMR.Lang.CldMR.html#cldmr">cldmr</a></span>): <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="Qcert.Common.Env.RVar.html#var">var</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;:= <span class="id"><a href="Qcert.CldMR.Lang.CldMR.html#cldmr_chain_io_vars">cldmr_chain_io_vars</a></span> <span class="id"><a href="Qcert.CldMR.Lang.CldMR.html#cldmr">cldmr</a></span>.(<span class="id"><a href="Qcert.CldMR.Lang.CldMR.html#cldmr_chain">cldmr_chain</a></span>).<br/>
<br/>
&nbsp;&nbsp;<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="function_with_no_free_vars">function_with_no_free_vars</a></span> (<span class="id">f</span>: <span class="id"><a href="Qcert.Common.Env.RVar.html#var">var</a></span> * <span class="id"><a href="Qcert.cNNRC.Lang.cNNRC.html#nnrc">nnrc</a></span>) :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">forall</span> (<span class="id">x</span>: <span class="id"><a href="Qcert.Common.Env.RVar.html#var">var</a></span>), <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id"><a href="Qcert.CldMR.Lang.CldMR.html#x">x</a></span> (<span class="id"><a href="Qcert.cNNRC.Lang.cNNRCShadow.html#nnrc_free_vars">nnrc_free_vars</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#snd">snd</a></span> <span class="id"><a href="Qcert.CldMR.Lang.CldMR.html#f">f</a></span>)) -&gt; <span class="id"><a href="Qcert.CldMR.Lang.CldMR.html#x">x</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> <span class="id"><a href="Qcert.CldMR.Lang.CldMR.html#f">f</a></span>).<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="function2_with_no_free_vars">function2_with_no_free_vars</a></span> (<span class="id">f</span>: (<span class="id"><a href="Qcert.Common.Env.RVar.html#var">var</a></span> * <span class="id"><a href="Qcert.Common.Env.RVar.html#var">var</a></span>) * <span class="id"><a href="Qcert.cNNRC.Lang.cNNRC.html#nnrc">nnrc</a></span>) :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> <span class="id"><a href="Qcert.CldMR.Lang.CldMR.html#f">f</a></span>)) &lt;&gt; (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#snd">snd</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> <span class="id"><a href="Qcert.CldMR.Lang.CldMR.html#f">f</a></span>)) /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">x</span>, <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id"><a href="Qcert.CldMR.Lang.CldMR.html#x">x</a></span> (<span class="id"><a href="Qcert.cNNRC.Lang.cNNRCShadow.html#nnrc_free_vars">nnrc_free_vars</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#snd">snd</a></span> <span class="id"><a href="Qcert.CldMR.Lang.CldMR.html#f">f</a></span>)) -&gt; <span class="id"><a href="Qcert.CldMR.Lang.CldMR.html#x">x</a></span> = (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> <span class="id"><a href="Qcert.CldMR.Lang.CldMR.html#f">f</a></span>)) \/ <span class="id"><a href="Qcert.CldMR.Lang.CldMR.html#x">x</a></span> = (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#snd">snd</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> <span class="id"><a href="Qcert.CldMR.Lang.CldMR.html#f">f</a></span>))).<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="init_vkey">init_vkey</a></span> := "<span class="id">vkey</span>$"%<span class="id">string</span>.<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="init_vval">init_vval</a></span> := "<span class="id">vval</span>$"%<span class="id">string</span>.<br/>
<br/>
<h1> Evaluation Semantics </h1>
<br/>
<br/>
<div class="doc">A few useful functions for key manipulation, lifting and
  building the initial CldMR environment. </div>
&nbsp;&nbsp;<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="add_keys_to_binding">add_keys_to_binding</a></span> (<span class="id">binding</span>: <span class="id"><a href="http://coq.inria.fr/library/Coq.Strings.String.html#string">string</a></span> * (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="Qcert.Common.Data.RData.html#data">data</a></span>)) : <span class="id"><a href="http://coq.inria.fr/library/Coq.Strings.String.html#string">string</a></span> * <span class="id"><a href="Qcert.Common.Data.RData.html#data">data</a></span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> <span class="id"><a href="Qcert.CldMR.Lang.CldMR.html#binding">binding</a></span>, <span class="id"><a href="Qcert.CldMR.Lang.CldMRUtil.html#pack_kvl">pack_kvl</a></span> (<span class="id"><a href="Qcert.CldMR.Lang.CldMRUtil.html#init_keys">init_keys</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#snd">snd</a></span> <span class="id"><a href="Qcert.CldMR.Lang.CldMR.html#binding">binding</a></span>))).<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="lift_binding_to_coll">lift_binding_to_coll</a></span> (<span class="id">binding</span>: <span class="id"><a href="http://coq.inria.fr/library/Coq.Strings.String.html#string">string</a></span> * <span class="id"><a href="Qcert.Common.Data.RData.html#data">data</a></span>) : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#option">option</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Strings.String.html#string">string</a></span> * (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="Qcert.Common.Data.RData.html#data">data</a></span>)) :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#snd">snd</a></span> <span class="id"><a href="Qcert.CldMR.Lang.CldMR.html#binding">binding</a></span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="Qcert.Common.Data.RData.html#dcoll">dcoll</a></span> <span class="id">coll</span> =&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> <span class="id"><a href="Qcert.CldMR.Lang.CldMR.html#binding">binding</a></span>, <span class="id">coll</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">_</span> =&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<div class="doc">The evaluation relies on the existence of an initial database
  containing a single document with the unit value. This is necessary
  in order to trigger computation when all other input databases are
  empty. </div>
&nbsp;&nbsp;<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="cld_load_init_env">cld_load_init_env</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">initunit</span>: <span class="id"><a href="Qcert.Common.Env.RVar.html#var">var</a></span>) (<span class="id">cenv</span>: <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Strings.String.html#string">string</a></span> * <span class="id"><a href="Qcert.Common.Data.RData.html#data">data</a></span>)) : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#option">option</a></span> <span class="id"><a href="Qcert.Common.Data.RData.html#bindings">bindings</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;:=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id"><a href="Qcert.Utils.Lift.html#lift_map">lift_map</a></span> <span class="id"><a href="Qcert.CldMR.Lang.CldMR.html#lift_binding_to_coll">lift_binding_to_coll</a></span> <span class="id"><a href="Qcert.CldMR.Lang.CldMR.html#cenv">cenv</a></span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">cenv</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">full_bindings</span> := (<span class="id"><a href="Qcert.CldMR.Lang.CldMR.html#initunit">initunit</a></span>, (<span class="id"><a href="Qcert.Common.Data.RData.html#dunit">dunit</a></span>::<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span>)) :: <span class="id"><a href="Qcert.CldMR.Lang.CldMR.html#cenv">cenv</a></span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> <span class="id"><a href="Qcert.CldMR.Lang.CldMR.html#add_keys_to_binding">add_keys_to_binding</a></span> <span class="id"><a href="Qcert.CldMR.Lang.CldMR.html#full_bindings">full_bindings</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span> =&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<h2> Map </h2>
&nbsp;&nbsp;<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="apply_map_fun_with_keys">apply_map_fun_with_keys</a></span> (<span class="id">doc</span>:<span class="id"><a href="Qcert.Common.Env.RVar.html#var">var</a></span>) (<span class="id">body</span>:<span class="id"><a href="Qcert.cNNRC.Lang.cNNRC.html#nnrc">nnrc</a></span>) :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> (<span class="id"><a href="Qcert.Common.Data.RData.html#data">data</a></span> * <span class="id"><a href="Qcert.Common.Data.RData.html#data">data</a></span>) -&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#option">option</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> (<span class="id"><a href="Qcert.Common.Data.RData.html#data">data</a></span> * <span class="id"><a href="Qcert.Common.Data.RData.html#data">data</a></span>)) :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">fun</span> <span class="id">coll</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">f_map</span> (<span class="id">d</span>:<span class="id"><a href="Qcert.Common.Data.RData.html#data">data</a></span>*<span class="id"><a href="Qcert.Common.Data.RData.html#data">data</a></span>) :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> '(<span class="id">k</span>, <span class="id">v</span>) := <span class="id"><a href="Qcert.CldMR.Lang.CldMR.html#d">d</a></span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id"><a href="Qcert.cNNRC.Lang.cNNRC.html#nnrc_core_eval">nnrc_core_eval</a></span> <span class="id"><a href="Qcert.CldMR.Lang.CldMR.html#CldMR.h">h</a></span> <span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#empty_cenv">empty_cenv</a></span> ((<span class="id"><a href="Qcert.CldMR.Lang.CldMR.html#doc">doc</a></span>,<span class="id">v</span>)::<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span>) <span class="id"><a href="Qcert.CldMR.Lang.CldMR.html#body">body</a></span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span> =&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">res</span> =&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> (<span class="id">k</span>, <span class="id">res</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">in</span> <span class="id"><a href="Qcert.Common.Data.RRelation.html#rmap">rmap</a></span> <span class="id"><a href="Qcert.CldMR.Lang.CldMR.html#f_map">f_map</a></span> <span class="id"><a href="Qcert.CldMR.Lang.CldMR.html#coll">coll</a></span>.<br/>
&nbsp;&nbsp;<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="apply_map_fun_without_keys">apply_map_fun_without_keys</a></span> (<span class="id">doc</span>:<span class="id"><a href="Qcert.Common.Env.RVar.html#var">var</a></span>) (<span class="id">body</span>:<span class="id"><a href="Qcert.cNNRC.Lang.cNNRC.html#nnrc">nnrc</a></span>) :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> (<span class="id"><a href="Qcert.Common.Data.RData.html#data">data</a></span> * <span class="id"><a href="Qcert.Common.Data.RData.html#data">data</a></span>) -&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#option">option</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="Qcert.Common.Data.RData.html#data">data</a></span>) :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">fun</span> <span class="id">coll</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">f_map</span> (<span class="id">d</span>:<span class="id"><a href="Qcert.Common.Data.RData.html#data">data</a></span>*<span class="id"><a href="Qcert.Common.Data.RData.html#data">data</a></span>) :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> (<span class="id">_</span>, <span class="id">v</span>) := <span class="id"><a href="Qcert.CldMR.Lang.CldMR.html#d">d</a></span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id"><a href="Qcert.cNNRC.Lang.cNNRC.html#nnrc_core_eval">nnrc_core_eval</a></span> <span class="id"><a href="Qcert.CldMR.Lang.CldMR.html#CldMR.h">h</a></span> <span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#empty_cenv">empty_cenv</a></span> ((<span class="id"><a href="Qcert.CldMR.Lang.CldMR.html#doc">doc</a></span>,<span class="id"><a href="Qcert.CldMR.Lang.CldMR.html#v">v</a></span>)::<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span>) <span class="id"><a href="Qcert.CldMR.Lang.CldMR.html#body">body</a></span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span> =&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">res</span> =&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">res</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">in</span> <span class="id"><a href="Qcert.Common.Data.RRelation.html#rmap">rmap</a></span> <span class="id"><a href="Qcert.CldMR.Lang.CldMR.html#f_map">f_map</a></span> <span class="id"><a href="Qcert.CldMR.Lang.CldMR.html#coll">coll</a></span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="cldmr_step_map_eval">cldmr_step_map_eval</a></span> (<span class="id">map</span>: <span class="id"><a href="Qcert.CldMR.Lang.CldMR.html#cld_map">cld_map</a></span>) (<span class="id">coll</span>: <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> (<span class="id"><a href="Qcert.Common.Data.RData.html#data">data</a></span> * <span class="id"><a href="Qcert.Common.Data.RData.html#data">data</a></span>)) : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#option">option</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> (<span class="id"><a href="Qcert.Common.Data.RData.html#data">data</a></span> * <span class="id"><a href="Qcert.Common.Data.RData.html#data">data</a></span>)) :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">map_f</span> := <span class="id"><a href="Qcert.CldMR.Lang.CldMR.html#map">map</a></span>.(<span class="id"><a href="Qcert.CldMR.Lang.CldMR.html#map_fun">map_fun</a></span>) <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">emit_f</span> := <span class="id"><a href="Qcert.CldMR.Lang.CldMR.html#map">map</a></span>.(<span class="id"><a href="Qcert.CldMR.Lang.CldMR.html#map_emit">map_emit</a></span>) <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id"><a href="Qcert.CldMR.Lang.CldMR.html#map_f">map_f</a></span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="Qcert.CldMR.Lang.CldMR.html#CldMapId">CldMapId</a></span> (<span class="id">doc</span>, <span class="id">body</span>) =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id"><a href="Qcert.CldMR.Lang.CldMR.html#emit_f">emit_f</a></span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="Qcert.CldMR.Lang.CldMR.html#CldEmitDist">CldEmitDist</a></span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">nested_map</span> := <span class="id"><a href="Qcert.CldMR.Lang.CldMR.html#apply_map_fun_with_keys">apply_map_fun_with_keys</a></span> <span class="id">doc</span> <span class="id">body</span> <span class="id"><a href="Qcert.CldMR.Lang.CldMR.html#coll">coll</a></span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Qcert.CldMR.Lang.CldMR.html#nested_map">nested_map</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="Qcert.CldMR.Lang.CldMR.html#CldEmitCollect">CldEmitCollect</a></span> <span class="id">n</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">nested_map</span> := <span class="id"><a href="Qcert.CldMR.Lang.CldMR.html#apply_map_fun_without_keys">apply_map_fun_without_keys</a></span> <span class="id">doc</span> <span class="id">body</span> <span class="id"><a href="Qcert.CldMR.Lang.CldMR.html#coll">coll</a></span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Qcert.Utils.Lift.html#olift">olift</a></span> (<span class="id"><a href="Qcert.CldMR.Lang.CldMRUtil.html#map_without_key">map_without_key</a></span> (<span class="id"><a href="Qcert.CldMR.Lang.CldMRUtil.html#map_const_key">map_const_key</a></span> <span class="id">n</span>)) <span class="id"><a href="Qcert.CldMR.Lang.CldMR.html#nested_map">nested_map</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="Qcert.CldMR.Lang.CldMR.html#CldMapFlatten">CldMapFlatten</a></span> (<span class="id">doc</span>, <span class="id">body</span>) =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id"><a href="Qcert.CldMR.Lang.CldMR.html#emit_f">emit_f</a></span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="Qcert.CldMR.Lang.CldMR.html#CldEmitDist">CldEmitDist</a></span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">nested_map</span> := <span class="id"><a href="Qcert.CldMR.Lang.CldMR.html#apply_map_fun_with_keys">apply_map_fun_with_keys</a></span> <span class="id">doc</span> <span class="id">body</span> <span class="id"><a href="Qcert.CldMR.Lang.CldMR.html#coll">coll</a></span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Qcert.Utils.Lift.html#olift">olift</a></span> (<span class="id"><a href="Qcert.CldMR.Lang.CldMRUtil.html#flat_map_with_key">flat_map_with_key</a></span> <span class="id"><a href="Qcert.CldMR.Lang.CldMRUtil.html#map_invent_key">map_invent_key</a></span>) <span class="id"><a href="Qcert.CldMR.Lang.CldMR.html#nested_map">nested_map</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="Qcert.CldMR.Lang.CldMR.html#CldEmitCollect">CldEmitCollect</a></span> <span class="id">n</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">nested_map</span> := <span class="id"><a href="Qcert.CldMR.Lang.CldMR.html#apply_map_fun_without_keys">apply_map_fun_without_keys</a></span> <span class="id">doc</span> <span class="id">body</span> <span class="id"><a href="Qcert.CldMR.Lang.CldMR.html#coll">coll</a></span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">flattened_map</span> := <span class="id"><a href="Qcert.Utils.Lift.html#olift">olift</a></span> <span class="id"><a href="Qcert.CldMR.Lang.CldMRUtil.html#flat_map_without_key">flat_map_without_key</a></span> <span class="id"><a href="Qcert.CldMR.Lang.CldMR.html#nested_map">nested_map</a></span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Qcert.Utils.Lift.html#olift">olift</a></span> (<span class="id"><a href="Qcert.CldMR.Lang.CldMRUtil.html#map_without_key">map_without_key</a></span> (<span class="id"><a href="Qcert.CldMR.Lang.CldMRUtil.html#map_const_key">map_const_key</a></span> <span class="id">n</span>)) <span class="id"><a href="Qcert.CldMR.Lang.CldMR.html#flattened_map">flattened_map</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="mapIdDist_is_map">mapIdDist_is_map</a></span> (<span class="id">map</span>:<span class="id"><a href="Qcert.Common.Env.RVar.html#var">var</a></span>*<span class="id"><a href="Qcert.cNNRC.Lang.cNNRC.html#nnrc">nnrc</a></span>) (<span class="id">coll</span>:<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="Qcert.Common.Data.RData.html#data">data</a></span>) :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Qcert.Utils.Lift.html#lift">lift</a></span> <span class="id"><a href="Qcert.CldMR.Lang.CldMRUtil.html#cld_get_values">cld_get_values</a></span> (<span class="id"><a href="Qcert.CldMR.Lang.CldMR.html#cldmr_step_map_eval">cldmr_step_map_eval</a></span> (<span class="id"><a href="Qcert.CldMR.Lang.CldMR.html#mkMapCld">mkMapCld</a></span> (<span class="id"><a href="Qcert.CldMR.Lang.CldMR.html#CldMapId">CldMapId</a></span> <span class="id"><a href="Qcert.CldMR.Lang.CldMR.html#map">map</a></span>) (<span class="id"><a href="Qcert.CldMR.Lang.CldMR.html#CldEmitDist">CldEmitDist</a></span>)) (<span class="id"><a href="Qcert.CldMR.Lang.CldMRUtil.html#init_keys">init_keys</a></span> <span class="id"><a href="Qcert.CldMR.Lang.CldMR.html#coll">coll</a></span>)) = (<span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#mr_map_eval">mr_map_eval</a></span> <span class="id"><a href="Qcert.CldMR.Lang.CldMR.html#CldMR.h">h</a></span> (<span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#MapDist">MapDist</a></span> <span class="id"><a href="Qcert.CldMR.Lang.CldMR.html#map">map</a></span>) (<span class="id"><a href="Qcert.Common.Data.DData.html#Ddistr">Ddistr</a></span> <span class="id"><a href="Qcert.CldMR.Lang.CldMR.html#coll">coll</a></span>)).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2714')">Proof.</div>
<div class="proofscript" id="proof2714">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="Qcert.CldMR.Lang.CldMR.html#cldmr_step_map_eval">cldmr_step_map_eval</a></span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="Qcert.CldMR.Lang.CldMRUtil.html#init_keys">init_keys</a></span>; <span class="tactic">generalize</span> 0.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">coll</span>; <span class="tactic">intros</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">destruct</span> <span class="id">map</span>; <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">destruct</span> <span class="id">map</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="Qcert.CldMR.Lang.CldMR.html#apply_map_fun_with_keys">apply_map_fun_with_keys</a></span> <span class="kwd">in</span> *; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="Qcert.cNNRC.Lang.cNNRC.html#nnrc_core_eval">nnrc_core_eval</a></span> <span class="id"><a href="Qcert.CldMR.Lang.CldMR.html#CldMR.h">h</a></span> <span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#empty_cenv">empty_cenv</a></span> ((<span class="id">v</span>, <span class="id">a</span>) :: <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span>) <span class="id">n0</span>); <span class="tactic">try</span> <span class="tactic">reflexivity</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- (<span class="id">IHcoll</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#S">S</a></span> <span class="id">n</span>)); <span class="tactic">simpl</span>; <span class="tactic">clear</span> <span class="id">IHcoll</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="Qcert.CldMR.Lang.CldMRUtil.html#init_keys_aux">init_keys_aux</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#S">S</a></span> <span class="id">n</span>) <span class="id">coll</span>); <span class="tactic">try</span> <span class="tactic">reflexivity</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">p</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="Qcert.cNNRC.Lang.cNNRC.html#nnrc_core_eval">nnrc_core_eval</a></span> <span class="id"><a href="Qcert.CldMR.Lang.CldMR.html#CldMR.h">h</a></span> <span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#empty_cenv">empty_cenv</a></span> ((<span class="id">v</span>, <span class="id">d1</span>) :: <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span>) <span class="id">n0</span>); <span class="tactic">try</span> <span class="tactic">reflexivity</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">generalize</span> ((<span class="id"><a href="Qcert.Utils.Lift.html#lift">lift</a></span> (<span class="kwd">fun</span> <span class="id">t</span>' : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> (<span class="id"><a href="Qcert.Common.Data.RData.html#data">data</a></span> * <span class="id"><a href="Qcert.Common.Data.RData.html#data">data</a></span>) =&gt; (<span class="id">d0</span>, <span class="id">d2</span>) :: <span class="id">t</span>')<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="Qcert.Common.Data.RRelation.html#rmap">rmap</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">fun</span> <span class="id">d3</span> : <span class="id"><a href="Qcert.Common.Data.RData.html#data">data</a></span> * <span class="id"><a href="Qcert.Common.Data.RData.html#data">data</a></span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> (<span class="id">k</span>, <span class="id">v0</span>) := <span class="id"><a href="Qcert.CldMR.Lang.CldMR.html#d3">d3</a></span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id"><a href="Qcert.cNNRC.Lang.cNNRC.html#nnrc_core_eval">nnrc_core_eval</a></span> <span class="id"><a href="Qcert.CldMR.Lang.CldMR.html#CldMR.h">h</a></span> <span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#empty_cenv">empty_cenv</a></span> ((<span class="id">v</span>, <span class="id"><a href="Qcert.CldMR.Lang.CldMR.html#v0">v0</a></span>) :: <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span>) <span class="id">n0</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">res</span> =&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> (<span class="id"><a href="Qcert.CldMR.Lang.CldMR.html#k">k</a></span>, <span class="id">res</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span> =&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>) <span class="id">l</span>))); <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="Qcert.CldMR.Lang.CldMRUtil.html#box_key">box_key</a></span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="Qcert.CldMR.Lang.CldMRUtil.html#cld_get_values">cld_get_values</a></span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">o</span>; <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="lift_map_boxed_cons">lift_map_boxed_cons</a></span> <span class="id">n</span> <span class="id">d</span> <span class="id">coll</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="Qcert.Utils.Lift.html#lift">lift</a></span> (<span class="kwd">fun</span> <span class="id">kvs</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> (<span class="id"><a href="Qcert.Common.Data.RData.html#data">data</a></span> * <span class="id"><a href="Qcert.Common.Data.RData.html#data">data</a></span>) =&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#snd">snd</a></span> <span class="id"><a href="Qcert.CldMR.Lang.CldMR.html#kvs">kvs</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="Qcert.Utils.Lift.html#lift">lift</a></span> (<span class="kwd">fun</span> <span class="id">t</span>' : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> (<span class="id"><a href="Qcert.Common.Data.RData.html#data">data</a></span> * <span class="id"><a href="Qcert.Common.Data.RData.html#data">data</a></span>) =&gt; (<span class="id"><a href="Qcert.CldMR.Lang.CldMRUtil.html#box_key">box_key</a></span> (<span class="id"><a href="Qcert.CldMR.Lang.CldMR.html#n">n</a></span> :: <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span>), <span class="id"><a href="Qcert.CldMR.Lang.CldMR.html#d">d</a></span>) :: <span class="id">t</span>') <span class="id"><a href="Qcert.CldMR.Lang.CldMR.html#coll">coll</a></span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;= <span class="id"><a href="Qcert.Utils.Lift.html#lift">lift</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#cons">cons</a></span> <span class="id"><a href="Qcert.CldMR.Lang.CldMR.html#d">d</a></span>) (<span class="id"><a href="Qcert.Utils.Lift.html#lift">lift</a></span> (<span class="kwd">fun</span> <span class="id">kvs</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> (<span class="id"><a href="Qcert.Common.Data.RData.html#data">data</a></span> * <span class="id"><a href="Qcert.Common.Data.RData.html#data">data</a></span>) =&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#snd">snd</a></span> <span class="id"><a href="Qcert.CldMR.Lang.CldMR.html#kvs">kvs</a></span>) <span class="id"><a href="Qcert.CldMR.Lang.CldMR.html#coll">coll</a></span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2715')">Proof.</div>
<div class="proofscript" id="proof2715">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">coll</span>; <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
<br/>
<h2> Reduce </h2>
&nbsp;&nbsp;<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="cldmr_step_group_by_eval">cldmr_step_group_by_eval</a></span> (<span class="id">l</span>: <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> (<span class="id"><a href="Qcert.Common.Data.RData.html#data">data</a></span> * <span class="id"><a href="Qcert.Common.Data.RData.html#data">data</a></span>)) : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> (<span class="id"><a href="Qcert.Common.Data.RData.html#data">data</a></span> * (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="Qcert.Common.Data.RData.html#data">data</a></span>)) :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Qcert.Common.Data.RGroupBy.html#group_by_iter_eval_alt">group_by_iter_eval_alt</a></span> <span class="id"><a href="Qcert.CldMR.Lang.CldMR.html#l">l</a></span>.<br/>
<br/>
<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="cldmr_step_aggregate_eval">cldmr_step_aggregate_eval</a></span> (<span class="id">f_reduce</span>: (<span class="id"><a href="Qcert.Common.Env.RVar.html#var">var</a></span> * <span class="id"><a href="Qcert.Common.Env.RVar.html#var">var</a></span>) * <span class="id"><a href="Qcert.cNNRC.Lang.cNNRC.html#nnrc">nnrc</a></span>) (<span class="id">f_rereduce</span>: (<span class="id"><a href="Qcert.Common.Env.RVar.html#var">var</a></span> * <span class="id"><a href="Qcert.cNNRC.Lang.cNNRC.html#nnrc">nnrc</a></span>)) (<span class="id">groups</span>: <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> (<span class="id"><a href="Qcert.Common.Data.RData.html#data">data</a></span> * (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="Qcert.Common.Data.RData.html#data">data</a></span>)))  : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#option">option</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> (<span class="id"><a href="Qcert.Common.Data.RData.html#data">data</a></span> * <span class="id"><a href="Qcert.Common.Data.RData.html#data">data</a></span>)) :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> (<span class="id">key_values_args</span>, <span class="id">body</span>) := <span class="id"><a href="Qcert.CldMR.Lang.CldMR.html#f_reduce">f_reduce</a></span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> (<span class="id">key_arg</span>, <span class="id">values_arg</span>) := <span class="id"><a href="Qcert.CldMR.Lang.CldMR.html#key_values_args">key_values_args</a></span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">f_reduce</span> (<span class="id">key_values_v</span>: <span class="id"><a href="Qcert.Common.Data.RData.html#data">data</a></span> * <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="Qcert.Common.Data.RData.html#data">data</a></span>) : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#option">option</a></span> (<span class="id"><a href="Qcert.Common.Data.RData.html#data">data</a></span> * <span class="id"><a href="Qcert.Common.Data.RData.html#data">data</a></span>) :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> (<span class="id">key_v</span>, <span class="id">values_v</span>) := <span class="id"><a href="Qcert.CldMR.Lang.CldMR.html#key_values_v">key_values_v</a></span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id"><a href="Qcert.cNNRC.Lang.cNNRC.html#nnrc_core_eval">nnrc_core_eval</a></span> <span class="id"><a href="Qcert.CldMR.Lang.CldMR.html#CldMR.h">h</a></span> <span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#empty_cenv">empty_cenv</a></span> ((<span class="id"><a href="Qcert.CldMR.Lang.CldMR.html#values_arg">values_arg</a></span>, <span class="id"><a href="Qcert.Common.Data.RData.html#dcoll">dcoll</a></span> <span class="id"><a href="Qcert.CldMR.Lang.CldMR.html#values_v">values_v</a></span>) :: (<span class="id"><a href="Qcert.CldMR.Lang.CldMR.html#key_arg">key_arg</a></span>, <span class="id"><a href="Qcert.CldMR.Lang.CldMR.html#key_v">key_v</a></span>) :: <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span>) <span class="id"><a href="Qcert.CldMR.Lang.CldMR.html#body">body</a></span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span> =&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">res</span> =&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> (<span class="id"><a href="Qcert.CldMR.Lang.CldMR.html#key_v">key_v</a></span>, <span class="id">res</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">reduced</span> := <span class="id"><a href="Qcert.Common.Data.RRelation.html#rmap">rmap</a></span> <span class="id"><a href="Qcert.CldMR.Lang.CldMR.html#f_reduce">f_reduce</a></span> <span class="id"><a href="Qcert.CldMR.Lang.CldMR.html#groups">groups</a></span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">f_rereduce</span> (<span class="id">key_value_v</span>: (<span class="id"><a href="Qcert.Common.Data.RData.html#data">data</a></span> * <span class="id"><a href="Qcert.Common.Data.RData.html#data">data</a></span>)) : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#option">option</a></span> (<span class="id"><a href="Qcert.Common.Data.RData.html#data">data</a></span> * <span class="id"><a href="Qcert.Common.Data.RData.html#data">data</a></span>) :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> '(<span class="id">key_v</span>, <span class="id">value_v</span>) := <span class="id"><a href="Qcert.CldMR.Lang.CldMR.html#key_value_v">key_value_v</a></span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> '(<span class="id">values_arg</span>, <span class="id">rebody</span>) := <span class="id"><a href="Qcert.CldMR.Lang.CldMR.html#f_rereduce">f_rereduce</a></span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id"><a href="Qcert.cNNRC.Lang.cNNRC.html#nnrc_core_eval">nnrc_core_eval</a></span> <span class="id"><a href="Qcert.CldMR.Lang.CldMR.html#CldMR.h">h</a></span> <span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#empty_cenv">empty_cenv</a></span> ((<span class="id"><a href="Qcert.CldMR.Lang.CldMR.html#values_arg">values_arg</a></span>, <span class="id"><a href="Qcert.Common.Data.RData.html#dcoll">dcoll</a></span> (<span class="id">value_v</span>::<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span>)) :: <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span>) <span class="id">rebody</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span> =&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">res</span> =&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> (<span class="id">key_v</span>, <span class="id">res</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Qcert.Utils.Lift.html#olift">olift</a></span> (<span class="id"><a href="Qcert.Common.Data.RRelation.html#rmap">rmap</a></span> <span class="id"><a href="Qcert.CldMR.Lang.CldMR.html#f_rereduce">f_rereduce</a></span>) <span class="id"><a href="Qcert.CldMR.Lang.CldMR.html#reduced">reduced</a></span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="cloudant_sum_op">cloudant_sum_op</a></span> (<span class="id">typ</span>:<span class="id"><a href="Qcert.CldMR.Lang.CldMR.html#cld_numeric_type">cld_numeric_type</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;:= <span class="kwd">match</span> <span class="id"><a href="Qcert.CldMR.Lang.CldMR.html#typ">typ</a></span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="Qcert.CldMR.Lang.CldMR.html#Cld_int">Cld_int</a></span> =&gt; <span class="id"><a href="Qcert.Common.Operators.RUnaryOps.html#ASum">ASum</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="Qcert.CldMR.Lang.CldMR.html#Cld_float">Cld_float</a></span> =&gt; <span class="id"><a href="Qcert.CldMR.Lang.ForeignCloudant.html#cloudant_float_sum_op">cloudant_float_sum_op</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="cloudant_min_op">cloudant_min_op</a></span> (<span class="id">typ</span>:<span class="id"><a href="Qcert.CldMR.Lang.CldMR.html#cld_numeric_type">cld_numeric_type</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;:= <span class="kwd">match</span> <span class="id"><a href="Qcert.CldMR.Lang.CldMR.html#typ">typ</a></span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="Qcert.CldMR.Lang.CldMR.html#Cld_int">Cld_int</a></span> =&gt; <span class="id"><a href="Qcert.Common.Operators.RUnaryOps.html#ANumMin">ANumMin</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="Qcert.CldMR.Lang.CldMR.html#Cld_float">Cld_float</a></span> =&gt; <span class="id"><a href="Qcert.CldMR.Lang.ForeignCloudant.html#cloudant_float_min_op">cloudant_float_min_op</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="cloudant_max_op">cloudant_max_op</a></span> (<span class="id">typ</span>:<span class="id"><a href="Qcert.CldMR.Lang.CldMR.html#cld_numeric_type">cld_numeric_type</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;:= <span class="kwd">match</span> <span class="id"><a href="Qcert.CldMR.Lang.CldMR.html#typ">typ</a></span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="Qcert.CldMR.Lang.CldMR.html#Cld_int">Cld_int</a></span> =&gt; <span class="id"><a href="Qcert.Common.Operators.RUnaryOps.html#ANumMax">ANumMax</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="Qcert.CldMR.Lang.CldMR.html#Cld_float">Cld_float</a></span> =&gt; <span class="id"><a href="Qcert.CldMR.Lang.ForeignCloudant.html#cloudant_float_max_op">cloudant_float_max_op</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
&nbsp;&nbsp;<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="cldmr_step_reduce_eval">cldmr_step_reduce_eval</a></span> (<span class="id">red_fun</span>: <span class="id"><a href="Qcert.CldMR.Lang.CldMR.html#cld_reduce_fun">cld_reduce_fun</a></span>) (<span class="id">coll</span>: <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> (<span class="id"><a href="Qcert.Common.Data.RData.html#data">data</a></span> * <span class="id"><a href="Qcert.Common.Data.RData.html#data">data</a></span>))  : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#option">option</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> (<span class="id"><a href="Qcert.Common.Data.RData.html#data">data</a></span> * <span class="id"><a href="Qcert.Common.Data.RData.html#data">data</a></span>)) :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id"><a href="Qcert.CldMR.Lang.CldMR.html#red_fun">red_fun</a></span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="Qcert.CldMR.Lang.CldMR.html#CldRedId">CldRedId</a></span> =&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="Qcert.CldMR.Lang.CldMR.html#coll">coll</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="Qcert.CldMR.Lang.CldMR.html#CldRedAggregate">CldRedAggregate</a></span> <span class="id">f_reduce</span> <span class="id">f_rereduce</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">groups</span> := <span class="id"><a href="Qcert.CldMR.Lang.CldMR.html#cldmr_step_group_by_eval">cldmr_step_group_by_eval</a></span> <span class="id"><a href="Qcert.CldMR.Lang.CldMR.html#coll">coll</a></span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Qcert.CldMR.Lang.CldMR.html#cldmr_step_aggregate_eval">cldmr_step_aggregate_eval</a></span> <span class="id">f_reduce</span> <span class="id">f_rereduce</span> <span class="id"><a href="Qcert.CldMR.Lang.CldMR.html#groups">groups</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="Qcert.CldMR.Lang.CldMR.html#CldRedOp">CldRedOp</a></span> <span class="id"><a href="Qcert.CldMR.Lang.CldMR.html#CldRedOpCount">CldRedOpCount</a></span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">uop</span> := <span class="id"><a href="Qcert.Common.Operators.RUnaryOps.html#ACount">ACount</a></span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">v</span> := <span class="id"><a href="Qcert.Common.Operators.RUnaryOpsSem.html#fun_of_unaryop">fun_of_unaryop</a></span> <span class="id"><a href="Qcert.CldMR.Lang.CldMR.html#CldMR.h">h</a></span> <span class="id"><a href="Qcert.CldMR.Lang.CldMR.html#uop">uop</a></span> (<span class="id"><a href="Qcert.Common.Data.RData.html#dcoll">dcoll</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map">List.map</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#snd">snd</a></span> <span class="id"><a href="Qcert.CldMR.Lang.CldMR.html#coll">coll</a></span>)) <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">key</span> := <span class="id"><a href="Qcert.Common.Data.RData.html#dcoll">dcoll</a></span> (<span class="id"><a href="Qcert.Common.Data.RData.html#dnat">dnat</a></span> 0::<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span>) <span class="kwd">in</span> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Qcert.Utils.Lift.html#lift">lift</a></span> (<span class="kwd">fun</span> <span class="id">res</span> =&gt; (<span class="id"><a href="Qcert.CldMR.Lang.CldMR.html#key">key</a></span>, <span class="id"><a href="Qcert.CldMR.Lang.CldMR.html#res">res</a></span>)::<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span>) <span class="id"><a href="Qcert.CldMR.Lang.CldMR.html#v">v</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="Qcert.CldMR.Lang.CldMR.html#CldRedOp">CldRedOp</a></span> (<span class="id"><a href="Qcert.CldMR.Lang.CldMR.html#CldRedOpSum">CldRedOpSum</a></span> <span class="id">typ</span>) =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">uop</span> := <span class="id"><a href="Qcert.CldMR.Lang.CldMR.html#cloudant_sum_op">cloudant_sum_op</a></span> <span class="id">typ</span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">v</span> := <span class="id"><a href="Qcert.Common.Operators.RUnaryOpsSem.html#fun_of_unaryop">fun_of_unaryop</a></span> <span class="id"><a href="Qcert.CldMR.Lang.CldMR.html#CldMR.h">h</a></span> <span class="id"><a href="Qcert.CldMR.Lang.CldMR.html#uop">uop</a></span> (<span class="id"><a href="Qcert.Common.Data.RData.html#dcoll">dcoll</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map">List.map</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#snd">snd</a></span> <span class="id"><a href="Qcert.CldMR.Lang.CldMR.html#coll">coll</a></span>)) <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">key</span> := <span class="id"><a href="Qcert.Common.Data.RData.html#dcoll">dcoll</a></span> (<span class="id"><a href="Qcert.Common.Data.RData.html#dnat">dnat</a></span> 0::<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span>) <span class="kwd">in</span> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Qcert.Utils.Lift.html#lift">lift</a></span> (<span class="kwd">fun</span> <span class="id">res</span> =&gt; (<span class="id"><a href="Qcert.CldMR.Lang.CldMR.html#key">key</a></span>, <span class="id"><a href="Qcert.CldMR.Lang.CldMR.html#res">res</a></span>)::<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span>) <span class="id"><a href="Qcert.CldMR.Lang.CldMR.html#v">v</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="Qcert.CldMR.Lang.CldMR.html#CldRedOp">CldRedOp</a></span> (<span class="id"><a href="Qcert.CldMR.Lang.CldMR.html#CldRedOpStats">CldRedOpStats</a></span> <span class="id">typ</span>) =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">coll</span> := <span class="id"><a href="Qcert.Common.Data.RData.html#dcoll">dcoll</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map">List.map</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#snd">snd</a></span> <span class="id"><a href="Qcert.CldMR.Lang.CldMR.html#coll">coll</a></span>) <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">count</span> := <span class="id"><a href="Qcert.Common.Operators.RUnaryOpsSem.html#fun_of_unaryop">fun_of_unaryop</a></span> <span class="id"><a href="Qcert.CldMR.Lang.CldMR.html#CldMR.h">h</a></span> <span class="id"><a href="Qcert.Common.Operators.RUnaryOps.html#ACount">ACount</a></span> <span class="id"><a href="Qcert.CldMR.Lang.CldMR.html#coll">coll</a></span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">sum</span> := <span class="id"><a href="Qcert.Common.Operators.RUnaryOpsSem.html#fun_of_unaryop">fun_of_unaryop</a></span> <span class="id"><a href="Qcert.CldMR.Lang.CldMR.html#CldMR.h">h</a></span> (<span class="id"><a href="Qcert.CldMR.Lang.CldMR.html#cloudant_sum_op">cloudant_sum_op</a></span> <span class="id">typ</span>) <span class="id"><a href="Qcert.CldMR.Lang.CldMR.html#coll">coll</a></span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">min</span> := <span class="id"><a href="Qcert.Common.Operators.RUnaryOpsSem.html#fun_of_unaryop">fun_of_unaryop</a></span> <span class="id"><a href="Qcert.CldMR.Lang.CldMR.html#CldMR.h">h</a></span> (<span class="id"><a href="Qcert.CldMR.Lang.CldMR.html#cloudant_min_op">cloudant_min_op</a></span> <span class="id">typ</span>) <span class="id"><a href="Qcert.CldMR.Lang.CldMR.html#coll">coll</a></span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">max</span> := <span class="id"><a href="Qcert.Common.Operators.RUnaryOpsSem.html#fun_of_unaryop">fun_of_unaryop</a></span> <span class="id"><a href="Qcert.CldMR.Lang.CldMR.html#CldMR.h">h</a></span> (<span class="id"><a href="Qcert.CldMR.Lang.CldMR.html#cloudant_max_op">cloudant_max_op</a></span> <span class="id">typ</span>) <span class="id"><a href="Qcert.CldMR.Lang.CldMR.html#coll">coll</a></span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">v</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> (<span class="id"><a href="Qcert.CldMR.Lang.CldMR.html#count">count</a></span>, <span class="id"><a href="Qcert.CldMR.Lang.CldMR.html#sum">sum</a></span>, <span class="id"><a href="Qcert.CldMR.Lang.CldMR.html#min">min</a></span>, <span class="id"><a href="Qcert.CldMR.Lang.CldMR.html#max">max</a></span>) <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">count</span>, <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">sum</span>, <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">min</span>, <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">max</span>) =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> (<span class="id"><a href="Qcert.Common.Data.RData.html#drec">drec</a></span> (("<span class="id">count</span>"%<span class="id">string</span>, <span class="id"><a href="Qcert.CldMR.Lang.CldMR.html#count">count</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;::("<span class="id">max</span>"%<span class="id">string</span>, <span class="id"><a href="Qcert.CldMR.Lang.CldMR.html#max">max</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;::("<span class="id">min</span>"%<span class="id">string</span>, <span class="id"><a href="Qcert.CldMR.Lang.CldMR.html#min">min</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;::("<span class="id">sum</span>"%<span class="id">string</span>, <span class="id"><a href="Qcert.CldMR.Lang.CldMR.html#sum">sum</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;::<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">_</span> =&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">key</span> := <span class="id"><a href="Qcert.Common.Data.RData.html#dcoll">dcoll</a></span> (<span class="id"><a href="Qcert.Common.Data.RData.html#dnat">dnat</a></span> 0::<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span>) <span class="kwd">in</span> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Qcert.Utils.Lift.html#lift">lift</a></span> (<span class="kwd">fun</span> <span class="id">res</span> =&gt; (<span class="id"><a href="Qcert.CldMR.Lang.CldMR.html#key">key</a></span>, <span class="id"><a href="Qcert.CldMR.Lang.CldMR.html#res">res</a></span>)::<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span>) <span class="id"><a href="Qcert.CldMR.Lang.CldMR.html#v">v</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="cldmr_step_reduce_flatten_id">cldmr_step_reduce_flatten_id</a></span> (<span class="id">l</span>:<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> (<span class="id"><a href="Qcert.Common.Data.RData.html#data">data</a></span> * <span class="id"><a href="Qcert.Common.Data.RData.html#data">data</a></span>)) :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="Qcert.CldMR.Lang.CldMR.html#cldmr_step_reduce_eval">cldmr_step_reduce_eval</a></span> <span class="id"><a href="Qcert.CldMR.Lang.CldMR.html#CldRedId">CldRedId</a></span> <span class="id"><a href="Qcert.CldMR.Lang.CldMR.html#l">l</a></span>) = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="Qcert.CldMR.Lang.CldMR.html#l">l</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2716')">Proof.</div>
<div class="proofscript" id="proof2716">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
<br/>
<h2> Map/Reduce View </h2>
&nbsp;&nbsp;<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="cldmr_step_eval">cldmr_step_eval</a></span> (<span class="id">mr</span>:<span class="id"><a href="Qcert.CldMR.Lang.CldMR.html#cldmr_step">cldmr_step</a></span>) (<span class="id">coll</span>: <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> (<span class="id"><a href="Qcert.Common.Data.RData.html#data">data</a></span> * <span class="id"><a href="Qcert.Common.Data.RData.html#data">data</a></span>)) : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#option">option</a></span> ((<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> (<span class="id"><a href="Qcert.Common.Data.RData.html#data">data</a></span>*<span class="id"><a href="Qcert.Common.Data.RData.html#data">data</a></span>)) * <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#option">option</a></span> <span class="id"><a href="Qcert.Common.Env.RVar.html#var">var</a></span>) :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">map_result</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Qcert.CldMR.Lang.CldMR.html#cldmr_step_map_eval">cldmr_step_map_eval</a></span> <span class="id"><a href="Qcert.CldMR.Lang.CldMR.html#mr">mr</a></span>.(<span class="id"><a href="Qcert.CldMR.Lang.CldMR.html#cldmr_step_map">cldmr_step_map</a></span>) <span class="id"><a href="Qcert.CldMR.Lang.CldMR.html#coll">coll</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id"><a href="Qcert.CldMR.Lang.CldMR.html#mr">mr</a></span>.(<span class="id"><a href="Qcert.CldMR.Lang.CldMR.html#cldmr_step_reduce">cldmr_step_reduce</a></span>) <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span> =&gt; <span class="id"><a href="Qcert.Utils.Lift.html#lift">lift</a></span> (<span class="kwd">fun</span> <span class="id">x</span> =&gt; (<span class="id"><a href="Qcert.CldMR.Lang.CldMR.html#x">x</a></span>,<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span>)) <span class="id"><a href="Qcert.CldMR.Lang.CldMR.html#map_result">map_result</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">reduce</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">reduce_result</span> := <span class="id"><a href="Qcert.Utils.Lift.html#olift">olift</a></span> (<span class="id"><a href="Qcert.CldMR.Lang.CldMR.html#cldmr_step_reduce_eval">cldmr_step_reduce_eval</a></span> <span class="id">reduce</span>.(<span class="id"><a href="Qcert.CldMR.Lang.CldMR.html#reduce_fun">reduce_fun</a></span>)) <span class="id"><a href="Qcert.CldMR.Lang.CldMR.html#map_result">map_result</a></span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Qcert.Utils.Lift.html#lift">lift</a></span> (<span class="kwd">fun</span> <span class="id">x</span> =&gt; (<span class="id"><a href="Qcert.CldMR.Lang.CldMR.html#x">x</a></span>, <span class="id">reduce</span>.(<span class="id"><a href="Qcert.CldMR.Lang.CldMR.html#reduce_output">reduce_output</a></span>))) <span class="id"><a href="Qcert.CldMR.Lang.CldMR.html#reduce_result">reduce_result</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<br/>
<h2> Map/Reduce Chain </h2>
&nbsp;&nbsp;<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="cld_merge_env">cld_merge_env</a></span> (<span class="id">x</span>: <span class="id"><a href="Qcert.Common.Env.RVar.html#var">var</a></span>) (<span class="id">coll</span>: <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="Qcert.Common.Data.RData.html#data">data</a></span>) (<span class="id">env</span>: <span class="id"><a href="Qcert.Common.Data.RData.html#bindings">bindings</a></span>) : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#option">option</a></span> <span class="id"><a href="Qcert.Common.Data.RData.html#bindings">bindings</a></span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id"><a href="Qcert.Utils.Assoc.html#lookup">lookup</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Classes.EquivDec.html#equiv_dec">equiv_dec</a></span> <span class="id"><a href="Qcert.CldMR.Lang.CldMR.html#env">env</a></span> <span class="id"><a href="Qcert.CldMR.Lang.CldMR.html#x">x</a></span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span> =&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> ((<span class="id"><a href="Qcert.CldMR.Lang.CldMR.html#x">x</a></span>, <span class="id"><a href="Qcert.Common.Data.RData.html#dcoll">dcoll</a></span> <span class="id"><a href="Qcert.CldMR.Lang.CldMR.html#coll">coll</a></span>)::<span class="id"><a href="Qcert.CldMR.Lang.CldMR.html#env">env</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">d</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">d</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="Qcert.Common.Data.RData.html#dcoll">dcoll</a></span> <span class="id">coll</span>' =&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> ((<span class="id"><a href="Qcert.CldMR.Lang.CldMR.html#x">x</a></span>, <span class="id"><a href="Qcert.Common.Data.RData.html#dcoll">dcoll</a></span> (<span class="id"><a href="Qcert.CldMR.Lang.CldMR.html#coll">coll</a></span> ++ <span class="id">coll</span>') )::<span class="id"><a href="Qcert.CldMR.Lang.CldMR.html#env">env</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">_</span> =&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
&nbsp;&nbsp;<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="nnrc_env_of_cld_env">nnrc_env_of_cld_env</a></span> (<span class="id">form</span>:<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="Qcert.Common.Env.RVar.html#var">var</a></span>) (<span class="id">eff</span>: <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#option">option</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="Qcert.Common.Data.RData.html#data">data</a></span>)): <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#option">option</a></span> <span class="id"><a href="Qcert.Common.Data.RData.html#bindings">bindings</a></span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Qcert.Utils.Lift.html#olift">olift</a></span> (<span class="id"><a href="Qcert.Utils.ListAdd.html#zip">zip</a></span> <span class="id"><a href="Qcert.CldMR.Lang.CldMR.html#form">form</a></span>) <span class="id"><a href="Qcert.CldMR.Lang.CldMR.html#eff">eff</a></span>. <br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="effective_params_from_bindings">effective_params_from_bindings</a></span> (<span class="id">eff</span>:<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="Qcert.Common.Env.RVar.html#var">var</a></span>) (<span class="id">cld_env</span>:<span class="id"><a href="Qcert.Common.Data.RData.html#bindings">bindings</a></span>) : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#option">option</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="Qcert.Common.Data.RData.html#data">data</a></span>) :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Qcert.Utils.Lift.html#lift_map">lift_map</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">fun</span> (<span class="id">v</span> : <span class="id"><a href="Qcert.Common.Env.RVar.html#var">var</a></span>) =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id"><a href="Qcert.Utils.Assoc.html#lookup">lookup</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Classes.EquivDec.html#equiv_dec">equiv_dec</a></span> <span class="id"><a href="Qcert.CldMR.Lang.CldMR.html#cld_env">cld_env</a></span> <span class="id"><a href="Qcert.CldMR.Lang.CldMR.html#v">v</a></span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span> =&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">db</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Qcert.Utils.Lift.html#lift">lift</a></span> (<span class="kwd">fun</span> <span class="id">l</span> =&gt; <span class="id"><a href="Qcert.Common.Data.RData.html#dcoll">dcoll</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map">List.map</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#snd">snd</a></span> <span class="id"><a href="Qcert.CldMR.Lang.CldMR.html#l">l</a></span>)) (<span class="id"><a href="Qcert.CldMR.Lang.CldMRUtil.html#unpack_kvl">unpack_kvl</a></span> <span class="id">db</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Qcert.CldMR.Lang.CldMR.html#eff">eff</a></span>.<br/>
&nbsp;&nbsp;<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="cldmr_step_eval_last">cldmr_step_eval_last</a></span> (<span class="id">cld_env</span>:<span class="id"><a href="Qcert.Common.Data.RData.html#bindings">bindings</a></span>) (<span class="id">mr_last</span>: ((<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="Qcert.Common.Env.RVar.html#var">var</a></span>) * <span class="id"><a href="Qcert.cNNRC.Lang.cNNRC.html#nnrc">nnrc</a></span>) * (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="Qcert.Common.Env.RVar.html#var">var</a></span>)) : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#option">option</a></span> <span class="id"><a href="Qcert.Common.Data.RData.html#data">data</a></span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> (<span class="id">formal_params</span>, <span class="id">n</span>) := <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> <span class="id"><a href="Qcert.CldMR.Lang.CldMR.html#mr_last">mr_last</a></span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">effective_params</span> := <span class="id"><a href="Qcert.CldMR.Lang.CldMR.html#effective_params_from_bindings">effective_params_from_bindings</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#snd">snd</a></span> <span class="id"><a href="Qcert.CldMR.Lang.CldMR.html#mr_last">mr_last</a></span>) <span class="id"><a href="Qcert.CldMR.Lang.CldMR.html#cld_env">cld_env</a></span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">onrc_env</span> := <span class="id"><a href="Qcert.CldMR.Lang.CldMR.html#nnrc_env_of_cld_env">nnrc_env_of_cld_env</a></span> <span class="id"><a href="Qcert.CldMR.Lang.CldMR.html#formal_params">formal_params</a></span> <span class="id"><a href="Qcert.CldMR.Lang.CldMR.html#effective_params">effective_params</a></span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Qcert.Utils.Lift.html#olift">olift</a></span> (<span class="kwd">fun</span> <span class="id">nnrc_env</span> =&gt; <span class="id"><a href="Qcert.cNNRC.Lang.cNNRC.html#nnrc_core_eval">nnrc_core_eval</a></span> <span class="id"><a href="Qcert.CldMR.Lang.CldMR.html#CldMR.h">h</a></span> <span class="id"><a href="Qcert.NNRCMR.Lang.NNRCMR.html#empty_cenv">empty_cenv</a></span> <span class="id"><a href="Qcert.CldMR.Lang.CldMR.html#nnrc_env">nnrc_env</a></span> <span class="id"><a href="Qcert.CldMR.Lang.CldMR.html#n">n</a></span>) <span class="id"><a href="Qcert.CldMR.Lang.CldMR.html#onrc_env">onrc_env</a></span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="cldmr_chain_eval_inner">cldmr_chain_eval_inner</a></span> (<span class="id">env</span>:<span class="id"><a href="Qcert.Common.Data.RData.html#bindings">bindings</a></span>) (<span class="id">l</span>:<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="Qcert.CldMR.Lang.CldMR.html#cldmr_step">cldmr_step</a></span>) : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#option">option</a></span> (<span class="id"><a href="Qcert.Common.Data.RData.html#bindings">bindings</a></span> * <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> (<span class="id"><a href="Qcert.Common.Data.RData.html#data">data</a></span> * <span class="id"><a href="Qcert.Common.Data.RData.html#data">data</a></span>)) :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#fold_left">List.fold_left</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">fun</span> (<span class="id">acc</span>: <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#option">option</a></span> (<span class="id"><a href="Qcert.Common.Data.RData.html#bindings">bindings</a></span> * <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> (<span class="id"><a href="Qcert.Common.Data.RData.html#data">data</a></span> * <span class="id"><a href="Qcert.Common.Data.RData.html#data">data</a></span>))) <span class="id">mr</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id"><a href="Qcert.CldMR.Lang.CldMR.html#acc">acc</a></span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span> =&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> (<span class="id">env</span>', <span class="id">_</span>) =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">cld_input</span> := <span class="id"><a href="Qcert.CldMR.Lang.CldMR.html#mr">mr</a></span>.(<span class="id"><a href="Qcert.CldMR.Lang.CldMR.html#cldmr_step_input">cldmr_step_input</a></span>) <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id"><a href="Qcert.Utils.Assoc.html#lookup">lookup</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Classes.EquivDec.html#equiv_dec">equiv_dec</a></span> <span class="id">env</span>' <span class="id"><a href="Qcert.CldMR.Lang.CldMR.html#cld_input">cld_input</a></span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span> =&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">kvl</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">coll</span> := <span class="id"><a href="Qcert.CldMR.Lang.CldMRUtil.html#unpack_kvl">unpack_kvl</a></span> <span class="id">kvl</span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id"><a href="Qcert.Utils.Lift.html#olift">olift</a></span> (<span class="id"><a href="Qcert.CldMR.Lang.CldMR.html#cldmr_step_eval">cldmr_step_eval</a></span> <span class="id"><a href="Qcert.CldMR.Lang.CldMR.html#mr">mr</a></span>) <span class="id"><a href="Qcert.CldMR.Lang.CldMR.html#coll">coll</a></span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span> =&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> (<span class="id">res</span>,<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span>) =&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> (<span class="id"><a href="Qcert.CldMR.Lang.CldMR.html#env">env</a></span>, <span class="id">res</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> (<span class="id">res</span>,<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">x</span>) =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">env</span>'' := <span class="id"><a href="Qcert.CldMR.Lang.CldMR.html#cld_merge_env">cld_merge_env</a></span> <span class="id">x</span> (<span class="id"><a href="Qcert.CldMR.Lang.CldMRUtil.html#pre_pack_kvl">pre_pack_kvl</a></span> <span class="id">res</span>) <span class="id">env</span>' <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Qcert.Utils.Lift.html#olift">olift</a></span> (<span class="kwd">fun</span> <span class="id">env</span> =&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> (<span class="id"><a href="Qcert.CldMR.Lang.CldMR.html#env">env</a></span>, <span class="id">res</span>)) <span class="id">env</span>''<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Qcert.CldMR.Lang.CldMR.html#l">l</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> (<span class="id"><a href="Qcert.CldMR.Lang.CldMR.html#env">env</a></span>,<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span>)).<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="cldmr_eval">cldmr_eval</a></span> (<span class="id">env</span>:<span class="id"><a href="Qcert.Common.Data.RData.html#bindings">bindings</a></span>) (<span class="id">cldmr</span>:<span class="id"><a href="Qcert.CldMR.Lang.CldMR.html#cldmr">cldmr</a></span>) : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#option">option</a></span> <span class="id"><a href="Qcert.Common.Data.RData.html#data">data</a></span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id"><a href="Qcert.CldMR.Lang.CldMR.html#cldmr_chain_eval_inner">cldmr_chain_eval_inner</a></span> <span class="id"><a href="Qcert.CldMR.Lang.CldMR.html#env">env</a></span> <span class="id"><a href="Qcert.CldMR.Lang.CldMR.html#cldmr">cldmr</a></span>.(<span class="id"><a href="Qcert.CldMR.Lang.CldMR.html#cldmr_chain">cldmr_chain</a></span>) <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span> =&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> (<span class="id">env_res</span>, <span class="id">coll</span>) =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Qcert.CldMR.Lang.CldMR.html#cldmr_step_eval_last">cldmr_step_eval_last</a></span> <span class="id">env_res</span> <span class="id"><a href="Qcert.CldMR.Lang.CldMR.html#cldmr">cldmr</a></span>.(<span class="id"><a href="Qcert.CldMR.Lang.CldMR.html#cldmr_last">cldmr_last</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<br/>
<h1> Map/Reduce Chain Library </h1>
<br/>
<div class="doc">The following are built-in map/reduce which are useful for
  translations purposes. </div>
<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Section</span> <span class="id"><a name="CldMR.cldmr_step_library">cldmr_step_library</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="idReduce">idReduce</a></span> (<span class="id">v_out</span>:<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#option">option</a></span> <span class="id"><a href="Qcert.Common.Env.RVar.html#var">var</a></span>) : <span class="id"><a href="Qcert.CldMR.Lang.CldMR.html#cld_reduce">cld_reduce</a></span> := <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Qcert.CldMR.Lang.CldMR.html#mkReduceCld">mkReduceCld</a></span> <span class="id"><a href="Qcert.CldMR.Lang.CldMR.html#CldRedId">CldRedId</a></span> <span class="id"><a href="Qcert.CldMR.Lang.CldMR.html#v_out">v_out</a></span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="collectReduce">collectReduce</a></span> (<span class="id">v_out</span>:<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#option">option</a></span> <span class="id"><a href="Qcert.Common.Env.RVar.html#var">var</a></span>) : <span class="id"><a href="Qcert.CldMR.Lang.CldMR.html#cld_reduce">cld_reduce</a></span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Qcert.CldMR.Lang.CldMR.html#mkReduceCld">mkReduceCld</a></span> (<span class="id"><a href="Qcert.CldMR.Lang.CldMR.html#CldRedAggregate">CldRedAggregate</a></span> (<span class="id"><a href="Qcert.CldMR.Lang.CldMR.html#init_vkey">init_vkey</a></span>, <span class="id"><a href="Qcert.CldMR.Lang.CldMR.html#init_vval">init_vval</a></span>, <span class="id"><a href="Qcert.cNNRC.Lang.cNNRC.html#NNRCVar">NNRCVar</a></span> <span class="id"><a href="Qcert.CldMR.Lang.CldMR.html#init_vval">init_vval</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="Qcert.CldMR.Lang.CldMR.html#init_vval">init_vval</a></span>, <span class="id"><a href="Qcert.cNNRC.Lang.cNNRC.html#NNRCUnop">NNRCUnop</a></span> <span class="id"><a href="Qcert.Common.Operators.RUnaryOps.html#AFlatten">AFlatten</a></span> (<span class="id"><a href="Qcert.cNNRC.Lang.cNNRC.html#NNRCVar">NNRCVar</a></span> <span class="id"><a href="Qcert.CldMR.Lang.CldMR.html#init_vval">init_vval</a></span>))) <span class="id"><a href="Qcert.CldMR.Lang.CldMR.html#v_out">v_out</a></span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="opReduce">opReduce</a></span> (<span class="id">op</span>: <span class="id"><a href="Qcert.CldMR.Lang.CldMR.html#cld_reduce_op">cld_reduce_op</a></span>) (<span class="id">v_out</span>:<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#option">option</a></span> <span class="id"><a href="Qcert.Common.Env.RVar.html#var">var</a></span>) : <span class="id"><a href="Qcert.CldMR.Lang.CldMR.html#cld_reduce">cld_reduce</a></span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Qcert.CldMR.Lang.CldMR.html#mkReduceCld">mkReduceCld</a></span> (<span class="id"><a href="Qcert.CldMR.Lang.CldMR.html#CldRedOp">CldRedOp</a></span> <span class="id"><a href="Qcert.CldMR.Lang.CldMR.html#op">op</a></span>) <span class="id"><a href="Qcert.CldMR.Lang.CldMR.html#v_out">v_out</a></span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="defaultMR">defaultMR</a></span> : <span class="id"><a href="Qcert.CldMR.Lang.CldMR.html#cldmr_step">cldmr_step</a></span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Qcert.CldMR.Lang.CldMR.html#mkMRCld">mkMRCld</a></span> <span class="id"><a href="Qcert.CldMR.Lang.CldMR.html#init_vval">init_vval</a></span> (<span class="id"><a href="Qcert.CldMR.Lang.CldMR.html#mkMapCld">mkMapCld</a></span> (<span class="id"><a href="Qcert.CldMR.Lang.CldMR.html#CldMapId">CldMapId</a></span> (<span class="id"><a href="Qcert.CldMR.Lang.CldMR.html#init_vval">init_vval</a></span>, <span class="id"><a href="Qcert.cNNRC.Lang.cNNRC.html#NNRCConst">NNRCConst</a></span> <span class="id"><a href="Qcert.Common.Data.RData.html#dunit">dunit</a></span>)) (<span class="id"><a href="Qcert.CldMR.Lang.CldMR.html#CldEmitCollect">CldEmitCollect</a></span> (99%<span class="id">nat</span>))) <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span> .<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<br/>
&nbsp;&nbsp;<span class="kwd">End</span> <span class="id"><a href="Qcert.CldMR.Lang.CldMR.html#CldMR.cldmr_step_library">cldmr_step_library</a></span>.<br/>
<br/>
<h1> Toplevel </h1>
<br/>
<div class="doc">Top-level evaluation is used externally by the Q*cert
  compiler. It is parameterized by a given database name for the
  'initial database'. It takes a CldMR chain and a global environment
  as input. </div>
<br/>
&nbsp;&nbsp;<span class="kwd">Section</span> <span class="id"><a name="CldMR.Top">Top</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="cldmr_eval_top">cldmr_eval_top</a></span> (<span class="id">vinit</span>:<span class="id"><a href="Qcert.Common.Env.RVar.html#var">var</a></span>) (<span class="id">q</span>:<span class="id"><a href="Qcert.CldMR.Lang.CldMR.html#cldmr">cldmr</a></span>) (<span class="id">cenv</span>:<span class="id"><a href="Qcert.Common.Data.RData.html#bindings">bindings</a></span>) : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#option">option</a></span> <span class="id"><a href="Qcert.Common.Data.RData.html#data">data</a></span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">cenv</span> := <span class="id"><a href="Qcert.Utils.Bindings.html#rec_sort">rec_sort</a></span> <span class="id"><a href="Qcert.CldMR.Lang.CldMR.html#cenv">cenv</a></span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id"><a href="Qcert.CldMR.Lang.CldMR.html#cld_load_init_env">cld_load_init_env</a></span> <span class="id"><a href="Qcert.CldMR.Lang.CldMR.html#vinit">vinit</a></span> <span class="id"><a href="Qcert.CldMR.Lang.CldMR.html#cenv">cenv</a></span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">cenv</span> =&gt; <span class="id"><a href="Qcert.CldMR.Lang.CldMR.html#cldmr_eval">cldmr_eval</a></span> <span class="id"><a href="Qcert.CldMR.Lang.CldMR.html#cenv">cenv</a></span> <span class="id"><a href="Qcert.CldMR.Lang.CldMR.html#q">q</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span> =&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">End</span> <span class="id"><a href="Qcert.CldMR.Lang.CldMR.html#CldMR.Top">Top</a></span>.<br/>
&nbsp;&nbsp;<br/>
<span class="kwd">End</span> <span class="id"><a href="Qcert.CldMR.Lang.CldMR.html#CldMR">CldMR</a></span>.<br/>
<br/>

</div>
<div class="footer"><hr/>Generated by <a href="https://github.com/xavierleroy/coq2html/">coq2html</div>
</body>
</html>
